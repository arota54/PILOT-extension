//  Apache doesn't output an error message if it can't find   a program 
//  from commons logging. This would be my number one reason why java.util.logging   is bad - design by committee can be really bad ! The impact on performance of   using java.util.logging - and the ugliness if you need to wrap it - is far   worse than the unfriendly and uncommon default format for logs. 
// REMIND: rewrite multiple headers as if received as single  REMIND: change character set  REMIND: I forgot what the previous REMIND means 
/*      * Wait for Acknowledgement from other server.     * FIXME Please, not wait only for three characters, better control that the wait ack message is correct.     * @throws IOException An IO error occurred      */
/*      * Convert to char[] and fill the CharChunk.     * XXX Not optimized - it converts to String first.      */
//  FIXME - behavior if already started? 
//  TODO   - Should only use body encoding if useBodyEncodingForURI is true   - Otherwise, should use URIEncoding   - The problem is that the connector is not available...   - To add to the fun, the URI default changed in Servlet 4.0 to UTF-8 
//  TODO: This isn't pretty but it works. Significant refactoring would         be required to avoid the exception. 
/*  * A <b>Cluster </b> implementation using simple multicast. Responsible for * setting up a cluster and provides callers with a valid multicast * receiver/sender. * * FIXME wrote testcases * * @author Remy Maucherat * @author Peter Rossbach  */
/*      * This only works for tokens. Quoted strings need more sophisticated     * parsing.      */
/*  * This is a very basic ASN.1 parser that provides the limited functionality * required by Tomcat. It is a long way from a complete parser. * * TODO: Consider extending this parser and refactoring the SpnegoTokenFixer to *       use it.  */
//  XXX ENCODING - this only works if encoding is UTF8-compat   ( ok for tomcat, where we compare ascii - header names, etc )!!! 
//  FIXME - should we validate the return type? 
//  Only try to negotiate if both client and server have at least   one protocol in common   Note: Tomcat does not explicitly negotiate http/1.1   TODO: Is this correct? Should it change? 
//  FIXME How inform other session id cache like SingleSignOn 
/*          * Any call to this method is a result of a problem reading from the         * client. At this point that state of the connection is unknown.         * Attempt to send a close frame to the client and then close the socket         * immediately. There is no point in waiting for a close frame from the         * client because there is no guarantee that we can recover from         * whatever messed up state the client put the connection into.          */
//  FIXME At sender ack mode this method check only the state         transfer and resend is a problem! 
//  If sessions already exist in DB, remove and insert again.   TODO:   * Check if ID exists in database and if so use UPDATE.
//  Doesn't work on all platforms - see BZ 56448. 
/*                      * FIXME: should probably be checking for things like                     * pageContext, bodyContent, and parent here -akv                      */
//  Calling code should ensure that there is no data in the buffers for   non-blocking writes.   TODO Validate the assertion above
/*  I don't know how to evaluate this!  */
/*      * This method should only be called if there is no chance that the socket     * is currently being used by the Poller. It is generally a bad idea to call     * this directly from a known error condition.      */
//  XXX   making these absolute till we work out the   addition of a PathInfo issue 
//  TODO: Do we need to think about precedence of the various ways         a lambda expression may be obtained from something that         the parser thinks is a function? 
//  "surrogate" - UTF is _not_ 16 bit, but 21 !!!!   ( while UCS is 31 ). Amazing... 
//  PROTOCOL_ERROR is probably better than GOING_AWAY here 
//  XXX   should give more detail about the illegal argument 
//  TODO URLs returned by the Jar abstraction may be of the form jar:jar:        which is not a URL that can be resolved by the JRE. This should        use the JarFactory to construct and return a valid InputSource. 
//  TODO: Name validation takes place in Cookie and cannot be configured         per Context. Moving it to here would allow per Context config         but delay validation until the header is generated. However,         the spec requires an IllegalArgumentException on Cookie 
//  Do not do this at home. The unconstrained buffer is a DoS risk. 
//  Size is supposed to be 33 without huffman, or 27 with it   TODO: use the HpackHeaderFunction to enable huffman predictably 
//  Stupid - this will set the default minfo first.... 
//  Work around a problem with the URLs in the security policy file.   On Windows, the use of ${catalina.[home|base]} in the policy file   results in codebase URLs of the form file:C:/... when they should   be file:/C:/...   For file: and jar: URLs, the JRE compensates for this. It does not   compensate for this for war:file:... URLs. Therefore, we do that   here 
//  The Range header is present but not formatted correctly.   Could argue for a 400 response but 416 is more specific.   There is also the option to ignore the (invalid) Range header.   RFC7233#4.4 notes that many servers do ignore the Range header in   these circumstances but Tomcat has always returned a 416. 
//  TODO: should we use the Ant Project's log? 
//  TODO: Should the createWebResourceSet() methods be removed to some         utility class for file system based resource sets? 
// I'm not sure this is always exactly the same 
/*  Initial size - should be == average number of headers per request     *  XXX  make it configurable ( fine-tuning of web-apps )      */
/*     * sendMessage    *    * @param data ChannelMessage    * @throws IOException    * TODO Implement this org.apache.catalina.tribes.transport.IDataSender method     */
/*      * Configure the connection pool to use a DataSource according to {@link PoolConfiguration#setDataSource(Object)}     * But instead of injecting the object, specify the JNDI location.     * After a successful JNDI look, the {@link PoolConfiguration#getDataSource()} will not return null.     * @param jndiDS -the JNDI string @TODO specify the rules here.      */
//  TODO: Find a better solution than this variable 
// make an assumption that an empty response is a failure. This is   a problem   if a truly empty file 
//  FIXME (if possible): Not available in the OpenSSL API 
/*      * TODO SERVLET3 - Add comments     * @param <T> TODO     * @param t   TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  FIXME - log configuration problem 
/*      * @return TODO     * @since Servlet 3.0 TODO SERVLET3 - Add comments      */
//  TODO: Tests for unexpected flags. Better located in tests for section 6? 
// There's no way to specify the century in SimpleDateFormat.  We don't want to hard-code  20 since this could be wrong for the pre-2000 files. 
//  XXX Should be moved to embedded 
// synchronize, big time FIXME 
// todo implement  should only return keys where this is active. 
//  Socket write buffer is empty. Write the provided buffer directly   to the network.   TODO Shouldn't smaller writes be buffered anyway? 
//  XXX we shouldn't assume that the only kind of POST body   is FORM data encoded using ASCII or ISO Latin/1 ... or 
/*      * TODO SERVLET3 - Add comments     * @param <T> TODO     * @param c   TODO     * @return TODO     * @throws ServletException TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  should notify pool of error so the pooled connection can   be removed !FIXME! 
//  16 MB should be more than enough for Tomcat   TODO: Refactoring this entire class so it uses streaming rather than         buffering the entire set of files in memory would make it more         widely useful. 
//  The JDBC spec requires that a statement closes any open   ResultSet's when it is closed.   FIXME The PreparedStatement we're wrapping should handle this for us. 
//  This is a hack that won't work generally as servlets are expected to   handle more than one request. 
/*              * Error line number is delimited by set of colons.             * Ignore colon following drive letter on Windows (fromIndex = 2).             * XXX Handle deprecation warnings that don't have line info              */
//  The JDBC spec requires that a statement close any open   ResultSet's when it is closed.   FIXME The PreparedStatement we're wrapping should handle this for us.   See DBCP-10 for what could happen when ResultSets are closed twice. 
/*  * A message that represents a drawing action. * Note that we use primitive types instead of Point, Color etc. * to reduce object allocation.<br><br> * * TODO: But a Color objects needs to be created anyway for drawing this * onto a Graphics2D object, so this probably does not save much.  */
//  FIXME: Feature idea. Add support for patterns (ex: WEB-INF/*,          WEB-INF/*.xml), where we would only check if at least one          resource is newer than app.timestamp 
// Jasper incorrectly SMAPs certain Nodes, giving them an  outputStartLine of 0.  This can cause a fatal error in  optimizeLineSection, making it impossible for Jasper to  compile the JSP.  Until we can fix the underlying
//  XXX TODO: Source code line length   XXX TODO: More JavaDoc   XXX Optional: Add support for com.sun.management specific mbean                 (http://docs.oracle.com/javase/7/docs/jre/api/management/extension/index.html)   XXX Optional: Wire additional public static methods implemented here                 to the manager (think about manager access roles!)                   setLoggerLevel(),                   setVerboseClassLoading(),                   setThreadContentionMonitoringEnabled(),                   setThreadCpuTimeEnabled(),                   resetPeakThreadCount(),                   setVerboseGarbageCollection()                   gc(),                   resetPeakUsage(),                   setUsageThreshold(),                   setCollectionUsageThreshold() 
/*      * TODO SERVLET3 - Add comments     * @param className TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  XXX Group ?? Use Group + Type 
//  Hack the output buffer to extend the EOS marker for the header value   by another byte 
/*      * Get JMX Broadcaster Info     * FIXME: This two events we not send j2ee.state.failed and j2ee.attribute.changed!     * @see javax.management.NotificationBroadcaster#getNotificationInfo()      */
/*      * keepalive     *     * @return boolean     * TODO Implement this org.apache.catalina.tribes.transport.DataSender method      */
//  Has it been previously resolved? 
//  TODO add other attributes
//  TODO: These certificate setters can be removed once it is no longer   necessary to support the old configuration attributes (Tomcat 10?). 
/*      * memberAdded     *     * @param member Member     * TODO Implement this org.apache.catalina.tribes.MembershipListener     *   method      */
//  End of Tomcat specific hack 
//  FIXME add Loader.getObjectName 
//  TODO Figure out why non-blocking writes with the NIO connector appear 
//               case 0 : // impossible, as excluded above   6 bits - ignore entirely   TODO not currently tested; perhaps it is impossible? 
//  FIXME - should we do anything besides log these? 
//  TODO: Add tests for the individual operators 
//  XXX   warning: rather sticky code; heavily tuned 
// NB:  Trailing whitespace on these header strings will just be discarded. 
//  Assume the GSSContext is stateless   TODO: Confirm this assumption 
/*      * Provide default configuration for a context. This is the programmatic     * equivalent of the default web.xml.     *     *  TODO: in normal Tomcat, if default-web.xml is not found, use this     *  method     *     * @param contextPath   The context to set the defaults for      */
/*  * A smart implementation of a stateful replicated map. uses primary/secondary backup strategy. * One node is always the primary and one node is always the backup. * This map is synchronized across a cluster, and only has one backup member.<br> * A perfect usage for this map would be a session map for a session manager in a clustered environment.<br> * The only way to modify this list is to use the <code>put, putAll, remove</code> methods. * entrySet, entrySetFull, keySet, keySetFull, returns all non modifiable sets.<br><br> * If objects (values) in the map change without invoking <code>put()</code> or <code>remove()</code> * the data can be distributed using two different methods:<br> * <code>replicate(boolean)</code> and <code>replicate(Object, boolean)</code><br> * These two methods are very important two understand. The map can work with two set of value objects:<br> * 1. Serializable - the entire object gets serialized each time it is replicated<br> * 2. ReplicatedMapEntry - this interface allows for a isDirty() flag and to replicate diffs if desired.<br> * Implementing the <code>ReplicatedMapEntry</code> interface allows you to decide what objects * get replicated and how much data gets replicated each time.<br> * If you implement a smart AOP mechanism to detect changes in underlying objects, you can replicate * only those changes by implementing the ReplicatedMapEntry interface, and return true when isDiffable() * is invoked.<br><br> * * This map implementation doesn't have a background thread running to replicate changes. * If you do have changes without invoking put/remove then you need to invoke one of the following methods: * <ul> * <li><code>replicate(Object,boolean)</code> - replicates only the object that belongs to the key</li> * <li><code>replicate(boolean)</code> - Scans the entire map for changes and replicates data</li> *  </ul> * the <code>boolean</code> value in the <code>replicate</code> method used to decide * whether to only replicate objects that implement the <code>ReplicatedMapEntry</code> interface * or to replicate all objects. If an object doesn't implement the <code>ReplicatedMapEntry</code> interface * each time the object gets replicated the entire object gets serialized, hence a call to <code>replicate(true)</code> * will replicate all objects in this map that are using this node as primary. * * <br><br><b>REMEMBER TO CALL</b> <code>breakdown()</code> or <code>finalize()</code> when you are done with the map to * avoid memory leaks.<br><br> * TODO implement periodic sync/transfer thread * * @param <K> The type of Key * @param <V> The type of Value  */
//  FIXME : Facade this object ? 
//  TODO - Various, icon, description etc elements are skipped - mainly          because they are ignored when web.xml is parsed - see above 
/*      * Load sessions from other cluster node.     * FIXME replace currently sessions with same id without notification.     * FIXME SSO handling is not really correct with the session replacement!     * @param data Serialized data     * @exception ClassNotFoundException     *                if a serialized class cannot be found during the reload     * @exception IOException     *                if an input/output error occurs      */
//  Not strictly true but enables us to report both 
// XXX Please check. 
/*      * disconnect     *     * TODO Implement this org.apache.catalina.tribes.transport.IDataSender method      */
/*      * Convert string to datatype FIXME How we can transfer values from ant     * project reference store (ref)?     *     * @param value The value     * @param valueType The type     * @return The converted object      */
//  it is also possible that the user modified jre/lib/logging.properties -   but that's really stupid in most cases 
// always disconnect UDP, TODO optimize the keepalive handling 
//  -------------------- Additional methods --------------------   XXX What do we do about charset ???? 
//  This isn't good. 
//  Hack to work-around JarInputStream swallowing these   entries. TomcatJarInputStream is used above which   extends JarInputStream and the method that creates   the entries over-ridden so we can a) tell if the   entries are present and b) cache them so we can   access them here. 
//  Not ideal. This will indicate that data is available   which should trigger a read which in turn will trigger   another IOException and that one can be thrown. 
//  TODO: description (multiple with language) is ignored 
//  Hack (?) to get the stack trace. 
//  servlet   TODO: description (multiple with language) is ignored   TODO: display-name (multiple with language) is ignored   TODO: icon (multiple) is ignored   TODO: init-param/description (multiple with language) is ignored 
//  FIXME this stats update are not cheap!! 
//  NamingManager.getObjectInstance would simply return the reference here   Use the configured object factory to resolve it directly if possible   Note: This may need manual constructor reflection configuration 
//  This is the hard-coded default - ignore the call 
//  XXX Should be moved to embedded ! 
/*      * Returns the contents of the file as a String, using the default     * character encoding.  This method uses {@link #get()} to retrieve the     * contents of the file.     *     * <b>TODO</b> Consider making this method throw UnsupportedEncodingException.     *     * @return The contents of the file, as a string.      */
/*      * TODO SERVLET3 - Add comments     * @param wrapped The request to compare to the wrapped request     * @return <code>true</code> if the request wrapped by this wrapper (or     *         series of wrappers) is the same as the supplied request,     *         otherwise <code>false</code>     * @since Servlet 3.0      */
/*  Get JMX Broadcaster Info     * @TODO use StringManager for international support!     * @TODO This two events we not send j2ee.state.failed and j2ee.attribute.changed!     * @see javax.management.NotificationBroadcaster#getNotificationInfo()      */
//  Close the socket, as the response would be incomplete 
/*      * memberDisappeared     *     * @param member Member     * TODO Implement this org.apache.catalina.tribes.MembershipListener     *   method      */
//  FIXME - currently this removes *all* notifications for this listener 
/*      * process filter annotation and merge with existing one!     * FIXME: refactoring method too long and has redundant subroutines with     *        processAnnotationWebServlet!     * @param className The filter class name     * @param ae The filter annotation     * @param fragment The corresponding fragment      */
//  FIXME - It is tempting to use request.getRequestDispatcher() to   resolve a relative path directly, but Catalina currently does not   take into account whether the caller is inside a RequestDispatcher   include or not.  Whether Catalina *should* take that into account   is a spec issue currently under review.  In the mean time,   replicate Jasper's previous behavior 
// todo, implement a counter variable instead  only count active members in this node 
// FIXME ? 
//  TODO: Async requests may trigger multiple replication requests. How,         if at all, should the stats handle this? 
//  TODO Consider changing this to a single property for 3.x 
//  The JDBC spec requires that a statement close any open   ResultSet's when it is closed.   FIXME The PreparedStatement we're wrapping should handle this for us.   See bug 17301 for what could happen when ResultSets are closed twice. 
/*      * @return TODO     * @throws IllegalStateException If async is not supported for this request     * @since Servlet 3.0 TODO SERVLET3 - Add comments      */
/*      * This is a hack.     * We need to use streaming to avoid OOME on large uploads.     * We'd like to use Authenticator.setDefault() for authentication as the JRE     * then provides the DIGEST client implementation.     * However, the above two are not compatible. When the request is made, the     * resulting 401 triggers an exception because, when using streams, the     * InputStream is no longer available to send with the repeated request that     * now includes the appropriate Authorization header.     * The hack is to make a simple OPTIONS request- i.e. without a request     * body.     * This triggers authentication and the requirement to authenticate for this     * host is cached and used to provide an appropriate Authorization when the     * next request is made (that includes a request body).      */
//  XXX - A possible optimization here would be to check to see   if the only child of the parent node is TemplateText. If so,   we know there won't be any parameters, etc, so we can   generate a low-overhead JspFragment that just echoes its   body. The implementation of this fragment can come from 
//  FIXME: the regular processor syncs on socketWrapper, but here this deadlocks 
/*      * connect     *     * @throws IOException     * TODO Implement this org.apache.catalina.tribes.transport.DataSender method      */
//  TODO: The method should already be accessible here but the following   code seems to be necessary in some as yet not fully understood cases. 
//  Conversion often results fewer/more/different bytes.   That does not play nicely with range requests. 
/*      * TODO: would a properties resource be better ? Or just parsing     * /etc/mime.types ?     * This is needed because we don't use the default web.xml, where this     * is encoded.      */
/*      * TODO SERVLET3 - Add comments     * @param <T> TODO     * @param c   TODO     * @return TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @throws ServletException TODO     * @since Servlet 3.      */
//  TODO: this matches the current implementation but the URL logic looks fishy   map URI to location per JSP 7.3.6.2 
//  XXX - We use a proprietary call to the interpreter for now   as the current standard machinery is inefficient and requires   lots of wrappers and adapters. This should all clear up once   the EL interpreter moves out of JSTL and into its own project.   In the future, this should be replaced by code that calls   ExpressionEvaluator.parseExpression() and then cache the resulting   expression objects. The interpreterCall would simply select   one of the pre-cached expressions and evaluate it.   Note that PageContextImpl implements VariableResolver and   the generated Servlet/SimpleTag implements FunctionMapper, so   that machinery is already in place (mroth). 
//  Note this is a hack since nextChar only returns a single char   It is safe since <% does not require special treatment for EL   or for literals 
/*      * @return TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     *     * @since Servlet 3.0 TODO SERVLET3 - Add comments      */
//  TODO add other attributes   TODO encapsulate state and other attribute display in parent 
//  FIXME we have a lot of sends, but the trouble with one node stops the correct replication to other nodes! 
//  XXX to implement 
// FIXME check url or host/parameter 
//  TODO: Can this limitation be removed? 
//  FIXME better is to grap this sessions again ! 
/*          * The test below deliberately uses != to compare two Strings. This is         * because the code is looking to see if the default character encoding         * has been returned because no explicit character encoding has been         * defined. There is no clean way of doing this via the Servlet API. It         * would be possible to add a Tomcat specific API but that would require         * quite a bit of code to get to the Tomcat specific request object that         * may have been wrapped. The != test is a (slightly hacky) quick way of         * doing this.          */
//  XXX - Actually there is no need to declare those   "_jspx_" + varName + "_" + nestingLevel variables when we are   inside a JspFragment. 
//  XXX - Fixed a bug here - width and height can be set   dynamically. Double-check if this generation is correct. 
//  Ugly but the easiest way to test of the session is valid or not 
//  TODO: lazy init for the temp dir - only when a JSP is compiled or   get temp dir is called we need to create it. This will avoid the   need for the baseDir 
// were using a shared channel, document says its thread safe  TODO check optimization, one channel per thread? 
//  FIXME: Older spec revisions may still check this 
/*      * connect - blocking in this operation     *     * @throws IOException     * TODO Implement this org.apache.catalina.tribes.transport.IDataSender method      */
//  XXX   should a length of 0 be an IllegalArgumentException
//  TODO Add a new state to the AsyncStateMachine and remove        ASYNC_END (if possible)
//  Note: Hard-coded domain used since this object is per Server/JVM 
//  TODO - May need to add code here once additional   states are used
/*  * Changes from commons.modeler: * *  - use DynamicMBean *  - remove methods not used in tomcat and redundant/not very generic *  - must be created from the ManagedBean - I don't think there were any direct *    uses, but now it is required. *  - some of the gratuitous flexibility removed - instead this is more predictive and *    strict with the use cases. *  - all Method and metadata is stored in ManagedBean. BaseModelBMean and ManagedBean act *    like Object and Class. *  - setModelMBean is no longer called on resources ( not used in tomcat ) *  - no caching of Methods for now - operations and setters are not called repeatedly in most *  management use cases. Getters shouldn't be called very frequently either - and even if they *  are, the overhead of getting the method should be small compared with other JMX costs ( RMI, etc ). *  We can add getter cache if needed. *  - removed unused constructor, fields * *  TODO: *   - clean up catalina.mbeans, stop using weird inheritance  */
//  Number of tries is the number of attempts to connect to the database   during this login attempt (if we need to open the database)   This needs rewritten wuth better pooling support, the existing code   needs signature changes since the Prepared statements needs cached   with the connections.   The code below will try twice if there is an SQLException so the   connection may try to be opened again. On normal conditions (including 
/*      * The player that is associated with this Endpoint and the current room.     * Note that this variable is only accessed from the Room Thread.<br><br>     *     * TODO: Currently, Tomcat uses an Endpoint instance once - however     * the java doc of endpoint says:     * "Each instance of a websocket endpoint is guaranteed not to be called by     * more than one thread at a time per active connection."     * This could mean that after calling onClose(), the instance     * could be reused for another connection so onOpen() will get called     * (possibly from another thread).<br>     * If this is the case, we would need a variable holder for the variables     * that are accessed by the Room thread, and read the reference to the holder     * at the beginning of onOpen, onMessage, onClose methods to ensure the room     * thread always gets the correct instance of the variable holder.      */
//  TODO could be simplified if there is no requirement to reject invalid line sep when length <=0 
//  TLS 1.0 needs additional handling   TODO Figure out why this is necessary and if a simpler / better 
//  This method is deprecated and for good reason. This   is very risky code but is the only option at this   point. A *very* good reason for apps to do this   clean-up themselves. 
/*      * Class name of the generated file ( without package ).     * Can only be used if a single file is converted.     * XXX Do we need this feature ?     * @param p New value      */
//  TODO: Should support multiple icon elements ??? 
//  hack fix for resolveRelativeURI 
//  '*' has been added without removing other values. Optimise. 
/*      * TODO: Add support for more efficient bulk operations.     *     * We don't want to acquire the lock for every iteration, but we     * also want other threads a chance to interact with the     * collection, especially when count is close to capacity.      */
/*      * XXX Find if the 'className' is the name of the MBean or     *       the real class ( I suppose first )     * XXX Read (optional) descriptions from a .properties, generated     *       from source     * XXX Deal with constructors     *     * @param registry The Bean registry (not used)     * @param domain The bean domain (not used)     * @param realClass The class to analyze     * @param type The bean type     * @return ManagedBean The create MBean      */
//  FIXME - Accessible methods in superinterfaces? 
//    XXX NOTE: This is clearly incorrect for many strings,   but is the only consistent approach within the current   servlet framework. It must suffice until servlet output   streams properly encode their output.     high order byte must be zero 
//  Warning: JSP attribute escaping != Java String escaping   TODO - Currently we allow a single unescaped \ in attribute values 
//  FIXME: Strange why servletDef is Boolean and FilterDef is String? 
//  Workaround for certain files on platforms that use   EBCDIC encoding, when they are read through FileInputStream.   See commit message of rev.303915 for original details   https://svn.apache.org/viewvc?view=revision&revision=303915 
//  Nasty - instrument PooledConnection to drive time measurement instead of hard-coded System.currentTimeMillis() 
//  Hack via a static since we can't pass an instance in the test. 
/*              * REMIND:  this method feels too big; should it be re-written?              */
/*  * @since Servlet 3.0 * TODO SERVLET3 - Add comments  */
//  TODO: This certificate setter can be removed once it is no longer   necessary to support the old configuration attributes (Tomcat 10?).
//  XXX Not sure whether the following MBeans should better   be retrieved on demand, i.e. whether they can change   dynamically in the MBeanServer. 
/*      * Checks to see if there are any writes pending and if there are calls     * {@link #registerWriteInterest()} to trigger a callback once the pending     * writes have completed.     * <p>     * Note: Once this method has returned <code>false</code> it <b>MUST NOT</b>     *       be called again until the pending write has completed and the     *       callback has been fired.     *       TODO: Modify {@link #registerWriteInterest()} so the above     *       restriction is enforced there rather than relying on the caller.     *     * @return <code>true</code> if no writes are pending and data can be     *         written otherwise <code>false</code>      */
//  TODO Move this validation to the parsing stage
/*      * @param servletRequest    The ServletRequest with which to initialise the     *                          asynchronous context     * @param servletResponse   The ServletResponse with which to initialise the     *                          asynchronous context     * @return TODO     * @throws IllegalStateException If async is not supported for this request     * @since Servlet 3.0 TODO SERVLET3 - Add comments      */
//  TODO: I'm not entirely sure when onError should be called 
/*      * Add a context - programmatic mode, no default web.xml used. This means     * that there is no JSP support (no JSP servlet), no default servlet and     * no web socket support unless explicitly enabled via the programmatic     * interface. There is also no     * {@link javax.servlet.ServletContainerInitializer} processing and no     * annotation processing. If a     * {@link javax.servlet.ServletContainerInitializer} is added     * programmatically, there will still be no scanning for     * {@link javax.servlet.annotation.HandlesTypes} matches.     *     * <p>     * API calls equivalent with web.xml:     *     * <pre>{@code     *  // context-param     *  ctx.addParameter("name", "value");     *     *     *  // error-page     *  ErrorPage ep = new ErrorPage();     *  ep.setErrorCode(500);     *  ep.setLocation("/error.html");     *  ctx.addErrorPage(ep);     *     *  ctx.addMimeMapping("ext", "type");     * }</pre>     *     *     * <p>     * Note: If you reload the Context, all your configuration will be lost. If     * you need reload support, consider using a LifecycleListener to provide     * your configuration.     *     * <p>     * TODO: add the rest     *     * @param contextPath The context mapping to use, "" for root context.     * @param docBase Base directory for the context, for static files.     *  Must exist, relative to the server home     * @return the deployed context      */
/*      * TODO SERVLET3 - Add comments     * @param filterName TODO     * @return TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  TODO: Remove the internal representation and use Ranges
/*      * Indicate whether the session has been idle for longer     * than its expiration date as of the supplied time.     *     * FIXME: Probably belongs in the Session class.     * @param session The session to check     * @param timeNow The current time to check for     * @return <code>true</code> if the session is past its expiration      */
/*      * Proprietary method to evaluate EL expressions. XXX - This method should     * go away once the EL interpreter moves out of JSTL and into its own     * project. For now, this is necessary because the standard machinery is too     * slow.     *     * @param expression     *            The expression to be evaluated     * @param expectedType     *            The expected resulting type     * @param pageContext     *            The page context     * @param functionMap     *            Maps prefix and name to Method     * @return The result of the evaluation     * @throws ELException If an error occurs during the evaluation      */
//  FIXME : Removing status pages 
/*  Destroy needs to clean up the context completely.     *     * The problem is that undoing all the config in start() and restoring     * a 'fresh' state is impossible. After stop()/destroy()/init()/start()     * we should have the same state as if a fresh start was done - i.e     * read modified web.xml, etc. This can only be done by completely     * removing the context object and remapping a new one, or by cleaning     * up everything.     *     * XXX Should this be done in stop() ?     *      */
//  filter   TODO: Should support multiple description elements with language   TODO: Should support multiple display-name elements with language   TODO: Should support multiple icon elements 
// todo, optimize, if destination.length==1, then we can do  msg.setOptions(msg.getOptions() & (~getOptionFlag())  and just send one message
//  This is not optimal, but as this is not very common, it   shouldn't matter 
//  XXX - Another possible optimization would be for   lone EL expressions (no need to pushBody here either). 
//  TODO:   OpenSSL 1.0.2's ALPN callback doesn't support   failing the handshake with an error if no   protocol can be negotiated. Therefore, we need to   fail the connection here. Once this is fixed,   replace the code below with the commented out   block. 
//  FIXME - should we use the signature from opInfo? 
/*      * @return TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0 TODO SERVLET3 - Add comments      */
//  Read the body - quick and dirty 
//  FIXME: Exception handling needs to be similar to what is in the StandardWrapperValue 
// TODO: figure out a good value for this 
/*      * TODO SERVLET3 - Add comments     * @param wrappedType The class to compare to the class of the wrapped     *                    response     * @return <code>true</code> if the response wrapped by this wrapper (or     *         series of wrappers) is the same type as the supplied type,     *         otherwise <code>false</code>     * @since Servlet 3.0      */
/*  * Implementation of SSLSupport for APR. * <p> * TODO: Add a mechanism (or figure out how to use what we already have) to *       invalidate the session.  */
//  FIXME: Smarter algorithm (LRU) 
//  FIXME: Review lowercase policy 
//  Note: This could be more efficient with a dedicated Mapper         method but such an implementation would require some         refactoring of the Mapper to avoid copy/paste of         existing code. 
/*      * Note: The statistics are volatile to ensure the concurrent updates do not     *       corrupt them but it is still possible that:     *       - some updates may be lost;     *       - the individual statistics may not be consistent which each other.     *       This is a deliberate design choice to reduce the requirement for     *       synchronization.      */
//  TODO: Review this in light of HTTP/2 
//  This isn't perfect but it is a reasonable guess for the size of the 
/*  * TODO SERVLET3 - Add comments * @since Servlet 3.0  */
//  Going to have to have some casts /raw types somewhere so doing it here   keeps them all in one place. There might be a neater / better solution 
/*      * Filter out the default watched resources, to remove standard ones.     *     * @param context The context instance     * @param wresources The raw watched resources list     * @return The filtered watched resources     * @throws Exception Configuration storing error     * TODO relative watched resources     * TODO absolute handling configFile     * TODO Filename case handling for Windows?     * TODO digester variable substitution $catalina.base, $catalina.home      */
//  Unsupported transfer encoding   501 - Unimplemented 
//  NOTE: We don't try to reauthenticate using any existing SSO session,   because that will only work if the original authentication was   BASIC or FORM, which are less secure than the CLIENT-CERT auth-type   specified for this webapp     Change to true below to allow previous FORM or BASIC authentications   to authenticate users for this webapp   TODO make this a configurable attribute (in SingleSignOn??)
//  service-ref   TODO: Should support multiple description elements with language   TODO: Should support multiple display-names elements with language 
/*          * Not thread-safe. OK for this test. NOt OK for use in the real world.          */
//  @TODO is this case possible? 
//  If the only body element for this named attribute node is   template text, we need not generate an extra call to   pushBody and popBody. Maybe we can further optimize   here by getting rid of the temporary variable, but in   reality it looks like javac does this for us. 
//  No listener called dispatch() or complete(). This is an error.   SRV.2.3.3.3 (search for "error dispatch")   Take a local copy to avoid threading issues if another thread   clears this (can happen during error handling with non-container   threads) 
//  FIXME - add instance if already started? 
//  TODO - Should never happen
// TODO this operation is not thread safe 
//  ignored TODO perhaps add to tracker delete failure list somehow? 
//  Note this is a hack since nextChar only returns a single char   It is safe since %> does not require special treatment for EL   or for literals 
/*          * Temporary hack. If a JSP page uses the "extends" attribute of the         * page directive, the _jspInit() method of the generated servlet class         * will not be called (it is only called for those generated servlets         * that extend HttpJspBase, the default), causing the tag handler pools         * not to be initialized and resulting in a NPE. The JSP spec needs to         * clarify whether containers can override init() and destroy(). For         * now, we just disable tag pooling for pages that use "extends".          */
//  test cases but I'm not sure? 
//  Order is NOT important at this point. It is checked below. 
//  TODO Investigate why this test fails 
//  This method is deprecated and for good reason. This is   very risky code but is the only option at this point.   A *very* good reason for apps to do this clean-up   themselves. 
/*      * TODO SERVLET3 - Add comments     * @param wrapped The response to compare to the wrapped response     * @return <code>true</code> if the response wrapped by this wrapper (or     *         series of wrappers) is the same as the supplied response,     *         otherwise <code>false</code>     * @since Servlet 3.0      */
//  TODO: All of these SSL getters and setters can be removed once it is no   longer necessary to support the old configuration attributes (Tomcat 10?) 
//  Not thread safe. Accept that there may be multiple evaluations. 
//  FIXME handle EVT_GET_ALL_SESSIONS later 
/*      * Generate a real default StandardContext TODO read and interpret the     * default context.xml and context.xml.default TODO Cache a Default     * StandardContext ( with reloading strategy) TODO remove really all     * elements, but detection is hard... To Listener or Valve from same class?     *     * @see org.apache.catalina.storeconfig.StoreAppender#defaultInstance(java.lang.Object)      */
//  Not implemented 
/*  *  Memory-efficient repository for Mime Headers. When the object is recycled, it *  will keep the allocated headers[] and all the MimeHeaderField - no GC is generated. * *  For input headers it is possible to use the MessageByte for Fields - so no GC *  will be generated. * *  The only garbage is generated when using the String for header names/values - *  this can't be avoided when the servlet calls header methods, but is easy *  to avoid inside tomcat. The goal is to use _only_ MessageByte-based Fields, *  and reduce to 0 the memory overhead of tomcat. * *  TODO: *  XXX one-buffer parsing - for http ( other protocols don't need that ) *  XXX remove unused methods *  XXX External enumerations, with 0 GC. *  XXX use HeaderName ID * * * @author dac@eng.sun.com * @author James Todd [gonzo@eng.sun.com] * @author Costin Manolache * @author kevin seguin  */
//  ThreadPoolExecutor.setCorePoolSize checks that   remainingCapacity==0 to allow to interrupt idle threads   I don't see why, but this hack allows to conform to this   "requirement" 
//  Purely for debug purposes. May not be complete or correct. Certainly   is not efficient. Be sure not to call this from 'real' code. 
//  Message could not be sent. In this case, we don't   set isSendingMessage to false because we must assume the connection   broke (and onClose will be called), so we don't try to send   other messages.   As a precaution, we close the session (e.g. if a send timeout occurred).   TODO: session.close() blocks, while this handler shouldn't block.   Ideally, there should be some abort() method that cancels the   connection immediately... 
//  UCS-4, unusual octet order (3412)   REVISIT: What should this be? 
//  Really need to unload the old class but can't do that. Do   the next best thing which is throw away the JspLoader so   a new loader will be created which will load the new   class.   TODO Are there inefficiencies between reload and the        isOutDated() check? 
//  XXX   need to be more specific about illegal arg 
//  This differs from LogManager#resetLogger() in that we close not all   handlers of all loggers, but only those that are present in our   ClassLoaderLogInfo#handlers list. That is because our #addLogger(..)   method can use handlers from the parent class loaders, and closing   handlers that the current class loader does not own would be not   good. 
//  display-name - TODO should support multiple with language 
//  XXX Not sure if we can eliminate dead codes after this. 
//  message-destination   TODO: Should support multiple description elements with language   TODO: Should support multiple display-names elements with language 
//  The legacy code (dating down at least to Tomcat 4.1) just   skipped all mapping work in this case. That behaviour has a risk   of returning an inconsistent result.   I do not see a valid use case for it. 
//  XXX works only for enc compatible with ASCII/UTF !!! 
/*  Not yet implemented or not (easily) possible to implement  */
/*      * TODO SERVLET3 - Add comments     * @return TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
/*      * TODO SERVLET3 - Add comments     * @param listenerClass TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  Shouldn't happen, but let's play nice... 
//  XXX *could* move EL-syntax validation here... (sb) 
//  TODO - configure filter rules from Ant rather then system properties 
/*      * Many calls to SSL methods do not check the last error. Those that do     * check the last error need to ensure that any previously ignored error is     * cleared prior to the method call else errors may be falsely reported.     *     * TODO: Check last error after every call to an SSL method and respond     *       appropriately.      */
/*      * TODO SERVLET3 - Add comments     * @param <T> TODO     * @param c TODO     * @return TODO     * @throws ServletException TODO     * @throws UnsupportedOperationException    If called from a     *    {@link ServletContextListener#contextInitialized(ServletContextEvent)}     *    method of a {@link ServletContextListener} that was not defined in a     *    web.xml file, a web-fragment.xml file nor annotated with     *    {@link javax.servlet.annotation.WebListener}. For example, a     *    {@link ServletContextListener} defined in a TLD would not be able to     *    use this method.     * @since Servlet 3.0      */
//  TODO: Tests for over-sized frames. Better located in tests for section 6? 
//  TODO Handle remove also work dir content !   Stop the context first to be nicer 
//  cheap hack to return an empty hash 
//  XXX used only for headers - shouldn't be stored here. 
//  FIXME: Implement SSL environment variables
//  TODO: Description for init-param is ignored
//  UTF-16, big-endian, no BOM   (or could turn out to be UCS-2...   REVISIT: What should this be? 
//  TODO is this case possible? (see it a old Server 5.0 impl) 
//  TODO: Should support multiple description elements with language 
//  TODO What if the connection string contains a 'user' or 'password' query parameter but that connection string is not in a legal URL format? 
/*      * Not in the queue, currently being tested for possible eviction. An     * attempt to borrow the object was made while being tested which removed it     * from the queue. It should be returned to the head of the queue once     * eviction testing completes.     * TODO: Consider allocating object and ignoring the result of the eviction     *       test.      */
//  FIXME: Add transfer encoding header 
/*      * Tomcat requires that the base directory is set because the defaults for     * a number of other locations, such as the work directory, are derived from     * the base directory. This should be the first method called.     * <p>     * If this method is not called then Tomcat will attempt to use these     * locations in the following order:     * <ol>     *  <li>if set, the catalina.base system property</li>     *  <li>if set, the catalina.home system property</li>     *  <li>The user.dir system property (the directory where Java was run from)     *      where a directory named tomcat.$PORT will be created. $PORT is the     *      value configured via {@link #setPort(int)} which defaults to 8080 if     *      not set</li>     * </ol>     * The user should ensure that the file permissions for the base directory     * are appropriate.     * <p>     * TODO: disable work dir if not needed ( no jsp, etc ).     *     * @param basedir The Tomcat base folder on which all others will be derived      */
//  XXX Eliminate redundant fields !!!   ( both header and in special fields ) 
//  Logging credentials could be a security concern but they are   invalid and that is probably a bigger problem 
/*          * XXX This is a bit silly, but we want to have start and stop time and         * duration consistent. It would be better to keep start and stop         * simply in the request and/or response object and remove time         * (duration) from the interface.          */
//  Leading zero in non-zero octet. Not valid (ambiguous). 
/*  * All-to-all replication for a hash map implementation. Each node in the cluster will carry an identical * copy of the map.<br><br> * This map implementation doesn't have a background thread running to replicate changes. * If you do have changes without invoking put/remove then you need to invoke one of the following methods: * <ul> * <li><code>replicate(Object,boolean)</code> - replicates only the object that belongs to the key</li> * <li><code>replicate(boolean)</code> - Scans the entire map for changes and replicates data</li> *  </ul> * the <code>boolean</code> value in the <code>replicate</code> method used to decide * whether to only replicate objects that implement the <code>ReplicatedMapEntry</code> interface * or to replicate all objects. If an object doesn't implement the <code>ReplicatedMapEntry</code> interface * each time the object gets replicated the entire object gets serialized, hence a call to <code>replicate(true)</code> * will replicate all objects in this map that are using this node as primary. * * <br><br><b>REMEMBER TO CALL <code>breakdown()</code> or <code>finalize()</code> * when you are done with the map to avoid memory leaks.</b><br><br> * TODO implement periodic sync/transfer thread<br> * TODO memberDisappeared, should do nothing except change map membership *       by default it relocates the primary objects * * @param <K> The type of Key * @param <V> The type of Value  */
//  Hard coded for now. Consider making this optional. At Valve level or   page level? 
/*              * This method is slightly ugly; c'est la vie.             * "You cannot stop [ugliness], you can only hope to contain [it]"             * (apologies to Marv Albert regarding MJ)              */
//  The socket write buffer capacity is socket.appWriteBufSize   TODO This only matters when using TLS. For non-TLS connections it        should be possible to write the ByteBuffer in a single write 
//  note by slaurent : quite oddly threadPoolExecutor.setCorePoolSize   checks that queue.remainingCapacity()==0. I did not understand   why, but to get the intended effect of waking up idle threads, I   temporarily fake this condition. 
//  When running the test on Java 9, one or more URLs to jimage files may   be returned. By setting the scanAllFiles option, a callback will be   generated for these files which in turn will mean the number of URLs   and the number of call backs will agree and this test will pass.   There is a TODO in StandardJarScanner to add 'proper' Java 9 support. 
/*  * * @since Servlet 3.0 * TODO SERVLET3 - Add comments  */
//  TODO: This class could either extend ByteBuffer, or better a ByteBuffer   inside this way it could provide the search/etc on ByteBuffer, as a helper. 
//  Related to DBCP-212   Driver manager does not sync loading of drivers that use the service   provider interface. This will cause issues is multi-threaded   environments. This hack makes sure the drivers are loaded before   DBCP tries to use them. 
/*  * Filter that attempts to force MS WebDAV clients connecting on port 80 to use * a WebDAV client that actually works. Other workarounds that might help * include: * <ul> *   <li>Specifying the port, even if it is port 80, when trying to *       connect.</li> *   <li>Cancelling the first authentication dialog box and then trying to *       reconnect.</li> * </ul> * * Generally each different version of the MS client has a different set of * problems. * <p> * TODO: Update this filter to recognise specific MS clients and apply the *       appropriate workarounds for that particular client * <p> * As a filter, this is configured in web.xml like any other Filter. You usually * want to map this filter to whatever your WebDAV servlet is mapped to. * <p> * In addition to the issues fixed by this Filter, the following issues have * also been observed that cannot be fixed by this filter. Where possible the * filter will add an message to the logs. * <p> * XP x64 SP2 (MiniRedir Version 3790) * <ul> *   <li>Only connects to port 80</li> *   <li>Unknown issue means it doesn't work</li> * </ul>  */
//  TODO: close() may block if the remote endpoint doesn't read the data   (eventually there will be a TimeoutException). However, this method   (sendMessage) is intended to run asynchronous code and shouldn't   block. Otherwise it would temporarily stop processing of messages   from other clients.   Maybe call this method on another thread.   Note that when this method is called, the RemoteEndpoint.Async   is still in the process of sending data, so there probably should   be another way to abort the Websocket connection.   Ideally, there should be some abort() method that cancels the   connection immediately... 
/*              * The setting of isELIgnored changes the behaviour of the parser             * in subtle ways. To add to the 'fun', isELIgnored can be set in             * any file that forms part of the translation unit so setting it             * in a file included towards the end of the translation unit can             * change how the parser should have behaved when parsing content             * up to the point where isELIgnored was set. Arghh!             * Previous attempts to hack around this have only provided partial             * solutions. We now use two passes to parse the translation unit.             * The first just parses the directives and the second parses the             * whole translation unit once we know how isELIgnored has been set.             * TODO There are some possible optimisations of this process.              */
//  Not ideal. This will indicate that data is available which should   trigger a read which in turn will trigger another IOException and   that one can be thrown. 
//  TODO: Invalid frames for each of the remaining states 
/*      * disconnect     *     * TODO Implement this org.apache.catalina.tribes.transport.DataSender method      */
//  UCS-4, unusual octet order (2143)   REVISIT: What should this be? 
//  XXX - no need to generate temporary variable here 
//  XXX - Fixed a bug here - value used to be output   inline, which is only okay if value is not an EL   expression. Also, key/value pairs for the   embed tag were not being generated correctly.   Double check that this is now the correct behavior. 
//  Dummy implementation 
/*      * TODO SERVLET3 - Add comments     * @param wrappedType The class to compare to the class of the wrapped     *                    request     * @return <code>true</code> if the request wrapped by this wrapper (or     *         series of wrappers) is the same type as the supplied type,     *         otherwise <code>false</code>     * @since Servlet 3.0      */
// create the map to hold our stats  however TODO we need to improve the eviction  selection 
//  TODO: Consider implications of SSO cookies
//  Enable SO_LINGER to ensure close() only returns when TCP closing   handshake completes 
/*      * Fallback ::= '/>' | ( `>' S? `<jsp:body>' ( ( S? ( Char* - ( Char* `</jsp:body>' ) ) `</jsp:body>'     * S? ) | <TRANSLATION_ERROR> ) `</jsp:fallback>' ) | ( '>' ( Char* - (     * Char* '</jsp:fallback>' ) ) '</jsp:fallback>' )      */
// else 
//  Acknowledge request   Send a 100 status back if it makes sense (response not committed   yet, and client specified an expectation for 100-continue) 
/*              * query          = *( pchar / "/" / "?" )             *             * Note query allows everything absolute-path allows plus "?"              */
// only delete active keys 
//  for includes/forwards 
//  Protocol is the second 
/*  The quote used for the attribute - null for scripting expressions.  */
//  Now convert those bytes to a String using UTF-8 
//  Scan until we find the mech types list. If we find anything 
//  The context has stopped. 
//  Wrapper mapping 
// if not, we are ready, setMessage will reregister us for another write interest  do a health check, we have no way of verify a disconnected  socket since we don't register for OP_READ on waitForAck=false  this causes overhead 
//  Add the header count 
// *********************************************************************   PropertyEditor Support 
//  Prevent from going outside our context 
//  NOTE: Keys must always be added to both poolMap and         poolKeyList at the same time while protected by         keyLock.writeLock() 
//  The resource may be a file, a directory or a symlink to a file or   directory. 
//  Check against the per key limit 
/*      * contentType      */
//  Required for both fragments and non-fragments 
// read more data 
//  trick : convert duration configuration from old to new style 
//  Only finished if a content length is defined and there is no data   remaining 
/*  Wrap all values in double quotes.  */
//  Skipping spaces 
//  Trigger a call to sun.awt.AppContext.getAppContext(). This   will pin the system class loader in memory but that shouldn't 
//  stream 17's window and the connection window. 
/*  Process RunAs annotation which can be only on servlets.                 * Ref JSR 250, equivalent to the run-as element in                 * the deployment descriptor                  */
//  Utility class. Hide default constructor. 
//  Base name is converted path + version 
//  Back up all sessions idle longer than maxIdleBackup 
//  Now increase beyond the limit via a settings frame 
/*      * Tests for failure, when a different sub-domain is used, that's not in the     * allowed list of origins.     *     * @throws ServletException     * @throws IOException      */
//  Map the test Servlet 
/*      * Define the SSL verify levels      */
//  Separator 
//  Set up to handle the specified request and response 
//  Stored credentials are invalid   This may be expected if nested credential handlers are being used 
//  Terminate the APR in case the version   is below required. 
//  Control messages can appear in the middle of other messages   and must not be compressed. Pass it straight through 
//  configured for this web application 
//  Document the properties from ServletRequest 
//  If multiple timeouts, just use the first 
//  Same as GET for this test case 
//  No UTF-8 
//  Never decoded 
/*  Generated By:JJTree: Do not edit this line. AstAnd.java  */
//  ------------------------------------------------- HttpSession Properties 
//  OpenSSL treats many ciphers as having equal preference. The order   returned depends on the order they are requested. The following code   checks that the Parser produces a cipher list that is consistent with   OpenSSL's preference order by confirming that running through OpenSSL 
//  Unbind any objects associated with this session 
//  Reset for next call to this method 
//  Bean is defined using useBean, introspect at compile time 
//  Extract the sequence from the payload 
//  Called from StandardContext.init() 
//  ---------------------------------------------- SocketProcessor Inner Class 
//  Add date header unless it is an informational response or the 
//  Close the stream (in app code so need to 
//  Load all datas relative to the handler : SOAPHeaders, config init element, 
/*  Determines whether the current node was actually closed and     pushed.  This should only be called in the final user action of a     node scope.   */
/*  * Startup event listener for a <b>Host</b> that configures Contexts (web * applications) for all defined "users" who have a web application in a * directory with the specified name in their home directories.  The context * path of each deployed application will be set to <code>~xxxxx</code>, where * xxxxx is the username of the owning user for that web application * * @author Craig R. McClanahan  */
//  If sa is null, no proxy is configured so need to create sa 
//  Extensions   Should normally only be one header but handle the case of 
// grab the global lock 
//  sendfile not possible so check if resource   content is available directly via   CachedResource. Do not want to call   getContent() on other resource   implementations as that could trigger loading   the contents of a very large file into memory 
//  Open the connection 
//  expire swapped out session 
//  Return the configured database instance 
//  Should be good to copy the WAR now 
//  Close all sockets in the add queue 
//  Build the argument map   Start with the arguments from any outer expressions so if there is   any overlap the local arguments have priority 
//  Bug 62976   Jar files containing tags are typically opened during initial   compilation and then closed when compilation is complete. The   reference counting wrapper is used because, when background   compilation is enabled, the Jar will need to be accessed (to   check for modifications) after it has been closed at the end   of the compilation stage.   Using a reference counted Jar enables the Jar to be re-opened,   used and then closed again rather than triggering an ISE. 
//  Delay validation (and triggering any exception) until this point   since all the headers still have to be read if a StreamException is 
//  Fall back to platform default 
//  this compilation unit. 
//  Setup the file channel 
/*      * Confirm the Basic parser tolerates excess white space around     * the username inside the base64 blob.     *     * RFC2617 does not define the separation syntax between the auth-scheme     * and basic-credentials tokens. Tomcat should tolerate any reasonable     * amount of white space.      */
//  mapMembers has the correct type 
//  Destroy and remove from pool 
//  One thread for read, one for write 
//  New line for next record 
//  annotation mapping not added s. Servlet Spec 3.0 (Nov 2009)   8.2.3.3.iv page 81 
//  Process some command line parameters 
//  Remove the old expanded WAR. 
//  First message. Don't check 
//  OpenSSL does not include ECDH/ECDHE ciphers in all and there is no           EC alias. Use aRSA.   OpenSSL 1.0.0 onwards does not include eNULL in all. 
/*  JavaCC - OriginalChecksum=1ccce09e6dc04d17e33b6d15b9c1f0c3 (do not edit this line)  */
// prepare the buffer 
/*                  * The uploaded file is being stored on disk                 * in a temporary location so move it to the                 * desired file.                  */
// we need a CRLF 
//  Allowed roles should be the union of the roles in the constraints   ** is any authenticated user   User is not authenticated 
// don't read data after the trailer 
// FilenameUtils.isSystemWindows() 
//  Copy manager.xml if requested 
//  General purpose addition of a new entry 
//  To expire immediately we need to set the time in past 
//  and (for Java 9+) in an exported module 
//  Arguably not valid but does the right thing anyway 
//  delayed ACKs. Requires an API (TBD) for applications to send settings. 
// perform close cleanup 
//  writable. 
//  Ignore the returned value as we just want to reduce   the queue to 3 entries to use for the rolling average. 
//  Strip the URL header   Find the appropriate NamingContext according to the current bindings   Execute the lookup on that context 
//  Accept the next incoming connection from the server   socket 
// synchronized 
/* NOOP */
//  the following fails because getRealPath always return a non-null path   even if there's no such resource   assertPageContains("/test/contextGetRealPath.jsp?path=nonexistent",   "resourceAInWebInfClasses=true", 404); 
//  follow the redirect to the protected resource 
//  Store nested <PreResources> elements 
//  Expose getters for monitoring attributes 
//  Prevent instance creation. This is a utility class. 
//  Trigger parsing of parameters 
//  If the sslEngine is disabled on the AprLifecycleListener   there will be an Exception here but there is no way to check   the AprLifecycleListener settings from here 
//  At the end the postconstruct annotated   method is invoked 
//  Load the cluster component, if any 
//  Don't return corrupted content 
//  Fire the onError event 
//  padding is invalid. 
/*  * Based on * https://bz.apache.org/bugzilla/show_bug.cgi?id=62614 * https://bz.apache.org/bugzilla/show_bug.cgi?id=62620 * https://bz.apache.org/bugzilla/show_bug.cgi?id=62628  */
//         this.datasource.getPoolProperties().setMaxActive(10);          this.datasource.getPoolProperties().setFairQueue(false);          this.threadcount = 20;          this.transferPropertiesToC3P0();          this.datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis();          TestThread[] threads = new TestThread[threadcount]; 
//  There are makeObject() calls in progress that might   bring the pool to capacity. Those calls might also   fail so wait until they complete and then re-test if   the pool is at capacity or not. 
//  This should trigger the error 
//  Create and return the new Session object 
//  End of frame and possible message as well. 
//  Can't register the ContextListener again if the ContextListener is   calling this method 
// publish the backup data to one node 
//  Add the shell environment variables (if any) 
//  Blocking read so need to release here since there will   not be a callback to a completion handler. 
//  Check whether connection IO is in "not allowed" state 
//  No lock record means user can't be locked 
//  Mapper treats as '/' do the same to prevent NPE 
//  Digester will check there is only one jsp-config 
//  NO-OP by default.   There is no buffer created for this test object since no test depends   on one being present or on this method suspending it. 
//  Declare AT_END scripting variables 
// avoid over growing our cache or add after we have stopped 
//  Alias conflicting with existing Host 
// the success flag is to imply whether the assign is successful 
//  The reason phrase is optional but the space before it is not. Skip   sending the reason phrase. Clients should ignore it (RFC 7230) and it   just wastes bytes. 
//  HTTP 0.9 or HTTP 1.0 request without a host when no default host   is defined. This is handled by the CoyoteAdapter. 
//  Skip directories 
//  ------- Extra customization -------   You can tune individual Tomcat objects, using internal APIs 
//  Override since this protocol implementation requires the APR/native   library 
//  It is not permitted to load resources once the web application has   been stopped. 
//  Check for the single sign on cookie 
// strip the trailing "/" from the webAppRootDir 
//  Normalise destination path (remove '.' and '..') 
//  Message is complete, start a new message 
//  Session ID (do this before setting the path since it may change it) 
/*      * Confirm the Basic parser tolerates excess white space after     * the base64 blob.     *     * RFC2617 does not define this case, but asks servers to be     * tolerant of this kind of client deviation.      */
// remove the msg nr 
//  Return null if we cannot create an object of the requested type 
//  Re-registration after Context.reload()   Replace ContextVersion with the new one 
//  written until after the second request has been made. 
//  Server is shutting down, so thread pools will be shut down so   there is no need to clean the threads 
//  Binding a User Transaction reference 
//  Used in TestStaticFieldELResolver 
//  if we have limit and we're below 
/*  The Kerberos ciphers. OpenSSL doesn't support these. Java does but they     * are used for Kerberos authentication.      */
//  -------------------------------------------------- SocketList Inner Class 
//  Put the socket back in the poller for 
//  Look for two byte BOMs 
// we didn't queue, do nothing 
// *********************************************************************   Constants 
//  in the pattern. If so, we succeeded. Otherwise failure. 
/*      * Processes the given JSP parse error.     *     * @param fname Name of the JSP file in which the parse error occurred     * @param line Parse error line number     * @param column Parse error column number     * @param errMsg Parse error message     * @param exception Parse exception      */
//         setId((String) stream.readObject()); 
//  Incompatible types 
//  During initialisation, getResourcePaths() is called before   resourceJARs is initialised 
/*  To allow to select the connector  */
//  The time at which the connection will timeout unless data arrives before 
//  -------------------------------------------------------- Protected Methods 
//  Close any open DB connection 
//  First request should return in the login page 
//  Coding error. No need for i18n 
//  Indicates that one replacement character is missing 
//  Properties 
//  ----------------------------------------------------------------------   DataSource implementation 
//  Set version so second time through mapping 
//  Overwriting the destination 
//  Deploy WAR 
//  Check a request can be made 
/*      * Generate setter for JspContext so we can create a wrapper and store both     * the original and the wrapper. We need the wrapper to mask the page     * context from the tag file and simulate a fresh page context. We need the     * original to do things like sync AT_BEGIN and AT_END scripting variables.      */
//  Protocol exceptions normally mean the client sent invalid or   incomplete data. 
//  Should be ignored 
//  Decode extra attributes 
//  Add object creation rule 
//  Log at least WARN 
//  confirm the session is not recognised by the server alone 
//  Collect warnings 
//  servlet-mapping   Note: URLPatterns from web.xml may be URL encoded 
//  The tag handler and its body code can reside in a separate   method if it is scriptless and does not have any scripting   variable defined. 
//  Avoid threshold values of less than zero as they cause trigger NPEs 
//  a MethodExpression to be able to invoke 
//  Number of segments has to match 
//  This is required because of statement pooling. The poolable   statements will always be strongly held by the statement pool. If the   delegating statements that wrap the poolable statement are not   strongly held they will be garbage collected but at that point the   poolable statements need to be returned to the pool else there will   be a leak of statements from the pool. Closing this statement will   close all the wrapped statements and return any poolable statements   to the pool. 
//  It is possible that processing may be triggered for read and   write at the same time. The sync above makes sure that processing   does not occur in parallel. The test below ensures that if the   first event to be processed results in the socket being closed,   the subsequent events are not processed. 
//  bug 48112 
//  ------------------------------- Methods from javax.activation.DataSource 
//  Append ".tmp" to the file name so it won't get deployed if auto   deployment is enabled. It also means the old war won't get   deleted if the upload fails 
//  Advance the end 3 characters: %nn 
//  Close the service method 
//  StreamProcessor instances are not re-used.   Clear fields that can be cleared to aid GC and trigger NPEs if this   is reused 
//  Don't stop host if already stopped 
//  Possible redirect 
//  Config 
//  OpenSSL 
//  Comment=comment 
/*      * Backwards compatibility with 8.5.x      */
//  check is in progress. See BZ 62603. 
// view 
//  remove key from selected set, it's been handled 
//  labels must start with a letter or number 
/*  Fixed DH auth (kDHd or kDHr)  */
//  Remove the fileBase location from the start of the paths since that   was not part of the requested path and the remaining check only 
//  Synchronize AT_BEGIN and NESTED scripting variables 
//  NO-OP: RST is OK here 
//  Handle rename for 1.1.0 onwards 
//  Wait for up to 5 seconds for the client session to open 
//  Log the problem for posterity 
/*      * For internal use to avoid setting the useSendFileSet flag      */
/*      * This test case covers the special case in section 13.4.1 of the Servlet     * 3.1 specification for {@link javax.servlet.annotation.HttpConstraint}.      */
//  No default factory supported. 
//  we have a word token.  We need to scan over the word and then try to parse it. 
//  ----------------- Processor methods that are NO-OP by default for upgrade 
//  Attachment may be null if another thread has called   cancelledKey() 
//  Rewrite is expected to fail. Probably because invalid characters   were written into the request target 
//  provide JSP servlet definition. 
//  Create objects 
//  path parameters; 
//  Add new host 
//  Try and corrupt the headerPayload 
//  This is to maintain the original protocol. 
//  OpenSSL should have returned one cipher per line 
//  array required 
/* --Logic--------------------------------------------------- */
//  push it into the including jspWriter 
//  allow the session to time out and lose authentication 
//  ------------------------------------------------------------ Constructor 
//  There should be one Filter MBean registered 
//  If the JVM is shutting down, skip the memory leak checks 
//  not used 
//  Validate encoders 
//  start the SMAP 
//  Increase the Window size 
//  Cipher C078 
//  doInternalComplete(true); 
//  get the files in the extensions directory 
//  Temporarily reduce the limit 
/*          * Gets the XML-style 'name' attribute          */
//  version numbers 
//  Note: Invalid input is filtered out 
//  Java keywords, boolean literals & the null literal in alphabetical order 
// case : buf.append(" F "); break; 
//  Add Listeners 
// get the "set" method; 
//  Compatibility with legacy server-embed.xml location 
//  When the 'engine' is found, set the parentClassLoader. 
//  Invalidate this session 
//  HTTP/2 equivalent of AbstractConnectionHandler#process() without the   socket <-> processor mapping 
//  No data buffered in this filter. Flush next buffer. 
//  Headers not visible yet, body not processed 
//  503 - Service unavailable 
//  Load the previously unloaded active sessions 
//  Extension type is two byte 
//  --------------------------------------------------- Object Stack Methods 
/*  It is possible that the server sent one or more messages as soon as         * the WebSocket connection was established. Depending on the exact         * timing of when those messages were sent they could be sat in the         * input buffer waiting to be read and will not trigger a "data         * available to read" event. Therefore, it is necessary to process the         * input buffer here. Note that this happens on the current thread which         * means that this thread will be used for any onMessage notifications.         * This is a special case. Subsequent "data available to read" events         * will be handled by threads from the AsyncChannelGroup's executor.          */
// udp port 
/*          * Now do the byte-compare. The constructor has recorded the number of         * bytes to compare in nrBytes, use that. If any of the byte we have to         * compare is different than what we expect, we don't have a match.         *         * If, on the opposite, after this loop, all bytes have been deemed         * equal, then the loop variable i will point to the byte right after         * that -- which we will need...          */
// ------------------------------------- 
//  This test uses small window updates that will trigger the excessive 
//  no "facade" 
/*          * Due to depends chain, Ant could call the Task more than once, this is         * to prevent that we attempt to configure uselessly more than once the         * Redirector.          */
//  Generate lots of concurrent load on the user database 
//  Error, we have reached the end of the header w/o a end quote 
/* -             * PATH_TRANSLATED must be determined after PATH_INFO (and the             * implied real cgi-script) has been taken into account.             *             * The following example demonstrates:             *             * servlet info   = /servlet/cgigw/dir1/dir2/cgi1/trans1/trans2             * cgifullpath    = /servlet/cgigw/dir1/dir2/cgi1             * path_info      = /trans1/trans2             * webAppRootDir  = servletContext.getRealPath("/")             *             * path_translated = servletContext.getRealPath("/trans1/trans2")             *             * That is, PATH_TRANSLATED = webAppRootDir + sPathInfoCGI             * (unless sPathInfoCGI is null or blank, then the CGI             * specification dictates that the PATH_TRANSLATED metavariable             * SHOULD NOT be defined.             *              */
//  Remove this attribute from our collection 
//  Allow an additional 10% for closed streams that are used in the 
// already have this view installed 
//  Cipher C077 
//  ------------------------------------------------------- Lifecycle Methods 
//  The session is closed. The Future had not completed when last checked.   There is a small timing window that means the Future may have been   completed since the last check. There is also the possibility that   the Future was not registered in time to be cleaned up during session   close.   Attempt to complete the Future with an error result as this ensures   that the Future completes and any client code waiting on it does not   hang. It is slightly inefficient since the Future may have been   completed in another thread or another thread may be about to   complete the Future but knowing if this is the case requires the sync   on stateLock (see above).   Note: If multiple attempts are made to complete the Future, the         second and subsequent attempts are ignored. 
//  Allow processing to continue.   If present, the error reporting valve will provide a response 
//  Parse the XML input to load this database 
//  ignore it. It is included in the defaults so it may be configured. 
//  Remove the current request if it is our wrapper 
//             threads[i].start();          } 
//  evaluate expr-a to value-a 
//  Section 5.3.2 
//  initialize the initial out ... 
//  Replace the earlier version 
//  ----------------------------------------------------- ModelMBean Methods 
//  No more data to read 
//  Setting the context in read/write mode 
//  Most (all?) of these should have been   prevented by the checks when the import   was defined. 
//  Client thread might move faster than server. Wait for upto 5s for the 
//  Use the thread local URI and mapping data 
//  Have we got a cached authenticated Principal to record? 
//  Probably the max. number of players has been   reached. 
//  For Java 9+ 
//  ------------------------------------------------------- NIO 2 style APIs 
//  More data for this message expected, start a new frame 
//  can't use StringBuilder due to DateFormat 
//  For annotation element values, this is the annotation 
//  Stream redirection 
//  Create the environment 
/*  Generated By:JJTree: Do not edit this line. AstEqual.java  */
//  OK to construct stream now 
//  Look for the specific type to find a suitable alias 
//  ----------------------------------------------------- Constructor 
//  Configure allowed trailer headers 
// apache displays this as an empty string rather than (none) 
// state is transferred, we are ready for messaging 
//  Remove this player from the room. 
//  Add unprotected servlet 
//  ArrayList of AT_END scripting variables 
//  Load the Catalina instance with the regular configuration files   from specified source 
//  ensure that the digester is properly configured, as   the digester could be used as a SAX ContentHandler   rather than via the parse() methods. 
//  Spin a while until GC happens or we wait too long 
//  See if failure is due to CPDSConnectionFactory authentication failure 
//  == private data 
// key.interestOps(SelectionKey.OP_READ); 
//  Nested types 
/*      * Test the optional behaviour of BASIC authentication to create     * a session on the server. The server will return a session cookie.     *     * 1. try to access a protected resource without credentials, so     *    get Unauthorized status.     * 2. try to access a protected resource when providing credentials,     *    so get OK status and a server session cookie.     * 3. access the protected resource once more using a session cookie.     * 4. repeat using the session cookie.     *     * Note: The FormAuthenticator is a two-step process and is protected     *       from session fixation attacks by the default AuthenticatorBase     *       changeSessionIdOnAuthentication setting of true. However,     *       BasicAuthenticator is a one-step process and so the     *       AuthenticatorBase does not reissue the sessionId.      */
//  Remove this component from its parent component 
//  For includes, get the info from the attributes 
//  Switch to in-memory key store 
//  Return the authenticated Principal (if any) 
//  Initialize our internal data structures 
//  deal with later 
//  Cipher C079 
/*          * Visits root node.          */
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=59081 
//  Use port-component-ref 
/*  Generated By:JJTree: Do not edit this line. AstChoice.java  */
/*      * Parse a name in the query string.      */
//  Create a dummy Include directive node
//  Stop the old component if necessary 
/*      * JspServletWrapper for tag files.      */
//  compare for "tag ", so we don't match "taglib" 
//  accessCount=1 
//  Search the class imports 
//  A user did not start handshake by calling this method by him/herself,   but handshake has been started already by wrap() or unwrap() implicitly.   Because it's the user's first time to call this method, it is unfair to   raise an exception.  From the user's standpoint, he or she never asked   for renegotiation. 
//  Ask our superclass to locate this class, if possible 
/*      * Checks to see if the given URI is matched by a URL pattern specified in     * a jsp-property-group in web.xml, and if so, returns the value of the     * <page-encoding> element.     *     * @param absFileName The URI to match     *     * @return The value of the <page-encoding> attribute of the     * jsp-property-group with matching URL pattern      */
// attributes.put( name, value ); 
//  Prevent an attacker guessing the RMI object ID 
//  Creation of the DataSource is wrapped inside a doPrivileged   so that javamail can read its default properties without   throwing Security Exceptions 
//  Dangerous: someone may treat this as " "   RFC1738 does allow it, it's not reserved      initialSafeChars.set('+'); 
//  uri references TLD file 
//  container fragments) 
//  just ignore it, skip to next word 
//  Welcome files 
// get the value of "name" 
/*          * Computes this custom tag's custom nesting level, which corresponds to         * the number of times this custom tag is nested inside itself.         *         * Example:         *         * <g:h> <a:b> -- nesting level 0 <c:d> <e:f> <a:b> -- nesting level 1         * <a:b> -- nesting level 2 </a:b> </a:b> <a:b> -- nesting level 1         * </a:b> </e:f> </c:d> </a:b> </g:h>         *         * @return Custom tag's nesting level          */
//  Internally bytes, externally kilobytes 
// initialize the "result" which will be assigned to the var or target.property 
// queue is empty, add ourselves as waiters 
//  Malformed. Use quality of zero so it is dropped and skip until   EOF or the next delimiter 
//  Expected to handle message types of <ByteBuffer> only 
//  Stop host 
//  Cipher C074 
//  return CorsFilter.join(new HashSet<>(list), ","); 
//  Skip annotations. 
//  Link exists so should be OK now 
//  Enable host verification 
//  Directories created by Subversion 1.6 and earlier clients 
//  re-throw 
//  Create a new JDBCRealm instance 
//  Notify encoder of EOF. 
//  Validate entry B 
//  Special handling for form-based logins to deal with the case where   a resource is protected for some HTTP methods but not protected for   GET which is used after authentication when redirecting to the   protected resource.   TODO: This is similar to the FormAuthenticator.matchRequest() logic 
//  Expected behavior 
//  has been specified for the logger. 
//  Continuation line found 
//  ----------------------------------------------------- Constants 
//  Use HTTPS since WebSocket starts over HTTP(S) 
//  RFC2617 says nc is 8LHEX. <">8LHEX<"> will also be accepted 
/*      * Sets the connection timeout based on the current number of active     * streams.      */
//  create a new connection 
// remove proxies that have no backup nor primaries 
// payload 
//  Close the server socket and return 
//  since there is a limit, create a prepared statement pool without an eviction thread;   pool has LRU functionality so when the limit is reached, 15% of the pool is cleared.   see org.apache.commons.pool2.impl.GenericKeyedObjectPool.clearOldest method 
//  UCS-4, big endian (1234) 
//  Need to trigger error handling. Poller may return error   codes plus the flags it was waiting for or it may just   return an error code. We could handle the error here but   if we do, there will be no exception associated with the   error in application code. By signaling read/write is   possible, a read/write will be attempted, fail and that   will trigger an exception the application will see.   Check the return flags first, followed by what the socket   was registered for 
//  Create bean 
//  Nothing to add here 
//  Create list 
//  Size may exceed cache size a bit 
/*          * Use an in memory key store where possible.         * For PEM format keys and certificates, it allows them to be imported         * into the expected format.         * For Java key stores with PKCS8 encoded keys (e.g. JKS files), it         * enables Tomcat to handle the case where multiple keys exist in the         * key store, each with a different password. The KeyManagerFactory         * can't handle that so using an in memory key store with just the         * required key works around that.         * Other keys stores (hardware, MS, etc.) will be used as is.          */
//  listener-[description|display-name|icon] added in Servlet 2.4   None of these are supported in WebXml 
//  java.lang should be automatically imported so no need for full class   name 
//  Continue until everything is written 
//  Have to catch Throwable because a classic tag handler   helper method is declared to throw Throwable. 
//  Cipher C073 
//  JSP has leading and trailing white-space 
//  background = "yellow";   foreground = "red"; 
/*  3 == length("org")  */
//  minor one) in a profiler. 
/*      * Logon to access a protected resource in a webapp that uses     * BASIC authentication. Then try to access a protected resource     * in a different webapp which does not have a login method.     * This should be rejected with SC_FORBIDDEN 403 status, confirming     * there has been no cross-authentication between the webapps.      */
//  if our base is null (we know there are more properties to evaluate) 
//  Use same classloader and classpath for compiling tag files 
//  Return immediately if no JMX name has been specified 
//  Handle varArgs and any coercion required 
//  Propagate current positions to the byte chunk and char chunk, if   this continues the char buffer will get resized 
//  Inside an EL literal '\' is only used to escape '\', ''' and '"' 
//  Fall-back. Use the default 
//  Cipher C076 
//  Register all failed authentications 
//  loop while data available, channel is non-blocking 
//  ------------------------------- OpenSSL specific configuration properties 
//  Section 5.3.1 
//  Link relative to this context 
//  d.addAfterOrdering("c"); 
//  HSTS 
//  Exact wrapper 
/*      * Parses named attributes.      */
//  Write out all elements in the proper order. 
//  Need to know the correct timeout before starting the read   but that may not be known at this time if one or more   requests are currently being processed so don't set a 
//  Validate the result 
//  Parse context level web.xml 
//  Charset not available in this JVM - remove cache entry 
//  Set context 
//  The requirements of RFC 2616 are being   applied. If the host header and the request   line do not agree, the request line takes   precedence 
//  Must have a real docBase for webapps - just use temp 
//  Check the pause state before processing headers since the pause state   determines if a new stream is created or if this stream is ignored. 
/*          * Build up the base call to the interpreter.          */
//  Derived major and minor version attributes 
// Thread.sleep(1000); 
// ******************************************************************************/        ClusterManager Interface  ******************************************************************************/ 
// Create and set up the window. 
//  Even if there is no value, the parameter is present,   so we return an empty file name rather than no file   name. 
//  Done 
//  Don't cache classes. The class loader handles this.   Don't cache JARs. The ResourceSet handles this. 
//  Microsoft IE and Microsoft Edge don't understand Max-Age so send   expires as well. Without this, persistent cookies fail with those   browsers. See http://tomcat.markmail.org/thread/g6sipbofsjossacn 
/*  Done port and host are the expected ones  */
//  Read more input data 
//  Reset position and limit to 0 
//  If there is only one, consider it to be /the/ locale 
//  Cipher C075 
//  * means all roles defined in web.xml 
//  the requested operation 
//  NIO or NIO2. Tests do not use JSSE+OpenSSL so JSSE will be used.   Due to check above, it is known that TLS 1.3 is available 
//  Process padding before sending any notifications in case 
//  Validate entry A 
//  Verify that pool's factory refers back to it. If not, log a warning and try to fix. 
//  Increase the flow control window but keep it under the limit 
//  Configure our repositories 
//  In case root cause is somehow heavily nested 
//  Third request should succeed if we increment nc 
//  If there is no explicit docBase, derive it from the path and version 
//  Check if secret was submitted if required 
/*      * Begin Twitter API additions      */
//  Get the date. 
//  Recover the previous match expression 
//  Set the start time once we start reading data (even if it is 
//  Compression methods (single byte for length) 
//  Should never happen. 
/*      * Expected behaviour for deployment of a WAR without an embedded XML file.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *    Y/N       Y/N        N            N    Y    N     *    Y/N       Y/N        Y            N    Y    Y      */
// assume file is non existent 
//  RFC 6265 prefers Max-Age to Expires but... (see below) 
/*  Generated By:JJTree: Do not edit this line. AstMapData.java Version 4.3  */
//  If the constraint now has no collections - remove it 
/*      * when a valid CORS Pre-flight request arrives, with empty     * Access-Control-Request-Method      */
//  Error probably occurred during a non-blocking read 
//  Single OpenSSLName name 
//  Path and query string 
//  Type (required) 
//  Extract SMAP from class file. First line "SMAP" is not included 
/*              * (1) Compile              */
// 3 seconds 
//  window. 
//  Note %C2%A1 == \u00A1 
//  Record position in case we need to return. 
//  immediately after a call to recycle(). 
//  Section 6.1.1 and Section 6.2.1 
//  set up the smtp session that will send the message 
//  ...set a timeout on the connection 
//  Server object already present. Must be running as a service 
//  Remove it 
// ========================================================================= 
//  No permission to configure logging in context   Log and carry on 
/*  Generated By:JJTree: Do not edit this line. AstNull.java  */
//  Converting each byte in the buffer 
//  Let the Set implementation handle duplicates 
/*      * Indicates the syntax (XML or standard) of the file being processed      */
//  Add a security constraint 
// if we reached here, we need to add it to the queue 
/*      * The WEAVED_REPLACEMENT_1 and WEAVED_REPLACEMENT_2 field contents are generated using the     * following code. To regenerate them, alter the TesterUnweavedClass code as desired, recompile,     * and run this main method.      */
//  Guarded by registeredLock 
/*  Disable SSL 3.0/TLS 1.0 CBC vulnerability workaround that was added     * in OpenSSL 0.9.6d.  Usually (depending on the application protocol)     * the workaround is not needed.  Unfortunately some broken SSL/TLS     * implementations cannot handle it at all, which is why we include     * it in SSL_OP_ALL.  */
//  Ignore Graal "unknown" classloader 
/*      * Tests if a non-simple request is given to simple request handler.     *     * @throws IOException     * @throws ServletException      */
//  Send specified request body using method 
/*  Generated By:JJTree: Do not edit this line. AstDeferredExpression.java  */
//  Try to stop the context first to be nicer 
//  b.addAfterOrdering("a"); 
//  Mostly to cleanup references 
//  without regard to the handshake status. 
/*      * End Twitter API Additions      */
//  if someone would change the limit in process,   he would face consequences 
//  Read the body 
//  The policy file may have been modified to adjust   permissions, so we're reloading it when loading or   reloading a Context 
//  Need to stop Tomcat to ensure background processed have been stopped. 
/*  Generated By:JJTree: Do not edit this line. AstMod.java  */
//  Determine the value of the <short-name> subelement of the 
//  Copy current stats 
// get the raw url according to "url" and "context" 
//  No init or start as that will be in a new context object 
//  Detect failure 
// publish the data out to all nodes 
//  (which correctly triggers an error) 
//  Cipher C072 
//  ------------------------------------------------------ Public Properties 
// the current position in the tree 
//  associated sessions 
/*  SRP ciphersuite from RFC 5054  */
//  Never delete per host context.xml defaults 
//  See if this returns a LambdaEXpression 
/*      * Note: If either of fileToRemove and newDocBase are null, both will be     *       ignored.      */
//  ---------------------------------------------------------- 
//  once a conflict has been found 
//  Unprotected resource with no preemptive authentication 
// do redirect 
//  NOTE: This class is focused on InputStream, OutputStream, Reader and   Writer. Each method should take at least one of these as a parameter,   or return one of them. 
//  TODO: Remove 
/*                  * Requested JSP has been target of                 * RequestDispatcher.include(). Its path is assembled from the                 * relevant javax.servlet.include.* request attributes                  */
//  See if the Session is in the Store 
//  fragments 
//  of adding new ones). 
//  Spec says method name is a token followed by a single SP but 
/*          * If it is not 0, however, we must test for the relevant bits in the         * next byte (whatever is in the bytes after that doesn't matter). We do         * it this way (remember that lastByteShift contains the amount of bits         * we should _right_ shift the last byte):         *         * - grab both bytes at index i, both from the netmask address and the         * candidate address; - xor them both.         *         * After the xor, it means that all the remaining bits of the CIDR         * should be set to 0...          */
//  Shut down our servlet instance (if it has been initialized) 
//  Check for https 
//  Add a test filter that fails 
//  ignore server 
//  Skip 
//  Changed to getWorkPath per Bugzilla 35819. 
/*  Basic request properties must be set before this call  */
// Ignore 
//  If the URI ends with "/." or "/..", then we append an extra "/"   Note: It is possible to extend the URI by 1 without any side effect 
//  Set SSL 
//  null line-sep forces no chunking rather than throwing IAE 
//  If there is an expanded directory then any xml in that directory   should only be used if the directory is not out of date and 
//  Calculate non-chunked size - rounded up to allow for padding   cast to long is needed to avoid possibility of overflow 
//  Ack was unexpected 
/*  SC_LENGTH_REQUIRED  */
//  Removing wrapper listeners 
//  ----------------------------------------- ServletResponseWrapper Methods 
//  What encoding to use? Some platforms, eg z/os, use a default 
//  Methods to support mark/reset 
/*      * Try to access a protected resource in a webapp that     * does not have a login method defined.     * This should be rejected with SC_FORBIDDEN 403 status.      */
// avoid dead lock 
//  reset buffer 
//  No, extract the desired path directly from the request 
/*  empty slot: +18  */
//  Other encodings. No BOM. Try and ID encoding. 
//  for now we don't write out the wrapper details 
//  Is FrameType valid for the given stream? 
// must start the receiver first so that we can coordinate the port it 
//  Spec says apps should have read/write for their temp   directory. This is fine, as no security sensitive files, at   least any that the app doesn't have full control of anyway, 
//  the limit 
//  this is a normal token, so it doesn't matter what the previous token was.  Add the white space 
/*  * Note: This test is split using two base classes. This is because, as a single *       test, it takes so long to run it dominates the time taken to run the *       tests when running tests using multiple threads. For example, on a *       system with 12 cores, the tests take ~5 minutes per connector with this *       test as a single test and ~3.5 minutes per connector with this test *       split in two.  */
//     protected ComboPooledDataSource c3p0Datasource; 
//  Look to see if this class implements the interface of interest 
//  Pass this request on to the next valve in our pipeline 
//  Ignore and fallback to defaults 
//  impossible for a key to be associated with a null value. 
/*  To obtain the CountryName of the Client Certificate Issuer     * use the SSL_INFO_CLIENT_I_DN + SSL_INFO_DN_COUNTRYNAME      */
//  Time of the request - useful to avoid repeated calls to System.currentTime 
// get the value of the "items" attribute 
//  File does not exist - ignore (shouldn't happen) 
/*          * According to the spec, only dynamic attributes with no uri are to be         * present in the Map; all other dynamic attributes are ignored.          */
//  Now check to see if the rest of the attributes are valid too. 
//                      modified = true;               return modified; 
//  At least one of the tokens of the locks must have been given 
//  we will be adding SDE and it isn't already counted 
//  --------------------------------------------------- Sendfile Inner Class 
//  Should not take very long but some failures have been seen 
//  1 extra - should pass 
//  Tolerate null non-primitive values 
//  Sort listeners in two arrays 
//  Add servlet 
//  Add security valve 
//  Use this sequence for padding to make it easier to spot errors 
//  ----------------------------------------------- Generic property handling 
//  First byte F0, second byte 90..BF 
//  found a non-backslash char. 
//  get the bytes 
//  most of the data should have been flushed out 
//  Set up the mock request and response 
//  Convert a request-relative path to a context-relative one 
//  Check if the buffered messages exceed   a specific amount - in that case, disconnect the client   to prevent DoS.   In this case we check if there are >= 1000 messages   or length(of all messages) >= 1000000 bytes. 
/*      * Generates the getter method for the given attribute name.      */
//  See Bugzilla 31257 
//  Write the payload 
//  Create the roles PreparedStatement string 
//  Note: PersistenceManager.findSession() silently updates 
//  0-2   nothing to do here 
//  Open an output stream to the specified pathname, if any 
//  Clean-up since we are here anyway 
//  Read stream 3 headers and first part of body 
// are we calling isClosed? 
/*  the +1 was to account for } which we increment now  */
//  If the SSO session was only associated with one web app the call 
//  Register with the new Container (if any) 
//  Get the current thread group 
//  Java SE API (as of Java 8) does not expose the API to   control the Window size. It is effectively hard-coded 
//  First check the basics work 
//  Other 
//  Only perform multi-release processing on first access 
//  If we have a public ID, this is not a 2.4 or later webapp 
//  producing an error report that will never be read 
//  Set up the driver connection factory we will use 
/*      * (non-Javadoc)     *     * @see java.io.Externalizable#writeExternal(java.io.ObjectOutput)      */
//  ... and try again. Note, that bufferCount = 0 here ! 
//  take our key. We will replace with a pool when ready. 
//  Generate the digested form of the user provided password 
//  Check messages were received 
//  Get the root element of the document 
//  Create a new char buffer if anything changed 
//  Store nested <Resource> elements 
// 50MB 
//  -------------------- Adding data to the buffer -------------------- 
//  Parsing overwrite header 
//  Make sure this listener is currently present 
//  UTF-16, with BOM 
//  Find the content length (chunked responses not handled) 
//  Expires - Not stored explicitly. Generated from Max-Age (see V1) 
//  generate servlet .java file 
//  Next 3 characters must be "://" 
//  Stream id 
//  Default wrapper 
//  If we send an incomplete preface the server should kill the   connection. 
//  Need to combine data from multiple callbacks so use this to hold   the data   Process the callbacks 
//  Check the protocol 
//  Convert '\' to '/' 
//  Check status is 400 
//  Skip parsing when there is an empty absolute ordering and   validation is not enabled 
//  Ignore and carry on 
// get context 
//  Might match a different varargs method 
/*      * Force faster timeout for an active Container than can     * be defined in web.xml. By getting to the active Session we     * can choose seconds instead of minutes.     * Note: shamelessly cloned from ManagerBase - beware of synch issues     *       on the underlying sessions.      */
//  Expect a normal response 
//  Id's for tagplugin declarations 
//  rfc2109 semantically does not allow $Version to be 0 but it is valid syntax 
//  Loop as long as there is data to read. If isReady() returns false   the socket will be added to the poller and onDataAvailable() will   be called again as soon as there is more data to read. 
// Errors 
//  Validate the proposed constraint 
//  For new instances, count will have been incremented at the   time of creation 
//  We reload the context and verify that the pages are still accessible 
//  Note: We don't know if the Servlet implements   SingleThreadModel until we have loaded it. 
//  Store nested <Environment> elements 
//  Control character or EOF (-1) terminates loop 
// compare with the dispatched response 
//  Bug 49000 
//  else 
//    0   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F   00-0f 
//  do it 
// ------------------------------------------------------------------------------                map owner interface  ------------------------------------------------------------------------------ 
//  Nothing to return 
/*      * Test that a resource with empty content is also processed      */
//  Allowed roles should be the union of the roles in the constraints   Constraint with empty auth section prevents all access   User has matching role 
//  Make sure the keySizeCache is loaded now as part of connector startup   else the cache will be populated on first use which will slow that   request down. 
//  are here for performance. 
//  Set query string encoding 
//  Start capturing the System.err output for this thread 
//  Set up the extension using defaults 
//  Should send quickly until the network buffers fill up and then 
//  Handles a Normal request that is not a cross-origin request. 
//  Acknowledge the request 
//  Sending the response header buffer 
/*  TCN_IS_DEV_VERSION  */
//  Instantiate the new object and push it on the context stack 
//  Expose getters for configuration settings 
//  We don't support any keys without attachments 
//  Both host and alias removed 
//  If the specified value is not recognised, default to the   strictest possible option. 
//  Make sure DefaultServlet isn't exposing special directories   by remounting the webapp under a sub-path 
/*      * When the endpoint is created and configured, the APR library will not     * have been initialised. This flag is used to determine if the default     * value of useSendFile should be changed if the APR library indicates it     * supports send file once it has been initialised. If useSendFile is set     * by configuration, that configuration will always take priority.      */
//  Synchronize AT_BEGIN scripting variables 
//  RewriteMap name rewriteMapClassName whateverOptionalParameterInWhateverFormat 
//  Create and populate a SavedRequest object for this request 
//  default values 
//  Process configuration file for this valve 
/*  -------------------------------- *     * Validation onBorrow              *     * --------------------------------  */
//  Body Header Section 
//  Retrieve configuration of logging file name 
/*  SSL_kGOST  - GOST key exchange  */
//  Make sure the connection is closed 
//  Request line 
//              throw new IllegalArgumentException();           final ReentrantLock lock = this.lock;           lock.lock(); 
//  Should be overridden in JAASRealm - to avoid pretty inefficient conversions 
//  Ensure caches for timing stats are the right size by filling with   nulls. 
//  Enable deployer 
//  the frame handling code 
//  Nothing to do - always generate list 
/*      * Expected behaviour for deployment of an XML file that points to an     * external WAR.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *    Y/N       Y/N        Y            Y    N    Y     *    Y/N       Y/N        N            Y    N    N     *     * Notes: No WAR file is present in the appBase because it is an external     *        WAR.     *        Any context.xml file embedded in the external WAR file is ignored.      */
//  in the Commons FileUpload port for fields that have no data. 
//  but I couldn't find it 
//  Add them to the web application wide cache for future lookup in   error handling etc. 
//  Not on a container thread so need to execute the dispatch 
//  -------------------------------------------------- ServletConfig Methods 
//  Extension size is another two bytes 
//  No need to test how trailing '=' are handled here. HTTP2Settings payloads   are always a multiple of 6 long which means valid payloads never end in   '='. Invalid payloads will be rejected anyway. 
//  Name finished. No value. 
//  copy old constant pool return index of SDE symbol, if found 
//  Also need to remove this stream from the p2 list 
//  Something went wrong reading the class bytes (and will have   been logged at debug level). 
//  Validate required extensions 
//  notify change sessionID 
//  Not enough space in the destination buffer to   store all of the data. We could use a bytes read   value of -bufferSizeRequired to signal the new   buffer size required but an explicit exception is   clearer. 
//  Set the realmPath for JMX naming 
//  % decoded (if necessary) using UTF-8 
/*          * These last two lines could be shortened to:         *         * lastByteShift = (8 - (cidr % 8)) & 7;         *         * But... It's not worth it. In fact, explaining why it could work would         * be too long to be worth the trouble, so let's do it the simple way...          */
//  If collection is null, continue to avoid an NPE   See Bugzilla 30624 
//  If the page for jsp:include was specified via   jsp:attribute, first generate code to evaluate   that body. 
//  -------------------- Formatting -------------------- 
//  Broadcast that one player is removed. 
//  Return the Principal (if any) 
//  the async error process 
//  The client presenting a valid ignore-cookie value? 
//  Find the end of the var reference 
//  Expire all the sessions we just wrote 
//  If there is no web.xml, normal folder no impact on   distributable 
//  Re-throw all other exceptions 
//  Try shortcut that should work for nearly all uses first as it does   not use reflection and is therefore faster. 
//  TLV 1.3 draft 26 - subject to change 
//  This approach makes the '=' padding characters completely optional. 
//  Check for case insensitivity 
//  Remove recipients that receive their full allocation so that 
//  Name only cookies are not dropped in RFC6265 
//  Enable JNDI - it is disabled by default 
//  Relative ordering 
//  Never contended, but necessary for visibility 
//  By default, the engine will hold the reloading thread 
//  ignore - JMX not available 
//  Note: For programmatically added Servlets this may not be the         complete set of security constraints since additional         URL patterns can be added after the application has called         setSecurity. For all programmatically added servlets, the         #dynamicServletAdded() method sets a flag that ensures that         the constraints are re-evaluated before the servlet is         first used 
//  chr is next byte of header name. Convert to lowercase. 
/*  Accept the client connection  */
// 1 resends 
//  a.addAfterOrderingOthers(); 
//             log.error( "Can't set model mbean ", t );          } 
//  internal errors can cause shutdown without marking the engine closed 
//  NOTE - Some elements need to be skipped based on the version of the          specification being used. Version is validated and starts at          2.2. The version tests used in this method take advantage of          this. 
//  Do nothing if there is a database connection already open 
/*  Add cipher list, keep order but remove duplicates  */
//  Loop until destroy() is called 
//  No additional methods 
//  must change the client nonce to succeed 
//  If any proto type .java and .class files was generated,   the prototype .java may have been replaced by the current   compilation (if the tag file is self referencing), but the   .class file need to be removed, to make sure that javac would 
//  we only save the Cookie values, not header prefix 
//  ----------------------------------------------------- Public Methods 
//  used for bean instantiation. 
//  If the size of the name is greater that 1, then we go through a   number of subcontexts. 
//  ----------------------------------------------------- DTDHandler Methods 
//  Remove the trailing '/' we added to that input and output are   consistent w.r.t. to the presence of the trailing '/'. 
//  TCK signature fails with generics 
//  Do nothing if we are nested in a false branch   except count it 
//  Calculate maximum chunk size as packetSize may have been changed from   the default (Constants.MAX_PACKET_SIZE) 
// temp name for exception and caught 
//  Simulate STRICT_SERVLET_COMPLIANCE 
//  Responses to HEAD requests are not permitted to include a response 
//  setup both NonLogin and Login webapps 
//  ***********************************************************************   PooledConnectionManager implementation   *********************************************************************** 
//  Optimisation. If there is no data to flush then do not send an   empty message. 
//  in OpenSSL so it is always enabled 
//  First check we get the expected response line 
//  Additional checks to detect invalid sequences ASAP   Checks derived from Unicode 6.2, Chapter 3, Table 3-7 
//  Simple sequence that failed for some inputs 
//  Compression can't be used with sendfile 
//  Domain Name with trailing dot - valid 
//  Wait for session to open on the server 
//  Reconfigure the enabled protocols 
/*  Tag library and XML namespace management methods  */
//  A WAR was expanded. Tomcat will have set the last modified   time of warTracker file to the last modified time of the WAR so   changes to the WAR while Tomcat is stopped can be detected 
//  Send the flush message 
// we only want to verify that we have at least one package 
//  Files visible in some tests only 
//  Dummy OpenSSL command name/value pair 
//  Need to make sure any BOM is removed 
//  Check all three sessions are open 
//  Registering a programmatic logout 
//  Validate the username and password we have received 
//  Cipher 0x010080 (SSLv2) 
// we connected, register ourselves for writing 
//  Always use GET for the login page, regardless of the method used 
//  all have type except Constructor 
//  Second choice, wildcard match 
//  ------------------------------------------------- RootLogger Inner Class 
//  Process the settings 
//  token, name-only with an '=', or other (bad) 
// was close invoked? 
//  Identify the request parameters that we need 
//  Check to make sure the engine has not been closed 
//  Check that var.name-from-attributes has valid values. 
//  Remove url encoding from destination 
//  Duplicate annotation 
//  IPv6 unspecified address 
//  load the discovered services 
//  Turn output back on 
//  Forces the item onto the queue, to be used if the task is rejected 
//  validator 
//  Setup the global Tag Libraries location cache for this 
//  Deregister this prefix mapping 
//  Control flow processing 
//  Acquire (or calculate) the work directory path 
//  ----------------------------------------------------- Protected Methods 
/*          * If the "qop" value is "auth-int", then A2 is: A2 = Method ":"         * digest-uri-value ":" H(entity-body) since we do not have an entity-body, A2 =         * Method ":" digest-uri-value for auth and auth_int          */
// Classes 
//  Need more input 
//  Simple property replacement (mostly for folder names) 
//  Transport Attributes 
//  locale-encoding-mapping-list 
//  Simple dispatch with path parameters on dispatch 
//  Walk through the collection of ready keys and dispatch 
//  Add socket to the list. Newly added sockets will wait 
//  Scan WEB-INF/lib 
/*  SSL_kKRB5  - Kerberos 5 key exchange  */
//  Fill the read buffer as best we can. 
//  save the current TCCL (if any) to be used later by the evictor Thread 
//  Server is storing digested passwords with a prefix indicating   the digest type and the salt used when creating that digest 
//  Reserve as much as possible right away 
//  provide the harvested session cookie for authentication 
//  Add implicit TLD to dependency list 
//  Has an authenticator been configured already? 
//  increment sessionCounter to correct stats report 
//  Setup the ServletWriter 
//  Exceptions 
//  update the auto commit flag 
//  Read the global ref addr 
//  Optimization:   If len-avail < length (i.e. after we fill the buffer with what we   can, the remaining will fit in the buffer) we'll just copy the first   part, flush, then copy the second part - 1 write and still have some   space for more. We'll still have 2 writes, but we write more on the first.
//  1owwwwww 
// There's no way to specify this with SimpleDateFormat  translate.put("U","week in year with first Sunday as first day..."); 
//  30-3f 0-9   40-4f A-O 
//  TODO: Test initial requests with bodies of various sizes 
//  Is there a way to remove the duplication? 
//  Should not be used in a close frame   return CloseCodes.CLOSED_ABNORMALLY; 
//  JSP Servlet settings). 
//  Use a fake executor 
//  __begin introspecthelperMethod 
/*  The HTTP methods this Servlet will pass to the CGI script  */
//  Call ServletContainerInitializers 
//  For AllRolesMode.STRICT_AUTH_ONLY_MODE there must be zero roles 
//  try next proxy in the list 
/*  empty slot: +10  */
//  POST body buffer fails so TLS handshake never happens 
//  As far as possible, process in alphabetical order so it is easy to   check everything is present 
//  pre-destroy elements 
//  Set up the defaults 
//  Log at the lowest level available. logAccess() will be   automatically called on parent containers. 
//  Start again 
//  Name is path + version 
//  consistent with the Servlet spec rules for request mapping. 
//  Performance optimisation. Return as soon as it is known there are no 
//  Add message handlers before calling onOpen since that may trigger a   message which in turn could trigger a response and/or close the   session 
//  ------------------------------------------------------------- public 
//  Stream window update after reading request body 
//  -------------------------------------------------- Public Static Methods 
//  Unknown frame type 
//  Read more data 
//  Perform the standard transformation 
/*          * At this point, we know we're dealing with JSP syntax.         * If an XML prolog is provided, it's treated as template text.         * Determine the page encoding from the page directive, unless it's         * specified via JSP config.          */
//  Copy WAR to the host's appBase 
//  NOTE: This also calls the servlet's service() method 
//  Is this JAR part of the application or is it a container JAR? Assume it 
//  Skip blank lines 
//  -------------------- Deprecated code --------------------   efficient long 
//  JMX specific attributes 
//  Hand-craft the client so we have complete control over the timing 
//  Is there a saved request? 
//  Character mismatch 
//  name of the attribute 
//  Acquire the information we will need to match filter mappings 
/*      * Timeout with app reading request body directly.      */
//  Reset stream back to the beginning of the JAR 
//  whitespace found 
// if we do batch execution, then we name the query 'batch' 
//  add a listener to the transaction context 
// according to the tag file, the value attribute is mandatory. 
//  Used to avoid useless B2C conversion on the host name. 
//  Retrieve user information 
// will show as pm instead of PM 
//  e.g. 0:0:0:0:0:0:127.0.0.1 -> :::127.0.0.1 -> ::127.0.0.1 
//  Need to call onOpen using the web application's class loader   Create the frame using the application's class loader so it can pick   up application specific config from the ServerContainerImpl 
/*      * private fields for 1.1 info      */
//  Checking resource locks 
//  If compile is set, generate both .java and .class, if   .jsp file is newer than .class file;   Otherwise only generate .java, if .jsp file is newer than 
//  If the cache has been generated on a previous invocation   while waiting for the lock, just return the toString 
/*      * verify the parser follows RFC2617 by treating the auth-scheme     * token as case-insensitive.      */
//  Broadcast to the other players that one player joined. 
//  Do we have enough room in dsts to write decrypted data? 
//  Stream decoders have to process the message so no   more decoders can be matched 
//  Check the specific "*" special servlet name 
//  $: back reference to rule 
//  If 'A' was read, echo back 'Z' 
//  Replace it 
//  paused are unpaused. 
//  We got the version that we asked for. That is it. 
//  This one is mapped 
// ---------------------------------------------------------- Public Methods 
// unique Id 
//  Context > Host > Engine > Service 
/*              * Useful references:             * http://tools.ietf.org/html/rfc4121#page-5             * http://tools.ietf.org/html/rfc2743#page-81             * https://msdn.microsoft.com/en-us/library/ms995330.aspx              */
//  Unknown protocol 
//  Don't actually close the connection if in a transaction. The   connection will be closed by the transactionComplete method.     DBCP-484 we need to make sure setClosedInternal(true) being   invoked if transactionContext is not null as this value will   be modified by the transactionComplete method which could run   in the different thread with the transaction calling back. 
//  key: operation val: invoke method  private Hashtable invokeAttMap=new Hashtable(); 
//  Look for an exact match 
//  There will always be a next transformation 
//  Suggestion from dev list (s/ECDHE/kEECDH/, s/DHE/EDH/ 
//  If session is already invalid,   expire session to prevent memory leak. 
//  Store nested <Transport> element 
//  Otherwise ignore 
//  Should never happen with UTF-8   If it does - ignore & return null 
//  Custom Tags may contain declarations from tag plugins. 
/*  mod_header writes "(null)" when the ssl variable is no filled  */
//  This method isn't supported by the PoolingDataSource returned by the   createDataSource 
//  No need to add an additional field 
/*      * Confirm the Basic parser rejects an invalid authentication method.      */
//  would be added 
/*  Start the client that connects to the server  */
//  if this event occurred because we were validating, or if this   connection has been marked for removal, ignore it   otherwise return the connection to the pool. 
//  -------------------------------------------------------- MapOwner Methods 
//  Test "addConnectorPort" and with port matching only in allow 
//  Ensures that all the threads which may be in a race to load   a particular class all end up with the same ResourceEntry   instance 
//  from FAILED to STOPPED state was successful. 
/*      * POJO programmatic followed by programmatic duplicate.      */
//  Add the constraints to the context 
//  authentication?  If so, forward the *original* request instead. 
//  One of the child paths was locked   We generate a multistatus error report 
//  If this request was to the root of the context without a trailing   '/', need to redirect to add it else the submit of the login form   may not go to the correct web application 
/*  GOST R 34.10-94 signature auth  */
//  Store nested <WrapperLifecycle> elements 
//  Cipher 0x040080 (SSLv2) 
//        to continue the loop until the final '}' is detected 
//  On some platform / Connector combinations (e.g. Windows / NIO2),   the TCP connection close will be processed before the client gets   a chance to read the connection close frame. 
//  Ignore - session will be expired 
//  (1) Permission to define this class when using a SecurityManager 
//  Add date header unless application has already set one (e.g. in a 
// these two data member are to indicate 
// check to see if we need to replicate this object isDirty()||complete || isAccessReplicate() 
//  No '*'s, so we make a shortcut 
//  Implicit tag libraries have no functions: 
/*  AES is our preferred symmetric cipher  */
//  If the thread is not bound, return a shared writable context 
//  Disable TLS Session Tickets (RFC4507) to protect perfect forward secrecy 
//  ----------------------------------- AttributeNamesEnumerator Inner Class 
/*  Helper object to be able to call SimpleDateFormat.format().  */
//  security-constraint/display-name was added in 2.3 so should be 
//  path != null, extension == "*":   /foo/* 
//  Need to make path params available to POJO 
//  "java.util.Timer$TimerImpl" in Apache Harmony and in IBM JDK 
/*  Generated By:JJTree: Do not edit this line. AstValue.java  */
//  Instantiate protocol handler 
//  The future has completed. It is not known if the future was   completed normally by the I/O layer or in error by doClose(). It   doesn't matter which. There is nothing more to do here. 
/*      * Checks to see if the given URI is mapped to a tag library.     *     * @param uri The URI to map     *     * @return true if the given URI is mapped to a tag library, false     * otherwise      */
//  Used for headers conversion 
//  Generate an out.write() when see a '\n' in template 
//  ----------------------------------------------------- Poller Inner Classes 
/*          * Converts taglib directive into "xmlns:..." attribute of jsp:root         * element.          */
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#setValue(javax.el.ELContext,     *      java.lang.Object)      */
//  Must be running on Java 9 without the necessary command line   options. 
//  ------------------------------- ContainerBackgroundProcessor Inner Class 
//  Escape character - skip a character 
//  The password is available. Insert it since it may be required for   role searches. 
//  Return immediately if this DataSource has already been registered 
//  System property not set, use the Tomcat default 
//  implies base != null 
//      /**        * Adds all of the elements in the specified collection to this        * queue.  Attempts to addAll of a queue to itself result in        * {@code IllegalArgumentException}. Further, the behavior of        * this operation is undefined if the specified collection is        * modified while the operation is in progress.        *        * @param c collection containing elements to be added to this queue        * @return {@code true} if this queue changed as a result of the call        * @throws ClassCastException        * @throws NullPointerException        * @throws IllegalArgumentException        * @throws IllegalStateException        * @see #add(Object)        */       public boolean addAll(Collection<? extends E> c) { 
//  if used on the server side SSL_get_peer_cert_chain(...) will not include the remote peer certificate.   We use SSL_get_peer_certificate to get it in this case and add it to our array later.     See https://www.openssl.org/docs/ssl/SSL_get_peer_cert_chain.html 
// executor = new ThreadPoolExecutor(minThreads,maxThreads,60,TimeUnit.SECONDS,new LinkedBlockingQueue<Runnable>()); 
//  Map out Node.Nodes 
//  Trying to expand outside the docBase   Throw an exception to stop the deployment 
//  Don't override any explicitly set property 
//  JSP 2.1   JSP 2.1 
//  Switch to the socket timeout. 
//  Well within limits 
//  This method gets called once a second. 
//        Map, use a ConcurrentHashMap for consistency 
//  Checking the first character of the new line. If the character 
/*      * Log message.     * @param level Log message severity. See LOG_XXX enums.     * @param message Message to log      */
//  Can't happen, as decodedQuery can't overflow 
//  Evict from the pool 
//  Always use a random IV For cipher setup.   The recipient doesn't need the (matching) IV because we will always   pre-pad messages with the IV as a nonce. 
//  Either we timed out or we woke up, process events first 
// notify upwards 
//  50-5f P-Z _ 
/*  Pushes a node on to the stack.  */
/*      * These two methods would ideally be in the utility class     * org.apache.tomcat.util.buf.UriUtil but that class is not visible until     * after the class loaders have been constructed.      */
//  and the parent ClassLoader for all others 
//  SkipResult.EOF 
//  else return the data we have and deal with the   partial data on the next read 
//  Trace if allowed 
//  This should either be a fully-qualified class name or a package   name with a wildcard 
//  Token is broader than what is permitted in a language tag   (alphanumeric + '-') but any invalid values that slip through   will be caught later 
//  Invoking JSP context 
//  len will have been -1 on last iteration 
//  switch 
/*      * XMLTemplateText ::= ( S? '/>' ) | ( S? '>' ( ( Char* - ( Char* ( '<' |     * '${' ) ) ) ( '${' ELExpressionBody )? CDSect? )* ETag ) |     * <TRANSLATION_ERROR>      */
//  process remainder of filter chain 
//  Now we parse one of 'CustomActionTagDependent',   'CustomActionJSPContent', or 'CustomActionScriptlessContent'.   depending on body-content in TLD. 
//  Perform final cleanup 
//  Expected to be over-ridden by implementation 
//  The session is closed. The future may or may not have been registered   in time for it to be processed during session closure. 
//  Time for a request to process (need to allow for threads to start etc.) 
//  Handles a Simple CORS request. 
//  Used to check which methods of a server endpoint were called 
//  create factory which returns raw physical connections 
/*      * Request line host is an exact match for Host header     * (no port, with user info)      */
//  HTML Header Section 
//  Check user-agent header 
//  Assume custom SSL is not supporting this 
/*      * The expectation is that you can set a context attribute on     * ServletContextB from ServletContextA and then access that attribute via     * a cross-context dispatch to ServletContextB.      */
//  List of factories for application defined stream handler factories. 
//  Keep track of how many scriptless nodes we've encountered   so we know whether our child nodes are forced scriptless 
//  this trick avoids escaping issues 
/*  Items are given as comma separated list  */
//  Set content type 
//  Max-Age=secs ... or use old "Expires" format 
/*  CLF log format  */
/*      * Returns the next unquoted character and sets the lastChEscaped flag to     * indicate if it was quoted/escaped or not.     * &apos; is always unquoted to '     * &quot; is always unquoted to "     * \" is always unquoted to "     * \' is always unquoted to '     * \\ is always unquoted to \     * \$ is unquoted to $ if EL is not being ignored     * \# is unquoted to # if EL is not being ignored     * <\% is always unquoted to <%     * %\> is always unquoted to %>      */
//  We still have data in the buffer 
//  ignored !?! 
//  Session listeners 
//  Note: this mutates the path: do not do any processing   after this (since we set the redirectPath, there   shouldn't be any) 
//  The node in the parse tree for the NamedAttribute 
//  Mapping for *.do is defined in web.xml 
//  This is a singleton so need to get correct Logger for   current TCCL 
//  explicitly 
// =================================================================         POOL PROPERTIES  =================================================================  =========================================================    PROPERTIES / CONFIGURATION  ========================================================= 
//  Synchronized as the generation of the iterator and the clearing   of dispatches needs to be an atomic operation. 
//  Invalid encoding, skip to the next one 
//  Attempt to prevent deadlocks - see DBCP - 272 
//  10-1f 
//  Local repository 
// ================================================================= 
//  Call to a constructor or a static method 
//  User was not found in the database.   Waste a bit of time as not to reveal that the user does not exist. 
/*      * If an init param is null, it's default value will be used.     *     * @throws ServletException      */
//  Restore the original security environment 
//  Discard all data up to the delimiter. 
//  Ensure safe characters is not shared 
//  since neither can be done reliably. 
/*      * Tests the presence of the origin (and not '*') in the response, when     * supports credentials is enabled alongwith any origin, '*'.     *     * @throws IOException     * @throws ServletException      */
//  Flag that indicates if create should:   - TRUE:  call the factory to create an object   - FALSE: return null   - null:  loop and re-test the condition that determines whether to 
//  Give server 20s to close. 5s should be plenty but the Gump VM is slow 
// are we in the middle of closing or closed? 
//  Don't combine this with outer if or we could get an NPE in   'else if' below 
//  Replace BEAN01 
//  Special case small text strings 
//  Don't close is. That remains the callers responsibility. 
//  For BZ 54391. Relative ordering is specified in resources2.jar. 
//  Create and add buffered input filter 
//  Get class name from constant pool via `name_index' indirection 
/*      * Multiple, different Host headers      */
// we have already started up all components  nothing to start 
//  f.addAfterOrdering("e"); 
//  set the query timeout to 2 sec 
//  Append the remaining text 
/*      * Server status codes; see RFC 2068.      */
//  d is always the empty string   Neither a nor b are set, c is empty 
//  Async support was introduced for Servlet 3.0 onwards 
//  Default host may have changed 
//  && 
//  section 
//  Process characters after last star 
/*  Configure a 1s timeout for reading from client  */
//  Should list GET as a method 
//  If we couldn't find a frame in the stack trace corresponding   to the generated servlet class or we don't have a copy of the   smap to hand, we can't really add anything 
//  Reset the old context class loader 
//  Has a Realm been configured for us to authenticate against? 
//  Find the next $ 
//  Open the default context.xml file, if it exists 
//  Configure authentication 
/*      * Adapted from FileUploadBase.getFileName()      */
//  create a new XAConnection 
//  append jsp:id 
//  request-encoding and response-encoding was introduced in Servlet 4.0 
/*  Return OpenSSL version number (compile time version, if version < 1.1.0)  */
//  @Test /* Uncomment to test performance for different implementations. */ 
//  Store nested <JarResources> elements 
//  Instantiate a new LifecycleListener implementation object 
/*      * @return true if there is something left in EL expression buffer other     * than white spaces.      */
//  Only need to check interfaces that use generics 
//  Code 2 for forward request 
//  Register this connection with JMX 
/*  JDBC_4_ANT_KEY_END  */
//  Register the naming resources 
//  Client hello didn't fit into single TLS record.   Treat this as not present. 
//  check that there's no duplicate in the URLs 
//  Servlet 3.0 asynchronous support 
//           next stage simpler. 
//  Mark as close the connection after the request, and add the   connection: close header 
//  Add the constraint for all the other methods 
//  variant of Bug 49779 
//  Actual write has to be outside sync block to avoid possible   deadlock between messagePartLock and writeLock in   o.a.coyote.http11.upgrade.AbstractServletOutputStream 
//  Parse global web.xml if present 
//  Not defined in main web.xml 
//  Start Rx Thread 
//  Leading zeros (4.1) 
//  filter says not to. 
/*                  *  IPv6 part ends with two consecutive colons,                 *  last colon is part of IPv6 format.                 *  e.g. ::127.0.0.1                  */
/*          * Number of threads with registered interest in this key.         * register(K) increments this counter and deRegister(K) decrements it.         * Invariant: empty keyed pool will not be dropped unless numInterested         *            is 0.          */
//  Restore the original state ( pre reading web.xml in start )   If you extend this - override this method and make sure to clean up 
//  Tomcat's custom jar:war: URL handling treats */ and ^/ as special 
//  Clear the IntrospectionUtils cache. 
//  check simple Parameter 
//  Should have been encoded in a fewer octets 
/*      * Negative test, when a CORS request arrives, with an empty origin.     *     * @throws ServletException      */
//  the end of this test 
//  If it's a forward special attribute, and null, it means this   is an include, so we check the wrapped request since   the request could have been forwarded before the include 
//  We only know how to deal with <code>javax.naming.Reference</code>s   that specify a class name of "javax.sql.DataSource" 
//  Since we'll generate the body anyway, this is really a nop,   except for the fact that it lets us put the Java sources the   plugins produce in the correct order (w.r.t the body). 
/*          * An XML declaration is generated under the following conditions: -         * 'omit-xml-declaration' attribute of <jsp:output> action is set to         * "no" or "false" - JSP document without a <jsp:root>          */
//  noop - this pool is already running 
//  Singleton instance 
//  Filter out bad input. 
//  web-app elements   TODO: Ignored elements:   - description   - icon 
//  If the file/dir must exist but the identified file/dir can't be read 
// ------------------------------------------------------------------   NOT USED BY CONPOOL IMPLEMENTATION  ------------------------------------------------------------------ 
//  --------------------------------------------------------  WebdavStatus Class 
/*  ECDSA auth */
//  Only user1 should be able to perform a POST as only that user has 
//  Shouldn't need to wait long but allow plenty of time as the CI 
//  Confirm behaviour as per Servlet 12.2 
/*  This macro indicates whether or not EBCDIC is the native character set.      */
//  In digest auth, digests are always lower case 
//  Set limit and position to expected values 
/*  If set, always create a new key when using tmp_dh parameters  */
//  wait long enough for my session to expire 
//  Expected response is a 400 response. 
//  Invoke the main method of the application class 
//  Generate class declaration 
//  Dates 
//  Authorization 
//  length 
//  Properties which are to be displayed. 
//  Any non timeup or interrupted error is critical 
//  The default request encoding 
//  Need to make sure that if there is more than one certificate, none of   them have a type of undefined. 
//  error page mechanism to kick in could be viewed as handling the error 
//  Parsing the CRLF increments pos 
//  For an OPTIONS request, the response will vary based on the   value or absence of the following headers. Hence they need be be 
//  Always strip off the leading '/' to get the JAR path 
//  index is 1 based 
//  Release the Http11 processor to be re-used 
// state transfer request 
//  Add include-preludes and include-codas 
//  Method arguments don't match 
//  Superclass implements interface and defines unknown type for generic   Map that unknown type to the generic types defined in this class 
//  Do nothing if the database connection is already closed 
//  Unbinding thread 
//  Test 
//  ------------------------------ ModelMBeanNotificationBroadcaster Methods 
//  Go back one further 
/*                  * According to javadocs of org.xml.sax.helpers.AttributesImpl,                 * the addAttribute method does not check to see if the                 * specified attribute is already contained in the list: This                 * is the application's responsibility!                  */
//  Should have been released above but may not have been on some   exception paths 
// init flags 
//             throwable = e; 
//  A SC_NO_CONTENT response may include entity headers 
//  Well we cleaned the pool in terminate. 
// select a backup node if we don't have one 
//  flush the InternalOutputBuffer 
//  This should never happen but bug 56684 suggests that   it does. 
//  NO-OP. Tested in TestDirResource 
//  Special cases 
//  Create base for config files 
//  to support multi-byte characters 
//  Need to be in async mode to use non-blocking I/O 
//  o.a.catalina.tribes.test.io 
//  Reading the last modified time opens an input stream so we   need to make sure it is closed again otherwise the TLD file   will be locked until GC runs. 
// start pkg  data length  alive time  port  secure port  udp port  host length  host  command length  command  domain length  domain  unique id  payload length  payload  end pkg 
//  Cast to avoid having to catch an IOE that is never thrown. 
// check that the ServletContainerInitializer wasn't initialized. 
/*  Camellia ciphersuites from RFC4132 (            128-bit portion)  */
//  This is fatal for the connector so throw an exception to prevent   it from starting 
//  Transfer the minimal information required for the copy of the Request   that is passed to the HTTP upgrade process 
//  Re-create idle instances. 
//  The BlockingSendHandler doesn't call end message so update the   flags. 
//  If the JAR has been mounted below the web application root, return   an empty resource for requests outside of the mount point. 
//  Generate content with a simple known format. 
//  Add each byte one at a time. 
/*  ARIA ciphers 0xC054 to 0xC055     * Unsupported by both Java and OpenSSL      */
//  Assume JSSE processing of the certificate failed, try again with OpenSSL   without a key manager 
/*      * Force rapid timeout scanning for the Basic Authentication webapp     * The StandardManager default service cycle time is 10 seconds,     * with a session expiry scan every 6 cycles.      */
//  Note for each uses an iterator internally so this is safe 
/*  First second contained in cache  */
//  Check current parameters remain unaffected 
//  Need to try and load the class 
//  but some CI systems get be slow at times. 
//  length is always 4 
//  Create SSL Context 
// add after 
//  Add a leading "/" if necessary 
//  The problem will be handled later, consider the frame read is done 
//  server always overrides anything the app might set 
//  Do not forward the request down the filter chain. 
/*                  * Fixed in Java 9 onwards (from early access build 133)                  */
//  Work around IE5 Mac bug with input type=image.   Because the boundary delimiter, not including the trailing   CRLF, must not appear within any file (RFC 2046, section   5.1.1), we know the missing CR is due to a buggy browser   rather than a file containing something similar to a   boundary. 
/*  * None of these tests should throw a NPE.  */
//  ALPN is not supported by this connector and the upgrade   protocol implementation does not support standard HTTP   upgrade so there is no way available to enable support   for this protocol. 
//  Then print the output string to the java file 
//  If this is a user database resource need to destroy groups, roles,   users and UserDatabase mbean 
//  Get the base name and version for this versioned entry 
//  No early test for invalid sequences here as peeking   at the next byte is harder 
//  Constant not available in latest ECJ version shipped with   Tomcat. May be supported in a snapshot build.   This is checked against the actual version below. 
//  will grow, up to limit 
// read some more 
/*      * isErrorPage      */
//  Try shortcut 
//  Process timeouts 
//  Add ServletContainerInitializer 
// we already have this view 
//  XXX - See comment in openFragment() 
//  print cdata sections 
//  Nothing to do if we already have an instance or an instance pool 
//  NOOP - Don't register this Valve in JMX 
//  Save the thread/runnable   Keeping a reference to the thread object here does not prevent   GC'ing, as the reference is removed from the Map in the finally clause 
//  Loop until we receive a shutdown command 
//                 m.invoke(resource, new Object[] {this});              } 
/*      * Tag File Directives      */
//  Ensure latest agreed table size is used 
//  readAheadLimit doesn't matter as all the readers passed to this   method buffer the entire content. 
//  Make sure this lifecycle listener is currently present 
//  Fast for valid alpha characters, slower for some incorrect   ones 
//  ------------------------------------------------ Sessions administration 
//  Start our defined Connectors second 
//  an invalid sequence has been provided 
//  Didn't find match 
//  IE6, IE7 and possibly other browsers don't understand Max-Age.   They do understand Expires, even with V1 cookies! 
//  is first encountered 
//  If we reached this point, this Engine can't have an AccessLog   Look in the defaultHost 
/*      * BZ https://bz.apache.org/bugzilla/show_bug.cgi?id=57441     * Can't validate function names defined in lambdas (or via imports)      */
//  Step 6. Merge web-fragment.xml files into the main web.xml 
//  This is logged in writeSession() 
/*      * apr_file_permissions File Permissions flags      */
//  The listener sees 3 copies of the first "error" message,   as it is being re-sent. Thus the listener1 count is off by +2. 
//  May throw IAE 
//  Check the key 
//  While a custom context implementation could cause this,   if this occurs during this unit test the cause will be an   invalid (unmapped) target path which returned a null   dispatcher 
//  Use up 56k of the connection window 
//  Negative values - don't wait on port - tomcat is embedded or we just don't like ports 
//  Create the RMI registry 
//  TODO: reserved local   TODO: reserved remote 
//  Day 
//  Removing environments 
//  If we don't send the preface the server should kill the connection. 
//  Read a set of characters from the socket 
//  http2Connect() - modified 
//  Validate the webAppPath before going any further 
//  We haven't emptied out the buffer yet 
//  Attributes not defined in web.xml or web-fragment.xml 
//  Need a local address of the same type (IPv4 or IPV6) as the   configured bind address since the connector may be configured 
//  FIXME - addConnector will fail 
//  Must be Java 8 
//  Check the value 
//  Access log entry as processing won't reach AccessLogValve 
//  nothing in, nothing out. 
//  apply ERROR to the global dispatcherMapping. 
//  NOTE: Do not call response.encodeRedirectURL or the bad 
//  State identifies the state of the previous character 
//  There is partial data in the socketReadBuffer 
//  include the session id in the redirect 
/*      * Encapsulate the logic needed to run a suitably-configured tomcat     * instance, send it an HTTP request and process the server response      */
//  Didn't write the whole amount of data in the last   non-blocking write.   Exit the loop. 
//  ------------------------------------------------------ Private Methods 
// we should be in a close state 
//  Conditionally select and set the character encoding to be used 
//  Set up the poolable connection factory 
//  Clear the tracking data 
//  Don't expire anything that has been checked within the TTL 
//  Entire file has been sent 
//  If objectDeque was null, it won't be any more. Obtain a reference   to it so the deficit can be correctly calculated. It needs to   take account of objects created in other threads. 
//  Don't want any instances so hide the default constructor. 
//  access, this, super 
//  Wait for up to 20s for this to complete. It should be a lot faster 
//  Write data to the channel 
//  The specification strongly implies all configuration should be done   during the creation of the handler object.   This includes setting level, filter, formatter and encoding. 
//  Fill as much of the remaining byte array as possible with the 
// we can ignore this, as it means we have an invalid package  but we will log it to debug 
//  There is no need for other threads to wait for us to release 
/*      * Expected behaviour for deployment of a WAR with an embedded XML file.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *     N        Y/N        N            N    Y    N     *     N        Y/N        Y            N    Y    Y     *     Y         N         N            N    Y    N     *     Y         N         Y            N    Y    Y     *     Y         Y         N            Y    Y    N     *     Y         Y         Y            Y    Y    Y      */
//  This can only support JSSE 
// --Logic--------------------------------------------------- 
/*  The engine at the top of the container hierarchy in which this SSO Valve     * has been placed. It is used to get back to a session object from a     * SingleSignOnSessionKey and is updated when the Valve starts and stops.      */
//  AJP does not use Send File 
//  print FileSection 
//  Header   Length 0 
//  Note %C2%A1 == \u00A1   Failing to escape the redirect means UTF-8 bytes in the Location   header which will be treated as if they are ISO-8859-1 
//  setPropertyMethodVoid can't be null when used 
//  This call is here to ensure the pool thinks the connection   is being used. 
// log the error, but proceed, this should only happen if a node went down,  and if the node went down, then it can't receive the message, the others  should still get it. 
// this is what OP_REGISTER turns into. 
//  Didn't write any data in the last non-blocking write.   Therefore the write buffer will still be full. Nothing   else to do here. Exit the loop. 
//  When a control message is sent while another message is being   sent, the control message is queued. Chances are the   subsequent data message part will end up queued while the   control message is sent. The logic in this class (state   machine, EndMessageHandler, TextMessageSendHandler) ensures   that there will only ever be one data message part in the   queue. There could be multiple control messages in the queue. 
//  Executor may take a short time to stop all the   threads. Make a note of threads that should be   stopped and check them at the end of the method. 
//  then test that if we configure StandardContext with the additional 
//  Checking if there is already a shared lock on this path 
//  we were unable to find a selector 
//  Source encoding of the page containing this Root 
/*      * Ensures APR Library.initialize() and Library.terminate() don't interfere     * with the calls from the Lifecycle listener and trigger a JVM crash      */
// could be a shutdown notification 
//  Avoids NPEs during shutdown. A call to recycle will null this field. 
//  convert nulls and convert stringy parameters   for non-stringy param types 
//  If any of the params have their values specified by   jsp:attribute, prepare those values first. 
//  If the context is null, it is likely that the endpoint was   shutdown, this connection closed and the request recycled in   a different thread. That thread will have updated the access   log so it is OK not to update the access log here in that   case.   The other possibility is that an error occurred early in   processing and the request could not be mapped to a Context. 
// make sure the pool is properly configured 
//  Write plain text application data to the SSL engine 
//  Restore docBase for management tools 
//  Used by parameterized tests. Defined here to reduce duplication. 
//  Compute the current matching rule 
//  Check the right exception was thrown 
//  OpenSSL can handle multiple certs in a single config so the reference to   the context is here at the virtual host level. JSSE can't so the 
//  3. the url isn't absolute 
/*          * A page directive may contain multiple 'import' attributes, each of         * which consists of a comma-separated list of package names. Store each         * list with the node, where it is parsed.          */
//  To keep the IDE happy 
// ignore: invalidated session 
/*      * Define the SSL options      */
//  Recurse through the defined global JNDI resources context 
//  NO-OP - This will work 
//  Should not happen - ignore it if it does 
//  if the Destination URL contains the protocol, we can safely   trim everything upto the first "/" character after "://" 
//  For GET and HEAD, we should respond with   304 Not Modified.   For every other method, 412 Precondition Failed is sent   back. 
//  Process the event that has occurred 
//  Blocking IO so ignore block parameter as this will always use   blocking IO.   Always blocks so never any data left over. 
//  Really ConnectionException 
//  Methods 
//  RFC 7231 requires the server to explicitly signal an empty   response in this case 
/*          * Visits jsp:root element of JSP page in XML syntax.         *         * Any nested jsp:root elements (from pages included via an         * include directive) are ignored.          */
//  Repeat the servlet path (e.g. /webdav/) in the listing path 
//  Should not be used in a close frame   return CloseCodes.RESERVED; 
//  TryCatchFinally 
//  Can't change the API 
//  Save configuration values 
//  8 bits = 6 + 2   top 6 bits: 
//  from W3C 
//  It is possible that the max packet size will be exceeded 
//  Superclass implements interface and defines explicit type for   the interface of interest 
//  write() is meant to create a file so ensure that the path doesn't   end in '/' 
//  Mark the current buffer position 
//  no content is written in the response 
/*  JavaCC - OriginalChecksum=a8c1609257dac59e41c43d6ed91072c6 (do not edit this line)  */
/*                  * AJP13 misses to forward the local IP address and the                 * remote port. Allow the AJP connector to add this info via                 * private request attributes.                 * We will accept the forwarded data and remove it from the                 * public list of request attributes.                  */
//  invoke method 
//  Some socket types may not support this option which is set by default 
//  -------------------------------------------------------------- Properties 
//  Make sure that init() and destroy() were called correctly 
//  Expect 3 packets: headers, body, end 
// throw new SsiCommandException( "Not a conditional command:" +   cmdName ); 
//  Don't restore connections for now, since I have not tested it 
/*  Generated By:JJTree: Do not edit this line. AstFunction.java  */
// the data read 
//  Client is assuming header is ISO-8859-1 encoding which it isn't. Turn   the header value back into the received bytes (this isn't guaranteed 
//  Unwrap request/response if needed 
//  bytes is the only range unit supported 
//  ?jsp_precompile=true 
//  Skip the META-INF directory from any JARs that have been   expanded in to WEB-INF/classes (sometimes IDEs do this). 
//  file private 
// do nothing 
//  No domain member found 
//  Exact match including special case for the context root. 
//  -------------------------------------------------- CharEntry Inner Class 
//  Write the headers 
//  propNode must be non-null if type == FIND_BY_PROPERTY 
//  Terminal transformations don't use RSV bits and there is no next   transformation so always return true. 
// if "var" is specified, the url string store in the attribute var defines 
//  No injection targets so use the defined type for the resource 
//  ----------------------------------------------- EntityResolver Methods 
//  Re-encode the content so that bytes = characters 
//  It is possible that some resources will only be visible for a given   value of useClassLoaderResources. Therefore, if the lookup is made   with a different value of useClassLoaderResources than was used when   creating the cache entry, invalidate the entry. This should have   minimal performance impact as it would be unusual for a resource to   be looked up both as a static resource and as a class loader   resource. 
//  Remove any file extensions 
//  Store nested watched resources <WatchedResource> 
//  At compile time, we have determined that the bean class   exists, with a public zero constructor, new() can be 
//  ------------------------------------------------- ServletRequest Methods 
//  This is correct from the API docs 
//  VALIDATE X-FORWARDED-PROTO 
//  ((StandardSession)session).activate(); 
//  DBCP-215   Trick to make sure that initialSize connections are created 
//  Synchronize NESTED scripting variables 
// @GuardedBy("dateFormat") 
//  Priority frames (also headers) 
//  JKS keystores always convert the alias name to lower case 
//  Wait until request processing ends, as Request.recycle() updates 
//  Unused type_index 
//  Get some more data 
//  error will be caught in Parser 
/*      * (non-Javadoc)     *     * @see com.sun.el.parser.NodeVisitor#visit(com.sun.el.parser.Node)      */
//  resource-ref names must be unique within a web(-fragment).xml 
//  log only outside synch block! 
//  resource, list, array) and bean 
//  Read value until delimiter is found: 
//  Save the current context path before re-writing starts 
//  Handle dynamically adding wrappers 
//  Update the pipeline 
//  English 
//  case A: ValueExpression exists, getValue which must 
//  remove suspect member 
//  Can't be null due to assertion above 
//  done, ready for more, return to pool 
//  Update major and minor version 
//  Do the write 
//  properties are set) 
//  Do not register with the queue 
//  Return the appropriate Principal for this authenticated Subject 
//  Make sure regular multipart works properly 
//  Client is never going to see this so this is really just 
//  (1) Delegate to our parent if requested 
// initialize the property 
//  Thread context class loader first 
//  WsFrame adds the necessary final transformations. Copy the   completed transformation chain to the remote end point. 
//  request session state 
//  session was not accessed, so once again no save will happen 
/*      * Class loader for evictor thread to use since, in a JavaEE or similar     * environment, the context class loader for the evictor thread may not have     * visibility of the correct factory. See POOL-161. Uses a weak reference to     * avoid potential memory leaks if the Pool is discarded rather than closed.      */
//  Check if user meets constraints 
//  Remove left over temporary files if present 
//  Only Context's will have injection targets 
//  Method name doesn't match 
//  Make our application available if no problems were encountered 
// http://localhost/status?cmd=update&mime=txt&w=lb&lf=false&ls=true   > 0 
/*      * Receives notification of character data inside an element.     *     * The SAX does not call this method with all of the template text, but may     * invoke this method with chunks of it.  This is a problem when we try     * to determine if the text contains only whitespaces, or when we are     * looking for an EL expression string.  Therefore it is necessary to     * buffer and concatenate the chunks and process the concatenated text     * later (at beginTag and endTag)     *     * @param buf The characters     * @param offset The start position in the character array     * @param len The number of characters to use from the character array     *     * @throws SAXException      */
//  Identify the objects to be used 
//  Window updates always come in pairs 
//  Add a target servlet to dispatch to 
//  Check if we're included so we can return the appropriate   missing resource name in the error 
/*          * First check to see if all the mandatory attributes are present. If so         * only then proceed to see if the other attributes are valid for the         * particular tag.          */
//  Newer JREs are dropping support for SSLv2Hello. If it is not   implemented and not explicitly requested we can ignore it. It is 
/*      * Parses a tag directive with the following syntax: PageDirective ::= ( S     * Attribute)*      */
// Add a LineInfo that corresponds to the beginning of this node 
//  Complete stop process first 
//  Ignore: normal error due to dual definition of package 
//  Don't add sockets back to the poller.   The resumeProcessing() method will add this socket   to the poller. 
//  Check resources individually 
//  Beware of the differences between escaping in JSP attributes and   in Java Strings 
//  Protocol Version 
//  Store varReader in appropriate scope 
//  Server is storing digested passwords with a prefix indicating   the digest type 
//  Hex hashes should be compared case-insensitively 
// do nothing, we connect on demand 
//  500 - Internal Server Error   Can't add a 500 to the access log since that has already been   written in the Adapter.service method. 
/*          *  Two consecutive colons, initial expansion.         *  e.g. 2001:db8:0:0:1::1 -> 2001:db8:0:0:1:0:0:1          */
//  __begin introspectMethod 
//  deny-uncovered-http-methods was introduced in Servlet 3.1 
//  handle restoring VariableMapper 
//  page-scope attributes 
//  a clean-up now. 
//  Initialize utility executor 
/*              * https://bz.apache.org/bugzilla/show_bug.cgi?id=57653#c6 suggests             * this merging is only necessary on OSX and BSD.             *             * https://bz.apache.org/bugzilla/show_bug.cgi?id=56313 suggests the             * same, or a similar, issue is happening on Windows.             * Notes: Only the first startCount * 2 elements of the array             *        are populated.             *        The array is event, socket, event, socket etc.              */
// check valves if we support async 
//  null value for submit - user hit enter instead of clicking on   "add" or "remove" 
//  IPv4 
//  Write the request body 
//  Check the existence of the client Principal in our database 
//  workaround for catalina weird mbeans - the declaring class is BaseModelMBean.   but this is the catalina class. 
// select a new backup node 
// Don't bother validating if already have recently enough 
//  Two cases: either we just exceeded the train count, in   which case the cache must be created, or we just update 
/*      * Log objects are not Serializable but this Filter is because it extends     * GenericFilter. Tomcat won't serialize a Filter but in case something else     * does...      */
//  Initializing javac task 
/*      * TODO SERVLET 3.1      */
//  Timeouts are calculated on a dedicated thread and then   dispatched. Because of delays in the dispatch process, the   timeout may no longer be required. Check here and avoid 
//  Default to closing the socket if the SocketEvent passed in   is not consistent with the current state of the Processor 
//  Should have caught this earlier but just in case... 
//  The method, URI, queryString and protocol are normally stored as   bytes in the HttpInputBuffer and converted lazily to String. At this   point, the method has already been set as String in the line above   but the URI, queryString and protocol are still in byte form in the   HttpInputBuffer. Processing the saved request body will overwrite   these bytes. Configuring the HttpInputBuffer to retain these bytes as   it would in a normal request would require some invasive API changes.   Therefore force the conversion to String now so the correct values 
//  havePublicId and isServlet24OrLater should be mutually exclusive 
//  No processing is required 
//  Link objects 
/*      * Private serializable variables to keep the messages state      */
/*      * After successful authentication, any record of previous authentication     * failure is removed.      */
/*  Found, so remember for next call and return. */
//  Get the filename if uploaded name includes a path 
//  Make sure this welcome file is currently present 
//  Validate the path argument 
//  Double checked locking. OK since random is volatile. 
/*  Returns the node currently on the top of the stack.  */
//  Configure the security constraints for the resource 
//  This class does not provide a stack trace 
// error free close, all the way 
//  Welcome files with trailing path parameters on dispatch 
//  Completely replace the message with the decrypted one 
//  Might not be an IPv4 address. Could be a host / FQDN with   a fully numeric component. 
//  Draw the circle and numbers 
//  on other platforms this call is noop and will return APR_ENOTIMPL. 
//  SSL Engine status variables 
//  EOM has just been completed 
//  End of :: 
//  null "x-forwarded-proto" 
//  TODO: move to ManagedBean 
//  Read it back 
//  Goaway 
/*          * verify the server response html body is the page we expect,         * based on the dialogue position given by the caller.          */
//  5s should be plenty but Gump can be a lot slower 
//  weed out escaped end-parens 
//  systems are sometimes slow. 
//  Tomcat JNDI creates a Reference out of server.xml   <ResourceParam> configuration and passes it to an   instance of the factory given in server.xml. 
//  Strictly there needs to be a check for valid %nn   encoding here but skip it since it will never be   decoded because the userinfo is ignored 
//  Any and all specified constraints have been satisfied 
//  Allowed roles should be the union of the roles in the constraints   User role is in last constraint 
//  *********************************************************************   Until javax.servlet.jsp.tagext.TagLibraryInfo is fixed 
//  ---------------------------------------------------------- Public methods 
//  -------------------------------------------------------- Adapter Methods 
//  Rather than have every component that might need to call   destroy() check for SingleUse, don't log an info message if   multiple calls are made to destroy() 
//  for now we don't write out anything 
//  attributes 
//  This stream went from IDLE to CLOSED and is likely to have   been created by the client as part of the priority tree. 
//  Insert the additional parameters from the dispatch target 
//  Skip this combination as exceptions that occur on application   managed threads are not visible to the container. 
//  ------------------------------------------------------------ constructors 
//  exists() is a relatively expensive check for a file so   use the fact that we know if it exists at this point 
/*          * First check to see if there is a custom mapping for the login         * method. If so, use it. Otherwise, check if there is a mapping in         * org/apache/catalina/startup/Authenticators.properties.          */
//  Configure the parser 
//  Look for the parent 
//  register our connection as the shared connection 
/*  The type ($ or #) of expression. Literals have a type of null.  */
// =================================================================         POOL OPERATIONS 
//  Getters for monitoring attributes 
//  http://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml#tls-parameters-4 
//    if this fails 
// we have already stopped up all components  nothing to stop 
//  Ignore - null test below handles this 
//  Single OpenSSL alias 
//  Note: The directory must exist for this to work. 
//  Add TLD (jar==null) / JAR (jar!=null) file to dependency list   2nd parameter is null since the path is always relative   to the root of the web application even if we are   processing a reference from a tag packaged in a JAR. 
/*      * Delete any resource that would trigger the automatic deployment code to     * re-deploy the application. This means deleting:     * - any resource located in the appBase     * - any deployment descriptor located under the configBase     * - symlinks in the appBase or configBase for either of the above      */
//  Does the request URI match? 
//  Pool closed while object was being added to idle objects.   Make sure the returned object is destroyed rather than left   in the idle object pool (which would effectively be a leak) 
//  WsFrame adds the necessary final transformations. Copy the 
//  Overly large settings 
/*          * assert !(keyedPool instanceof GenericKeyedObjectPool) :         * "GenericKeyedObjectPool is already thread-safe"; assert !(keyedPool         * instanceof StackKeyedObjectPool) :         * "StackKeyedObjectPool is already thread-safe"; assert         * !"org.apache.commons.pool.composite.CompositeKeyedObjectPool"         * .equals(keyedPool.getClass().getName()) :         * "CompositeKeyedObjectPools are already thread-safe";          */
//  Find the root thread group 
//  Set compression stream to null 
//  By calling unbindThread and bindThread in a row, we setup the 
// log.append("FAIL-03"); 
//  Only delete resources in the appBase or the 
//  -------------------- Utils -------------------- 
/*  (non-Javadoc)     * @see javax.el.FunctionMapper#resolveFunction(java.lang.String, java.lang.String)      */
//  Use server's preference order for ciphers (rather than 
//  http-method-omission added in Servlet 3.0   Let this trigger a validation error as dropping it silently could   be a security concern 
// --- JMX support ---------------------------------------------------------- 
//  subProtocols to be set 
//  Play nice with SSO and mixed Realms   No need to pass the wrapper here because role mapping has been   performed already a few lines above 
/*              * Write begin tag              */
//  next, add the constant http headers 
//  ------------------------------- Properties managed by the ProtocolHandler 
//  ------------------------------------------------------ Constructor 
/*          * This method creates a valid base64 blob          */
//  Hups! 
//  EJB references 
//  First two bytes should always be AB 
//  SecurityManager assume that untrusted applications may be deployed. 
/*  constant_pool[0] is unused by the compiler and may be used freely         * by the implementation.          */
//  Fall-back. Also used by unit tests 
/*      * Find a method with the right name If found, call the method ( if param is     * int or boolean we'll convert value to the right type before) - that means     * you can have setDebug(1).      */
/*          * If the error is triggered after Thread B completes async processing         * there is essentially a race condition between thread B making the         * change and the container checking to see if the error flag has been         * set. We can't easily control the execution order here so we don't         * test it.          */
//  Stop the existing server 
//  ensure it is contextual 
/*  6 == length("javax.")  */
// previously marked suspect, system below picked up the member again 
//  -------------------- Removing data from the buffer -------------------- 
//  Try a setFoo ( InetAddress ) 
//  This has to be here as it can't be moved to SSLHostConfig since the 
//  So many things to go wrong above... 
/*      * Scan a URL for JARs with the optional extensions to look at all files     * and all directories.      */
//  Confirm we have all 720 possible input orders   Set<String> orders = new HashSet<>(); 
//  Avoid possible NPE 
// initiate the strDefName with null. 
//  Store nested <Member> elements 
//  Create the Platform server 
//  Work-around for XML documents that use just the file name for the 
//  Generating href element 
//  d.addAfterOrderingOthers(); 
//  IPv6 
//  Add the registration, noting any registration it replaces 
//  ISE for now. Could swallow this silently / log this if the ISE   becomes a problem 
//  Look up the user's credentials 
/*      * Returns true if and only if all the resources for this web application     * are provided via a packed WAR file. It is used to optimise cache     * validation in this case on the basis that the WAR file will not change.      */
//  Have we authenticated this user before but have caching disabled? 
//  an acceptable certificate 
//  JSP 2.1   JSP 2.1   JSP 2   JSP 21 
// update our map of members, expire some if we didn't receive a ping back 
//  Store nested <GlobalNamingResources> element 
//  post-construct elements 
//  creation exception was ignored   nothing was put onto the stack 
//  this successful NonLogin access should replenish the 
//  If child is started then it is too late for life-cycle listener   to register the child so register it here 
//  SRV 10.9.2 - Handling an error is entirely the application's   responsibility when an error occurs on an application thread.   Calling sendError() followed by complete() and expecting the standard 
//  preface which is longer than a single ping. 
//  no reason to hide this - but good reasons to not hide 
//  next, access it again to harvest the session id url parameter 
/*  JavaCC - OriginalChecksum=151e58546054b618e758d7dc172cc7b5 (do not edit this line)  */
//  This is a directory - strip leading "META-INF/resources" 
//  a response.sendError() will be ignored 
//  Process the data we have 
//  Process this property change 
/*  we want to wait for the process to exit,  Process.waitFor()                 * is useless in our situation; see                 * http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4223650                  */
//  Flush not called as the writer passed could be a BodyContent and   it doesn't allow to flush. 
//  No need to log failure - it is expected in this case 
//  ------------------------------------------------------------ Constructors 
//  Can't close a uConn directly. Have to do it like this. 
//  Check to see if the expected listener fired. 
//  If not using a connection pool, open a connection to the database 
//  Indicates if a performance short-cut is available 
// TRIBES_MBR_END 
//  Send j2ee.state.starting notification 
/*  Is expression language being ignored - affects unquoting. \$ and \# are     * treated as literals rather than quoted values.  */
//  Total time = divide by requestCount to get average. 
//  systems which don't support it cause major problems 
//  All other resources should not be deleted 
//  check if the validation query has changed. 
//  wait long enough for my NonLogin session to expire 
//  Check for connection aborted cond 
//  Only if the Context has started. If it has not, then it   will have its own "after_start" life-cycle event later. 
//  Assume a 'complete' FilterRegistration is one that has a class and 
//  simple character, just write it out. 
//  When including a file, we need to check for a BOM   to determine if a conversion is required, so we 
//  Close the class definition 
//  Finish processing the connection 
//  session-cookie-config added in 3.0 
//  included in the Vary header. 
//  Parse the one or more named attribute nodes 
//  null base, null response 
//        for async 
//  COMPLEMENTOFDEFAULT is also not exactly as defined by the docs 
/*  * The BoM detection is derived from: * https://svn.us.apache.org/viewvc/tomcat/trunk/java/org/apache/jasper/xmlparser/XMLEncodingDetector.java?annotate=1742248 * * The prolog is always at least as specific as the BOM therefore any encoding * specified in the prolog should take priority over the BOM.  */
//  The buffer is already at (or bigger than) limit. 
//  This is decoded and normalized 
//  Check headers - looking to see if response is chunked (it should be) 
//  Should probably log the throwable 
//  Wrap use of tag in try/finally to ensure clean-up takes place 
//  Include empty segments. 
//  Formerly part of the main() method in SmapGenerator 
//  Read some content from the resource 
//  Whatever kind of value it is, return it as a string 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=61197      */
//  VERIFY TEXT/HTML 
//  Treat headers as single values by default. 
// extra 
//  borrow a new connection from the pool 
//  Return the normalized path that we have completed 
// transfer state from another map 
//  Can't map context or wrapper without a uri 
//  Allowed roles should be the union of the roles in the constraints   * is any app role   User role is an app role 
//  The ScheduledThreadPoolExecutor doesn't use MaximumPoolSize, only CorePoolSize is available 
//  Clear the first map 
//  Usually means an invalid protocol has been configured 
//  RFC 7540, 5.3.4 endpoints should maintain state for at least the 
//  Update the value of the "out" attribute in the page scope   attribute namespace of this PageContext 
//  Listeners were added in 2.3 so should be excluded in 2.2 
//  Don't allow more than one servlet on the same pattern 
//  foo%bar.jsp 
//  Ignoring maxConcurrentStreams increases the overhead count 
/*      * Look at a threads stack trace to see if it is a request thread or not. It     * isn't perfect, but it should be good-enough for most cases.      */
/*      * private fields      */
//  slightly paranoid verification 
//  20-2f - 
//  ------------------------------------------------------ public 
//  Create QName object 
//  Create byte array and copy bytes 
//  MemoryUserDatabase requires the use of ConfigFileLoader/ConfigurationSource 
// Executor 
//  Cast the input object to an array (calling method has checked it is   an array)   Get the target type for the array elements 
// are we closing or closed? 
//  we should not get here 
//  Handle dynamically adding welcome files 
//  Only need a list when members are expired (smaller gc) 
/*  Generated By:JJTree: Do not edit this line. SimpleNode.java  */
/*      * Test {@link RemoteIpFilter} in Tomcat standalone server      */
//  session is rewrite at other request, rewrite this also 
//  Server port 
//  The tests are only supported for APR and OpenSSL 
//  Retrieve values of userRoleName attribute 
/*              * If the request length exceeds the size of the output buffer,             * flush the output buffer and then write the data directly. We             * can't avoid 2 writes, but we can write more on the second              */
//  Prepare a writer to a buffered area 
//  NO-OP. Some connections are expected to fail. 
//  serialize sessionID 
/*  * <p>Abstract implementation of the <b>Valve</b> interface that generates a web * server access log with the detailed line contents matching a configurable * pattern. The syntax of the available patterns is similar to that supported by * the <a href="https://httpd.apache.org/">Apache HTTP Server</a> * <code>mod_log_config</code> module.</p> * * <p>Patterns for the logged message may include constant text or any of the * following replacement strings, for which the corresponding information * from the specified Response is substituted:</p> * <ul> * <li><b>%a</b> - Remote IP address * <li><b>%A</b> - Local IP address * <li><b>%b</b> - Bytes sent, excluding HTTP headers, or '-' if no bytes *     were sent * <li><b>%B</b> - Bytes sent, excluding HTTP headers * <li><b>%h</b> - Remote host name (or IP address if * <code>enableLookups</code> for the connector is false) * <li><b>%H</b> - Request protocol * <li><b>%l</b> - Remote logical username from identd (always returns '-') * <li><b>%m</b> - Request method * <li><b>%p</b> - Local port * <li><b>%q</b> - Query string (prepended with a '?' if it exists, otherwise *     an empty string * <li><b>%r</b> - First line of the request * <li><b>%s</b> - HTTP status code of the response * <li><b>%S</b> - User session ID * <li><b>%t</b> - Date and time, in Common Log Format format * <li><b>%u</b> - Remote user that was authenticated * <li><b>%U</b> - Requested URL path * <li><b>%v</b> - Local server name * <li><b>%D</b> - Time taken to process the request, in millis * <li><b>%T</b> - Time taken to process the request, in seconds * <li><b>%F</b> - Time taken to commit the response, in millis * <li><b>%I</b> - current Request thread name (can compare later with stacktraces) * <li><b>%X</b> - Connection status when response is completed: *   <ul> *   <li><code>X</code> = Connection aborted before the response completed.</li> *   <li><code>+</code> = Connection may be kept alive after the response is sent.</li> *   <li><code>-</code> = Connection will be closed after the response is sent.</li> *   </ul> * </ul> * <p>In addition, the caller can specify one of the following aliases for * commonly utilized patterns:</p> * <ul> * <li><b>common</b> - <code>%h %l %u %t "%r" %s %b</code> * <li><b>combined</b> - *   <code>%h %l %u %t "%r" %s %b "%{Referer}i" "%{User-Agent}i"</code> * </ul> * * <p> * There is also support to write information from the cookie, incoming * header, the Session or something else in the ServletRequest.<br> * It is modeled after the * <a href="https://httpd.apache.org/">Apache HTTP Server</a> log configuration * syntax:</p> * <ul> * <li><code>%{xxx}i</code> for incoming headers * <li><code>%{xxx}o</code> for outgoing response headers * <li><code>%{xxx}c</code> for a specific cookie * <li><code>%{xxx}r</code> xxx is an attribute in the ServletRequest * <li><code>%{xxx}s</code> xxx is an attribute in the HttpSession * <li><code>%{xxx}t</code> xxx is an enhanced SimpleDateFormat pattern * (see Configuration Reference document for details on supported time patterns) * </ul> * * <p> * Conditional logging is also supported. This can be done with the * <code>conditionUnless</code> and <code>conditionIf</code> properties. * If the value returned from ServletRequest.getAttribute(conditionUnless) * yields a non-null value, the logging will be skipped. * If the value returned from ServletRequest.getAttribute(conditionIf) * yields the null value, the logging will be skipped. * The <code>condition</code> attribute is synonym for * <code>conditionUnless</code> and is provided for backwards compatibility. * </p> * * <p> * For extended attributes coming from a getAttribute() call, * it is you responsibility to ensure there are no newline or * control characters. * </p> * * @author Craig R. McClanahan * @author Jason Brittain * @author Remy Maucherat * @author Takayuki Kaneko * @author Peter Rossbach  */
//  Set the status, then generate the XML response containing 
//  8KB is what tomcat would use by default anyway 
//  Target JVM 
//  Protect against possible NPE if key has been removed in another   thread. Not worth locking the keys while this loop completes. 
//  Character decoding 
//  Make sure we get a 200 response and not a 405 response   which would indicate that error.jsp is complaining about being called   with the PUT method. 
//  BZ 51249 
//  Duplicate of message not yet processed 
//  New binary message 
//  Expire all active sessions 
//  unexpected 
//  EL 3.0 specification says parameter is LambdaExpression but it   may already have been evaluated. If that is the case, the   original parameter will have been checked to ensure it was a   LambdaExpression before it was evaluated. 
//  Configure the authenticator and inherit the Realm from Engine 
//  JNDI resources are unbound in CONFIGURE_STOP_EVENT so stop   naming resources before they are unbound since NamingResources   does a JNDI lookup to retrieve the resource. This needs to be 
//  default to appBase dir + name 
//  Can't read files - ignore 
//  Register with JMX 
//  Should never happen as B2CConverter should replace   problematic characters 
//  not match. 
//  An empty URL is not acceptable 
// invoke all the listeners 
//  ----------------------------------------------- HTTPS specific properties   -------------------------------------------- Handled via an SSLHostConfig 
//  Fill up the input buffer with as much data as we can 
//  Throws exception if alive 
//  Return our cached information (if any) 
//  no flags 
//  Strip leading slash if present, as Sun JAAS impl 
/*  Cache components of the MBean registration.  */
//  Add the relevant path-mapped filters to this filter chain 
// this happens a lot before the system has started   up 
/*      * Create a message to request the given URL.      */
//  Unable to complete the TLS handshake. Treat it as   if the handshake failed. 
//  Cache NotFound results to save repeated calls to findClass()   which is relatively slow 
//  Java 9 onwards. The internal class loaders no longer extend   URLCLassLoader 
//  Consume and buffer the request body, so that it does not   interfere with the client's handshake messages 
//  ------------------------------------------------- MapElement Inner Class 
//  Decrypt the data in the buffer 
//  If JULI is used, shut JULI down *after* the server shuts down   so log messages aren't lost 
//  Output is via an OutputStream 
//  Milli-seconds in 24 hours 
//  This should normally return "http", but any non null non exception is good enough 
// uniqueId data 
//  Store nested <Service> elements 
//  Regular expressions will only ever be used with EqualNode   so return zero for equal and non-zero for not equal 
//  No data to process 
//  Retrieve value of userPassword 
//  Note: This will also be true for the Graal substrate VM 
//  Use the same domain as our associated container if we have one 
/*      * Verify preferring of brotli in default configuration for actual Firefox and Chrome requests.      */
//  Return value undefined 
// channel1.addInterceptor(tint); 
//  No (detectable) changes to the WAR 
//  Parsing lock request 
//  Tomcat can use URLs other than file URLs. However, a protocol   other than file: will generate a bad file system path, so   only add file: protocol URLs to the classpath. 
//  Output the simple/old format for backwards compatibility 
//  Deploy expanded folders 
//  Add an SCI that has no interest in any type 
//  Need to read response headers to test version switching 
//  If we already know the current state, return it. 
//  Check destination path to protect special subdirectories 
//  No version found for this name. Create one. 
/*         private Exception doRequest(String method,                                    String queryString,                                    String contentType,                                    String requestBody,                                    boolean allowBody) {         */
//  Looking for \r\n\r\n 
//  undocumented yet - for embedding apps that are around, alive. 
//  No additional implementation - just need a class that extends BB for   testing EL methods calls 
//  The surrogate pair ends with a high-surrogate. 
//  Modified WAR triggers a reload if there is an XML   file present   The only resource that should be deleted is the   expanded WAR (if any) 
//  If this is missing, 
//  First request in separate thread because the response won't be 
//  Copying source to destination 
/*  Timestamp of last time servlet resource was modified  */
//  Store nested <CookieProcessor> elements 
//  If the path is already context-relative, just pass it through 
//  Identify which parameter isn't an exact match 
//  Be VERY careful if you call this method directly. If it is called   twice for the same socket the JVM will core. Currently this is only   called from Poller.closePollset() to ensure kept alive connections   are closed when calling stop() followed by start(). 
//  record the location of the first non lwsp and drop down to process the   token characters. 
//  no error message provided 
//  check the application itself for the extension 
// if var specified, put the current token into the attribute "var" defines. 
//  Lazy init 
//  Stop the evictor before the pool is closed since evict() calls 
//  if there were non-metacharacters, copy them all as a block 
//  Password on PooledConnectionAndInfo does not match 
// this should never be called with a network buffer that contains data  so we can clear it here. 
// message-destination 
//  Method call not at end of expression 
//  Load and initialize all "load on startup" servlets 
//  HTTP separators less comma, semicolon and space since the Netscape   spec defines those as separators too.   '/' is also treated as a special case 
//  a.addBeforeOrdering("c"); 
//  Indicates that two replacement characters are missing 
//  The browser isn't expecting this conditional response now.   Assuming that it can quietly recover from an unexpected 412.   BZ 43687 
/*              * Generate a 'attr = "value"' for each <jsp:param> in plugin body              */
//  the specified paramType is not String. 
//  not point to a file 
//  Don't ignore RuntimeExceptions thrown by   this method 
//  Redirect to the corresponding SSL port 
//  Can't normalize canPath earlier as canonicalBase is not normalized 
//  Access log 
//  We've got to resolve the very call to the interpreter   at runtime since we don't know what type to expect   in the general case; we thus can't hard-wire the call   into the generated code. (XXX We could, however,   optimize the case where the bean is exposed with   <jsp:useBean>, much as the code here does for   getProperty.) 
//  host's configBase 
//  ************************************************************************   General Purpose Runtime Methods   ************************************************************************ 
//  child.destroy() may have already been called which would have   triggered this call. If that is the case, no need to destroy the   child again. 
// to use encodeInteger we need to place the first byte in the buffer. 
//  Echo the message back 
//  see tearDown()! 
//  If specified, Implementation Vendor ID must match 
//  Allowed roles should be the union of the roles in the constraints   User role is in first constraint 
//  We must have a begin and end attributes 
//  Check each defined security constraint 
//  Even if the resource content larger than objectMaxSizeBytes   there is still benefit in caching the resource metadata 
//  Store image as PNG 
//  Note: ECB is not an appropriate mode for secure communications.              return new ECBEncryptionManager(algorithm, new SecretKeySpec(encryptionKey, algorithmName), providerName); 
//  Always set httpOnly if the context is configured for that 
//  Store nested <Sender> element 
//  Partially processed the request so need to respond 
//  The handshake process reads/writes from/to the   socket. status may therefore be OPEN_WRITE once   the handshake completes. However, the handshake   happens when the socket is opened so the status   must always be OPEN_READ after it completes. It   is OK to always set this as it is only used if   the handshake completes. 
//  any other exception or error is odd. Here we log it   with "ERROR" level, so it will show up even on   less-than-verbose logs. 
//  Testing 
//  Not sure we need this 
//  The surrogate pair starts with a low-surrogate. 
//  Has to match signature in DataSource 
//  111ozzzz 
// we have done our initial handshake 
// create a add value button 
//  Check for universal mapping 
//  Register with MBean server 
// optimization, if we do have a writable channel, write it now 
//  If you manage to get more than 100 million of ids, you'll   start getting ids longer than 8 characters. 
//  -------------------------------------------------- CORS Response Headers 
//  If there is only one, consider it to be /the/ user 
//  Add new members or refresh the members in the membership 
//  Request attribute support 
//  Don't start host if already started 
//  Order is important for the error handling below.   Must look up c1 first. 
// Variables like DATE_LOCAL, DATE_GMT, and LAST_MODIFIED need to be   updated when  the timefmt changes. This is what Apache SSI does. 
//  [seguin] added for consistency -- most other objects have recycle(). 
//  reverse that so this valve can write to the response. 
//  of the digester's stack 
/*      * Fatal error. Usually an I/O error. Try and send notifications. Make sure     * socket is closed.      */
//  Invalid field-name, skip to the next one 
//  Manager is required for remaining check 
//  ----------------------------------------------------------------------   Instrumentation Methods 
// only once per VM 
//  Detect format error at translation time 
//  instance of TagExtraInfo 
//  Given the minIdleSwap settings, this should swap one out to get below 
//  Connection properties 
//  these are lazy created to reduce memory overhead 
//  Keep the original configuration line as it is not possible to get   the parameters back without an API change 
//  The APR/native connector always supports ALPN if TLS is in use   because OpenSSL supports ALPN. Therefore, this is equivalent to   testing of SSL is enabled. 
//  handle assigning deferred vars to VariableMapper, storing   previous values under '_el_ve[i]' for later re-assignment 
//  Delete reload resources (to remove any remaining .xml descriptor) 
/*  Callers of this method must:         * - have acquired the readPending semaphore         * - have acquired a lock on readCompletionHandler         *         * This method will release (or arrange for the release of) the         * readPending semaphore once the read has completed.          */
//             // ignore 
//  Validate host 
//  override those in annotations 
// make sure that the session gets ready to expire if 
//  Delete destination resource, if it exists 
//  --------------------------------------------- SSL is not supported in AJP 
//  Build scheme://host:port from request 
//  Since authenticate modifies the response on failure, 
//  use the loader Registry 
//  This class's class loader if no joy with the tccl 
//  Create dummy root and initialize it with given page encodings 
//  any active event. 
//  Test behavior needs to adjust for OpenSSL 1.1.1-pre3 and above 
//  There should be no data to read 
//  do nothing 
//  Add the roles as additional subjects as per the contract with the   JAASRealm 
//  Release Stream 15 which is waiting for a single byte. 
/*  for MBean to read ready and busy  */
//  Protect against NPEs if the context was destroyed during a 
//  Skip null valves 
//        null of *any* other type so this works. 
//  NO-OP by default 
//  Configure the socket 
//  filter-mapping/dispatcher/ASYNC added in Servlet 3.0 
//  Third example from spec with e & f added 
// unlock the global lock 
//  Only those fragments listed should be processed 
//  Set maximum messages size to 10.000 bytes. 
//  Handle dynamically removing host aliases 
//  finally, provide credentials to confirm the resource 
/*      * Pulled out into a separate method in case we need to handle other unusual     * sequences in the future.      */
//  ------------------------------------------------------- Private Methods 
//  No match with previous registration so need to check listeners   for all less specific registrations to see if they need to be   notified of this new registration. That there is no exact match   with a previous registration allows a few short-cuts to be taken 
//  We're done. 
/*      * ScriptlessBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.'     * XMLDirectiveBody ) | ( '<%!' <TRANSLATION_ERROR> ) | ( '<jsp:declaration'     * <TRANSLATION_ERROR> ) | ( '<%=' <TRANSLATION_ERROR> ) | ( '<jsp:expression'     * <TRANSLATION_ERROR> ) | ( '<%' <TRANSLATION_ERROR> ) | ( '<jsp:scriptlet'     * <TRANSLATION_ERROR> ) | ( '<jsp:text' XMLTemplateText ) | ( '${'     * ELExpressionBody ) | ( '<jsp:' StandardAction ) | ( '<' CustomAction     * CustomActionBody ) | TemplateText      */
//  (2 bytes for length, each cipher ID is 2 bytes) 
//  Ran out of message buffer - exit inner loop and   refill 
//  Update the UID on initial lookup 
//  Retrieve and remove the SavedRequest object from our session 
//  Try to flush all data 
//  NOTE: The expected values must themselves be \ escaped below 
//  Handle special case because the syntax for the empty set is the same 
//  AES should beat CAMELLIA 
//  Try from the current loader (that's the case for trusted apps)   Should only be required if using a TC5 style classloader structure   where common != shared != server 
//  type (0 for data)   flags (0)   stream (0)   payload (0) 
//  verify the sessionID has not changed 
/*      * test cases with good BASIC Auth credentials - Base64 strings     * can have zero, one or two trailing pad characters      */
//  Use the thread local mapping data 
//  -------------------- JMX registration  -------------------- 
//  Create blank instance 
//  Extension wrapper 
//  - content type (note: this will not force the content type, use a filter 
//  The JDBC specification requires that a Connection close any open   Statement's when it is closed.   DBCP-288. Not all the traced objects will be statements 
//  interrupted 
//  Deploy expanded folder 
//  The remainder of the processing needs to know about container 
//  Check a known attribute 
//  Context doesn't use version directly 
//  response will be empty if this exception is thrown 
/*          * This method is called as part of the custom tag's start element.         *         * If the given custom tag has a custom nesting level greater than 0,         * save the current values of its scripting variables to temporary         * variables, so those values may be restored in the tag's end element.         * This way, the scripting variables may be synchronized by the given         * tag without affecting their original values.          */
//  Store nested <SessionIdGenerator> element; 
//  Use a single listener for read and write. Listeners often need to   share state to coordinate reads and writes and this is much easier as 
//  makes parsing simpler. 
//  (0) Check our previously loaded class cache 
//  Should use POST 
//  Set up the context init params 
// if they are, simply issue the memberAdded message 
//  Most likely cause is a user closing their browser. Check to see if   the root cause is EOF and if it is ignore it.   Protect against infinite loops. 
//  -------------------- utils -------------------- 
/*  Generated By:JJTree: Do not edit this line. AstDiv.java  */
//  Assume EVAL_BODY_BUFFERED 
//  Construct an object name with the right domain 
//  See if the URLHandler can resolve it 
//  End of /* */ comment 
//  Cleanup, in case the page ends with a template text 
//  A failure here is not fatal as the directory may be unavailable   now but available later. Unavailability of the directory is not   fatal once the Realm has started so there is no reason for it to   be fatal when the Realm starts. 
//  ------------------------------------------------------- Public Methods 
//  POST with overlapping GET and POST parameters 
//  nested handler so handler may be null. 
//  NoOp 
//  list. 
//  NO-OP. WebSocket has no requirement to access the TLS information   associated with the underlying connection. 
//  Use the POJO message handler wrappers as they are designed to wrap   arbitrary objects with MessageHandlers and can wrap MessageHandlers   just as easily. 
//  Separated out to make it easier for folks that extend NioEndpoint to 
//  Append the helper class 
//  Default name is "other" per JAAS spec 
// msg.setMsgNr((int)++total); 
//  WebSocket version header 
/*          * Clone the returned array only if there is a security manager         * in place, so that performance won't suffer in the non-secure case          */
//  No methods 
//  Check SSL has not be configured with anything else 
//  Swallow all exceptions apart from those that must be re-thrown 
//  Iterator 
//  we are here, since close on is failed. That means it was not null 
//  A connection for the connection factory has already been enrolled   in the transaction, replace our delegate with the enrolled connection 
/* --Deployer Operations ------------------------------------ */
//  Make sure we get the original 500 response and not a 405 response   which would indicate that error.jsp is complaining about being called 
// get the value of the "delim" attribute 
//  Is this request URI subject to a security constraint? 
//  Name of jar file 
//  Add or replace the specified attribute 
//  Spec does not define an order. 
//  Fire "body" events for all relevant rules 
//  Add '/' so it isn't encoded when we encode a path 
//  -------------------------------------------------------- Private Methods 
// prepare the buffer with the incoming data 
//  ------------------------------------------------------- Abstract methods 
//  Can't use StringBuilder due to DateFormat 
//  This must be the EOS symbol which MUST be treated   as an error 
//  The pool has been dereferenced and the class loader   GC'd. Cancel this timer so the pool can be GC'd as   well. 
//  After a last wrap, consider it is going to be done 
//  prevent it from looking ( if it finds one - it'll have dup error ) 
//  is. 
//  so hasData() will return false, and this method can return -1 
/*  * Originally written by Jason Hunter, http://www.servlets.com.  */
//  If there are too many open streams, simply ignore the push   request. 
//  we can't assume the chain flushed its output 
// create a channel object 
/*      * Replaces the text at the start of START_TEXT with PATCH_TEXT.      */
//  Now use a settings frame to increase the size of the flow control 
// now the total buffer has to be long enough to hold 
/*              * Make sure the encoding explicitly specified in the XML             * prolog (if any) matches that in the JSP config element             * (if any), treating "UTF-16", "UTF-16BE", and "UTF-16LE" as             * identical.              */
//  Use mark(1)/reset() rather than skip(-1) since skip() is a NOP   once the end of the String has been reached. 
//  Fail if no entries found 
//  Delete   Purge the cookie's value 
//  Now check the value reference 
//  Check the length 
//  Acquire global JNDI resources if available 
//  Control frames are never compressed and may appear in the middle of   a WebSocket method. Pass them straight through. 
//  Take a copy of the buffer so the original cookie header is not   modified by this unescaping. 
/*      * Confirm the Basic parser tolerates excess white space after     * the authentication method.     *     * RFC2617 does not define the separation syntax between the auth-scheme     * and basic-credentials tokens. Tomcat tolerates any amount of white     * (within the limits of HTTP header sizes).      */
//  Append stack trace if not null 
/*      * isThreadSafe      */
//   this keeps this test from slowing things down too much 
//  Data frames 
/*  Only look for error pages when isError() is set.         * isError() is set when response.sendError() is invoked. This         * allows custom error pages without relying on default from         * web.xml.          */
//  Use lastAsyncStart to determine if this instance has been used since   it was last recycled. If it hasn't there is no need to recycle again 
//  Set the async timeout 
//  Initializing classpath 
//  Check if content is not already compressed 
//  -------------------- Headers -------------------- 
/*  ARIA ciphers 0xC058 to 0xC05B     * Unsupported by both Java and OpenSSL      */
/*  Generated By:JavaCC: Do not edit this line. JSONParser.java  */
//  Establish the connection with the server 
//  now 
//  Is the passed in Stream a descendant of this Stream?   Start at the passed in Stream and work up 
/*  JavaCCOptions:KEEP_LINE_COLUMN=true  */
//  Manager may be null during replication of new sessions in a   cluster. Avoid the NPE. 
//  handle int overflow 
//  File exists but failed to load 
/*      * Encapsulate the logic to generate an HTTP header     * for BASIC Authentication.     * Note: only used internally, so no need to validate arguments.      */
//  Flushing should happen automatically on session close 
//  JASPIC API uses raw types 
//  sometimes we get uri's massaged from File(String), so check for   a root directory separator char 
//  Make sure that the response object is not the wrapper for include 
//  Initialize the path elements for this request 
// were included, but not sure how else to tell. 
//  this is not a decoded token. 
/*  * Tests compatibility of JSSE and OpenSSL settings.  */
//             throw new IllegalArgumentException                  ("Login Page resource path must start with a '/'"); 
//  Client host 
//  Generate imports 
// not thread safe, but don't sacrifice performance for this kind of stuff 
//  Request a page that does not exist 
//  Only one context deployed 
//  Setting the result marks this (partial) message as   complete which means the next one may be sent which   could update the value of the handler. Therefore, keep a   local copy before signalling the end of the (partial)   message. 
// ------------------------------------------------------ Non-blocking writes 
//  HTTP/2 started via HTTP upgrade.   The initial HTTP/1.1 request is available as Stream 1. 
//  Reset counter 
//  Multiple content lengths 
/*      * Hostname (with port) is included in the request line, but Host header     * is empty.     * Added for bug 62739.      */
//  errors are handled higher up. 
//  Check for a default factory 
//  No -- Save this request and redirect to the form login page 
//  ==== methods using the TLD data ======= 
//  Declaration 
//  Normal close: underlying connection is still open, so we   simply need to return this proxy to the pool 
//  Locking a single resource 
//  Check the number of classes in the cache 
//  Note: Whilst the Servlet 2.4 DTD implies that the location must   be a context-relative path starting with '/', JSP.7.3.6.1 states   explicitly how paths that do not start with '/' should be   handled. 
//  get all sessions and serialize without sync 
/*  Experimental (and now expired) TLSv1 versions of SSLv3 ciphers.     * Unsupported by Java and OpenSSL 1.1.x onwards. Some earlier OpenSSL     * versions do support these.  */
//  Check SRV.8.2 / SRV.14.2.5.1 compliance 
/*      * Work through input looking for literals and expressions until the input     * has all been read.      */
//  Ping ack 
//  Traces order of events across multiple components 
//  OpenSSL typically returns null whereas JSSE typically   returns "" when no protocol is negotiated 
// =================================================================         NOTIFICATION INFO 
//  Welcome files with query strings 
//  ---------------------------------------------------- Security Classes 
//  If this is a scriplet node then there is a one to one mapping   between JSP lines and Java lines 
//  Ordering is important here 
//  Check the access log 
//  Split using a positive lookahead to keep the separator in   the capture so we can check which case it is. 
//  Nulls cause NPEs further down the line 
//  Don't call noCache(path) since the class loader only caches   individual resources. Therefore, always cache collections here 
//  A null could mean that the class not present in application or   that there is nothing of interest. Either way, nothing to do here   so move along 
//  Configure using standard JMX system properties 
//  Skip anonymous inner classes 
//  the count for the string 
//  Custom authenticator that may not trigger authorization.   Do the authorization here to make sure it is done. 
//  Map the Java lines that handles start of custom tags to the 
//  Create and register with the queue 
//  Request body was too large for save buffer   Return null which will trigger an auth failure 
//  the earliest possible moment 
//  Can't tell what was happening when the error occurred but the   socket is registered for non-blocking write so use that 
// final JTable table = new JTable(data, columnNames); 
// alive data 
//  0 1 2 3   (01o00000b << 6)+(1o000000b)   (011o0000b << 12)+(1o000000b << 6)+(1o000000b)   (0111o000b << 18)+(1o000000b << 12)+(1o000000b << 
//  Need to read more data into buffer 
//  Removing children 
/*  If a quote appears that matches quote, must it always be escaped? See     * JSP.1.6.      */
//  TODO use ByteBuffer.wrap to avoid copying the data. 
//  Hostname safety 
/*  11 == length("org.apache.")  */
//  Retrieving the EJB link 
//  Create the MBeans for each defined Group 
//  This may be sufficient to complete the request and we   don't want to trigger another read since if there is no   more data to read and this request takes a while to 
//  Could null out objects here 
//  Package private to facilitate testing 
//  Get encoding for the logging file 
//  Compute a crossContext flag 
//  Have to be static to be able to retrieve results from test case 
//  Hosts Header Section 
//  When coercing an Enum to a String, name() should always be used. 
//  Path should never be null, '/' or '/ROOT' 
// env-entry 
//  Don't trigger WebSocket initialization if a WebSocket Server   Container is already present 
//  Invalid no equals 
//  All data has now been written 
//  Incorrectly escaped. 
//  null input should be ignored 
//  Generate code for method declaration 
//  There won't be any application data until we're done handshaking   
//  A no context manager message is replied in order to avoid   timeout of GET_ALL_SESSIONS sync phase. 
//  setter method 
//  Scan the nodes for presence of Jasper generated inner classes 
//  Check monitored threads, being careful that the request might have   completed by the time we examine it 
//  This one does NOT get an extra/empty definition (no trailing whitespace) 
//  Configure decoder to fail on an error 
//  Store nested <OpenSSLConf> element 
//  Use this class's classloader as Ant will have set the TCCL to its own 
//  Remove host 
//  ------------------------------------------------------------ Private Classes 
//  The response should end with CRLFCRLF 
//  12 bits = 8 + 4 
// remove the last added element 
//  Must be wss due to scheme validation above 
//  mutate() method. 
// we got interrupted 
//  Per key 
/*      * (non-Javadoc)     *     * @see java.lang.Object#hashCode()      */
//  Rethrow original exception so it is visible to caller 
//  ---------------------------------------------------------- Realm Methods 
//  References to objects we will need later 
//  Note: Proxy is not supported as Tomcat does not have proxy         capabilities 
//  re-add it with a very short timeout 
// it is to big to fit, so we just completely clear the table. 
/*      * To simplify the mapping process, wild card hosts take the form     * ".apache.org" rather than "*.apache.org" internally. However, for ease     * of use the external form remains "*.apache.org". Any host name passed     * into this class needs to be passed through this method to rename and     * wild card host names from the external to internal form.      */
/*      * StandardAction ::= 'include' StdActionContent | 'forward'     * StdActionContent | 'invoke' StdActionContent | 'doBody' StdActionContent |     * 'getProperty' StdActionContent | 'setProperty' StdActionContent |     * 'useBean' StdActionContent | 'plugin' StdActionContent | 'element'     * StdActionContent      */
//  Close our prepared statements (if any) 
//  Convert, line-by-line: 
// invoke the method through the reflection 
//  Check that host alias has the same data 
//  Advance to the next request in the chain 
// service-ref 
//  To advertise a different default to the client specify it here but DO NOT 
//  response at this point 
/*      * Constructor      */
//  -------------------------------------------- ClassLoaderInfo Inner Class 
//  Fast for valid numeric characters, slower for some incorrect   ones 
//  Issue 1 
//  Skip classes already listed   Skip public inner class   Skip public inner class   Skip public inner class   Should have in list 
//  Check to see if we have read any of the request line yet 
//  Process the input file to configure our registry 
// if we exchanged an object with another thread, wake it up. 
//  Parse session id from cookies 
/*                  * For fragments, their bodies will be generated in fragment                 * helper classes, and the Java line adjustments will be done                 * there, hence they are set to null here to avoid double                 * adjustments.                  */
// read more data, reregister for OP_READ 
//  ---------------------------------------------- LifecycleListener Methods 
//  write direct to gzip 
//  Connection: close header. 
//  Do we have enough room in dst to write encrypted data? 
//  If already closed, don't call onError and close again 
// the target is ok 
//  Much larger 
//  Worst case scenario 
//  File.getCanonicalPath() 
// Here comes the bug! No more active connections and unable to establish new connections. 
//  Validate preface content 
// cut off file name 
//  Initializing sourcepath 
//  Required attribute of web-app element 
//  Use the resource content directly 
/*  stream + static  */
//  Default for Connector depends on this system property 
//  Check again, now we are inside the sync so this code only runs once   Double check locking - isValid needs to be volatile 
//  Only report drivers that were originally registered. Skip any 
/*      * Tag Files      */
//  We'll send the attribute change notifications to all listeners ( who care )   The normal filtering can be used.   The problem is that there is no other way to add attribute change listeners   to a model mbean ( AFAIK ). I suppose the spec should be fixed. 
//  Re-encode the request body so that bytes = characters 
//  Note FileUtils.getFileUtils replaces FileUtils.newFileUtils in Ant 1.6.3 
//  May be dealing with an application set header, or multiple headers.   Header names overlap so can't use String.contains(). Have to parse   the existing values, check if the new value is already present and   then add it if not. The good news is field names are tokens which 
//  Two JSSE names 
//  Which user principal have we already authenticated? 
//  If we are nested inside a false branch then pop out 
//  Send j2ee.object.deleted notification 
//  Process annotations 
//  Attributes of the current frame 
//  Use standard test webapp as ROOT 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=57054 
/* org.apache.coyote.Constants.STAGE_KEEPALIVE */
//  If initialSize > 0, preload the pool 
//  Finish the handling of the request 
//  Header (5) + Data (2^14) + Compression (1024) + Encryption (1024) + MAC (20) + Padding (256) 
/*      * Initialize character translation and type tables.      */
//  Get the cookie/attribute name. This must be a token 
/*  -------------------------------- *     * Validation onConnect             *     * --------------------------------  */
//  Page encoding can only occur once per file so a second   attribute - even one with a duplicate value - is an error 
//  Fake re-deploy resource to detect if a WAR is added at a later 
//  from J2EE 1.4 
// leave mcast group 
//  ----------------------------------------------------------- Constructors 
//  Lock (if required) while getting or creating bean 
//  NO-OP for the terminal transformations 
//  Should have a canonical path 
//  Shortcut should fail too 
//  Test that denying uncovered HTTP methods when adding servlet security   constraints programmatically does work. 
//  When running with SecurityManager, some classes may be   not accessible, but have accessible interfaces. 
//  Values <0 mean use the implementation default 
//  Ensure the next test is not affected 
//  Longer alive time, means sort first 
//  Must start with '[' 
//  Allowed roles should be the union of the roles in the constraints   Constraint with empty auth section prevents all access   User has matching constraint role 
//  Ensure clean-up takes place 
//  This is to avoid rounding issues triggering an infinite   loop. It will cause a very slight over allocation but   HTTP/2 should cope with that. 
// Remove any variables that are reserved by this class 
//  Over-ridden to add cast 
//  Cause this session to expire 
//  Failed. 
//  Assume resources inside WARs will not change 
//  If the executor has not terminated, there is a thread/memory leak 
//  A blocking flush will always empty the buffer. 
//  Assume the client is at fault 
// perform the wrap function 
// in case disconnect has been called 
// this happens before the request 
//  Check again, now we are inside the sync so this code only runs once   Double check locking - isValid needs to be volatile   The check of expiring is to ensure that an infinite loop is not 
//  @HandlesTypes matches 
//  Cache, if used, is no longer required so clear it 
//  Send the ping message 
//  Calculate the directory into which we will be deploying applications 
/*      * Note: populateHost() is not over-ridden.     *       request.serverName() will be set to return the default host name by     *       the Mapper.      */
/*  * Extends {@link AjpMessage} to provide additional methods for reading from the * message. * TODO: See if it makes sense for any/all of these methods to be transferred to *       AjpMessage  */
//  Need at least two bytes of data to do this 
//  Header names are encoded as either an integer code starting   with 0xA0, or as a normal string (in which case the first   two bytes are the length). 
//  or use some other statement which will block   for a longer time 
//  Use ordered JARs followed by remaining JARs 
//  Configuration properties 
//  Socket and socket pool 
//  Create and add the void filters. 
//  Write captured output 
//  Too small should fail   Response code will be OK, but parameters list will be empty 
//  10053 on Windows is connection aborted 
//  Need to get references to:   in Sun/Oracle JDK:   - newTasksMayBeScheduled field (in java.util.TimerThread)   - queue field   - queue.clear()   in IBM JDK, Apache Harmony:   - cancel() method (in java.util.Timer$TimerImpl) 
//  Not running in a Servlet 2.2 container.   Try to get the JDK 1.2 java.io.tmpdir property 
//  Send a ping to get an idea of round trip time as early as possible 
//  Go away 
/*  * Interface for handling JSP parse and javac compilation errors. * * An implementation of this interface may be registered with the * ErrorDispatcher by setting the XXX initialization parameter in the JSP * page compiler and execution servlet in Catalina's web.xml file to the * implementation's fully qualified class name. * * @author Jan Luehe * @author Kin-man Chung  */
//  Set the new host if it changed 
//  Get the number of headers 
//  Use XOR 
/*  SSL_kRSA   - RSA key exchange  */
// return a future with the item 
//  Get bean one to be sure it has been replaced when testing replace 
//  Make sure parseBodyMethodsSet has a default 
//  Request must be HTTP/1.1 to support trailer fields 
//  FIXME: i18n 
//  represents nothing having been set. This will be seen 
/*      * Test session.invalidate() in a clustered environment.      */
// make sure we don't retrieve from ourselves 
//  Copy WAR to appBase 
//  verify the sessionID was encoded in the absolute URL 
// allow close to be called multiple times 
//  class HTTPHeaderInputStream 
//  Cannot reliably serve partial content with a Writer 
/*          * Determine which context object to use.          */
//  Add the properties of the protocol handler 
// ------------------------------------------------------------ Section 3.2.1 
//  Headers should be the same (apart from Date) 
//  The reservation has been fully allocated   so this stream can be removed from the   backlog. 
// we can get here through a recursive call  by using the NioBlockingSelector 
//  Sort the entries according to occurrence 
//  Pong message.   Do nothing. 
//  Give the original thread a chance to exit the   ErrorReportValve before we throw this exception 
//  Rule 4c -- Welcome resources processing 
//  Response 200 
//  context-param 
//  ---------- Helper methods and classes ------------------- 
//  Assemble the class path information from our class loader chain 
/*      * Logs the given throwable.     * @param message TODO     * @param throwable the throwable.     *     * @since 2.7.0      */
//  Need to find a common type amongst the injection targets 
//  merge tomcat-web.xml 
//  ------------------------------------------- Nested configuration elements 
//  Return the latest version   The versions array is known to contain at least one element 
//  This is the transaction on the thread so no need to check it's status - we should try to use it and   fail later based on the subsequent status 
//  Unusual not to be able to transfer any bytes   Check the length was set correctly 
//  these should really be singletons to be type-safe, 
//  Read all the backslashes 
/*      * Repeatedly access the protected resource after the client has     * successfully logged-in to the webapp. The current session attributes     * will be used and cannot be changed.     *  3. after successful login, follow the redirect to the original page     *  4. repeatedly access the protected resource to demonstrate     *     persistence of the authenticated session     *     * @param resourceMethod HTTP method for accessing the protected resource     * @param protectedUri to access (with or without sessionid)     * @param useContinue whether the HTTP client should expect a 100 Continue     * @param clientShouldUseCookies whether the client should send cookies     * @param serverWillUseCookies whether the server should send cookies     *      */
//  Count the number of array dimension 
//  (0.5) Permission to access this class when using a SecurityManager 
//  under the fileBase so all further checks are disabled. 
//  Copy the raw URI to the decodedURI 
//  Setup a simple default Instance Manager 
//  Filter out non-JAR resources 
//  elapsed may be negative if:   - another thread updates lastReturnTime during the calculation window   - System.currentTimeMillis() is not monotonic (e.g. system time is set back) 
//  6)+(1o000000b) 
//  Look for a match 
//  simply capture it 
//  Avoid ArrayIndexOutOfBoundsException   Probably bug 48498 but could be some other cause 
//  Set a username only if there is no session cache for the principal 
/*      * The purpose of this class is to provide a way for HostConfig to get     * a Context to delete an expanded WAR after the Context stops. This is to     * resolve this issue described in Bug 57772. The alternative solutions     * require either duplicating a lot of the Context.reload() code in     * HostConfig or adding a new reload(boolean) method to Context that allows     * the caller to optionally delete any expanded WAR.     *     * The LifecycleListener approach offers greater flexibility and enables the     * behaviour to be changed / extended / removed in future without changing     * the Context API.      */
/*  (non-Javadoc)     * @see java.lang.Object#equals(java.lang.Object)      */
//  Close the connection. 
//  These have been removed from all supported versions. 
//  XP 32-bit SP3 - needs redirect with explicit port 
/*      * Logon to access a protected resource using BASIC authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp, but without sending the SSO session cookie.     * This should be rejected with SC_FORBIDDEN 403 status.      */
//  key: attribute val: getter method 
// tmp.getMessage().append(flag,0,flag.length); 
//  Accept only the first session id cookie 
/*      * Tests for failure, when the 'null' origin is used, and it's not in the     * list of allowed origins.      */
//  second 
//  If a prefix is defined look for a prefixed property first 
//  used 8k (56k -1). Increase it to 57k 
//  Register and map servlet 
//  First byte F1..F3, second byte 80..BF 
//  associate the SingeSignOn Valve before the Contexts 
//  Test "addConnectorPort" and with port not matching in both patterns 
// add ourself as a listener for memberships 
//  Retain '/simple' url-pattern since it enables code re-use 
//  Deploy the files we copied 
//  HTTP2 upgrade 
/*                  * This method is called when non-blocking IO is initiated by defining                 * a read and/or write listener in a non-container thread. It is called                 * once the non-container thread completes so that the first calls to                 * onWritePossible() and/or onDataAvailable() as appropriate are made by                 * the container.                 *                 * Processing the dispatches requires (for APR/native at least)                 * that the socket has been added to the waitingRequests queue. This may                 * not have occurred by the time that the non-container thread completes                 * triggering the call to this method. Therefore, the coded syncs on the                 * SocketWrapper as the container thread that initiated this                 * non-container thread holds a lock on the SocketWrapper. The container                 * thread will add the socket to the waitingRequests queue before                 * releasing the lock on the socketWrapper. Therefore, by obtaining the                 * lock on socketWrapper before processing the dispatches, we can be                 * sure that the socket has been added to the waitingRequests queue.                  */
//  Apply OpenSSLConfCmd if used 
//  VALIDATE 
//  This is the first fragment of this message 
// *********************************************************************   Private utility methods 
//  register the context (or create a new one) 
//  Add to the list for that count 
//  Test for all the classes and interfaces in StandardContext's type hierarchy 
//  Remove from trace now because this statement will be   added by the activate method. 
//  If not SingleThreadedModel, return the same instance every time 
//  Set certificate chain file 
//  mostly default configuration : enable "x-forwarded-proto" 
//  First 1k of body 
//  Did we find any unexpected MBeans? 
//  Methods used by SocketInputBuffer 
//  payload (pad length of 1) 
//  --------------------------------------------------------- Public methods 
//  Need ordered set of names 
//  Check host header 
//  Mark the connection as upgraded 
//  Unexpected state 
//  if the application is metadata-complete then we can skip fragment processing 
//  The container is responsible for the first call to   listener.onWritePossible(). If isReady() returns true, the container   needs to call listener.onWritePossible() from a new thread. If   isReady() returns false, the socket will be registered for write and   the container will call listener.onWritePossible() once data can be 
//  jspFile for a jsp configured explicitly as a servlet, in environments where this 
//  Store nested <Realm> element 
//  ServletRequestListener to complete 
//  Configure the Realm 
//  Statistics from the thread pool 
//  Ignore the latch result as the message count test below will tell us 
//  BlockingQueue methods 
//  crossContextSessions.remove() only exist at Java 5   register ArrayList at a pool 
//  Occasionally the directory context will timeout.  Try one more 
//  Not for use in normal unit test runs 
//  RFC 6266. This is either a token or a quoted-string 
//  Test code assumes connection window and stream window size are the same at the start 
// if the attribute var has been specified then assign the result to the var; 
//  <jsp:attribute> 
// pause, once or twice 
// XByteBuffer buffer = new XByteBuffer(b.length+128,false); 
//  Header   length 
//  }) 
//  Encoding names should all be ASCII 
//  Check for a full URI (including protocol://host:port/) 
//  Version 1 (RFC2109) attributes 
//  Reference loop (but not circular dependencies) 
//  Parse 'Attributes' production: 
/* end properties for the statement cache */
// ===============================================================================    JMX Operations - Register the actual pool itself under the tomcat.jdbc domain  =============================================================================== 
//  ignore is normal at shutdown or stop listen socket 
//  there is a modification in a resource. 
//  jsp-config/jsp-property-group 
//  The handler will initiate all further I/O 
//  Create variable names 
//  A child resource of this collection is locked 
//  Length without zone ID (%zone) or IPv4 address 
//  Acquire a reference to the component to be removed 
//  Compare the two. If they are not the same, the contextPath must 
//  Keep from being marked abandoned 
//  Actually perform the write 
/*          * When an SSLHostConfig is replaced at runtime, it is not possible to         * call destroy() on the associated OpenSSLContext since it is likely         * that there will be in-progress connections using the OpenSSLContext.         * A reference chain has been deliberately established (see         * OpenSSLSessionContext) to ensure that the OpenSSLContext remains         * ineligible for GC while those connections are alive. Once those         * connections complete, the OpenSSLContext will become eligible for GC         * and this method will ensure that the associated native resources are         * cleaned up.          */
// construct a access message 
//  Added from OpenJDK 12 ea28 
//  Empty at this point 
/*  Socket.get types  */
//  Should never happen... 
//  Don't delay on first exception 
//  Next check that an .xsl or .xslt file has been specified 
// sessionId - String  recordAll - boolean  size - int  AttributeInfo - in an array 
//  For calls from outside the Poller, the caller is   responsible for registering the socket for the   appropriate event(s) if sendfile completes. 
//  Allowed roles should be the union of the roles in the constraints   ** is any authenticated user   User has constraint role 
//  Stop the Valves in our pipeline (including the basic), if any 
//  Remove the specified welcome file 
//  If "class" is specified, try an instantiation at compile time 
//  Propfind depth 
//  Log this message 
//  Some messages sends are expected to fail. Assertions further on   in this method will check for the correct behaviour so ignore any   exception here. 
//  If partial messages are supported, send what we have   managed to decode 
//  Skip if null values were passed in. They indicate a function   added via a lambda or ImportHandler; nether of which need to be   placed in the Map. 
//  not valid anymore 
/*  Set on servers to choose the cipher according to the server's     * preferences  */
//  Add names of attributes specified using jsp:attribute 
//  Saves a call to getClassLoader() on very request. Under high load these   calls took just long enough to appear as a hot spot (although a very 
//  When merging, the default welcome files are only used if the app has 
//  Is this a crawler - check the UA headers 
/*  SC_NOT_IMPLEMENTED  */
//  Try the authentication again. 
//  Valve.init requires all of this stuff 
//  Append any methods that were generated in the buffer. 
//  Edge case. If value starts with '=' but this is not   allowed in a value make sure we treat this as no 
//  Out of sync block - there is no need for other threads to   wait for us to construct a tag for this thread. 
//  0x00 0x00 
//  Player can be null if it couldn't enter the room 
//  Is it explicitly suppressed, e.g. in embedded environment? 
//  Chrome 50 Accept-Encoding 
//  we are try but no luck 
//  Part 2 
//  the connection. 
/*      * Represents a character token in EL      */
//  current stream 
//  apply REQUEST to the global dispatcherMapping. 
/*  flags for apr_file_attrs_set  */
//  Reset pointers 
//  Data 
/*  RSA auth  */
//  ---------------------------------------------------- LogNode Inner Class 
//  Third request - the login was successful so 
//  NO-OP: Logging occurs per header 
//  V1 cookies can also use commas to separate cookies 
//  If too many bytes were read, return the amount. 
//  -------------------- Setup -------------------- 
//  If a method is found where every parameter matches exactly, 
/*  SEED ciphersuites from RFC4162  */
//  See class javadoc for explanation of this magic number (12) 
//  Send j2ee.state.running notification 
//  Part 1 
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#getExpectedType()      */
//  Note: We don't care about safety for the stats 
//  Make sure the client has sent a valid connection preface before we 
//  true if a String value was computed. Probably not needed, 
//  for now we don't write out the context in XML 
// see if we meet the requirements to measure 
//  Removing security constraints 
//  Make sure superclass is compatible 
//  Add the associated docBase to the redeployed list if it's a WAR 
//  Password has not changed, so refuse client, but return connection to the pool 
//  Return the parser we already created (if any) 
//  i.e. SC_FORBIDDEN (403 status) will be generated later. 
/*      * Once inside EL, no need to unquote or convert anything. The EL is     * terminated by '}'. The only other valid location for '}' is inside a     * StringLiteral. The literals are delimited by '\'' or '\"'. The only other     * valid location for '\'' or '\"' is also inside a StringLiteral. A quote     * character inside a StringLiteral must be escaped if the same quote     * character is used to delimit the StringLiteral.      */
//  Security constraints 
//  Serve the requested resource, without the data content unless we are   being included since in that case the content needs to be provided so   the correct content length is reported for the including resource 
//  Create the context (don't use addWebapp as we want to modify the 
//  Validate our current state 
//  Writing the byte chunk to the output buffer 
//  Additional infrastructure is required to run this test 
//  notify member 
//  Make sure we can create an instance 
// todo: some form of lookup? 
//  the lock information 
//  400 - Bad Request 
//  Poller isn't running at this point so use destroySocket() 
//  List rulesList = (List) this.cache.get(pattern); 
/*  Everything else being equal, prefer ephemeral ECDH over other key exchange mechanisms  */
//  st is not null when used 
//  Use reflection to get hold of the internal Map 
//  invalid 
//  Also disable TLSv1.3 
//  A child collection of this collection is locked 
//  Content will not be cached but we still need metadata size 
//  Set the default window size to 1024 bytes 
//  Add a broken error page configuration 
//  Prevent starting our own host 
//  Use AsyncChannelGroupUtil to share a common group amongst all   WebSocket clients 
//  Duplicate uriTemplate; 
//  Trying to quote # or $ should throw an error 
//  2.3 and earlier 
//  NO-OP. OpenSSL always supports SSLv2Hello 
//  Reset limit tracking 
//  Duplicate the add and remove lists so that the syncs are   minimised 
//  settings 
//  OpenSSL state 
//  parse TLD but store using the URI supplied in the descriptor 
//  Validates the host name 
//  type 
//  Can't use URI.resolve() because "jar:..." URLs are not valid   hierarchical URIs so resolve() does not work. new URL()   delegates to the jar: stream handler and it manages to figure   it out. 
//  NOOP: Request isn't used so ignore it 
/*      * Logon to access a protected resource using BASIC authentication,     * which will establish an SSO session.     * Wait until the SSO session times-out, then try to re-access     * the resource. This should be rejected with SC_FORBIDDEN 401 status.     *     * Note: this test should run for ~10 seconds.      */
//  and dangerous at worst. 
//  Probably running on Windows so no umask 
/*      * For GetProperty: StdActionContent ::= Attributes EmptyBody      */
//  Need to truncate 
/*  SSL_kECDHe - ECDH cert, ECDSA CA cert  */
//  set to initial position 
//  Check if this is a user-defined tag. 
//  --------------------------------------------------- Socket Wrapper Class 
//  Range header makes no sense for a zero length resource. Tomcat   therefore opts to ignore it. 
//  TODO handler-chains 
//  This triggers the StackOverflowError 
//  Invalid date header - proceed as if none was set 
/*          * Appends XML prolog with encoding declaration.          */
/*      * Tests for failure, when an invalid {@link HttpServletRequest} is     * encountered.      */
//  which will also tear down the SSO session at the same time. 
/*  Generated By:JJTree: Do not edit this line. AstMapEntry.java Version 4.3  */
//  Subsequent requests - keep accessing the protected resource 
//  Check the reason phrase 
/*      * First-pass Visitor for JspRoot nodes (representing jsp:root elements)     * and TablibDirective nodes, ignoring any other nodes.     *     * The purpose of this Visitor is to collect the attributes of the     * top-level jsp:root and those of the jsp:root elements of any included     * pages, and add them to the jsp:root element of the XML view.     * In addition, this Visitor converts any taglib directives into xmlns:     * attributes and adds them to the jsp:root element of the XML view.      */
//  unpackWARs is true. Note the code below may apply further limits 
//  ------------ Implementation for non-declared introspection classes 
//  long running request. 
//  The function map associated this EL 
//  Utility class 
//  Read the header name 
//  See bug 17301 for what could happen when ResultSets are closed twice. 
//  Only try to unlock the acceptor if it is necessary 
//  step 1 - start async 
//  In case the getter returns a defensive copy 
//  Fail in all other cases 
//  Build the custom headers 
// initiate the strEscapeXmlName with true; 
// if we are executing, get the current time 
//  getMembers() may then receive an intermediate result. 
/*  Maximum number of environment variables for create process call  */
/*      * Use this method to filter parser results when comparing them to OpenSSL     * results to take account of unimplemented cipher suites.      */
//  "Creating" a lock-null resource 
//  second, we test the actual effect of the flag on the startup 
//  have a single key so don't need filtering 
//  key cannot be null 
/*      * Happy path test, when a valid CORS Simple request arrives.     *     * @throws ServletException      */
//  Length 
//  Check role names used in <servlet> elements 
//  invoking this wakes up the worker thread then returns  add task to thread pool 
//  Keep empty string default if location is null 
//  receive member shutdown 
// be set to the attribute "var" defines in page scope 
//  no parens here; return whole thing 
//  Just use the name supplied in the Cookie 
//  message-destination was added in 2.4 so should be excluded in 2.3 
//  If no set realm has been called - default to NullRealm   This can be overridden at engine, context and host level 
//  unsigned short 
//  Register this prefix mapping 
//  log message and error 
/*  HMAC based TLS v1.2 ciphersuites from RFC5289  */
//  Always NO-OP for HTTP Upgrade 
//  For each Player, send all per Player buffered   DrawMessages, prefixing each DrawMessage with the player's   lastReceivedMessageId.   Multiple messages are concatenated with "|". 
//  Normal container shutdown processing 
// check to see if we have objects 
//  cookies 
// ignore left overs 
//  Read Stream reset frame 
//  %: server variable as %{variable} 
//  Fall-back to default (ISO-8859-1) 
//  Expect back a request for more data (which will be empty and   trigger end of stream in Servlet) 
//  Add this mapping to our registered set 
//  Make sure we are flushed 
//  Need to instantiate decoder to ensure it is valid and that   deployment can be failed if it is not 
//  create builder 
/*      * Read the body of the server response. Save its contents and     * search it for uri-elements only if requested      */
//  Ensure body is read correctly 
//  Check the allow patterns, if any 
//  Allocate the flush message array 
//  Reset mapping 
/*      * User data management      */
//  Discard connection and set next validation outcome to provided outcome value 
//  Start with methods that are always allowed 
//  depending on type 
//  Start the Valves in our pipeline (including the basic), 
//  ------------------------------------------------------ Private Constants 
//  Send the connector a request for commit. The connector should   then validate the headers, send them (using sendHeaders) and   set the filters accordingly. 
// new headers map 
/* ------------------------------------------------------------------------ */
//  Buffer is 1k. BOM is only 4 bytes. 
//  auth-param = token "=" ( token | quoted-string ) 
/*  Look for properties with explicitly configured setter  */
//  Check 2nd byte 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=61491      */
//  SocketExceptions are normal 
//  Completely replace the message 
//  Read the body, if requested and if one exists 
//  SingleThreadModel 
//  called from different thread which closed the Websocket session. 
//  Store nested <Manager> element 
//  This switch statement is slightly slower   for my vm than the if statement.   Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_07-164) 
/*      * The combining constraints tests are based on the scenarios described in     * section      */
//  PUT and DELETE depend on readonly 
//  Start Tx Thread 
// setLayout(new GridLayout(5, 0)); 
//  Inspired by work on bug 45451, comments from kkolinko on the dev   list and looking at the spec to find some edge cases 
//  Bug 49779 
//  Should list POST as an omitted method 
//  Not a lambda expression so must be a function. Check there is just a 
// unwrap the data 
//  Use pattern or search for user entry 
//  Need to exclude the GOST ciphers 
//  Add  servlet 
//  Identify the class loader we will be using 
//  Servlet 3.1 will call the write listener once even if nothing   was written 
//  Configure the actions we will be using 
//  Listen only on localhost 
//  Copied from org.apache.tomcat.util.buf.HexUtils 
//  Destroy our defined Services 
//  Async requests are supported 
//  Exclude non-public classes   Back to the class name 
//  Verifying configuration created by setUp() 
//  Runnable wrapped by Thread   "target" in Sun/Oracle JDK   "runnable" in IBM JDK 
//  let it stay 
//  parse header   HEADER_MULTI_LINE 
// increment for the next round of back up selection 
/*      * Expected behaviour for the deletion of files.     *     * Artifacts present     Artifact     Artifacts remaining     *  XML  WAR  EXT  DIR    Removed     XML  WAR  EXT DIR    Notes     *   N    N    N    Y       DIR        -    -    -   N     *   N    Y    N    N       WAR        -    N    -   -     *   N    Y    N    Y       DIR        -    Y    -   R     1     *   N    Y    N    Y       WAR        -    N    -   N     *   Y    N    N    N       XML        N    -    -   -     *   Y    N    N    Y       DIR        N    -    -   N     *   Y    N    N    Y       XML        R    -    -   Y     2     *   Y    N    Y    N       EXT        Y    -    N   -     *   Y    N    Y    N       XML        N    -    Y   -     *   Y    N    Y    Y       DIR        R    -    Y   R     1,2     *   Y    N    Y    Y       EXT        Y    -    N   N     *   Y    N    Y    Y       XML        N    -    Y   N     *   Y    Y    N    N       WAR        N    N    -   -     *   Y    Y    N    N       XML        N    N    -   -     *   Y    Y    N    Y       DIR        R    Y    -   R     1,2     *   Y    Y    N    Y       WAR        N    N    -   -     *   Y    Y    N    Y       XML        R    Y    -   Y     *     * Notes: 1. The DIR will be re-created since unpackWARs is true.     *        2. The XML will be extracted from the WAR/DIR if deployXML and     *           copyXML are true.      */
//  Skip base entries where there is a multi-release entry   Skip multi-release entries that are not being used 
//  Auto binding is in use. Check if port is known 
// message-destination-ref 
//  Skip the line and ignore the header 
//  First delimiter may be not preceded with a CRLF. 
//  ClassNotFoundException. 
//  These need to reflect the original resource, not the potentially   precompressed version of the resource so get them now if they are going to 
//  switches to write mode 
//  Buffer needs expansion 
//  Equals character in value 
//  tests context.getRealPath 
//  The code that was notified is now reading its data 
//  Register shutdown hook 
//  name 
//  multipart-config was added in Servlet 3.0 
//  Add endorsed directories if any are specified and we're forking 
//  Close the connection so that it gets reopened next time 
//  Bugzilla 41217 
//  Load our application class 
//  Returns null if directory is not readable 
/*      * Define the certificate algorithm types      */
//  Logger   must not be static 
//  Invalid priority 
//  If socket was registered for multiple events but   only some of the occurred, re-register for the   remaining events.   timeout is the value of System.currentTimeMillis() that   was set as the point that the socket will timeout. When   adding to the poller, the timeout from now in   milliseconds is required. 
/*  Multicast Port  */
//  Next time this method is invoked by the user, we should raise an exception. 
// ------------------------------------------------------------------ write() 
//  If the response is not yet committed, chunked encoding can be used 
//  Reset response fields 
//  Set up an authenticated user 
//  All timeouts in milliseconds 
// no validation required, no init sql and props not set 
/*  Generated By:JJTree: Do not edit this line. AstGreaterThan.java  */
//  If this web application context is running from a 
// --------------------------------------------------------------------------                CONSTRUCTORS / DESTRUCTORS  -------------------------------------------------------------------------- 
//  Therefore, set the Vary header to keep proxies happy 
//  May be expected when working with a trust store   Re-throw. Caller will catch and log as required 
//  Unknown types 
//  Check for write timeout 
//  Test the results 
// create an rpc channel and add the map as a listener 
//  Environment entries 
//  protocol 
//  Some logging implementations use weak references for loggers so there is   the possibility that logging configuration could be lost if GC runs just   after Loggers are configured but before they are used. The purpose of   this Map is to retain strong references to explicitly configured loggers 
//  Check for compatible MIME-TYPE 
//  Identify the engine we are associated with 
//  set property 
//  no ports have been found 
//  Must be a JAR nested inside a WAR if archivePath is non-null 
//  Configure httpOnly on SSO cookie using same rules as session 
//  Close server socket if bound on start   Note: test is in AbstractEndpoint 
//  extract the first container's session ID 
/*  GOST Ciphersuites. Unsupported by Java. OpenSSL lists them with IDs     * 0x3000080 to 0x3000083     * The ciphers are not listed in the IANA registry.  */
/*                  * Write end tag                  */
//  Any left over data is a compression error 
//  Handling One 16-Bit 0 Field (4.2.2) 
//  send session at blocks 
//  Assume direct HTTP/2 connection 
//  Is a 100 continue response expected? 
//  processor hasn't set it, use the settings from the connector 
//  Make this a NO-OP so that further entries can be read from the stream 
//  Look in cache first 
//  Load the user database object for this host 
//  no op, senders created upon demands 
//  Should never happen 
// Try GET 
//  Read the body, if one exists 
//  This clear cleans up the keys now any waiting threads have been 
//  Skip class resources since they are started below 
//  Ensure that the SSLEngine is consistent with that used for SSL init 
//  #valueUnbound() will be called on session expiration 
//  Render the link to our parent (if required) 
//  TEST 
//  Failed to send close message. Close the socket and let the caller 
//  Upgrade to write lock 
//  Done is equivalent to sendfile not being used 
//  Ensure that we have an open database connection 
/*      * Note: This method was protected prior to JDBC 4.      */
/*          * This is a (possibly nested) lambda expression with one or more sets         * of parameters provided.         *         * If there are more nested expressions than sets of parameters this may         * return a LambdaExpression.         *         * If there are more sets of parameters than nested expressions an         * ELException will have been thrown by the check at the start of this         * method.          */
//  Headers + body 
//  2. ServletContext init parameter 
//  prepareStatement 
/*          * Synchronizes the scripting variables of the given custom tag for the         * given scope.          */
//  Log access to stopped class loader 
//  Extract the string from the array 
//  FIX ME package "javax." was removed to prevent HotSpot   fatal internal errors 
// compare with the dispatched request 
//  '/' does not appear in the authority so use the first   instance to split the authority and the path segments 
//  There is an exact match 
// no data read 
//  OK to ignore boxing here 
//  Draw a rectangle. 
//  determine exact type 
//  prepare readers/writers 
//  If there is data left in the buffer the socket will be registered for   write further up the stack. This is to ensure the socket is only   registered for write once as both container and user code can trigger   write registration. 
//  Optimisation for case where anything is allowed 
//  Namespace issue maybe 
//  No headers to continue 
//  Upload WAR 
//  Find and remove the old host 
//  Can create arrays of generic types 
//  wsPackage is "javax.websocket." 
//  Close sessions explicitly as Gump reports a session remains open at 
//  Iterate over the set of threads 
//  The entity has not been modified since the date   specified by the client. This is not an error case. 
/*  In case something external rotated the file instead  */
//  Don't set any attributes 
// check for keys that didn't make it in. 
//  Entries with lookup-name and value are an error (EE.5.4.1.3) 
//  ---------------------------------------------- TribesThreadPoolExecutor Inner Class 
//  Optional name element 
//  Check to see if this WebSocket implementation has a matching mapping 
//  no possibility of hitting buffer limit 
//  Now close the session 
//  Store nested <WrapperListener> elements 
//  Blocking, so use notify to release StreamOutputBuffer 
//  Will always be non-null 
//  Superclass implements interface and defines explicit type for generic 
//  If we run into the container response we are done 
//  Save the length of the file 
/*      * %xx decoding of a string. FIXME: this is inefficient.     * @param str The URL encoded string     * @param query <code>true</code> if this is a query string     * @return the decoded string      */
/*  SSL_kEECDH - ephemeral ECDH  */
//  New password works, so kill the old pool, create a new one, and borrow 
//  weed out escaped open parens and parens enclosing the   whole statement (in the case of valid LDAP search   strings: (|(something)(somethingelse)) 
//  Avoid NPE if attribute is not set 
//  Protect against scanning the WebSocket API JARs 
//  since there is no "line". 
//  TODO: If (x1 == x2 || y1 == y2) draw as line. 
//  Step 2. Order the fragments. 
//  Resolve occurrences of "/./" in the normalized path 
//  no provider file found, this is OK 
//  The session was logged out.   Deregister this single session id, invalidating 
/*          * SRV.13.4 ("Deployment Descriptor"):         * If the timeout is 0 or less, the container ensures the default         * behaviour of sessions is never to time out.          */
//  -------------------------------------------------------- message receiver handler 
//  foo;bar.jsp 
//  good 
//  Assume no overflow 
//  Invalid tag, skip to the next one 
//  Do not process this branch 
//  Are we being processed by a RequestDispatcher.include()? 
//  Stop older versions of IE thinking they know best. We set text/plain   in the line above for a reason. IE's behaviour is unwanted at best 
//  If valid, apply settings from request / connector 
//  Uncomment the sync block to test adding the sync fixes   issues on platforms where fis is not thread-safe 
/*      * there should be a multiple of 4 encoded characters. However,     * the RFC says the decoder should pad the input string with     * zero bits out to the next boundary. An error will not be detected     * unless the payload has been damaged in some way - this     * particular crib has no damage.      */
//  General informations 
//  Static data for getImports() 
//  Skip whitespace and non-token characters (separators) 
// the encoded version is longer than the original  just return false 
//  Ensure encode as space is not shared 
/*      * Processes the given javac compilation errors.     *     * @param details Array of JavacErrorDetail instances corresponding to the     * compilation errors      */
/*      * Parses jsp:body action.      */
//  Everything else being equal, AES is preferred 
//  Data is from the server so it is not masked 
/*      * Sub-classes may want to check, whether an AccessLogValve is active      */
/*  TCN_PATCH_VERSION  */
//  This header line is malformed, skip it. 
//  Accumulate the user's roles 
//  Header must be spread over multiple frames. Keep doubling   buffer size until the header can be read. 
/*      * My hash of sub-pools (ObjectQueue). The list of keys <b>must</b> be kept     * in step with {@link #poolKeyList} using {@link #keyLock} to ensure any     * changes to the list of current keys is made in a thread-safe manner.      */
//  The host is already registered in the mapper.   E.g. it might have been added by addContextVersion() 
//  names map directly back into Java.  The reverse isn't necessarily true. 
//  The only invalid char is \n   We also need to keep the string short and split it with \nSPACE   XXX TODO 
// measure the time 
//  Quoted Value 
//  DBCP-97 / DBCP-399 / DBCP-351 Idle connections in the pool should   have autoCommit enabled 
//  Not static - the set may differ ( it's better than adding 
//  Don't try and stop the threads unless explicitly 
//  Exclude any resource in the /WEB-INF and /META-INF subdirectories 
/*      * Bug 58444      */
//  Default is empty resource in main resources 
//  File name will now be whatever is after the final / 
//  Match on context relative request path 
//  nothing to do 
//  Mapping is against the normalized uri 
//  Ignore the 2 bytes already read. 4 for the mask 
/*      * Checks if an OPTIONS request is processed as pre-flight where any origin     * is enabled.     *     * @throws IOException     * @throws ServletException      */
//  Add the new node to the opp stack 
//  cannot use side-effects.  It's removed and added back each time   there is a modification in a resource. 
//  Next write the mask && length length 
//  Redeploy resources in CATALINA_BASE/conf are never deleted 
/*  Generated By:JJTree: Do not edit this line. AstLiteralExpression.java  */
//  this class implements its own factory 
//  ----------------------------------------------- HTTPS specific properties   ------------------------------------------ passed through to the EndPoint 
// add ourself as a listener for messages 
//  If the TLD is in a JAR, that JAR may not be part of the web   application 
//  Frame not complete - what did we run out of? 
//  Not a valid HTTP Status-Line 
//  Single contextVersion means no need to remap   No session ID means no possibility of remap 
//  -------------------------------------------- All NO-OPs beyond this point 
//  Client originated ping. Echo it back. 
//  Removing resources 
//  NO-OP since we are not pooling anything 
//  reset it in case the connection times out.   the primary may come back. 
//  Order is important since it determines the search order for a   matching handler if only an algorithm is specified when calling   main() 
//  Wait for server thread to stop 
//  ----------------------------------------------------------------- Fields 
//  We have to flush and it's incomplete, save the bytes written until done 
//  End of stream 3 thenack 
//  2: SSL handshake 
//  Use local copies to ensure thread safety 
//  Must be OK to cast to Object 
// if the "name" is null then do nothing.  else add such string "name=value" to the url. 
//  40-4f A-O 
// just in case the limit has changed 
//  as in Apache HTTPD server 
//  No processing required 
//  Length of data in bytes 
//  Just log it here 
//  DBCP-265: Need to close the result sets that are   generated via DatabaseMetaData 
//  Call the service() method for the allocated servlet instance 
//  skip implicit and call app resolvers, stream resolver and static   resolver 
//  Locate the method to be invoked, either in this MBean itself   or in the corresponding managed resource 
//  Check if this value appear in the attribute of the node 
//  The ROOT Locale uses English. If English is requested, force the   use of the ROOT Locale else incorrect results may be obtained if   the system default locale is not English and translations are   available for the system default locale. 
//  -------------------- Conversion and getters -------------------- 
//  Call the specified method 
/*  Generated By:JJTree: Do not edit this line. AstInteger.java  */
//  If the servlet wanted to be unavailable it would have   said so, so do not call unavailable(null). 
//  Unable to determine the list of available protocols. This will   have been logged previously.   Use the configuredProtocols and hope they work. If not, an error   will be generated when the list is used. Not ideal but no more   can be done at this point. 
//  Write protocol name 
//  remaining 2: 
//  synchronization may be required (see fireListenerLock for an example). 
//  increment the constantPoolCount 
/*  Second formatted in most recent invocation  */
//  Welcome files from the application deployment descriptor   completely replace those from the default conf/web.xml file 
//  path is required 
//  This is the call the failed 
//  found a potential Engine! Let's call getLocale() on it. 
//  Lambda parameters 
//  Cipher 0x0700C0 (SSLv2) 
//  Duplicate Host name 
//  Remove the multi-release version 
/* org.apache.coyote.Constants.STAGE_NEW */
//  Message handlers that require decoders may map to text messages,   binary messages, both or neither. 
//  Reset ServletContextInitializer scanning 
//  Still expect the property to be resolved and the listener to fire   since the vent is at the time of resolution. The EL spec could be a   lot clear on this. 
//  Double-checked locking. OK because state is volatile 
//  Failure 
//  Check if we are in the initial handshake phase 
//  Not a token - ignore it 
//  it's not a duplicate 
//             con2 = datasource.getConnection(); 
//  Set parent logger 
//  Look for an end-of-comment or end-of-tag: 
// check suspect members if they are still alive, 
//  Type 1 (client hello) 
//  Is `/' on all systems, even DOS 
//  Avoid an infinite loop with java.lang.Object 
//  Time 
//  See http://docs.oracle.com/javase/7/docs/api/javax/net/ssl/SSLEngine.html#getSession() 
//  Jump 2 ahead and then confirm (skipped value should be null) 
//  Remaining data must be buffered 
//  This simplifies the code later in this method 
//  ---------------------------------------------------------  Constructors 
//  listener   TODO: description (multiple with language) is ignored   TODO: display-name (multiple with language) is ignored 
//  Hex: 0-9, a-f, A-F 
/*              * absolute-path  = 1*( "/" segment )             * segment        = *pchar             * pchar          = unreserved / pct-encoded / sub-delims / ":" / "@"             *             * Note pchar allows everything userinfo allows plus "@"              */
//  Note: need to strip leading '/' from path 
//  More method parameters than there are nested lambda expressions 
/*          * Appends a tag directive containing a single 'pageEncoding'         * attribute whose value is hard-coded to UTF-8.          */
//  Allocate new CharEntry for the lookup 
//  Retrieve the current state information 
//  Async write is in progress 
/*  JavaCC - OriginalChecksum=3fa555852689f4df3b05452671ed7031 (do not edit this line)  */
//  Create the upgrade processor 
//  Data is type 0 
// reset the position counter 
//  Last modified as a resolution of 1s. Ensure that a write   to the file is not in progress by ensuring that the last   modified time is at least 2 seconds ago. 
//  ------------------------------------------- Implemented Processor methods 
//  Called from StandardContext.start() 
//  Determine if there are any aliases 
//  ejb-local-ref 
//  Ignore   May see a SocketException if the request hasn't been   fully read when the connection is closed as that may   trigger a TCP reset. 
// new a StringTokenizer Object according to the "items" and the "delim" 
//  User was not found   Waste a bit of time as not to reveal that the user does not exist. 
//  Check current status in case resources were added that had already   been started 
//  Initialize local variables we may need 
//  -------------------- Recycling -------------------- 
//  Headers + 8k response 
//  Called from StandardContext.destroy() 
//  Check to see if session has already been invalidated.   Do not check expiring at this point as expire should not return until   isValid is false 
//  Case 4 - "Default" Match 
//  XXX Use group + name 
//  The URI points to the TLD itself or to a JAR file in which the TLD is stored 
//  Return the configured DataSource instance 
//  Unexpected stream 
//  20-2f + / 
//  ---------------------------------------------------------- Object methods 
//  Attempting to read from the socket when the poller   has not signalled that there is data to read appears   to behave like a blocking read with a short timeout   on OSX rather than like a non-blocking read. If no   data is read, treat the resulting timeout like a   non-blocking read that returned no data. 
//  Start host 
//  Streams 
//  Set up streams A=17, B=19, C=21 
//  Allowed roles should be the union of the roles in the constraints   Constraint without role or implied role permits unauthenticated users   User is not authenticated 
//  NO-OPs the attribute requests since they are pre-populated when   parsing the first AJP message. 
//  element name 
//  Skip source 
//  from J2EE 1.2 
//  OK to process reload flag now. 
//  AsynchronousChannelGroup needs exclusive access to its executor service 
//  Redirects within a web application 
//  De-register any remaining JDBC drivers 
//  Use a string buffer for better performance 
//  Create the maximum number of sessions 
//  Set the header bytes 
//  No further validation required 
//  Should be found in file system 
//  Set in the stats hash map 
//  Ignore. GOAWAY is sent on a best efforts basis and the original   error has already been logged. 
//  AttributesImpl.removeAttribute is broken, so we do this... 
// --- configuration attributes --------------------------------------------- 
//  Process next frame 
//  Close all sockets still in the poller 
//  nothing 
//  Get a SecureRandom from the pool 
//  Invalid AJP header signature 
//  Restore the previous CCL 
//  be an issue. 
//  -------------------------------------------------------- Abstract methods 
//  ignore children report error them self!   see StandardContext.storeWithBackup() 
//  values from JDK Level 
//  TODO if validating and testOnBorrow == true then pre-allocate for 
/*  GCM ciphersuites from RFC5288  */
//  from J2EE 1.3 
//  Configure server socket factories 
//  Init concurrency control if needed 
/*      * Logon to access a protected resource using DIGEST authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp while sending the SSO session cookie provided by the     * first webapp.     * This should be successful with SC_OK 200 status.      */
/*      * Parses a directive with the following syntax:     *     * XMLJSPDirectiveBody ::= S? ( ( 'page' PageDirectiveAttrList S? ( '/>' | (     * '>' S? ETag ) ) | ( 'include' IncludeDirectiveAttrList S? ( '/>' | ( '>'     * S? ETag ) ) | <TRANSLATION_ERROR>     *     * XMLTagDefDirectiveBody ::= ( ( 'tag' TagDirectiveAttrList S? ( '/>' | (     * '>' S? ETag ) ) | ( 'include' IncludeDirectiveAttrList S? ( '/>' | ( '>'     * S? ETag ) ) | ( 'attribute' AttributeDirectiveAttrList S? ( '/>' | ( '>'     * S? ETag ) ) | ( 'variable' VariableDirectiveAttrList S? ( '/>' | ( '>' S?     * ETag ) ) ) | <TRANSLATION_ERROR>      */
/* org.apache.coyote.Constants.STAGE_ENDED */
//  Tomcat's handler always takes priority so applications can't override   it. 
//  Handle a custom error page for this status code 
/*  Done: take the first one  */
/*          * DCL on 'reload' requires that 'reload' be volatile         * (this also forces a read memory barrier, ensuring the new servlet         * object is read consistently).         *         * When running in non development mode with a checkInterval it is         * possible (see BZ 62603) for a race condition to cause failures         * if a Servlet or tag is reloaded while a compile check is running          */
//  Try and handle this here to give Tomcat a chance to close the   connection and prevent clients waiting until they time out.   Worst case, it isn't recoverable and the attempt at logging   will trigger another OOME. 
//  Check for static, public method and module access for Java 9+ 
//  So that javac won't complain about   codes after "return" 
//  70-7a p-z 
//  Do the decoding and get the results into the byte chunk and the char 
//  NOTE:  Clients may still possess the old single sign on cookie,   but it will be removed on the next request since it is no longer   in the cache 
/*      * Find a valid alias when none was specified in the config.      */
//  (3) Delegate to parent unconditionally 
//  No more bytes left to be written : return -1 and clear the   buffer 
//  Give threads up to 2 seconds to shutdown 
/*                  * Top-level page.                 *                 * Add                 *   xmlns:jsp="http://java.sun.com/JSP/Page"                 * attribute only if not already present.                  */
// loop while we can perform pure SSLEngine data 
//  Any extra frame is not processed yet, so put back any leftover data 
//  Stage 1. Make all dependencies bi-directional - this makes the 
//  There was an error executing the scheduled task, get it and log it 
//  directory, start the background compilation thread 
//  All data has been written 
//  Check to see if a Filter, Valve or wrapper has written some content.   If it has, disable range requests and setting of a content length 
/*      * See     * https://github.com/openssl/openssl/blob/7c96dbcdab959fef74c4caae63cdebaa354ab252/ssl/ssl_ciph.c#L1371      */
//  Configure the use of the plug-in rather than the standard impl 
//  quickly validate again for this request 
//  Stream 3 
//  MUST be specified in the element 
//  Create the MBeans for each defined Role 
//  Should not be used in a close frame   return CloseCodes.NO_STATUS_CODE; 
/*      * This method gets the next unquoted character and looks for     * - literals that need to be converted for EL processing     *   \ -> type{'\\'}     *   $ -> type{'$'}     *   # -> type{'#'}     * - start of EL     *   ${     *   #{     * Note all the examples above *do not* include the escaping required to use     * the values in Java code.      */
//  If the list of exposed headers is not empty add one or more   Access-Control-Expose-Headers headers, with as values the header 
//  Note: The following lists are intended to be aligned with the most         recent release of each OpenSSL release branch. Running the unit         tests with earlier releases is likely to result in failures. 
//  Timeout any waiting processor 
//  Session ID is 32. Standard text is 36. Host could easily be 20+.   Context could be anything from 0 upwards. 128 seems like a reasonable   size to accommodate most cases without being too big. 
//  Bytes available for reading and there may be   sufficient data in the socketReadBuffer to   support further reads without reading from the   socket 
//  If not all in the previous match, then no match. 
//  The real mbean is created and registered 
//  send invalid sessions   DeltaManager returns String[0] 
// we have started the receiver, but not yet waited for membership to establish 
//  non-array base, null response 
//  Cannot delete the whole tempDir, because logs are there, 
//  Map the URI 
//  to which it submits) might be outside the secured area 
//  Link. Need to look at the global resources 
// type - int  action - int  name - String  hasvalue - boolean  value - object 
//  Body 
/*      * "-" is not a legal base64 character. The RFC says it must be     * ignored by the decoder. This is a very strange case because the     * next character is a pad, which terminates the string normally.     * It is likely (but not certain) the decoded password will be     * damaged and subsequent authentication will fail.      */
//  The source of physical db connections 
// the channel running in this demo 
/*  empty slot: +16  */
//  Cipher 9F 
//  Clean up the input stream 
//  ?jsp_precompile&foo=bar... 
// Create the scroll pane and add the table to it. 
//  Defaults 
// my message msg.src=local 
//  Read-write properties 
//  The nature of bridge methods is such that it actually   doesn't matter which one we pick as long as we pick   one. That said, pick the 'right' one (the non-bridge   one) anyway. 
//  Check for read only attribute 
//  Default to 1.8 
//  XXX 
//  Open connection 
//  Port only known after Tomcat starts 
//  name of the current file 
//  Parse host level web.xml if present 
/*  -------------------------------- *     * Validation onReturn              *     * --------------------------------  */
//  Dimensions used to draw hands   Formats the date displayed   String to hold date displayed   Font for number display on clock   Used to get date to display   Color of main hands and dial   Color of second hand and numbers 
// simulate work 
/*      * We want to use TLS 1.3 where we can but this requires TLS 1.3 to be     * supported on the client and the server.      */
//  Redundancy. Duplicate Alias for the same Host name. No error here. 
//  Now we can check for UTF16-LE. There is an assumption here that we   won't see a UTF16-LE file with a BOM where the first real data is 
// initialize the strScope 
//  Stream 1 
//  Removing application parameters 
//  all links relative 
//  pull another connection and check it 
// file unchanged by default 
//  Add this constraint to the set for our web application 
/*      * Checking individual characters is about 10 times faster on markt's dev     * PC for typical length file names. The file names need to get to ~65     * characters before the Pattern matching is faster.      */
//  If the tag contains no scripting element, generate its codes 
//  More renames 
//  first we test the flag itself, which can be set on the Host and   Context 
//  DO NOTHING the original exception will be rethrown 
//  pFileName.replace("\u0000", "\\0") 
//  Include whitespace to ensure Parser handles it correctly (it should be   skipped). 
//  print text 
//  should be able to perform a PUT. 
//  assert that even though the validation query we don't get a connection 
//  No need to set the context class loader. The threads will be   cleaned up when the connection is closed. 
//  HTTP/2 preface matched 
//  Use an Iterator so fully allocated children/recipients can be   removed. 
//  Wait up to 5s for the response 
//  Just use base class 
//  ---------------------------------------------- SocketTimeouts Inner Class 
//  Local copy to ensure consistency 
//  average over two frames to avoid false positives. 
//  On entering loop buffer will be empty and at the start of a new   loop the buffer will have been fully read. 
//  Re-write the URI if it contains a ;jsessionid parameter 
//  Empty name (not necessarily valid but checking edge cases in filter) 
//  Trigger a redeploy if a WAR is added 
//  Determine defaults for -a and -h. The rules are more complex to   express than the implementation:   - if neither -a nor -h is set, use SHA-512 and     MessageDigestCredentialHandler   - if only -a is set the built-in handlers will be searched in order     (MessageDigestCredentialHandler, SecretKeyCredentialHandler) and     the first handler that supports the algorithm will be used   - if only -h is set no default will be used for -a. The handler may 
//  Only one parameter is not an exact match - try using the   super class 
/*      * Test context unpackWAR setting.     * If context.getUnpackWAR != Host.getUnpackWARs the Host wins.      */
//  endAccess() to ensure timeouts happen correctly.   access() to keep access count correct or it will end up 
//  initial output stream 
/*                      * 'jsp' prefix has been hijacked, that is, bound to a                     * namespace other than the JSP namespace. This means that                     * when adding an 'id' attribute to each element, we can't                     * use the 'jsp' prefix. Therefore, create a new prefix                     * (one that is unique across the translation unit) for use                     * by the 'id' attribute, and bind it to the JSP namespace                      */
// uniqueId.length 
//  alone) so no change in overall count 
//  In the case where the parameter for the method   is taken from an attribute, and that attribute   isn't actually defined in the source XML file,   skip the method call 
//  Also make examples available 
//  Reflection related problems 
/* org.apache.coyote.Constants.STAGE_SERVICE */
//  make buffer empty 
//  GIVEN 
//  Read the response 
//  Concurrent callers will end up with the same CachedResource 
//  store all <Context> elements 
//  Allocate a new filter instance if necessary 
//  Ran out of space in text buffer - flush it 
/*                  * Present in Java 7 onwards                 * Fixed in Java 9 (from early access build 156)                  */
//  All characters in the string are used. Check if only '*'s are left 
//  Wait for session to close on the server 
// addr length 
//  Build single header to replace current multiple headers 
/*  JavaCC - OriginalChecksum=e1dc4e2011eee313491decfa9e0152fe (do not edit this line)  */
//  We reached end of current group 
//  No read pending, so do a read 
/*          * Appends the given tag, including its body, to the XML view,         * and optionally reset default namespace to "", if none specified.          */
//  Some handlers, such as the IntermediateMessageHandler, do not have a 
//  Optimizations by Tag Plugins 
//  Setup Tomcat instance 
//  ------------------------------------------------- Instance Variables 
// start the channel 
// check to see if the member really is gone 
//  If client authentication is being used, OpenSSL requires that   this is set so always set it in case an app is configured to 
//  Do the request again to ensure that the remaining body was swallowed 
//  Zero length messages can't be compressed so pass the   final (empty) part straight through. 
//    or may nor support -a and may or may not supply a sensible default 
//  Request the first servlet 
//  Fetch initial members 
//  Cipher 9C 
//  notify() needs to be outside sync   to avoid deadlock 
//  Optimize expiration handling 
//  primitive tracking of the test phases to verify the HTML body 
// switch 
//  overlaps with UTF-32LE. 
// $FALL-THROUGH$ to set the client requested ciphers 
//  Should be shutdown once the stop() method above exists 
//  Resolve occurrences of "/../" in the normalized path 
//  Sanity check on the specified buffer sizes 
//  Ignore leading whitespace. 
//  sent and half of request 2 
//  Comments are ignored in XML view 
// 1 second 
//  Process the request 
//  Version is unused - undeploy it completely   The -1 is a 'trick' to ensure all redeploy   resources are removed 
//  Parse path param, and extract it from the decoded request URI 
//  error-page with just location allowed in Servlet 3.0+ 
//  There cannot be a session if no context has been assigned yet 
//  Simulate deploy on start-up 
//  Getters for abandoned object removal configuration 
//  Resolve occurrences of "//" in the normalized path 
//  Interface el.parser.Node uses a raw type (and is auto-generated) 
//  Don't evict on error conditions 
//  child's container is Context 
//  Invoke the selected method on the appropriate object 
//  Log must be non-static as loggers are created per class-loader and this   Filter may be used in multiple class loaders   must not be static 
//  Cipher 9B 
//  Home first 
//  Pattern contains only '*', which matches anything 
//  Common 
//  Intermittent CI errors were observed where the response body   was exactly one block too small. Use an AtomicInteger to be   sure blockCount is thread-safe. 
/*      * Host header exists but has its value is empty (and there are multiple     * spaces after the ':'.  This is valid if the request line does not     * include a hostname/port.     * Added for bug 62739.      */
//  Has a session been created? 
//  src will always be an object   Short-cut. null is always assignable to an object and in EL null   can always be coerced to a valid value for a primitive 
//  Skip name only cookies if not supported 
//  Re-order. Can't sort in place since a call to 
// ------------------------------------------------------------------ mkdir() 
//  500 - Internal Server Error 
//  See if a quality has been provided 
//  If force mode, the browser checks are skipped 
//  Looking for a body, it still can be empty; but if there is a   a tag body, its syntax would be dependent on the type of 
//  See #encrypt(byte[]) for an explanation of the return value 
//  Push our registry object onto the stack 
//  Cipher 9E 
// removes the key from this selector 
//  ------------------------------------------------------ Principal Methods 
//  Render the result as a String of hexadecimal digits 
//  Add the named objects to the list of 'introduced' names to enable 
//  do nothing by default, needed for b/w compatibility. 
//  copy the class attributes, return true if SDE attr found (not copied) 
//  that specify a class name of "org.apache.catalina.UserDatabase" 
//  Session has been invalidated.   Ignore and fall through to application scope. 
//  Can't cache InputStreams 
//  No validation query by default 
//  take a minimum 
//  Duplicate definition 
//  testUser, testPwd 
//  Simple cases - handlers already accepts one of the types expected by 
/*      * Resolve the name of the file and update baseDirStack() to keep track of     * the current base directory for each included file.     * The 'root' file is always an 'absolute' path, so no need to put an     * initial value in the baseDirStack.      */
//  Calculate the class name for the change notification 
// --Constructor--------------------------------------------- 
//  All keys 
//  The same request is processed successfully 
//  filter-mapping/dispatcher added in Servlet 2.4 
//  First frame in new message 
//  Request a third JSP (again, no tag libraries etc.) 
/*          * Number of instances created - number destroyed.         * Invariant: createCount <= maxTotalPerKey          */
//  Expected on 21st checkout 
//  TaskQueue.take() takes care of timing out, so that we are sure that   all threads of the pool are renewed in a limited time, something like   (threadKeepAlive + longest request time) 
//  IMPORTANT: DefaultServlet can be mapped to '/' or '/path/*' but always   serves resources from the web app root with context rooted paths.   i.e. it cannot be used to mount the web app root under a sub-path   This method must construct a complete context rooted path, although   subclasses can change this behaviour. 
//                 This is OK because of the processing in stage 1. 
//  Used to ensure that isReady() and onWritePossible() have a consistent 
//  Get logging level for the handler 
// send a stop message 
// X{A-ldr, A-src, mbrs-A,B,C,D} 
//  The SSL session has increased the required buffer size   since the buffer was created. 
//  Should be default error page 
//  Cipher 9D 
//  Seems like there is no way to explicitly disable SSLv2Hello in OpenSSL so it is always enabled 
//  Set the socket wrapper so the access log can read the socket related   information (e.g. client IP) 
//  No longer know if data is available 
//  and position information to be easily passed between parsing methods 
//  Acquire the list of files in our storage directory 
//  responsibility but just in case... 
//  Populate mapping of tag names to tag file paths 
//  If the scripting variable has been declared, skip codes   for saving and restoring it. 
//  Acquire the filter mappings for this Context 
// replacement for Process.waitFor() 
//  > 59 
//  is this a whitespace character?   whitespace found 
/* --Instance Variables-------------------------------------- */
//  ----------------------------------------------------------- JMX Lifecycle 
//  recycle old backup session 
// double the membership sender 
//  iterate through the list of required extensions 
//  process pattern between stars. padIdxStart and patIdxEnd point 
//  Add unprotected servlet to the context 
//  Fill in entry for general notifications          descriptor = new DescriptorSupport              (new String[] { "name=GENERIC",                              "descriptorType=notification",                              0"log=T",                              "severity=5", 
//  Construct the class loader we will be using 
//  and finally the encoded text. 
//  Note: a mapped buffer is a special construct with an underlying file   that doesn't need to be closed 
//  Initialize variables we need to determine the appropriate action 
//  We prepend CR/LF to the boundary to chop trailing CR/LF from   body-data tokens. 
/*    * Ordinals for various reasons why an Error of this type can be thrown.    */
/*      * Logon to access a protected resource using BASIC authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp while providing the SSO session cookie received from the     * first webapp. This should be successful with SC_OK 200 status.      */
//  Servlet Service Method is called by the FilterChain 
//  Removing any lock-null resource which would be present 
//  If getPathInfo() returns null, must be using extension mapping 
//  AsyncContext has been recycled and should not be being used 
//  Setup arguments for either getMapForFunction or mapFunction 
/*      * Expected behaviour for deployment of an XML file.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *    Y/N       Y/N       Y/N           Y    N    N     *     * Note: Context will fail to start because no valid docBase is present.      */
//  Apps Row Section 
//  Token: Anything 0-127 that is not a control and not a separator 
/*      * Expect failure as it is not possible to identify which method named     * "testB()" is intended. Note: In EL null can always be coerced to a valid     * value for a primitive.      */
/*  * Various requests, usually originating from fuzzing, that have triggered an * incorrect response from Tomcat - usually a 500 response rather than a 400 * response.  */
//  ---------------------------------------------- stats of the thread pool 
//  Value determined by observation of what the SSL Engine requested in 
//  Mandatory attribute "name" will be checked in Validator 
//  Context has been removed from Mapper at this point (so no new   requests will be mapped) but is still available. 
//  Actions related to body evaluation 
//  Recycle cookies and session info in case the   correct context is configured with different 
//  Internal 
//  Not explicitly set. Use default ports based on the scheme 
//  Security: Do not recycle 
//  If an error has occurred that prevents further I/O, don't waste time 
//  Enumerate the global JNDI resources of the requested type 
/*      * Test context copyXML setting.     * If context.copyXML != Host.copyXML the Host wins.     * For external WARs, a context.xml must always already exist      */
//  At this point docBase should be canonical but will not end   with File.separator 
//  Request a second JSP (again, no tag libraries etc.) 
//  print LineSection 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=50413#c6 
//  The same as in standard Tomcat configuration.   This creates an APR HTTP connector if AprLifecycleListener has been   configured (created) and Tomcat Native library is available.   Otherwise it creates a NIO HTTP connector. 
//  Can't be null 
//  ------------------------------------------------------------Constructors 
//  Doing our best here to get a canonical name   from the binary name, should work 99.99% of time. 
//  This is going to trigger a Set-Cookie header. While the value is   not security sensitive, ensure that expectations for secure and 
/*          * JSP.6.1.1: All textual nodes that have only white space are to be         * dropped from the document, except for nodes in a jsp:text element,         * and any leading and trailing white-space-only textual nodes in a         * jsp:attribute whose 'trim' attribute is set to FALSE, which are to         * be kept verbatim.         * JSP.6.2.3 defines white space characters.          */
//  Used to init SecureRandom prior to running tests 
// cleanup 
//  Haven't read any request data yet so use the keep-alive   timeout. 
//  Cipher 9A 
//  for the receipt the peer's close_notify message -- shutdown. 
//  There must be at least one entry 
//  Should never happen. The name above is valid. 
//  file may have been modified since then. 
//  Indicates that at invalid sequence is detected one character later than 
//  Process the pipelined request data 
//  Contains codes to initialize the functions mappers.   Contains declarations of the functions mappers. 
//  The WebSocket spec says to ignore the new match in this case 
//  Check correct time passed 
// we have an object, release 
//  Paranoid verification that active sessions have now gone 
//  Read in all elements and place in queue 
//  add a new host 
//  (0) Check our previously loaded local class cache 
/*              * Append all other attributes              */
//  Acquire clustered manager 
//  if the ServletContext has ORDERED_LIBS, then use that to specify the 
//  Fallback to using context-relative path 
//     oldValue=getAttribute( name ); 
//  This is the first use of the connection in this transaction, so we must   enlist it in the transaction 
/*  * These unit tests are ignored by default as they are not reliable. They have * been failing regularly on Gump for some time and have recently started to * fail regularly on markt's laptop. * * The problem is that the ThreadLocal Maps are affected by GC. If GC occurs at * the wrong point, the leaking ThreadLocal will be cleaned up and the test will * fail. It is not possible to force the test to pass without effectively * changing the nature of the test so it no longer tests detection of leaks via * ThreadLocals. * * The test has been left in place since it will work reasonably reliably on * most systems (just not all and particularly some of the ASF's CI systems) and * still may be useful if a bug is reported in this area in the future.  */
//  Hard-coded to use the default 
//  Check if the current thread already holds a lock on this room.   If yes, then we must not directly execute the Runnable but instead   cache it until the original invokeAndWait() has finished. 
//  Perform the IO operation   Called from the poller to continue the IO operation 
//  This message part has been fully processed by the   deflater. Fire the send handler for this message part   and move on to the next message part. 
//  Can't do anything: close the socket right away 
//  Skip the numeric suffix for the first pool in case there is   only one so the names are cleaner. 
//  Identify the requested resource path 
//  Associate the processor with the connection 
/*          * This routine sorts the ciphers with descending strength. The sorting         * must keep the pre-sorted sequence, so we apply the normal sorting         * routine as '+' movement to the end of the list.          */
//  unspecified   unspecified 
//  ************************************************************************ 
//  tempDir contains log files which will be open until JULI shuts down 
//  encoded words start with the characters "=?".  If this not an encoded word, we throw a   ParseException for the caller. 
//  Test that if LifecycleListener on webapp fails during   configure_start event and if the cause of the failure is gone,   the context can be started without a need to redeploy it. 
//  pound sign 
//  Although the internal implementation uses a Map, this cache   implementation is only concerned with the keys. 
//  start() should trigger IllegalArgumentException 
//  TLS 1.0 
//  According to the spec, the JspWriter returned by   JspContext.pushBody(java.io.Writer writer) must behave as   though it were unbuffered. This means that its getBufferSize()   must always return 0. 
//  warm up 
//  a.addBeforeOrdering("b"); 
//  ---------------------------------------------- Public Methods 
//  Create a Catalina instance and let it parse the configuration files 
//  We want something of the form   out.println( "<param name=\"blah\"   value=\"" + ... + "\">" ); 
//  Default of 30000 (30s) is set by the connector 
//  Setting the context in read only mode 
// host length 
/*      * Populate <code>wrappers</code> list with information for registration of     * mappings for this wrapper in this context.      */
//  Look for the next module 
//  If this is false there will be a call back when it is true 
//  This has to be called after the other resources have been started 
/* "shtml", "text/x-server-parsed-html", */
//  Thrown if the session is already closed 
//  TODO - get content first 
//  Allocate a new instance if possible, or else wait 
//  Each Cipher always has at least one JSSE name 
/*      * Sends an TesterAjpMessage to the server and returns the response message.      */
//  --------------------- Methods that need to work even for a failed context 
//  outside the try/catch/finally block) 
//  strValue!=null is the same 
//  Extract version number 
//  (0.1) Check our previously loaded class cache 
//  If mandatory attribute is missing then the exception is thrown 
//  Found a matching context but it is paused. Mapping data will   be wrong since some Wrappers may not be registered at this   point. 
//  Get the connection timeout 
/*      * Second-pass Visitor responsible for producing XML view and assigning     * each element a unique jsp:id attribute.      */
// return 0 if we are complete, otherwise we still have data to write 
//  too early, so it should be reset. 
/*      * JSPCommentBody ::= (Char* - (Char* '--%>')) '--%>'      */
//  File 
//  20-2f -   30-3f 0-9 
//  -------------------- Idx access to headers ---------- 
//  --------------------------------------- ThresholdingOutputStream methods 
// prepare the buffer for writing 
//  Avoid NPE when using RI API JAR - see BZ 56343 
//  This should not encode '&' 
//  SSL protocol 
//  Inefficient initial implementation. Will be replaced on the next 
//  Although this is a public method, all other paths to this   method use this sync and it is required to prevent race   conditions during the reload. 
//  Override the defaults 
//  todo: forgot this change and making it up again! 
//  invalid chunk - it's better to ignore 
//  Convert Context names and display names to base names 
// ------------------------------------------------------ Instance Variables 
// resource-env-ref 
//  removed. 
//  Re-calculate now docBase is a canonical path 
//  finally, a set of tests to explore quirky situations   but there is not need to replicate all the scenarios above. 
//  Find the matching method 
// main part to generate code 
//  validate composite expression 
//  Restore original method so that it is written into access log 
//  HTTP/0.9 
//  Notify each listener of the shutdown. This enables them to 
// don't report queries less than this 
//  May need to acknowledge a 100-continue expectation 
//  Domain Name - valid 
// and the url should be encoded 
//  Java 9+) in an exported package 
//  If attrs==null, tempLength == 0 
//  Cipher 97 
//  following "${" || "#{" to first unquoted "}" 
//  Standard container startup 
//  Space available in destination. Try and fill it. 
//  If the last player left the Room, we need to cancel the Broadcast Timer Task. 
//  Never remove active streams 
//  Indicates that three replacement characters are missing 
/*              * Using a writer or setting the output character encoding means the             * response will specify a character set. These cases therefore             * reduce to can the file be read with the correct encoding.             * (Assuming any BOM is always skipped in the included output.)              */
/*  SSL_kSRP   - SRP  */
//  Note: as a special behavior, the completion handler for accept is   always called in a separate thread. 
//  Redirect the user to the original request URI (which will cause 
/*      * Bug 55453      */
//  -------------------------------------------------------------- Constants 
/*              * Set request attributes. Do not set the             * javax.servlet.error.exception attribute here (instead, set in the             * generated servlet code for the error page) in order to prevent             * the ErrorReportValve, which is invoked as part of forwarding the             * request to the error page, from throwing it if the response has             * not been committed (the response will have been committed if the             * error page is a JSP page).              */
//  Estimate (on high side to be safe) of average size excluding content 
//  clear loader 
//  First pass 
//  &apos; 
//  Skip the '@' 
//  the buffer is already at ( or bigger than ) limit 
/*                             String order = one.getName() + two.getName() +                                    three.getName() + four.getName() +                                    five.getName() + six.getName();                            orders.add(order);                             */
//  Application handlers 
//  Have to do this outside of the sync above to prevent a   possible deadlock 
//  Cipher 96 
// descriptor); 
//  Find all the container fragments and remove any present from the 
//  jsp-config was added in Servlet 2.4. Prior to that, tag-libs was used 
//  Create and add the identity filters. 
//  Check to see if user is locked 
// generate the temp variable name 
//  messageDestinations were ignored in Tomcat 6, so ignore here 
//  from JavaEE 5 
//  round of tune-up 
//  All init code should be in here. run() needs to be quick 
/*      * add all saved cookies to the outgoing request      */
//  Invalid ranges 
//  fill source entries, before we hand the record over to another   thread with another class loader 
//  Set clock window size 
//  Look to see if the value is quoted 
//  NO-OP send so simply return the message unchanged. 
//  No need to retain the length - just need to consume it and make   sure it is valid. 
//  apply INCLUDE to the global dispatcherMapping. 
//  Bug 56612 
//  The app has not been deployed in exploded form 
// clear the command string 
//  Look via a ServiceLoader for a Log implementation that has a   constructor taking the String name. 
/*      * Tests the presence of exposed headers in response, if configured.     *     * @throws IOException     * @throws ServletException      */
//  finally, for posts only, deal with the request content 
//  Read the target 
// do nothing, we couldn't connect 
//  Checking if a child resource of this collection is   already locked 
//  <param > for java_codebase 
//  Re-add this listener to the new AsyncContext 
//  Ignore. Probably triggered by a call to stop().   In the highly unlikely event it was a different trigger,   simply ignore it and continue. 
//  Create a new parser 
//  Create and execute our Digester 
//  Cipher 99 
//  Ignore everything else 
//  Returns ModuleFinder 
//  with the two Authenticators used in the remaining tests. 
//  References to variables that refer to lambda expressions will be   parsed as functions. This is handled at runtime but at this point   need to treat it as a variable rather than a function. 
//  some cases. 
//  Start with current settings (returns a copy) 
//  Generate an empty response 
//  Find content type. 
//  Is it better to use a sync or a thread local here? 
//  Make sure getServer() has been called as that is where naming is   disabled 
//  This is expected - swallowing the exception is the reason this   method exists. Log at debug in case someone is interested. 
//  A value of 0 is equivalent to using INFO_ALL   A negative value will trigger infinite suppression   The value is milliseconds 
//  The position is OK (On a delimiter) 
//  consistently for the entire message 
//  be a MethodExpression 
//  Generate the mask 
//  When parsed as EL in JSP the escaping of # as \# is optional 
//  control window. This should make the stream 3 window negative 
//  Cipher 98 
//  Complain if no servlet class has been specified 
//  If Host is using default value Context can override it. 
//  $Version=1 -> RFC2109   $Version=0 -> RFC2109 
//  create a XAResource to manage the connection during XA transactions 
//  normal case 
//  ------------------------------------------- FakeOutputStream Inner Class 
//  solution is available 
//  Skip directory listings if we have been configured to   suppress them 
//  Rethrow an exception if one was thrown by the invoked servlet 
//  Session 
//             threads[i] = new TestThread();              threads[i].setName("tomcat-pool-"+i);              threads[i].d = this.c3p0Datasource;            } 
//  Use plugin to generate more efficient code if there is one. 
//  Multi-value headers are stored as a single header and the client is 
//  Exception will not be thrown in this case 
//  Not worth caching this right now 
//  Avoid unknown protocol triggering an additional error 
//  Add another parameter 
//  See comment below for the reason we generate the extra "}" here. 
//  Receiver Attributes 
//  Map the async servlet to /simple so we can re-use the HTTP/2 handling   logic from the super class. 
//  JMX registration 
//  from JavaEE 8 
//  Cipher 93 
//  Create SSL context if properties were set to define a certificate 
//  Load our mapping properties for the standard authenticators 
//  Two requests 
//  service-ref element 
//  If we're parsing a packaged tag file or a resource included by it   (using an include directive), ctxt.getTagFileJar() returns the   JAR file from which to read the tag file or included resource,   respectively. 
//  Figure out what type of JSP document and encoding type we are   dealing with 
//  IE style plugin   <object ...> 
//  A read is pending, so no longer in initial state 
//  The setParent() method need not be called if the value being   passed is null, since SimpleTag instances are not reused 
//  Servlet SRV.6.2.2. The Request/Response may have been wrapped   and may no longer be instance of RequestFacade 
//  - redirect (code) 
/*          * Parse compilation errors. Each compilation error consists of a file         * path and error line number, followed by a number of lines describing         * the error.          */
//  Copy reference to avoid NPE if close happens after null check 
/*          * Constructor for custom action implemented by tag file.          */
// timeout has occurred 
//  Try to add duplicates 
//  Cipher 92 
//  classname is default filterName as annotation has no name! 
// should return instantly 
//  NOTE: The priority order for session cookie configuration is:         1. Context level configuration         2. Values from SessionCookieConfig         3. Defaults 
//  Ignore - JSP API is not present. 
//  Set the appropriate output headers 
/*  corresponding setters and getters  */
//  Missing host header is illegal but handled above 
// class ReceiverThread 
//  If name is empty, a newly allocated naming context is returned 
//  a specific status code so use the default. 
// tmp.getMessage().append(XByteBuffer.toBytes(i),0,4); 
//  No pending completion handler, so writing to the main buffer   is possible 
//  o.a.catalina.tribes.test.interceptors 
//  Do we need to look for a constructor that will take properties? 
//  throw an exception? 
//  Cipher 95 
//  Make the authenticator think the user originally requested   the landing page 
//  It is better to make sure the method is accessible, but   ignore exceptions and hope for the best 
//  from JavaEE 6 
//  Use empty dir for root of web app. 
/*          * Decoding is required.         *         * Potential complications:         * - The source String may be partially decoded so it is not valid to         *   assume that the source String is ASCII.         * - Have to process as characters since there is no guarantee that the         *   byte sequence for '%' is going to be the same in all character         *   sets.         * - We don't know how many '%nn' sequences are required for a single         *   character. It varies between character sets and some use a variable         *   length.          */
// nioSenders.remove(entry.getKey()); 
//  The property should tyake precedence over the field and this should   be null 
/*  OS Enums  */
//  shrink header list array 
//  skip 
//  Store nested <Valve> elements 
//  Execute the runnable using a container thread from the   Connector's thread pool. Use a wrapper to prevent a memory leak 
//  ----------------------------------------------- Http2Parser.Input methods 
//  Assume write is not possible 
//  len > buf.length + avail   long write - flush the buffer and write the rest   directly from source 
// Creating new buffer 
// c3p0Datasource = null; 
//  directly and jsp-property-group did not exist 
/*  * For a POJO class annotated with * {@link javax.websocket.server.ServerEndpoint}, an instance of this class * creates and caches the method handler, method information and parameter * information for the onXXX calls.  */
//  Message 
//  convert to external encoding before hex conversion 
//  No need to truncate 
//  Make sure this security role is currently present 
// don't support the body content 
//  If patterns is null, continue to avoid an NPE   See Bugzilla 30624 
// the whole thing is in the table 
//  Use connector scheme and secure configuration, (defaults to   "http" and false respectively) 
//  This is the only point where garbage is created by throwing away the   old array. Note it is only the array, not the contents, that becomes   garbage. 
//  from JavaEE 7 
//  Identify the host we are associated with 
//  ClusterValve are not store at Hosts element, see 
//  Cipher 94 
//  Number of sessions created by this manager 
// initialize the flags 
//  Iterate over the values in the table 
//  Configure the list of failed users to delete the oldest entry once it   exceeds the specified size 
//  Tag Library Data 
//  Set to distributable else every app will be prevented from being   distributable when the default fragment is merged with the main 
//  Init 
/*      * Represents a quoted (single or double) string token in EL      */
//  if the right number of messages arrived 
/*          * Appends a page directive with 'pageEncoding' and 'contentType'         * attributes.         *         * The value of the 'pageEncoding' attribute is hard-coded         * to UTF-8, whereas the value of the 'contentType' attribute, which         * is identical to what the container will pass to         * ServletResponse.setContentType(), is derived from the pageInfo.          */
//  visit body 
//  Has an upgrade been requested? 
//  If we are currently unloading this servlet, throw an exception 
//  Rule 4a -- Welcome resources processing for exact macth 
//  A simplified copy of ContextConfig.getDefaultWebXmlFragment(). 
//  Continue flushing 
//  Rule 2 -- Prefix Match 
//  Need to test sending push promise when push promise support is disabled 
//  SSL not enabled by default as it can only used on its own 
//  Swallowed 
//              boolean modified = false; 
//  XXX - Need to change pageContext to jspContext if   we're not in a place where pageContext is defined (e.g. 
//  should be a lot faster. 
//  OK, it's really time to dispose of this thread 
/*  Generated By:JJTree: Do not edit this line. AstFalse.java  */
// if we have less threads than maximum force creation of a new thread 
//  Too small ping 
//  NO-OP: Unused 
// find the first byte 
/*      * Try to use the session cookie from the BASIC webapp to request     * access to the webapp that does not have a login method. (This     * is equivalent to Single Signon, but without the Valve.)     *     * Verify there is no cross-authentication when using similar logic     * to testBasicLoginRejectProtected (above).     *     * This should be rejected with SC_FORBIDDEN 403 status.      */
// clean up any cancelled keys 
//  Output header: 
//  From https://tools.ietf.org/html/draft-ietf-tls-chacha20-poly1305-04   These might change. 
//  Trust store 
//         this.datasource.getPoolProperties().setMaxActive(10);          this.threadcount = 20;          this.transferPropertiesToC3P0();          this.c3p0Datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis(); 
//  ignore errors 
// get the response object 
//  Check the dependencies count 
//  to flush any data that is still to be written to the client. 
//  Use this rather than hashCode since in some environments,   multiple instances of this object were created with the same   hashCode 
//  If in state NEW when destroy is called, the object name will never   have been set so the notification can't be created 
//  Check dispatcher mapping 
//  See https://bz.apache.org/bugzilla/show_bug.cgi?id=57943 
//  Instantiate our database driver if necessary 
//  destroy() will not be called, thus clear the reference now 
//        SRV.10.7.2 
//  --------------------------------------- CatalinaShutdownHook Inner Class 
//  60-6f a-o 
//  Decrypt remainder of the message. 
// add params 
//  Connection reset. Connection ID will vary so use a pattern   On some platform / Connector combinations (e.g. Windows / APR),   the TCP connection close will be processed before the client gets   a chance to read the connection close frame which will trigger an   IOException when we try to read the frame.   Note: Some platforms will allow the read if if the write fails         above. 
//  service-ref was introduced in Servlet 2.4 
//  NOTE - Elements need to be written in the order defined in the 2.3          DTD else validation of the merged web.xml will fail 
//  TODO SERVLET 3.1 
//  Nothing can come before jsp:attribute, and only   jsp:body can come after it. 
//  Order depends on server side timing. Handle both possibilities. 
//  Doesn't matter what we look for, result should be EOF 
//  ------------------------------------------------ HTTP specific properties   ------------------------------------------ passed through to the EndPoint 
//  We throw the original exception - the super will deal with   it 
//  Read the sessionid after the response.   HttpSession hsess = hreq.getSession(false); 
//  Skip the control characters except VTAB 
//  Handle dynamically removing wrappers 
//  Super size the flow control window. 
//  The end of the processing will instead be an async callback 
//  Use a GET no role - should be allowed as denyUncovered is false 
//  This should be plenty of time, even on slow systems. 
// send a ping, wait for all nodes to reply 
//  Hide the default constructor since this is a utility class. 
//  Cipher 91 
//  Window size updates after reading POST body 
// ------------------------------------------------------------------   Non cancellable Future used to check and see if a connection has been made available 
//  whatever... try to invalidate the connection 
//  Still not found - use introspection 
/*  store the session and remove it from the manager  */
// if we have a message that requires a response,  but none was given, send back an immediate one 
//  Scriptlet 
// class CGIServlet 
//  Non-final to support clone() 
//  Request a JSP page (that doesn't load any tag libraries etc.)   This page does use @PostConstruct to ensure that the cache does not 
//  Close socket and clear pool 
//  The data buffer is empty, we can reuse the entire buffer. 
//  Close anyway 
//  Look for 4-byte BOMs 
//  Cipher 90 
// simple refresh the table model 
//  Version for the second mapping loop and 
//  Try the ROOT context of default host 
//  Custom 5xx code so we can detect if the correct error is   reported 
//  c.addAfterOrderingOthers(); 
//  Detect Special cookies 
//  Evaluation done 
//  apply FORWARD to the global dispatcherMapping. 
//  The writer is only used during the compile, dereference   it in the JspCompilationContext when done to allow it 
//  Added via Lambda or ImportHandler. EL will expect a   function mapper even if one isn't used so just pass null 
//  initialize state 
/* ----------------------------------------------------------------------- */
// default values 
//  - last (stop rewriting here) 
//  need to handle deferred values and methods 
//  If a page is to be precompiled only, return. 
//  both varargs methods match. 
//  Add two more values 
//  ----------------------------------------------------------- Inner classes 
//  Create subordinate information descriptors as required 
//  dispatcher was added in Servlet 2.4 
//  Validate scheme (and build proxyPath) 
//  ... and have a password 
//  Non-public, abstract, interface or not in an exported   package (Java 9+) - skip it. 
//  Build the expected location the same way the webapp base dir is built 
//  Check lower count limit is enforced 
//  Check for "<\%" 
//  Check for the servlet being marked unavailable 
//  wsSessions will be null if the HTTP session has ended 
//  begin with a repeat of testBasicLoginAcceptProtectedWithCookies 
//  the command line 
//  NOTE: It is assumed that update is always true in this method. 
//  Should work 
/*      * Cross-context requests with parallel deployment      */
// reset the values 
//  Something has gone wrong. The underlying connection has been   closed without the connection being returned to the pool. Return   it now. 
//  read the expected data 
//  Document the servlet configuration initialization parameters 
// We are making lots of unnecessary copies of the included data here. If  someone ever complains that this is slow, we should connect the included 
//  Wait up to another 10 seconds for the connection to be closed - 
//  -------------------------------------------------------- protected Methods 
//  append an encoded url to carry the sessionids 
//  Building an input stream on the WAR to upload, if any 
//  Print to the appropriate destination 
//  No flags   Stream 0 
//  Generally, continuation frames don't impact the overhead count but if   they are small and the frame isn't the final header frame then that   is indicative of an abusive client 
/*  Don't use compression even if supported  */
//  Alias conflicting with existing Alias 
//  To support jmx attributes 
// Cluster configuration end 
//  Strict servlet compliance requires all extension mapped servlets   to be checked against welcome files 
//  Deploy the copied war 
//  Check that the method expression does return the keys 
//  Status.CLOSED - unexpected 
//  Servlet 3.1 non-blocking write listener 
//  Invalid config 
//  Resources Env 
/*      * Additional private fields for 2.0 info      */
//  Create a working TagHandlerPool 
//  if we are below the limit 
//  Print failure message if needed 
//  Work up container hierarchy, add a component to the name for   each container 
//  need more space than we can afford, need to flush   buffer 
//  Should never come here 
//  Shut down this component 
//  Check if the response is of sufficient length to trigger the compression 
//  servlet doesn't support if-modified-since, no reason   to go through further expensive logic 
// we found the first character 
//  --- configuration attributes -------------------------------------------- 
// Still 3 active connections 
//             Method m=resource.getClass().getMethod("setModelMBean",                      new Class[] {ModelMBean.class}); 
/*      * This is the same as testAcceptProtectedBasic (above), except     * using an invalid password.      */
//  -------------------------------------------------------- Logging Methods 
//  application class loader 
/*      * The default behaviour of BASIC authentication does NOT create     * a session on the server. Verify that the client is required to     * send a valid authenticate header with every request to access     * protected resources.      */
//  And in any case, it's safe to say a branch 
//  Absolute ordering 
//  Can't be a lambda expression 
//  Fall back to platform default if specified encoding is not   supported. 
//  "action" in Apache Harmony 
//  Report results based on success or failure 
//  Check property names and log warnings about obsolete and / or unknown properties 
//  Test "addConnectorPort" and with port matching in both patterns 
//  Document the properties from HttpServletRequest 
//  Web application initialization is single threaded so this is   safe. 
//  Make sure this filter mapping is currently present 
//  Allow thread to be interrupted and back out of the publish   operation. No further action required. 
// write output 
//  Create the principals 
//  The authentication mechanism has authenticated the user so create   the Principal directly 
//  We have completed expire of this session 
//  For now... 
//  Test that filter mapping works. Test that the same filter is   called only once, even if is selected by several mapping   url-patterns or by both a url-pattern and a servlet-name. 
//  Skip duplicate aliases 
//  copy from InputStream  ----------------------------------------------------------------------- 
//  JarFile#getEntry() is multi-release aware 
/*  some vars below copied from Craig R. McClanahan's InvokerServlet  */
//  (possibly more than once if non-STM) 
//  Don't warn about this thread 
//  VERIFY 
//  Store nested <OpenSSLConfCmd> elements 
// noop - ignore known missing properties 
//  Display operating system statistics using APR if available 
//  Flushing was done, continue processing 
//  Async requests are supported with this valve 
//  Assigning permissions for the work directory 
//  Ignore request body 
/*  * This tests use A=1, B=2, etc to map stream IDs to the names used in the * figures.  */
//  If timeBetweenEvictionRunsMillis > 0, start the pool's evictor 
//  Close the resource we no longer need if we know how to do so 
// We need to fetch this value each time, since it may   change   during the loop 
//  Expected content doesn't end with a CR-LF so if it isn't chunked make   sure the content length is used as reading it line-by-line will fail 
//  Fast for correct values, slower for incorrect ones 
//  Now we have the full pipeline, validate the use of the RSV bits. 
//  IPv4 - invalid 
//  Now add a resource link to the context 
//  Open an input stream to the specified pathname, if any 
//             throw new IllegalArgumentException                  ("Error Page Location must start with a '/'"); 
//  low surrogate, insert high surrogate after putting it in 
//    streams will have been observed. 
//  Stop any threads the web application started 
//  Check if the requested JSP page exists, to avoid   creating unnecessary directories and files. 
// purpose of this test is to make sure that we have received all the members 
//  Removing local ejbs 
/*  Configure for blocking  */
//  Coded header 
//  Cipher 8E 
// will show as '07' instead of ' 7'  will show as '07' instead of ' 7' 
//  the org.apache.jasper.runtime package as a support class. 
//  Create the new Thread within a doPrivileged block to ensure that   the thread inherits the current ProtectionDomain which is   essential to be able to use this with a Java Applet. See   https://bz.apache.org/bugzilla/show_bug.cgi?id=57091 
/*      * Logon to access a protected resource using DIGEST authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp while sending the SSO session cookie provided by the     * first webapp.     * This should be successful with SC_OK 200 status.     *     * Then, wait long enough for the DIGEST session to expire. (The SSO     * session should remain active because the NonLogin session has     * not yet expired).     *     * Try to access the protected resource again, before the SSO session     * has expired.     * This should be successful with SC_OK 200 status.     *     * Finally, wait for the non-login session to expire and try again..     * This should be rejected with SC_FORBIDDEN 403 status.     *     * (see bugfix https://bz.apache.org/bugzilla/show_bug.cgi?id=52303)      */
//  Can't change this once the executor has started 
/*      * Section Section 6.2.6     *     * @throws ServletException     * @throws IOException      */
//  Process a relevant property change 
//  needs to be authorized? 
//  Header 
//  NO-OP by default.   There is no buffer created for this test object since no test depends   on one being present or on this method resetting it. 
//  Building URL 
//  We have a match 
// get the iScope according to the strScope 
//  MIME mappings 
//  The frame processing code expects binary message handlers to   accept ByteBuffer 
//  Cipher 8D 
//  In this order, in case add() throws. 
//  use the session cookie harvested with the other webapp 
//  The database itself 
//  Note: Subject already set in SPNEGO authenticator so no need         for Subject.doAs() here 
//  Ignore specified docBase 
//  Load our startup class and call its process() method 
//  Create a reference to the resource. 
//  Make sure a conflicting web application has not already been deployed 
//  Only user1 should be able to perform a DELETE as only that user has 
//  Load the JDBC driver class 
//  Use processor specified scheme to determine secure state 
//  Check all of the collections included in this constraint 
//  Don't use keystore type as the default if we know it is not   going to be used as a trust store type 
//  192k of body (24 * 8k) 
//  request 
//  Close socket and pool 
/*      * @param uri The uri of the TLD     * @param ctxt The compilation context     *     * @return the location of the TLD identified by the uri      */
//  We can't create an instance of the DataSource 
//  Check to see if we have finished handshaking 
//  Ignore unknown attribute for backward compatibility 
/*      * invalid base64 string tests     *     * Refer to RFC2045 section 6.8.      */
//  search from the next position 
//  labels must end with a letter or number 
// map of the current state at a given position 
//  <param > for type 
// 0011 1111  1000 0000 
//  WebSocket sub-protocols 
//  Disable JMX on the underlying pool if the DS is not registered: 
/*      * Needs to know if this was application initiated since that affects the     * error handling.      */
//  Should use chunked encoding 
//  Has an error occurred during async processing that needs to be   processed by the application's error page mechanism (or Tomcat's 
//  Need the exception in string form to prevent the retention of   references to classes in the stack trace that could trigger a memory   leak in a container environment. 
//  Can't grow above the limit 
//  Expose in String form for JMX 
//  Cipher 8F 
//  Only care about functions in ELNode's 
//         config();          this.transferProperties();          this.tDatasource.getConnection().close();          javax.sql.DataSource datasource = this.tDatasource;          Connection con1 = datasource.getConnection();          Connection con2 = null; 
//  Use NIO by default starting with Tomcat 8 
//  Set up parameters for an appropriate search 
// /main 
//  The second attempt 
//  Kerberos configuration file location 
//  Partial PUT 
//  An I/O error occurred on a non-container thread which means   that the socket needs to be closed so set success to false to   trigger a close 
//  Perform normal superclass finalization 
//  Section 6.1.2 
/*      * Tests what happens if a request is completed during a dispatch but the     * request body has not been fully read.      */
//  skip separator 
//  Store nested <Store> element 
//  If we've already taken another branch then 
/*      * Test JNDI is available to ServletContextListeners.      */
//  Since the "stuck thread notification" is warn, this should also   be warn 
//  package protected for access from I/O streams 
//  Allocate the end and close message array 
/*                  * For whatever reason we cannot write the                 * file to disk.                  */
// bind to the address to avoid security checks 
//         this.datasource.getPoolProperties().setMaxActive(10);          this.threadcount = 10;          this.transferPropertiesToC3P0();          this.c3p0Datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis(); 
/*      * NO-OP method provided to make it easy for other classes in this package     * to trigger the loading of this class and the population of the     * keySizeCache.      */
//  Conflict. Same unqualifiedName, different fully qualified names 
//  Delegation was enabled, go back and add the webapp paths 
//  Control> 0-31, 127 
//  ----------------------------------------------------- Properties 
//  TLS 1.3 does not support authentication after the initial handshake 
//  JSP Configuration settings do not apply to tag files 
/*      * Test https://bz.apache.org/bugzilla/show_bug.cgi?id=50026     * Verify serving of resources from context root with subpath mapping.      */
/*  KRB5 auth  */
//  The error page could be inside an include. 
//  Only set the status on the first call (the dispatch will trigger   another call to this Servlet) 
//  Cipher 8A 
// TODO lookup JNDI name  } 
// purpose of this test is to make sure that we have received all the members  that we can expect before the start method returns 
//  Tomcat will set this key to Boolean.TRUE if the   identifier is a stand-alone identifier (i.e.   identifier) rather than part of an AstValue (i.e.   identifier.something). Imports do not need to be   checked if this is a stand-alone identifier 
//  IPv4 - valid 
//  Request dispatcher in use 
//  https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82   "Test" = "Test" 
//  longs to avoid any possibility of overflow 
//  change the default defined in ConnectionSettingsBase. 
//  maintain() clears the queue, though it is not 100% reliable,   as queue is populated by GC asynchronously 
// / Note: These files are saved using the encoding indicated by the BOM 
//  Note: Min value for maxLoadedJsps is 2 
//  Should be an end body message 
//  To allow for timing differences between runs, a "best of n" approach 
// this ensures that if the registration came from tomcat, we're not losing  the unique domain, but putting that into as an engine attribute 
//  Need to filter out CTLs excluding TAB. ISO-8859-1 and UTF-8   values will be OK. Strings using other encodings may be   corrupted. 
//  with a new map but with the same contents. 
//  Otherwise, use the class (2.6.0 feature) 
//  Enumerate the entries until one is reached that represents an   entry that has not been seen before. 
//  Create the list of expected MBean names 
//  Should only be one HTTP2-Settings header 
//  Add a content-length header if a content length has been set unless   the application has already added one 
//             Assert.assertFalse("Connection got starved:"+x.getMessage(),true); 
/* --Constructor--------------------------------------------- */
//  Zero so we don't leave a zero length name 
//  Call the servlet destroy() method 
/*     // Cipher 80    TLS_GOSTR341094_WITH_28147_CNT_IMIT(            "GOST94-GOST89-GOST89",            KeyExchange.GOST,            Authentication.GOST94,            Encryption.eGOST2814789CNT,            MessageDigest.GOST89MAC,            Protocol.TLSv1,            false,            EncryptionLevel.HIGH,            false,            256,            256,            null,            null    ),    // Cipher 81    TLS_GOSTR341001_WITH_28147_CNT_IMIT(            "GOST2001-GOST89-GOST89",            KeyExchange.GOST,            Authentication.GOST01,            Encryption.eGOST2814789CNT,            MessageDigest.GOST89MAC,            Protocol.TLSv1,            false,            EncryptionLevel.HIGH,            false,            256,            256,            null,            null    ),    // Cipher 82    TLS_GOSTR341094_WITH_NULL_GOSTR3411(            "GOST94-NULL-GOST94",            KeyExchange.GOST,            Authentication.GOST94,            Encryption.eNULL,            MessageDigest.GOST94,            Protocol.TLSv1,            false,            EncryptionLevel.STRONG_NONE,            false,            0,            0,            null,            null    ),    // Cipher 83    TLS_GOSTR341001_WITH_NULL_GOSTR3411(            "GOST2001-NULL-GOST94",            KeyExchange.GOST,            Authentication.GOST01,            Encryption.eNULL,            MessageDigest.GOST94,            Protocol.TLSv1,            false,            EncryptionLevel.STRONG_NONE,            false,            0,            0,            null,            null    ), */
//  Frame header 
//  There will be no overflow as the output buffer is big   enough. There will be no underflow as all the data is   passed to the decoder in a single call. 
//  Create the APR address that will be bound 
/*  Make sure date is correct  */
// it fits in the current byte 
//  Reset the instance variables associated with this Session 
//  because testOnBorrow is true, this triggers the validation query 
//  Since "!/" has a special meaning in a JAR URL, make sure that the   sequence is properly escaped if present. 
//  Handle dynamically adding host aliases 
// --- inner classes ---------------------------------------------- 
//  Fill it up using an alphabetical order 
//  Cipher 8C 
//  Insert the ROOT name if required 
// if we call parseCRLF we overrun the buffer here  so we defer it to the next call BZ 11117 
//  POOL-356.   In case there are already threads waiting on something in the pool   (e.g. idleObjects.takeFirst(); then we need to provide them a fresh instance.   Otherwise they will be stuck forever (or until timeout) 
//  CORS PRE_FLIGHT (OPTIONS) requests set the following headers although   non-CORS OPTIONS requests do not need to. The headers are always set   as a) they do no harm in the non-CORS case and b) it allows the same   response to be cached for CORS and non-CORS requests. 
//  Many errors can occur during handshake and need to be reported 
//  Convert shtml mime type to ordinary html mime type but preserve   encoding, if any. 
//  Reading bytes until the end of the line 
//  Check for "/../" 
//  If anything goes wrong, just revert to the original behaviour 
//  Per user connection properties 
//  Update times 
//  ------------------------------------------------ Configuration Defaults 
//  ------------------------------------------------------ protected Methods 
//  Connection level window is empty. Although this   request is for a stream, use the connection 
/*          * Note that the implementation will convert primitives and their object         * equivalents by default but that users are free to specify their own         * encoders and decoders for this if they wish.          */
//  The separator is '&' after the second use 
//             exception(request, response, e); 
//  .. but lots of small payloads are inefficient so that will increase   the overhead count unless it is the final DATA frame where small   payloads are expected. 
//  relative to starting source line 
//  Check EOS followed by error page body 
//  Cipher 8B 
//  %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E (RFC6265)   %x80 to %xFF                                 (UTF-8) 
//  Use an invalid cipherSuite until the handshake is completed 
/*      * Logon to access a protected resource using BASIC authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp while providing the SSO session cookie received from the     * first webapp. This should be successful with SC_OK 200 status.     *     * Then, wait long enough for the BASIC session to expire. (The SSO     * session should remain active because the NonLogin session has     * not yet expired).     * Try to access the protected resource again, before the SSO session     * has expired. This should be successful with SC_OK 200 status.     *     * Finally, wait for the non-login session to expire and try again..     * This should be rejected with SC_FORBIDDEN 403 status.     *     * (see bugfix https://bz.apache.org/bugzilla/show_bug.cgi?id=52303)     *     * Note: this test should run for ~20 seconds.      */
// inputBuffer.addFilter(new GzipInputFilter()); 
//  Add this StoreFactory to our associated component 
//  Unknown type 
//  A custom error-page has not been defined for the exception   that was thrown during request processing. Check if an   error-page for error code 500 was specified and if so,   send that page back as the response. 
/*      * Receives notification of the end of an element.      */
/*  no auth (i.e. use ADH or AECDH)  */
//  Guarded by this 
//  If init fails, this may be null 
//  Skip this if we can 
// check to see if the message is diffable 
//  resource-env-ref 
//  Treat this file as a JAR 
// names of the temp variables 
//  Special case if there is only one function in the map 
//  Fixes the token in-place 
// ignore this one 
// check if the message is an EVT_GET_ALL_SESSIONS,  if so, wait until we are fully started up 
//  RewriteCond TestString CondPattern [Flags] 
//  HttpClient keep-alive threads 
//  Remove the current response if it is our wrapper 
//  We were able to perform login successfully so mark JAAS realm as   available as it could have been set to false in prior attempts.   Change invocationSuccess variable only when we know the outcome   of the JAAS operation to keep variable consistent. 
//  Need to decode the URL, primarily to convert %20   sequences back to spaces 
// Literal Header Field without Indexing 
//  Need to do this in two frames because HPACK encoder automatically   re-orders fields 
//  Fallback 
//  For logging purposes only 
//  Add listener directly to the list of instances rather than to   the list of class names. 
//  Resource injection only if JNDI is enabled 
//  ------------------------------------------------------  Instance Fields 
// a.addAfterOrderingOthers(); 
/*      * Represents a token in EL expression string      */
//  The connector isn't configured for authorization. Create a   user without any roles using the supplied user name. 
//  are \ " and '. # and $ are not escaped inside a String literal. 
//  domain must end with a label 
//  Only count the cookie header once since HTTP/2 splits it into   multiple headers to aid compression 
//  Must be at delimiter or EOF 
//  Output results 
//  (to force flushing) 
//  Synchronized since PUSH_PROMISE frames have to be sent in order. Once   the stream has been created we need to ensure that the PUSH_PROMISE 
//  Step 4. Process /WEB-INF/classes for annotations and 
//  Unexpected 
//  ----------------------------------------------- Accessors for sub-classes 
//  Then try URI.   Using resolve() enables the code to handle relative paths that did 
// first check start header 
//  We must wait to set the parameter until end   so that we can make sure that the right set of parameters   is at the top of the stack 
//  Example 13-4 
//             throw new IllegalStateException 
//  checked above 
//  This filters out same notification until processing   of the current one is done 
//             TestThread t = new TestThread();              t.setName("tomcat-pool-"+i);              t.d = this.c3p0Datasource;              t.start();          }          latch.await();          long delta = System.currentTimeMillis() - start; 
//  annotation mapping not added s. Servlet Spec 3.0 (Nov 2009)   8.2.3.3.vi page 81 
//  Dump the contents of this pipeline if requested 
//  @GuardedBy("evictionLock")   @GuardedBy("evictionLock") 
//  execute the query 
//  We're included   SRV.9.3 says we must throw a FNFE 
//  Only need to wrap as this point if it wasn't wrapped to process a   proxy CONNECT 
// it does not fit, it may need up to 4 bytes 
//  Tomcat 8 default as of 2014-08-04   This gets an A- from https://www.ssllabs.com/ssltest with no FS for   a number of the reference browsers 
/*          * There are various ways to handle the platform specific behaviour         * here. This was chosen as it is simple and the tests are run on         * Windows as part of every release cycle.          */
//  Not valid 
//  With httpd 2.2, AllowCONNECT requires fixed ports. From 2.4, a range   can be used. 
//  Example 13-3 
//  Do this last as it depends on servlets 
//  You'd be surprised, but System.currentTimeMillis   shows up on the profiler 
//  Try a setFoo ( boolean ) 
//  Wait for threads to finish 
//  Add the request listener 
//  view of buffer and registered. 
//  Special handling for XML settings as these attributes will always be   available if they have been set on the context 
//  Session should be idle at least for 0 second (maxIdleBackup)   to be eligible for persistence, thus no need to wait. 
//  If time is provided add the event. 
//  User was previously locked out but lockout has now   expired so reset failure count 
// call unwrap 
//  ----------------------------------------------- HttpOutputBuffer Methods 
// map init request 
// prepareStatement 
//  Determine where the resource is located 
//  Cipher 89 
//  Default to "ISO-8859-1" per JSP spec 
//  Hint to server that the client supports this   option. Java SE API (as of Java 8) does not   expose the API to control the Window size. It is   effectively hard-coded to 15 
//  Set a configFile so that the configuration is actually saved 
//  Removing wrapper lifecycles 
//  Use the system classloader as the victim for all this 
//  Connectors only need stopping if they are currently   started. They may have failed to start or may have been   stopped (e.g. via a JMX call) 
//  Recipients are children of the current stream that are in the 
//  Is ssl 
//  byte[] 
//  At this point the Host header has been processed. 
//  Enable Sendfile by default if it has not been configured but usage on 
//  Retain the original name used to set the charset so exactly that name is   used in the ContentType header. Some (arguably non-specification 
//  use a real driver cause we have an invalid query to validate 
//  Payload 
// channel properties 
//  May see Window updates depending on timing 
//  There can only be one 'import' attribute per page directive 
//  Prefix for the 'id' attribute 
//  Release reference to our user database 
//  scan the application for TLDs 
//  Secure 
//  Enforce any user data constraint for this security constraint 
//  URL of JAR / exploded JAR for this web-fragment 
//  We cannot match without a valid request method 
//  expire 
//  If the socket should have already expired by now, 
// make sure we dont do two things at the same time 
//  Trying to write to the client when the session has   already been closed.   Ignore 
//  The thread that displays clock 
//  Cipher 88 
//  Failed to set 
//  Example 13-2   @ServletSecurity(       @HttpConstraint( 
//  -------------------- equals -------------------- 
//  Page encoding specified in JSP config element 
//  Test that if WebappLoader start() fails and if the cause of   the failure is gone, the context can be started without   a need to redeploy it. 
//  sun bug 5076772 on windows JDK 1.5 
//  Nothing to do. Socket has been closed. 
//  Let request pass. 
//  There is still data inside the main write buffer, it needs to be written first 
// throw new SsiCommandException( "Error parsing expression." ); 
//  Is the start of the current frame too near the end of the input   buffer? 
//  Not the client's fault 
//  Guarded by membersLock 
//  Advance i past the space 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=60013 
/*      * Sub-classes need to know port so they can connect      */
// NOOP 
//  No substitutions required. Don't waste memory creating   a new buffer 
// define names of all the temp variables 
//  Some of these tests need this and it used statically so set it once 
//  if docBase specified and relative, it must be relative to appBase 
//  No way to navigate to Engine. Needs to have domain set. 
//  Send a rst 
//  Ensure empty SETTINGS frame increments the overhead count 
//  Stream errors are not fatal to the connection so   continue reading frames 
//  Check the list of known invalid values 
//  External link 
//  Different line-endings -> different files size -> different weak eTag 
/*      * Copied from org.apache.tomcat.util.collections.SynchronizedStack since     * we don't want the EL implementation to depend on the JAR where that     * class resides.      */
/*  Name used for creating a map for the functions in this           EL expression, for communication to Generator.          */
//  Should have 10 threads in stage 2 and 20 in stage 1 
//  Have to support SingleThreadModel 
//  First child is always parameters even if there aren't any 
//  create directories 
// cache the statement 
//  Unbalanced quotes   Too early to use standard i18n support. The class path hasn't   been configured. 
/*  SSL_kDHr   - DH cert, RSA CA cert  */
//  Note: exposed for use by tests 
//  wait long enough for the NonLogin session to expire, 
//  cannot happen, in theory 
//  This is unusual enough to log 
//  Get filter configuration 
//  Write end tag 
//  Close and release everything associated with our db. 
//  Already the default 
//  error handling 
//  Generate end of method 
// see if we already created a map for this pool 
//  Ignore, will try to use a writer 
//  @see test case Base64Test.testConstructors() 
/*  System property that controls if the requirement to have the object     * used in jsp:getProperty action to be previously "introduced"     * to the JSP processor (see JSP.5.3) is enforced.      */
//  Ignore because UserTransaction was obviously   added via ResourceLink 
//  By default, the registry will pick an address to listen on.   Setting this property overrides that and ensures it listens on 
//  Find the context associated with the session 
//  Information about the method to use 
//          transportGuarantee = TransportGuarantee.CONFIDENTIAL)) 
//  Set formatter 
//  Server should close the connection after the exception on open. 
//  session expiry in web.xml is defined in minutes 
//  Default to 4.0 until we know otherwise 
//  Cipher 85 
//  We're nested inside a node whose body is   declared to be scriptless 
//  Write encrypted data to network BIO 
//  Select the Host to be used for this Request 
/*  SC_BAD_REQUEST  */
//  other messages are ignored. 
//  no impact on distributable 
/*  Methods that do not terminate lines  */
//  initialize application context 
//  Validate and process attributes - don't re-validate the 
//  19-headers, 21-headers 
/*          * Encoder for URI paths, so from the spec:         *         * pchar = unreserved / pct-encoded / sub-delims / ":" / "@"         *         * unreserved  = ALPHA / DIGIT / "-" / "." / "_" / "~"         *         * sub-delims = "!" / "$" / "&" / "'" / "(" / ")"         *              / "*" / "+" / "," / ";" / "="          */
//  $Version must be the first avpair in the cookie header   (sc must be null) 
//  Duplicate. Mark the fragment that has already been found with   this name as having a duplicate so Tomcat can handle it   correctly when the fragments are being ordered. 
//  Still jave to support old JSP EL 
/*      * Parses a variable directive with the following syntax:     * PageDirective ::= ( S Attribute)*      */
// expected : we just swallow the exception to avoid disturbing  debuggers like eclipse's 
/*      * Params ::= `>' S? ( ( `<jsp:body>' ( ( S? Param+ S? `</jsp:body>' ) |     * <TRANSLATION_ERROR> ) ) | Param+ ) '</jsp:params>'      */
//  restore previous writer 
//  Server side uses the endpoint path as the key 
//  Populate session tracking modes 
//  W3C 
//  OpenSSLConfCmd context 
//  If no write is pending, notify that writing is possible 
//  This is intended for POST requests 
/*              * Generates getServletInfo() method that returns the value of the             * page directive's 'info' attribute, if present.             *             * The Validator has already ensured that if the translation unit             * contains more than one page directive with an 'info' attribute,             * their values match.              */
//  -------------------- Cookies -------------------- 
//  Cipher 84 
//  no leftovers to process and not using chunking 
//  Check if the last message and the new message are   String messages - in that case we concatenate them   to reduce TCP overhead (using ";" as separator). 
//  Process the current session (if there is one) 
//  Fast for valid HTTP protocol characters, slower for some incorrect   ones 
//  For non-STM, increment here to prevent a race   condition with unload. Bug 43683, test case   #3 
//  Attributes tracking state 
//  This can be ignored   This is OK for this constructor not to exist 
//  See When.java for the reason whey "}" is need at the beginning and   not at the end. 
//  Deliberately use the platform's default encoding 
/*                  * BZ 61313                 * NamingException may or may not indicate an error that is                 * recoverable via fail over. Therefore a decision needs to be                 * made whether to fail over or not. Generally, attempting to                 * fail over when it is not appropriate is better than not                 * failing over when it is appropriate so the code always                 * attempts to fail over for NamingExceptions.                  */
//  add escaped xml 
// initiate handshake 
//  Clear the image with white background. 
// Assumes servletContext is not-null  Assumes that identity comparison will be true for the same context  Assuming the above, getContext("/") will be non-null as long as the root   context is   accessible.  If it isn't, then servletContext can't be the root context anyway, hence   they will 
//  Using the specified factory 
// reset the head 
//  Skip non-class resoucres 
//  Filters were added in 2.3 so should be excluded in 2.2 
// if we have already done something to this attribute, make sure  we don't send multiple actions across the wire 
// one minute expiration 
//  and tear down the SSO session at the same time. 
/*                  *  IPv6 part ends with only one colon,                 *  last colon is not part of IPv6 format.                 *  e.g. ::FFFF:127.0.0.1                  */
//  Despite what the docs say, RSA is equivalent to kRSA 
//  As per 'clarification' from the Servlet EG, servlet definitions and   mappings in the main web.xml override those in fragments and those in   fragments override those in annotations   Skip servlet definitions and mappings from fragments that are 
//  Check if JARs have been added or removed 
//  This means we got an OOM or similar creating a thread, or that   the pool and its queue are full 
//  Step one, split the header into individual extensions using ',' as a   separator 
//  Not quoted - NO-OP 
//  Cipher 87 
//  Note: These can cause problems with downloading files with IE 
//  NOOP: No need for parameters from response in this filter 
//  Does not need to be secure 
//  If no rotate - no need for dateStamp in fileName 
//  This notification occurs once the configuration is fully done, including naming resources setup   Otherwise, the instance manager is not ready for creation 
//  Ensure that our ContainerServlet properties have been set 
//  Simple webapp 
//  Count lines inside text, but skipping comment lines at the   beginning of the text. 
//  implement custom [server]sockets 
//  Add the new player to the list. 
//  Unused due to buggy clients   TOKEN, 
//  A notification has been sent, it is possible to write at least once 
// get all the property of the target 
//  extractor needed more data to process but netInBuffer was full so   expand the buffer and read some more data. 
//  Add this Valve to the set associated with this Pipeline 
/*      * Minimal implementation to enable other transformations to be tested.      */
//  ---------------------------------------------------- InputFilter Methods 
//  Maps tag names to tag file paths 
// no responses 
//  Cipher 86 
// rely on DriverManager 
// Assume platform default encoding unless otherwise specified 
//  Always additive 
//  We reached end of zero group 
//  Configure the send file data 
// put the main thread to sleep until we are done 
/*      * All of the objects currently associated with this pool in any state. It     * excludes objects that have been destroyed. The size of     * {@link #allObjects} will always be less than or equal to {@link     * #_maxActive}. Map keys are pooled objects, values are the PooledObject     * wrappers used internally by the pool.      */
// validate the network buffers are empty 
//  do not add a role - which signals access permitted without one 
//  Need to check existing appContext registrations   (and layer and default)   appContext must match 
//   ---------------------------------------------------- persistence handler 
//  skip collection (map, resource, list, and array) resolvers 
/*      * Host header exists but its value is an empty string.  This is valid if     * the request line does not include a hostname/port.     * Added for bug 62739.      */
//  HTML Tail Section 
//  Check to see if the connection to the directory can be opened 
//  Don't treat a varArgs match as an exact match, it can   lead to a varArgs method matching when the result   should be ambiguous 
//  Replace the session id until one is valid 
//  Stores the groups we find in this iteration 
//  NO-OP if buffer is already in correct state 
//  Unexpected packet type. Unread body packets should have   been swallowed in finish(). 
//  TODO : Checking the WebDAV If header 
//  There may be pipe-lined data to read. If the data isn't   processed now, execution will exit this loop and call   release() which will recycle the processor (and input   buffer) deleting any pipe-lined data. To avoid this,   process it now. 
//  Default error pages are only supported from 3.0 onwards 
//  Note: Logic in AbstractProtocol depends on this method only returning   a non-null value if the iterator is non-empty. i.e. it should never   return an empty iterator. 
// init the flags 
//  Does work outside of 0-127 (unlike ByteChunk) 
// file was removed 
//  Should not be async at this point 
//  Validate default SSLHostConfigName 
//  Last stream 
//  40-4f A-O   50-5f P-Z 
//  cross-site scripting filter protection 
/*      * Section 6.2.3     *     * @throws ServletException     * @throws IOException      */
//  Process the request from this socket 
//  Negative Max-Age is equivalent to no Max-Age 
//  Give the async thread a chance to finish (but not too long) 
//  .java file 
// ********************************************************************* 
//  Call shutdown as the user may have created the OpenSslEngine and not used it at all. 
//  Check parents 
//  TODO Masking should move to this method   NO-OP send so simply return the message unchanged. 
// add true as the frag flag  byte[] flag = XByteBuffer.toBytes(true); 
//  Shorten as much as possible (4.2.1) 
//  been removed during the parsing of the request line 
//  Form the search filter 
//  reset hId -- if the header currently being read   happens to be 7 or 8 bytes long, the code below   will think it's the content-type header or the   content-length header - SC_REQ_CONTENT_TYPE=7,   SC_REQ_CONTENT_LENGTH=8 - leading to unexpected   behaviour.  see bug 5861 for more information. 
//  Example 13-1 
//  send the cookie which proves we have an authenticated SSO session 
//  Two forms of EOF as far as base64 decoder is concerned: actual   EOF (-1) and first time '=' character is encountered in stream. 
//  Need access to the stub field to report the leaks 
//  We fell off the end of the chain -- call the servlet instance 
//  Not decoded. Convert if required. 
//  just the header 
//  No need to reset position since skipBytes() will have done it 
//  getToken returns the position at the delimiter 
//  translation time) the type is fixed at java.lang.String. 
//  Must be a non-primitive and non array 
//  Can change maxHeaderCount 
//  Now the doTag() method 
//  Bug 60232 
//  Forward control to the specified location 
//  Usually means an invalid protocol has been configured. 
//  Valid range (too much) 
/*  SSL_kFZA   - Fortezza  */
//  Annotated as @PathParam so validate type 
//  Attributes of the current message 
//  Break the loop and add the socket to poller. 
//  Convert the annotation into constraints 
/*  6 == length("javax/")  */
//  Render the page header 
//  connection 
//  Non-blocking so dispatch 
/*  Putting the Boolean into the ELContext is part of a performance         * optimisation for ScopedAttributeELResolver. When looking up "foo",         * the resolver can't differentiate between ${ foo } and ${ foo.bar }.         * This is important because the expensive class lookup only needs to         * be performed in the later case. This flag tells the resolver if the         * lookup can be skipped.          */
//  The pool is not at capacity. Create a new object. 
/*      * "http://tomcat.apache.org" is an allowed origin and     * "https://tomcat.apache.org" is not, because scheme doesn't match     *     * @throws ServletException      */
// ejb-local-ref 
//  Non-PKCS#8 key stores will use the original key store 
//  Check magic tag of class file 
//  Error or timeout   Lift any suspension (e.g. if sendError() was used by an async   request) to allow the response to be written to the client 
//  not directly accessible. 
//  set the port the server channel will listen to 
//  LoginConfig is required to process @ServletSecurity 
// clear the remaining queue 
//  Longer than it needs to be because response will fail before   it is complete 
//  Use JspRuntimeLibrary to minimise code in _jspService() 
//  Jump through some hoops so we don't end up with an empty set while   doing updates. 
//  double[] 
/*      * Note: Returns this instance so it can be used with try-with-resources      */
//  Disallow any direct access to resources under WEB-INF or META-INF 
//  Some tests may call tomcat.destroy(), some tests may just call   tomcat.stop(), some not call either method. Make sure that stop()   & destroy() are called as necessary. 
//  Optimize on a common case.   If the buffer is empty and the source is going to fill up all the   space in buffer, may as well write it directly to the output, 
//  Fail safe on error 
//  Returns ModuleReference 
//  Leave this until now since it can only be set once - bug 49726 
//  This will trigger the ThreadLocal creation 
//  Wrap the response 
/*  Generated By:JJTree: Do not edit this line. AstDynamicExpression.java  */
//  also close the XAConnection that holds the physical connection. 
//  Start at -1 so the 'add 2' logic in closeIdleStreams() works 
// This is set to true for tests where the @OnMessage should send a message 
/*  JavaCCOptions:STATIC=false,SUPPORT_CLASS_VISIBILITY_PUBLIC=true  */
//  Let the container deal with it 
//  Validate the source of this event 
//  No command == list   List always displayed -> do nothing 
//  Should come back signed 
//  Minimum set required for default distribution/persistence to work   plus String 
//  Go back to the start and parse as a host / FQDN 
//  be needed later 
//  per-request state 
//  Tag files can't (easily) use lazy init for these so initialise them   here. 
//  reset at the end of the request 
/* --Inner classes------------------------------------------- */
//  Must have been triggered by one of the abstract methods (assume   code in this class is correct) 
/*      * Test what happens if a custom 404 page is configured,     * but its file is actually missing.      */
//  Assume there is only one 
//  Close server socket if it was initialised 
//  This is the earliest event in Lifecycle 
//  Strip leading zeros (2.1) 
//  No need to use default logger once request/response has been logged   once 
/*  Log error  */
// the scope name 
//  to work. Skip any BoM we discovered. 
//  First the package name: 
//  Range headers are only valid on GET requests. That implies they are   also valid on HEAD requests. This method is only called by doGet()   and doHead() so no need to check the request method. 
/*      * apr_cmdtype_e enum      */
//  ------------------------------------------------- AJP specific properties   ------------------------------------------ managed in the ProtocolHandler 
//  Report error 
//  Adding the additional port-component-ref, if any 
//  build membership provider 
/*  JavaCC - OriginalChecksum=a68b5c6f0a0708f478fdf8c0e6e1263e (do not edit this line)  */
//  Get nested exception 
//  Build arguments 
//  Char sequence impl 
//  No swap, Java order 
//  Update times. More than one file may have been updated. We 
//  Wasn't fragmented. Might be now 
//  EVAL_BODY 
/*  request.getRemoteUser() will not trust the AJP                     * info if tomcatAuthentication is set.  */
//  Stop older versions of IE thinking they know best. We set text/plain   in the line above for a reason. IE's behaviour is unwanted at best   and dangerous at worst. 
//  This is currently only used with HTTP   Either:    - this is an upgraded connection    - the request line/headers have not been completely      read 
/*  Shortcut for properties with explicitly configured setter  */
//  null if this is not a page 
//  00-0f   10-1f 
//  b.addBeforeOrdering("a"); 
//  ----------------------------------------------------------- Main Program 
//  classLoader must be non-null to have been registered 
//  Validate the request against the user data constraint 
//  50-5f P-Z 
//  If the page for jsp:forward was specified via   jsp:attribute, first generate code to evaluate   that body. 
//  2^14 
//  exact match 
//  Update max text size handled by session 
//  The actual response depends on timing issues. Particularly how much   data is transferred in StreamInputBuffer inBuffer to outBuffer on the 
//  Certificate store type 
//  generate prototype .java file for the tag file 
//  inAvail < 0 is how we're informed of EOF in the underlying data we're   encoding. 
/*                  * Body of tag is the body of the <jsp:body> element. The visit                 * method for that element is going to encapsulate that                 * element's body in a JspFragment and pass it to the tag                 * handler's setJspBody()                  */
//  Find the buffer on which the operation will be performed (no vectoring with APR) 
//  Clean up contentFile when Tomcat is terminated 
/*          * Appends the page directive with the given attributes to the XML         * view.         *         * Since the import attribute of the page directive is the only page         * attribute that is allowed to appear multiple times within the same         * document, and since XML allows only single-value attributes,         * the values of multiple import attributes must be combined into one,         * separated by comma.         *         * If the given page directive contains just 'contentType' and/or         * 'pageEncoding' attributes, we ignore it, as we've already appended         * a page directive containing just these two attributes.          */
//  Web application manifest 
// lengths determined by experimentation, just set it to something large then see how large it actually ends up 
//  Optional metadata-complete attribute 
//  Make sure that no sockets have been placed in the   addList or closeList since the check above.   Without this check there could be a 10s pause   with no processing since the notify() call in   add()/close() would have no effect since it   happened before this sync block was entered 
//  Set up Kubernetes API parameters 
//                 else 
//  Start in blocking-mode 
//  Check a token was supplied 
//  Try the default JVM configuration 
/*  * Creates {@link Driver} instances. * * @since 2.7.0  */
//  Ideally the utility threads are non daemon 
//  Assume the destruction succeeds 
/*      * Parses a JSP document by responding to SAX events.     *     * @throws JasperException      */
//  resource-ref/res-sharing-scope was introduced in Servlet 2.3 
//  Generate declaration for the map statically 
//  contentDelimitation being true at this point indicates that   chunked encoding is being used but chunked encoding should   not be used with a content length. RFC 2616, section 4.4,   bullet 3 states Content-Length must be ignored in this case -   so remove it. 
//  float[] 
//  we've found an encoded carriage return.  The next char needs to be a newline 
//  It isn't possible for the manager to reload itself 
//  should not be permitted to access a protected resource 
/*  DSS auth  */
//  Waiting a bit, to catch changes in last accessed time of a session 
//  NOOP in base class 
//  Generate static function mapper codes. 
//  Two cookies 
//  the remaining data directly to the network. 
/*  * Date processing based on AccessLogValve.  */
//  The Java compiler reports this as ambiguous. Using the parameter that   matches exactly seems reasonable to limit the scope of the method   search so the EL will find a match. 
//  This method is called on every loop of the Poller. Don't process   timeouts on every loop of the Poller since that would create too   much load and timeouts can afford to wait a few seconds.   However, do process timeouts if any of the following are true:   - the selector simply timed out (suggests there isn't much load)   - the nextExpiration time has passed   - the server socket is being closed 
//  Determine the resolution of System.nanoTime() so an appropriate error   margin can be used in tests that use nanoTime() 
// avoid circular loop 
// did we finish our handshake? 
/*  Generated By:JJTree: Do not edit this line. AstString.java  */
//  Read both files in, so we can inspect them 
//  Force a flush 
//  ------------------------------------------------------------ Protected Class 
//  Calls JarFile.getJarEntry() which is multi-release aware 
//  Utf8 
//  Ambiguous because the Strings coerce to both Boolean and Integer hence 
//  Better than reporting zero 
//  OK, at this point, we're not sure if another thread is trying to   remove the session or not so the only way around this is to lock it   (or attempt to) and then try to get it by this session id again. If   the other code ran swapOut, then we should get a null back during   this run, and if not, we lock it out so we can access the session   safely. 
//  the tagname/value map 
//  +   15   min   * 
//  Create test data. This is carefully constructed to trigger the edge   case. Small variations may cause the test to miss the edge case. 
//  Are we closing or closed? 
//  WebDav Status Codes 
//  Validation interval is disabled by default to ensure validation occurs everytime 
// for 
//  Release any threads that were waiting for an object 
//  vc: ScriptlessBody   We must follow the ScriptlessBody production if one of   our parents is ScriptlessBody. 
//  Get the timeout before we send the message. The message may   trigger a session close and depending on timing the client   session may close before we can read the timeout. 
//  Shut down the server 
// If we were inside quotes, close the quotes 
//  ------------------------------------------------- ErrorHandler Methods 
//  TCK signature test fails with generics 
//  Definitely not an IPv6, return untouched input. 
//  Process the step one list 
// do nothing, we wanted to remove it anyway 
//  set original sessionid at request, to allow application detect the   change 
//  path, the servlet is detected 
//  If only specific origins are allowed, the response will vary by   origin 
//  Validate the result. 
//  End of message 
//  Load this class with the same class loader as used for   this class. Note that the Thread context class loader   should not be used since that would trigger a memory leak   in container environments. 
//  Read tag byte 
//  Length zero 
//  be cast to an int. 
//  Use a GET with role - should be allowed as denyUncovered is false 
//  Note the double encoding of the result (httpd produces the same result) 
//  ignore; this is probably due to a name not fitting   the search path format exactly, as in a fully-   qualified name being munged into a search path   that already contains cn= or vice-versa 
/*      * Check that a {@link ServletContextListener} cannot install a     * {@link ServletContainerInitializer}.     * @throws Exception      */
//  Removing servlet mappings 
//  Taken from Java 11 EA18 Javadoc 
//  (3) Delegate to parent unconditionally if not already attempted 
//  Assuming that global web.xml exists, host-specific web.xml does not exist. 
//        (https://svn.apache.org/r285186) 
//  this may result in two ErodingFactors being created for a key   since they are small and cheap this is okay. 
//  Year 
//  Get all the interfaces 
//  Buffer depleted ? 
//  Default ContentType processing is deferred until after the page has 
/*          * extract the session id path element (if it exists in the given url)          */
//  Accept again on a new thread since countUpOrAwaitConnection may block
//  Note: BufferedReader.readLine() strips new lines 
//  close() can be triggered by a wide range of scenarios. It is far   simpler just to always use a dispatch than it is to try and track   whether or not this method was called by the same thread that   triggered the write 
//  check required interceptors 
//  Document document = 
//  Check for a JAR URL repository 
//  ---------------------------------------------- Constants 
//  Add packed directory JAR files 
// there already was one 
//  Create the network buffers (these hold the encrypted data). 
//  Index of the current zeroGroup, -1 means not found. 
//  Use the test web application so JSP support is available and the 
//  Don't set daemon until init() has completed 
//  Smap should not include the body 
//  Not found 
// Display the window. 
//  the spec requires that this return a new Connection instance. 
//  then signal that the resource was not found 
// prevent rollover 
//  Almost certainly a pre Tomcat 7.0.17 compiled JSP using the old   version of the interface. Force a re-compile. 
//  $Foo is allowed by Netscape but not by RFC2109 
// increase the packet count 
//  Populate redeploy resources with the WAR file 
//  No streams currently active. Use the keep-alive   timeout for the connection. 
//  we need to scope the modified VariableMapper for consistency and performance 
// Add the scroll pane to this panel. 
//  we have to check for allow-from-all first. 
//  Rename uploaded WAR file 
// select a backup node 
/*      * Verify serving of custom compressed resources from context root.      */
//  Prevent the same filter being added multiple times 
//  Create a new DataSourceRealm instance 
//  ----------------------------------------------------------------- Properties 
//  Included file expanded here 
//         this.threadcount = 20;          this.transferPropertiesToC3P0();          this.datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis();          TestThread[] threads = new TestThread[threadcount]; 
// endif 
//  check the container level list for the extension 
/*      * Reverse header order of getLocaleMultipleHeaders01() and make sure the     * result is the same.      */
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#isLiteralText()      */
//  reason of that class 
//  not white space 
//  Note: Gump current tests 8.5.x with OpenSSL 1.0.2 
//  Identify the context we are associated with 
/*  Generated By:JJTree: Do not edit this line. AstSemicolon.java Version 4.3  */
//  Tomcat was restarted so cached SMAP has been lost. However, it   was written to the class file so it can be recovered. 
//  Need to cast to be able to set StandardContext specific attribute 
//  Deploy WARs 
//  register the ServerSocketChannel with the Selector 
//  Call the servlet the first time 
//  static member 
//  Read-only properties 
//  request body 
//  Create service object 
//  First 2 bytes are size of server name list (only expecting one)   Next byte is type (0 for hostname) 
//  Add unpacked directories 
//  Check for <![CDATA[ 
//  Create a new JNDIRealm instance 
//  store all <Cluster> elements 
//  always to a '*'. 
//  Check for exact match 
// bah, linear search 
//  Just apply the defaults. 
//  Only a name provided, no signature so map the first   method declared 
/*                  * BZ 42449                 * Catch NPE - Kludge Sun's LDAP provider with broken SSL.                  */
//  This is a comment - make sure we are at the end 
//  loop 
//  Parse transfer-encoding header 
//  we are in a unit test and don't need to paranoid. 
//  ------------------------------------------------------- Host Inner Class 
//  Find associated node 
//  Nothing to do. Endpoint requested a close and there is no   longer a processor associated with this socket. 
//  These do not appear in TLS registry 
//  Could be a directory or a file 
//  Get the parent class loader 
/*      * Minimal implementation to indent the printing of stack traces. This     * implementation depends on Throwable using WrappedPrintWriter.      */
//  - next (redo again) 
//  Add associated handlers, if any are defined using the .handlers property. 
//  Message Destination References 
//  If true, this JspAttribute represents a <jsp:attribute> 
//  Removed 
//  Must be a varargs method with a single parameter.   Use a new array every time since the called code could modify the   contents of the array 
//  Use size of 2 to keep the memory overhead small 
// we always add first, so that the most recently used object will be given out 
//  prepareCall 
//  Need to allow name only cookies to handle equals at the start of   the value 
//  Start 'sub-realms' then this one 
// Ensure non-instantiability 
//  ----------------------------------------------------------- SQL Variables 
//  Release all Filter and FilterConfig instances 
//  CR 
//  Throw required runtime exceptions 
// stateTransferred = true; 
/*      * apr_exit_why_e enum      */
/*      * APR_Error      */
//  Make sure another thread hasn't already done this 
//  transaction should have been cleared up by TransactionContextListener, but in   rare cases another lister could have registered which uses the connection before   our listener is called. In that rare case, trigger the transaction complete call now 
//  On UNIX and similar systems, '\\' is a valid file name so do not   convert it to '/' 
//  set of JARs from WEB-INF/lib that should be used for loading services 
//  default to UTF-8 if we don't have enough bytes to make a 
// the buffer isn't even 14 bytes 
//  Slightly convoluted as SwallowedExceptionListener   uses Exception rather than Throwable 
//  Is there a relevant user data constraint? 
//  Replaced an existing registration so need to notify those listeners 
//  Enable DTD validation 
/*      * Test https://bz.apache.org/bugzilla/show_bug.cgi?id=50026     * Verify protection of special paths with re-mount of web app resource root.      */
//  noop - this pool is already running and obviously jmx enabled 
//  If JULI is being used, disable JULI's shutdown hook since   shutdown hooks run in parallel and log messages may be lost   if JULI's hook completes before the CatalinaShutdownHook() 
//  UCS-4, little endian (4321) 
//  Close the connection 
//  Test that for a servlet that was added programmatically its   loadOnStartup property is honored and its init() and destroy()   methods are called. 
/*      * apr_sockopt Socket option definitions      */
//  send multipart request 
//  Convert bytes to UTF-8 
//  Can't tell what was happening when the error occurred but the   socket is registered for non-blocking read so use that 
//  Decode headers 
//  round bitlen 
/*  Fixed ECDH auth (kECDHe or kECDHr)  */
//  Has a valid user already been authenticated? 
//  Inform interested listeners 
//  No user or no credentials   Can't possibly authenticate, don't bother the database then 
//  Check for "/./" 
//  create StringBuilder to hold escaped xml string 
//  Handle optional trailer headers 
//  Now read the first response 
//  match - find the type and invoke it 
//  than the set limit of 10 bytes 
//  -------------------------------------------------------- Package Methods 
//  for now, just check some expected files exist 
// SessionMessage 
// report the slow query 
//  Note: Java 9 on my OSX laptop consistently shows doUri() is faster         than doHomebrew(). Worth a closer look for Tomcat 10 on the         assumption it will require java 9 
//  'Normal' servlet support 
//  small enough.   small enough.   small enough. 
//  If postParseRequest() failed, it has already logged it. 
// instantiate the replicated map 
//  First byte F4, second byte 80..8F 
//  Optimize when no namespace URI is specified 
//  Input filter setup 
//  Create sorted map of deployed applications by context name. 
//  Forward the request down the filter chain. 
//  Check for trailer headers 
//  Do this first in case new value is invalid 
// assume we can write  start the timeout timer 
//  will be returned. 
//  Larger than expected body size 
/*      * Constructor.     *     * @param qName The action's qualified name @param localName The action's     * local name @param text The text associated with this node @param start     * The location of the jsp page @param parent The enclosing node      */
//  Ask this Context to process this request. Requests that are   already in error must have been routed here to check for   application defined error pages so DO NOT forward them to the the 
//  based on profiler data. 
//  Configure decoder to replace on an error 
//  Try a setFoo ( int ) 
//  Skip the original 
// wait for the connection to finish 
//  classname is default servletName as annotation has no name! 
//  Can't use RequestUtils.normalize since that package is not   available to Jasper. 
//  create ELContext for JspContext 
//  Identify the class name of the Valve we should configure 
//  Base64 encoded? 
//  Coerce each element in turn. 
//  Nothing to do if we have never loaded the instance 
//  Some executable code after comment 
/*  Return OpenSSL version string (run time version)  */
//  ContextName should be non-null with a path that is empty or starts   with / 
//  maybe it wasn't included - the ugly default will be used. 
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#getValue(javax.el.ELContext)      */
/*  Collect info via JMX  */
//  The response is an error 
//  Timeout the async process if the associated web application   is no longer running. 
//  Build the transformation pipeline 
//  Try to parse compression as an int, which would give the   minimum compression size 
// we are not complete, lets write some more 
//  WHEN 
//  Pipeline may not be present in unit testing 
//  Check for {} wrapped var 
//  Apache Tomcat added test 
/*      * Implementation note: If Tomcat ever supports ALPN for a protocol where     *                      the identifier is not the UTF-8 encoding of the name     *                      then some refactoring is going to be required.     *     * Implementation note: Tomcat assumes that the UTF-8 encoding of this name     *                      will not exceed 255 bytes. Tomcat's behaviour if     *                      longer names are used is undefined.      */
//  continuation frames 
//  Add the dependents for this tag file to its parent's   Dependent list. The only reliable dependency information 
// ============================================================================================================ 
/*      * write incoming headers - %{xxx}i      */
// create a new facade 
//  call substring to get rid of leading '<' 
//  Cipher C09E 
//  Version format changed from Java 9 onwards.   Support old format that was used in EA implementation as well 
// options  timestamp  off=4  unique id length off=12  id data off=12+uniqueId.length  addr length off=12+uniqueId.length+4  member data off=12+uniqueId.length+4+add.length  message length off=12+uniqueId.length+4+add.length+4 
//  make sure the last connection is marked as closed 
//  Reading lock information 
/*              * generate a <param> for each <jsp:param> in the plugin body              */
//  valve cluster can access manager - other cluster handle replication   at host level - hopefully! 
//  Write a RST frame 
//  Validate the padding is zero since receiving non-zero padding   is a strong indication of either a faulty client or a server   side bug. 
/*      * DeclarationBody ::= (Char* - (char* '%>')) '%>'      */
//  Need to filter out any external entities 
//  A connection, once closed, should stay closed 
//  print document 
/*          * Notice that due to a bug in the underlying SAX parser, the         * attributes must be enumerated in descending order.          */
//  Remove children now this container is being destroyed 
//  Concurrent use of this random is unlikely to be a performance 
//  don't write old SDE 
/* Ignore */
//  wait that state is transferred 
//  AstFunction->MethodParameters->Parameters() 
//  Notify ActivationListeners 
//  Cipher C09D 
//  Hide default constructor for this utility class 
//  Engine name 
//  Compact what we have to create as much space as possible 
//  normal hash. 
//  Last-Modified header not found, use now 
//  No templates with an equal number of segments so there will be   no matches 
//  This was already processed before 
/*          * Can't set close before this code block since the connection needs to be open when validation runs. Can't set         * close after this code block since by then the connection will have been returned to the pool and may have         * been borrowed by another thread. Therefore, the close flag is set in passivate().          */
//  Search for an implementation   1. ServletContext attribute (set by application or cached by a      previous call to this method). 
//  has been taken. 
//  Find the local WAR file 
//  Container is responsible for first call to onDataAvailable(). 
//  set up GzipOutputFilter to attach to the TesterOutputBuffer 
// set headers 
//  Don't add sockets back to the poller if this was a   non-blocking write otherwise the poller may trigger   multiple read events which may lead to thread starvation   in the connector. The write() method will add this socket   to the poller if necessary. 
//  Add a constraint with uncovered methods 
//  Filter trace method 
//  Handle full decoders 
//  access session 
//  Swallow any request body 
//  skip to the name-only part. 
//                    Thread.sleep(100); 
/*          * Indicates whether an encoding has been explicitly specified in the         * page's XML prolog (only used for pages in XML syntax). This         * information is used to decide whether a translation error must be         * reported for encoding conflicts.          */
//  a.addAfterOrdering("c"); 
//  being used. 
//  Update the member alive time 
//  Setters for Tag handler data 
//  Context name 
//  Validate and write response headers 
//  ----------------------------------------------------- Session Properties 
//  Configure registry socket factories 
//  If we don't get an exception at this point, then all mocked objects   worked as expected. 
/*      * Hostname (no port) is included in the request line, but Host header     * is empty.     * Added for bug 62739.      */
/*      * Tests for failure, when a different domain is used, that's not in the     * allowed list of origins.     *     * @throws ServletException     * @throws IOException      */
/*          * Class body begins here          */
//  Wait for upto 1000ms acceptor threads to unlock 
//  Make the fields in the Thread class that store ThreadLocals 
//  number of nodes on stack   current mark 
//  Configure the compiler object 
//  with the last modified time of the WAR 
//  Cipher C09F 
//  Apply initial level for new logger 
//  Prepare to scan the Principals for this Subject 
//  Ignore - use default 
//  Access Information 
//  Should trigger an error - must do one or other 
//  Make casual multipart request to "regular" servlet w/config   We expect that the server /will/ parse the parts, even though   there is no @MultipartConfig 
//  Add domain information, if present 
// create a map demo object 
//  Scan the classpath 
//  Now remove the abandoned objects 
/*          * Constructor.          */
/*  Generated By:JJTree: Do not edit this line. AstPlus.java  */
//  Get the name and e-mail. 
//  Enable all and then disable what we not want 
// the queue is empty we will wait for an object 
//  Entries with injection targets but no value are effectively ignored 
//  register names/values as per spec 
//  Cipher C09A 
//  Invalid range 
//  Wrap in IAE since we can't easily change the method signature to   to throw the specific checked exceptions 
// assume it does exist 
//  Can't use Class<?> because API needs to match specification in superclass 
//  Id - small ints to use array access. No reset on stop() 
//  attrName = contentType 
//  Special case 
/*  Formatted timestamp generated in most recent invocation  */
//  Nothing works - use platform default 
//  This might be the name of an imported static field 
//  Duplicate to another list, so that the syncing is   minimal 
//  First semi-colon marks the start of the extension. Further   semi-colons may appear to separate multiple chunk-extensions.   These need to be processed as part of parsing the extensions. 
//  Check that only supported tracking modes have been requested 
//  Not processed for web application JARs nor if the caller did not   provide a Deque of URLs to append to. 
//  continue to loop on remoteIpHeaderValue to build the new value of the remoteIpHeader 
//  Stop accepting requests temporarily. 
//  Check to see of the WAR has been expanded previously 
//  no need to release the semaphore, it will be GCed 
//  Ignore if not found 
//  will be registered under multiple names 
//  Header names are forced to lower case 
//  emulate tomcat server - offset points to method in header 
//  - forbidden 
// for serialization 
//  Overridden purely so it is visible to other classes in this package 
//  Too early 
//  '\' is only an escape for '${' and '#{'. 
//  Tag files should also set jspContext attributes 
//  No escaping present. Return original. 
//  Set up a container 
//  Special case, start over to avoid code duplication 
//  Endpoint might have been paused while waiting for latch 
//  If there is no web.xml, normal JAR no impact on   distributable 
//  Checks for encoded characters. Helps prevent CRLF injection. 
//  first assume docBase is absolute 
//  See Bugzilla 27704 
//  the configured address. 
// b.addAfterOrdering("c"); 
/*      * deferredSyntaxAllowedAsLiteral      */
//  Move the new file into place 
//  ensure the NamingResources follows the correct lifecycle 
//  faulty.  Scan forward to match the java line... 
//  Send j2ee.state.stopping notification 
//  Virtual directory 
//  if SSL_do_handshake returns > 0 it means the handshake was finished. This means we can update   handshakeFinished directly and so eliminate unnecessary calls to SSL.isInInit(...) 
//  Check for the application being marked unavailable 
/*      * when a valid CORS Pre-flight request arrives, with no     * Access-Control-Request-Method      */
/*  Return client certificate chain.     * Add certificate chain number to that flag (0 ... verify depth)      */
//  Users 
//  JSP.4.5 If the buffer was flushed, throw IllegalStateException 
//  SO_LINGER sends a TCP RST when timeout expires 
//  Some tests depend on this write failing (e.g.   because the client has gone away). In some cases   there may be a large (ish) buffer to fill before   the write fails. 
//  headers 
//  Cipher C09C 
//  The number of bytes written 
//  We can use a hash - but it's not clear how much   benefit you can get - there is an  overhead   and the number of headers is small (4-5 ?)   Another problem is that we'll pay the overhead   of constructing the hashtable 
//  If the type is undefined there will only be one certificate (enforced   in SSLHostConfig) so use the RSA slot. 
//  Return an input stream to the underlying bytes 
//  Create a Tag plugin instance 
//  Ignore - expected for some error conditions 
//  Retrieve the channel provided by the OS 
//  Used to block in the @OnMessage 
/*      * When requestMethod is null     *     * @throws ServletException      */
// clen - 4 bytes 
//    The following methods can't be used while enlisted in a transaction   
/*     // Cipher FF00    TLS_GOSTR341094_RSA_WITH_28147_CNT_MD5(            "GOST-MD5",            KeyExchange.RSA,            Authentication.RSA,            Encryption.eGOST2814789CNT,            MessageDigest.MD5,            Protocol.TLSv1,            false,            EncryptionLevel.HIGH,            false,            256,            256     ),     TLS_RSA_WITH_28147_CNT_GOST94(            "GOST-GOST94",            KeyExchange.RSA,            Authentication.RSA,            Encryption.eGOST2814789CNT,            MessageDigest.GOST94,            Protocol.TLSv1,            false, EncryptionLevel.HIGH,false,            256,            256     ),     {     1,     "GOST-GOST89MAC",     0x0300ff02,     KeyExchange.RSA,     Authentication.RSA,     Encryption.eGOST2814789CNT,     MessageDigest.GOST89MAC,     Protocol.TLSv1,     false, EncryptionLevel.HIGH,false,     256,     256     ),     {     1,     "GOST-GOST89STREAM",     0x0300ff03,     KeyExchange.RSA,     Authentication.RSA,     Encryption.eGOST2814789CNT,     MessageDigest.GOST89MAC,     Protocol.TLSv1,     false, EncryptionLevel.HIGH,false,     256,     256     }, */
//                 con2.setCatalog("mysql");//make sure connection is valid 
//  Note: This should be consistent with the way httpd behaves.         We might want to consider providing a dedicated decoder         with an option to add additional safe characters to         provide users with more flexibility 
/*      * Creates the tag library associated with the given uri namespace, and     * returns it.     *     * @param prefix The prefix of the xmlns attribute     * @param uri The uri namespace (value of the xmlns attribute)     *     * @return The tag library associated with the given uri namespace      */
/*  The URI is chars or String, and has been sent using an in-memory             * protocol handler. The following assumptions are made:             * - req.requestURI() has been set to the 'original' non-decoded,             *   non-normalized URI             * - req.decodedURI() has been set to the decoded, normalized form             *   of req.requestURI()              */
//  What if the LoginModule is in the container class loader ? 
//  Ack the end of stream 3 
//  append remaining attributes 
//  Final reply 
//  Servlet 2.4 
/*      * Ideally, fragment names will be unique. If they are not, Tomcat needs     * to know as the action that the specification requires (see 8.2.2 1.e and     * 2.c) varies depending on the ordering method used.      */
//  Simple state machine (sequence of states) 
//  Default connection window size is 64k - 1. Initial request will have   used 8k (56k -1). 
//  class loaders 
//  Cipher C09B 
/*  JSP idle timeout in milliseconds  */
// just refresh the table model 
//  Normal AVPair 
/*      * NOTE: There is no maintenance of state or checking for valid transitions     * within this class other than ensuring that bind/unbind are called in the     * right place. It is expected that the calling code will maintain state and     * prevent invalid state transitions.      */
/* org.apache.coyote.Constants.STAGE_ENDINPUT */
//  first test that without the setting on StandardContext the annotated 
//  Make sure these object which are only used during the   generation and compilation of the JSP page get   dereferenced so that they can be GC'd and reduce the   memory footprint. 
//  In keep-alive but between requests. OK to recycle   processor. Continue to poll for the next request. 
//  For tags in JARs, add the TLD and the tag as a dependency 
//  Check that this file is located under the WebResourceSet's base 
//  minimum session timeout 
//  Get the associated ServerSocket to bind it with 
/*  NO-OP  */
//  optional 
//  Class must be public, non-abstract, not an interface and (for 
//  Last-Modified header 
/*      * @deprecated Use {@link #subtract(byte[],int,int)}.     *             This method will be removed in Tomcat 10      */
//  Remove real host and all its aliases 
//  Use local copies for thread safety 
/*  welcome file processing - take 2         * Now that we have looked for welcome files with a physical         * backing, now look for an extension mapping listed         * but may not have a physical backing to it. This is for         * the case of index.jsf, index.do, etc.         * A watered down version of rule 4          */
//  pull out the character set information (this is the MIME name at this point). 
//  First, the ideal case - a setFoo( String ) method 
//  Operations 
//  unknown version (Versioning is not very strict) 
//  WAR files into the appBase and we want this to work correctly. 
//  Restore EL context 
//  Set up the actual test 
/*  Name are:             * ajp-nio-8009             * ajp-nio-127.0.0.1-8009             * ajp-nio-0:0:0:0:0:0:0:1-8009             * ajp-nio-10.36.116.209-8009              */
//  Ignore the attempt to interrupt the thread. 
//  Currently fragmented 
//  require it 
//  Place the CredentialHandler into the ServletContext so   applications can have access to it. Wrap it in a "safe"   handler so application's can't modify it. 
//  Add the entry in the local resource repository 
//  Buffer still has data from previous attempt to write   APR + SSL requires that exactly the same parameters are   passed when re-attempting the write 
//  ---------------------------------------------------- InputBuffer Methods 
//  Single byte reads for non-blocking need special handling so all   single byte reads run through this method. 
/*  Generated By:JJTree: Do not edit this line. AstSetData.java Version 4.3  */
//  one level on the nesting count 
//  Is there an SSO session against which we can try to reauthenticate? 
//  Check to see if the $ is escaped 
// =========================================================    PROPERTIES / CONFIGURATION  ========================================================= 
//  coerce to the expected type 
//  It exists but it isn't an env or a res link... 
//  Host names are case insensitive 
//  We are returning one backslash so we should only backup (count-1) 
//  -------------------- other utils -------------------- 
//  Associate the session with any existing SSO session. Even if   useSSO is false, this will ensure coordinated session   invalidation at log out. 
//  contain no scripting elements. 
//  number of duplicated session ids - anything >0 means we have problems 
//  Handle known failed members 
//  Multiple tests to improve readability 
//  Create the initial HTTP request to open the WebSocket connection 
//  Note: While the return value is ignored if the latch does time         out, logic further up the call stack will trigger a         SocketTimeoutException 
/*      * RFC 2045 says the Base64 encoded string should be represented     * as lines of no more than 76 characters. However, RFC 2617     * says a base64-user-pass token is not limited to 76 char/line.     * It also says all line breaks, including mandatory ones,     * should be ignored during decoding.     * This test case has a line break in the Base64 string.     * (See also testGoodCribBase64Big below).      */
//  Indirect call 
//  Write buffer full. Input fully read. Deflater may be   in one of four states:   - output complete (just happened to align with end of     buffer   - in middle of EOM bytes   - about to write EOM bytes   - more data to write 
//  Remove the specified parameter 
/*  look at error stack/return value/errno  */
//  The web application is shutting down. Complete any AsyncContexts   associated with an active client. 
//  Close the client session. 
//  Localize 
//  If this is an aborted request from a client just log it and return 
//  Can't load class - therefore ignore this target 
// 1 second default 
//  Write status code 
//  If there is still data inside the main write buffer, it needs to be written first 
/*          * Due to depends chain, Ant could call the Task more than once, this is         * to prevent that we attempt to reuse the previously closed Streams.          */
//  Assume we constructed this correctly 
//  INVALID COOKIE, advance to next delimiter   The starting character of the cookie value was 
//   ----------------------------------------------------- Inner Class 
//  use the semaphore to synchronize with the background thread   which might try to interrupt this current thread.   Otherwise, the current thread might be interrupted after   going out from here, maybe already serving a new request 
//  Create the SSL Context 
//  If training, everything is synced 
//  Remove the link 
//  Fast for correct values, slower for some incorrect ones 
//  Each injection target needs to be consistent with the defined   type 
//  Ignore className on all elements 
// add the member as suspect 
//  Constructor will fail if context or its parent is null 
//  "null" is a valid origin 
//  Use default as a last resort 
//  Display virtual machine statistics 
//  Make sure request is OK 
//  Destroy pool if it was initialised 
//  Unknown event 
//  Removing filter maps 
//  Only save the request body if there is something to save 
//  Ensure TLSv1.3 ciphers aren't returned 
//  Allowed roles should be the union of the roles in the constraints   User role is not in any constraint 
//  should be permitted to access an unprotected resource. 
//         }          this.run = false;          long delta = System.currentTimeMillis() - start;          printThreadResults(threads,"testC3P0Threads20Connections10",c3p0Datasource.getNumConnectionsAllUsers(),10);      } 
//  Can this message be decoded? 
//  ----------------------------------- OutputStreamOutputBuffer Inner Class 
//  Destroy and update pool counters   Remove any idle instances with this key 
// did we reach EOF? if so send EOF up one layer. 
/*          * Gets the encoding specified in the JSP config element whose URL         * pattern matches the page containing this Root.          */
// strong>NOTE</strong> - This header will be overridden   automatically if a <code>RequestDispatcher.forward()</code> call is   ultimately invoked. 
//  Listener instances may have been added directly to this Context by   ServletContextInitializers and other code via the pluggability APIs.   Put them these listeners after the ones defined in web.xml and/or   annotations then overwrite the list of instances with the new, full 
//  NOOP - just read the data 
//  IPv4 in IPv6 or Zone ID detected, end of checking. 
//  Fall-back 
//  Ordinary tag attributes can't be repeated, even with identical values 
//  Wait period has expired. Reset. 
//  Cipher C098 
//  Just echo the header value back as plain text 
//  Add additional bytes depending on length 
//  upgrade 
/*  Override the defaults  */
// ObjectName oname = loader.getObjectName(); 
//  remote address/host 
//  Required by testBug61185()   Does not impact other tests in this class 
//  Displaying the lock-null resources present in that   collection 
//  Build the interset of omitted methods for this   pattern 
//  NO-OP. Just provides a hook to enable the class to be loaded 
// allow classes to override 
//  Package private so it can be tested. charsetName must be in lower case. 
//  Can't load the class so no point   continuing 
//  If specified, available specification version must be >= required 
//  Rule 4 -- Welcome resources processing for servlets 
//  Note: With a read timeout of 3s the ASF CI buildbot was consistently         seeing failures with this test. The failures were due to the         JSP initialisation taking longer than the read timeout. The         root cause of this is the frequent poor IO performance of the         VM running the buildbot instance. Increasing this to 10s should         avoid these failures. 
//  Client sent invalid data.   Ignore, TODO: maybe close connection 
//  And one to check that non-matches return false 
//  Minimal implementation for tests that avoids using OutputBuffer 
//  expected to handle splitting into individual values 
//  build a list of jar files in the classpath 
//  harvest cookies whenever the server sends some new ones 
// execute the query 
//  Create a separate constraint that covers DELETE 
//  NOOP 
//  restore nested JspContext on ELContext 
//  Generating lock id 
//  Cipher C097 
//  Ensure that the FIPS mode is consistent with that used for SSL init 
// message data 
// this is our internal one, so we need to shut it down 
//  Additional Windows specific checks to handle known problems with 
/*      * This class duplicates code in javax.el.Util. When making changes keep     * the code in sync.      */
//  Read the chunk 
//  If the page was sent successfully, don't write the standard   error page. 
//  -------------------------------------------------- CORS Request Headers 
//  to help users who accidentally add '/' to the end of their patterns 
//  Expect 3 messages: headers, error report body, end for an invalid request 
// if there is no message here, we are done 
// if the url is relative, encode it 
//  is a LWS, then it's a multiline header 
//  Refill buffer with new data. 
//  Loop until one char is decoded or there is a decoder error 
//  Object with property not at end of expression 
//  All checks have passed. Compression is enabled. 
/*      * A CORS request arrives with a "null" origin which is explicitly allowed     * by configuration.      */
//  img stuff not req'd for source code html showing   all links relative! 
// I am the new leader  startElection(false); 
//  access, name, descriptor 
/*      * Checks to see if this translation unit contains the given prefix.     *     * @param prefix The prefix to check     *     * @return true if this translation unit contains the given prefix, false     * otherwise      */
//  ------------------------------------------------------ Lifecycle Methods 
// we added a new element, see if we need to remove the oldest 
//  Call the valueBound() method if necessary 
/*  ------- Helper mock classes -----  */
//  Must have been truncated 
//  Do not call the security manager since by default, we grant that package. 
//  Can't create a collection if a resource already exists at the given   path 
//  create our mark 
//  Stack of the objects one level below 
//  Currently, the only types of messages the client will send   are draw messages prefixed by a Message ID   (starting with char '1'), and pong messages (starting   with char '0').   Draw messages should look like this:   ID|type,colR,colB,colG,colA,thickness,x1,y1,x2,y2,lastInChain 
/*      * Used if block/non-blocking is set at the socket level. The client is     * responsible for the thread-safe use of this field via the locks provided.      */
/*          * Thread A is the container thread the processes the original request.         * Thread B is the async thread (may or may not be a container thread)         *   that is started by the async processing.          */
// define name of the temp variables 
/*  Generated By:JJTree: Do not edit this line. AstFloatingPoint.java  */
//  Perform the required renames to permanently save this file 
//  Preserve a negative value since it is an error 
//  just read the content-type header, so set it 
//  ----------------------------------------------------- Request attributes 
//  WebDAV Litmus test attempts to copy/move a file over a collection   Need to remove trailing / from destination to enable test to pass 
//  Expires attribute will depend on time cookie is generated so   use a modified test 
// Array containing the safe characters set. 
//  Cipher C099 
//  Explicitly set the provider name 
//  A unique temporary variable name suitable for code generation 
//  Find an existing matching war and expanded folder 
//  ------------------------------------------------------ Public Methods 
/*  Generated By:JJTree: Do not edit this line. AstEmpty.java  */
//  Stop ContainerBackgroundProcessor thread 
//  The code below is designed to run on Java 9 so skip this check   if running on Java 8. The test has previously been run with Java   9 (and later) so it is not necessary that this is executed on   every test run. The intention is that it will catch new classes   when the tests are run on a newer JRE.   The latest versions of the JRE where this test is known to pass are   - OpenJDK 11.0.1   - OpenJDK 12 EA 26   - OpenJDK 13 EA 02 
//  no sweat, ignore those keys 
//  Check to see if a proxy is configured. Javadoc indicates return value 
// if the first bit is set it is an indexed header field  unget the byte  prefix is 7 
//  No need to test the charsets that are pre-loaded 
//  Check for old versions of applications that can now be undeployed 
//  Complete the message - no extra headers required. 
//  -------------------- Internal implementation -------------------- 
//  We have a reference to the failure detector   Piggy back on it 
/*  Should never happen  */
//  do SSI processing 
//  Host with port 
//  Adding the results of a call to the superclass 
//  Append data in request input stream to contentFile 
//  Make the parser read something. 
//  Loop waiting for a connection and a valid command 
//  Log here, because thrown error might be not logged 
//  When in an array, class name changes for primitive 
//  Finally, replace the original mechType list with the re-ordered 
//  Close the session if it is expected to be open 
//  Create this so can use the super-class method   Also ensures that the same roundings are performed by the ctor and the code 
//  fatal. 
//  ----------------------------------------------------- Class Variables 
//  No link so should be null 
//  Cipher C094 
//  This allocation has been used. Leave the   stream on the backlog as it still has   more bytes to write. 
//  Should list POST as an method 
// timeout 
//  Use a bulk copy 
//  is only important if this is not the last cookie pair 
// this is common, since the sockets on the other  end expire after a certain time. 
//  ASync 
// ------------------------------------------------------------------------------ 
//  If the db connection open fails, return "not authenticated" 
// byte[] input = createParams(8); 
//  specified 
//  Used when there are no annotations in a class 
//  Append the name of the log instance if so configured 
//  client's) 
//  fill up the pool with worker threads 
//  No close frame was received 
//  JAR not in the web application so add it directly 
//  Initialize and set java extensions 
//  Some policy files may restrict this, even for the core,   so this exception is ignored 
//  Remove '&' from the safe character set since while it it permitted   in a URI path, it is not permitted in XML and encoding it is a simple   way to address this. 
//  default encoding 
//  Trigger an auto-deployment cycle 
//  wait that state is transferred with timeout check 
/*          * Escapes any occurrences of "]]>" (by replacing them with "]]&gt;")         * within the given text, so it can be included in a CDATA section.          */
//  First remove the session that we know has expired / been logged   out since it has already been removed from its Manager and, if   we don't remove it first, deregister() will log a warning that it 
/*     * Build this list of available extensions so that we do not have to    * re-build this list every time we iterate through the list of required    * extensions. All available extensions in all of the    * <code>ManifestResource</code> objects will be added to a    * <code>HashMap</code> which is returned on the first dependency list    * processing pass.    *    * The key is the name + implementation version.    *    * NOTE: A list is built only if there is a dependency that needs    * to be checked (performance optimization).    *    * @param resources A list of <code>ManifestResource</code> objects    *    * @return HashMap Map of available extensions     */
// we got a result - clear the interrupt status  don't propagate cause we have removed a connection from pool 
//  the number of pooled objects < maxTotalPerKey(); 
/*          * Appends the given text as a CDATA section to the XML view, unless         * the text has already been marked as CDATA.          */
//  JSP.2.3.5 
//  Enumeration 
//  Expose the Map containing dynamic attributes as a page-scoped var 
//  Obtain the canonical type name 
//  The first buffer should be 9 bytes long 
/*  Configure a 10s timeout for reading from client  */
/*  *  CGI-invoking servlet for web applications, used to execute scripts which *  comply to the Common Gateway Interface (CGI) specification and are named *  in the path-info used to invoke this servlet. * * <p> * <i>Note: This code compiles and even works for simple CGI cases. *          Exhaustive testing has not been done.  Please consider it beta *          quality.  Feedback is appreciated to the author (see below).</i> * </p> * <p> * * <b>Example</b>:<br> * If an instance of this servlet was mapped (using *       <code>&lt;web-app&gt;/WEB-INF/web.xml</code>) to: * </p> * <p> * <code> * &lt;web-app&gt;/cgi-bin/* * </code> * </p> * <p> * then the following request: * </p> * <p> * <code> * http://localhost:8080/&lt;web-app&gt;/cgi-bin/dir1/script/pathinfo1 * </code> * </p> * <p> * would result in the execution of the script * </p> * <p> * <code> * &lt;web-app-root&gt;/WEB-INF/cgi/dir1/script * </code> * </p> * <p> * with the script's <code>PATH_INFO</code> set to <code>/pathinfo1</code>. * </p> * <p> * Recommendation:  House all your CGI scripts under * <code>&lt;webapp&gt;/WEB-INF/cgi</code>.  This will ensure that you do not * accidentally expose your cgi scripts' code to the outside world and that * your cgis will be cleanly ensconced underneath the WEB-INF (i.e., * non-content) area. * </p> * <p> * The default CGI location is mentioned above.  You have the flexibility to * put CGIs wherever you want, however: * </p> * <p> *   The CGI search path will start at *   webAppRootDir + File.separator + cgiPathPrefix *   (or webAppRootDir alone if cgiPathPrefix is *   null). * </p> * <p> *   cgiPathPrefix is defined by setting *   this servlet's cgiPathPrefix init parameter * </p> * * <p> * * <B>CGI Specification</B>:<br> derived from * <a href="http://cgi-spec.golux.com">http://cgi-spec.golux.com</a>. * A work-in-progress &amp; expired Internet Draft.  Note no actual RFC describing * the CGI specification exists.  Where the behavior of this servlet differs * from the specification cited above, it is either documented here, a bug, * or an instance where the specification cited differs from Best * Community Practice (BCP). * Such instances should be well-documented here.  Please email the * <a href="https://tomcat.apache.org/lists.html">Tomcat group</a> * with amendments. * * </p> * <p> * * <b>Canonical metavariables</b>:<br> * The CGI specification defines the following canonical metavariables: * <br> * [excerpt from CGI specification] * <PRE> *  AUTH_TYPE *  CONTENT_LENGTH *  CONTENT_TYPE *  GATEWAY_INTERFACE *  PATH_INFO *  PATH_TRANSLATED *  QUERY_STRING *  REMOTE_ADDR *  REMOTE_HOST *  REMOTE_IDENT *  REMOTE_USER *  REQUEST_METHOD *  SCRIPT_NAME *  SERVER_NAME *  SERVER_PORT *  SERVER_PROTOCOL *  SERVER_SOFTWARE * </PRE> * <p> * Metavariables with names beginning with the protocol name (<EM>e.g.</EM>, * "HTTP_ACCEPT") are also canonical in their description of request header * fields.  The number and meaning of these fields may change independently * of this specification.  (See also section 6.1.5 [of the CGI specification].) * </p> * [end excerpt] * * <h2> Implementation notes</h2> * <p> * * <b>standard input handling</b>: If your script accepts standard input, * then the client must start sending input within a certain timeout period, * otherwise the servlet will assume no input is coming and carry on running * the script.  The script's the standard input will be closed and handling of * any further input from the client is undefined.  Most likely it will be * ignored.  If this behavior becomes undesirable, then this servlet needs * to be enhanced to handle threading of the spawned process' stdin, stdout, * and stderr (which should not be too hard). * <br> * If you find your cgi scripts are timing out receiving input, you can set * the init parameter <code>stderrTimeout</code> of your webapps' cgi-handling * servlet. * </p> * <p> * * <b>Metavariable Values</b>: According to the CGI specification, * implementations may choose to represent both null or missing values in an * implementation-specific manner, but must define that manner.  This * implementation chooses to always define all required metavariables, but * set the value to "" for all metavariables whose value is either null or * undefined.  PATH_TRANSLATED is the sole exception to this rule, as per the * CGI Specification. * * </p> * <p> * * <b>NPH --  Non-parsed-header implementation</b>:  This implementation does * not support the CGI NPH concept, whereby server ensures that the data * supplied to the script are precisely as supplied by the client and * unaltered by the server. * </p> * <p> * The function of a servlet container (including Tomcat) is specifically * designed to parse and possible alter CGI-specific variables, and as * such makes NPH functionality difficult to support. * </p> * <p> * The CGI specification states that compliant servers MAY support NPH output. * It does not state servers MUST support NPH output to be unconditionally * compliant.  Thus, this implementation maintains unconditional compliance * with the specification though NPH support is not present. * </p> * <p> * * The CGI specification is located at * <a href="http://cgi-spec.golux.com">http://cgi-spec.golux.com</a>. * * </p> * <h3>TODO:</h3> * <ul> * <li> Support for setting headers (for example, Location headers don't work) * <li> Support for collapsing multiple header lines (per RFC 2616) * <li> Ensure handling of POST method does not interfere with 2.3 Filters * <li> Refactor some debug code out of core * <li> Ensure header handling preserves encoding * <li> Possibly rewrite CGIRunner.run()? * <li> Possibly refactor CGIRunner and CGIEnvironment as non-inner classes? * <li> Document handling of cgi stdin when there is no stdin * <li> Revisit IOException handling in CGIRunner.run() * <li> Better documentation * <li> Confirm use of ServletInputStream.available() in CGIRunner.run() is *      not needed * <li> [add more to this TODO list] * </ul> * * @author Martin T Dengler [root@martindengler.com] * @author Amy Roh  */
//  can only be obtained from the tag instance. 
/*  Process Resource annotation.         * Ref JSR 250          */
//  Bugzilla 34724 
//  Lazy init to support serialization 
/*          * The following directives are ignored in text concatenation          */
//  Look for a single-char work delimiter: 
//  URI 
//  Failure to configure a security related component should always be   fatal. 
//  CCM ciphersuites from RFC7251 
//  Utility class. Hide the default constructor. 
//  Correct evaluation requires knowledge of the whole set of nested 
//  Must be ( '>' # Body ETag ) 
//  a single connection 
/*                      * Path ending in '/' was mapped to JSP servlet based on                     * wildcard match (e.g., as specified in url-pattern of a                     * jsp-property-group.                     * Force the context's welcome files, which are interpreted                     * as JSP files (since they match the url-pattern), to be                     * considered. See Bugzilla 27664.                      */
//  Whatever happens, return the buffer to its original state 
//  Path is not valid so can't be matched to a WebSocketEndpoint 
/*      * Set the logon password of this user, optionally prefixed with the     * identifier of an encoding scheme surrounded by curly braces, such as     * <code>{md5}xxxxx</code>.     *     * @param password The new logon password      */
//  Cipher C096 
//  Finally the go away frame 
//  We've read part of the request, don't recycle it   instead associate it with the socket 
//  look ahead to next URLencoded metacharacter, if any 
//  Set the handlers informations 
//  Server Row Section 
//  Step 10. Look for static resources packaged in JARs 
//  Validate the existence of our configuration file 
//  We need an active cookie for Path/Port/etc. 
//  Write the parameters back 
//  Need to write via output buffer 
//  resource-env-ref names must be unique within a web(-fragment).xml 
//  unnecessary processing. 
//  Accept ranges header 
//  calculate post data length 
/*  Standard socket defines  */
//  HttpOnly 
//  JSP.2.3.2 
//  Set up authorization with our credentials 
//  No further tests required. The bug triggers an infinite loop on   context start so the test will crash before it reaches this point if   it fails 
//  Add socket.[original name] if this is not a property   that could be set elsewhere 
//  Can't use the executor so call the runnable directly.   This may not be strictly specification compliant in all   cases but during shutdown only close messages are going   to be sent so there should not be the issue of nested   calls leading to stack overflow as described in bug   55715. The issues with nested calls was the reason for   the separate thread requirement in the specification. 
// ai.setSetMethodObj(sm); 
//  ------------------------------------------------- ContentHandler Methods 
//  Cipher C095 
//  Location was originally always a file before URI support was added so   try file first. 
//  Deploy the web application (if any) for each defined user 
//  Now get the final response 
//  null is never a valid state 
/*  (non-Javadoc)     * @see java.lang.Object#hashCode()      */
//  The next three are implied by the Javadoc getPath() 
//  Output whatever is in buffer 
//  Expected to fail because the trailers are longer 
//  JSP.2.3.3 
/*              * (3) Handle limitation of number of loaded Jsps              */
//  Check no errors 
//  Construct the parameter values array we will need   We only do the conversion if the param value is a String and 
// if not, simply issue the memberDisappeared message 
// Descriptor descriptor = info.getDescriptor();  addFields(descriptor); 
//  Stop our filters 
//  unexpected, abort the fix process. 
//  Sends incomplete request (no end chunk) so read times out 
//  -------------------------------------------------------------- Future 
/*  Whether we need to postprocess by adding milliseconds  */
//  Defaults (defined by the specification) 
//  "+ 4": BZ 57509. Reserve space for CR/LF/COLON/SP characters that   are put directly into the buffer following this write operation. 
//  Find the corresponding String 
//  All field names are valid tokens 
//  Check for read timeout 
//  Interface not found on this class. Look at the superclass. 
//  CLOSED_ABNORMALLY should not be put on the wire 
//  The request has been processed but the request body has not been   fully read. This typically occurs when Tomcat rejects an upload   of some form (e.g. PUT or POST). Need to tell the client not to   send any more data but only if a reset has not already been 
//  Negotiation phase 2. Create the Transformations that will be applied   to this connection. Note than an extension may be dropped at this   point if the client has requested a configuration that the server is 
//  ETag header 
//  Matches *, *.ext, /p/*, or /p/*.ext 
//  Trigger loading of class and reading of property 
// class SenderThread 
//  Remove the entry from the cache so the new directory is visible 
//  Cut off to avoid DoS attack 
//  Close all APR memory pools and resources if initialised 
//  Use the default 
//  Use handler 
//  Prepare our output writer to generate the response message 
//  print StratumSection 
// find the right property 
//  Split in on comma (might not be one) 
/*              * Creates the name of the tag handler pool whose tag handlers may             * be (re)used to service this action.             *             * @return The name of the tag handler pool              */
//  Find and remove the alias 
//  Used to reset the times 
//  it's a string or int/date string value 
//  Load the web resources 
//  There are no makeObject() calls in progress for this   key so the key is at capacity. Do not attempt to   create a new object. Return and wait for an object to   be returned. 
//  Block content sniffing 
//  Stop this valve if necessary 
//  Prevent deletion of special subdirectories 
//  just skipping blank lines) 
//  No need for this to use SecureRandom 
/*      * session      */
//  Make sure adding a duplicate *does not* overwrite 
//  Handle an HTTP path-based forward 
//  to a method. 
//  Create Node.Nodes from dummy root 
//  May be null of the class is not present or could not be loaded. 
//  Need to convert requested name to multi-release name (if one exists) 
//  Ignore the exception. It will be logged when trying to start the   end point. 
//  Parse the path parameters. This will:     - strip out the path parameters 
//  Do not add aliases, as removeHost(hostName) won't be able to   remove them 
//  Handshake is complete if this point is reached 
//  Create a new MemoryRealm instance 
//  Client data must be masked 
//  Store session ID list 
//  Ignore disallowed headers 
// the flags to indicate whether the attributes have been specified 
//  Copy one character at a time 
//  Add TLD within the JAR to the dependency list 
//  Finish off the rest of the opps 
//  Close all sockets in the close queue 
//  Until the Servlet API allows specifying the type of redirect to   use. 
//  Add our Principal to the Subject if needed 
//  When this test runs, the class loader will be loading resources   from a directory for each of these packages. 
// derby  url = System.getProperty("url","jdbc:derby:derbyDB;create=true");  driverClassName = System.getProperty("driverClassName","org.apache.derby.jdbc.EmbeddedDriver"); 
// that we can expect before the start method returns 
//  --------------------------------------------------- FilterConfig Methods 
//  Left with just proxy sessions - add them 
//  Valid partial PUT 
//  Our decoder accepts a long token without complaint. 
//  Utf8 tag 
//  +6 allows for 3 escaped characters by default 
//  Marked as transient so special handling can be applied to serialization 
//  If there is no context at this point, either this is a 404   because no ROOT context has been deployed or the URI was invalid 
//  Construct and return a new ModelMBeanInfo object 
//  Multiple servlets may not be mapped to the same url-pattern but main   web.xml takes priority 
/*      * RFC 2045 says the Base64 encoded string should be represented     * as lines of no more than 76 characters. However, RFC 2617     * says a base64-user-pass token is not limited to 76 char/line.      */
//  Any authenticated user should be able to perform a TRACE. 
/*  Start string for all versions  */
//  well. 
//  This now tests RealmBase#hasResourcePermission() because we need a wrapper 
//  Inputs 
//  Java 8 implementation of Java 9 methods 
/*  The object is being bound or unbound  */
//  Not much to do here, much of the work will be done in the   containing tags, <c:when> and <c:otherwise>. 
//             for physical folder 
/*      * Checks if the XML element with the given tag name is a custom action,     * and returns the corresponding Node object.      */
//  If <is-xml> is specified in a <jsp-property-group>, it is used. 
//  Add to the corresponding pipeline to get a notification once configure is done 
/*      * Force non-default behaviour for both Authenticators.     * The session id will not be regenerated after authentication,     * which is less secure but needed for browsers that will not     * handle cookies.      */
/*  Call this to reinitialize the node stack.  It is called     automatically by the parser's ReInit() method.  */
/*  Returns the number of children on the stack in the current node     scope.  */
//  if the same instance of this transformer was already added, bail out 
//  Request may complete before listener has finished processing so wait 
//  app dir is relative to server home 
//                 Assert.assertFalse("2nd Connection is not valid:"+x.getMessage(),true);              }              Assert.assertTrue("Connection 1 should be closed.",con1.isClosed()); //first connection should be closed 
// There's no way to specify this with SimpleDateFormat  translate.put("u","day of week ( 1-7 )"); 
//  No matches. Just return the first certificate. The handshake will   then fail due to no matching ciphers. 
//  Everything else triggers a redeploy   (just need to undeploy here, deploy will follow) 
//  The url patterns are reconstructed as the following:   path != null, extension == null:  / or /foo/bar.ext   path == null, extension != null:  *.ext 
/*              * (2) (Re)load servlet class file              */
//  Create catalina.base directory 
//  Fall back for custom protocol handlers not based on AbstractProtocol 
//  Valid 
//  No Principal means the user is not already authenticated   and so will not be assigned any roles. It is safe to   to say the user is now authenticated because access to   protected resources will only be allowed with a matching role. 
//  There is data to read so use the read timeout while 
//           processor 
//  validation fails 
//  Expected response 
//  Real paths depend on the OS and this test has to work on all 
//  Note: Check redirect first to save unnecessary getResource()         call. See BZ 62968. 
//  Render the column headings 
//  first, fail to access the protected resource without credentials 
//  Only if the Context has started. If it has not, then it will   have its own "after_start" event later. 
//  happen 
//  Create the GenericPrincipal 
//  Wdy, DD-Mon-YY HH:MM:SS GMT ( Expires Netscape format ) 
//  Bug 55917 
//  List of protocol names, separated by ",", "+" or "-".   Semantics is adding ("+") or removing ("-") from left   to right, starting with an empty protocol set.   Tokens are individual protocol names or "all" for a   default set of supported protocols.   Separator "," is only kept for compatibility and has the   same semantics as "+", except that it warns about a potentially   missing "+" or "-". 
//  Silent catch, as this is a normal case during the early   startup stages 
//  trigger any necessary clean-up. 
/*      * Checks if an OPTIONS request is processed as pre-flight.     *     * @throws IOException     * @throws ServletException      */
//  Call the initialization method of this servlet 
//  above will have removed the SSO session from the cache 
//        to load ContainerServlets 
//  There is a file ID 
//  ------------------------------------------------------- Static Variables 
//         this.datasource.getPoolProperties().setMaxActive(10);          this.datasource.getPoolProperties().setTestOnBorrow(true);          this.threadcount = 20;          this.transferPropertiesToC3P0();          this.c3p0Datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis(); 
//  .. and a new writeBuffer will be required. 
//             task.setName(task.getClass().getName() + "[" + inc() + "]");              task.setDaemon(true);              task.setPriority(Thread.MAX_PRIORITY);              task.start(); 
//  Writing MIME header. 
//  session was accessed, so it will be saved once again 
//  Closed, with children 
//  alert all ELContextListeners 
//  Use the executor to avoid binding the main thread if something bad   occurs and unbind will also wait for a bit for it to complete 
//  string buffer used to build XML view 
//  Already closed 
//  Default encoding: fast conversion 
//  Scan Servlet, Filter, Servlet, Listener 
/*      * POJO auto deployment followed by programmatic duplicate. Keep POJO.      */
//  Checking inheritable collection locks 
//  Method check 
//  Takes about 0.3s on a quad core 2.7Ghz 2013 MacBook 
//  current Thread CCL to be the webapp classloader 
//  Terminator 
//  Cipher 6D 
//  Setting up the I/O 
//  First check to see if another thread has loaded the session into   the manager 
//  Push a group marker 
//  Write to buffer 
//  @GuardedBy("keyLock") 
//  get content type 
//  process the read will timeout triggering an error. 
//         tearDown();      } 
// (new Random(System.currentTimeMillis())).nextInt(1000000)+100000; 
//  Duplicate of message already processed 
// Thread.currentThread().sleep(10); 
// TODO: use a custom data structure to reduce allocations 
//  close the connection so we know it will be reopened. 
//  Prevent stopping our own host 
//  If the response code supports an entity body and we're on   HTTP 1.1 then we chunk unless we have a Connection: close header 
//  Null will always be ambiguous 
//  Set up parameters 
/*  Some platform MBeans  */
//  Unreachable code - here to stop eclipse complaining about   a possible NPE further down the method 
/*      * Expected behaviour for modification of files.     *     * Artifacts present      Artifact   Artifacts remaining     * XML  WAR  EXT  DIR    Modified    XML  WAR  EXT DIR   Action     *  N    N    N    Y       DIR        -    -    -   M     None     *  N    Y    N    N       WAR        -    M    -   -   Redeploy     *  N    Y    N    Y       DIR        -    Y    -   M     None     *  N    Y    N    Y       WAR        -    M    -   R   Redeploy     *  Y    N    N    N       XML        M    -    -   -   Redeploy     *  Y    N    N    Y       DIR        Y    -    -   M     None     *  Y    N    N    Y       XML        M    -    -   Y   Redeploy     *  Y    N    Y    N       EXT        Y    -    M   -   Reload if WAR     *  Y    N    Y    N       XML        M    -    Y   -   Redeploy     *  Y    N    Y    Y       DIR        Y    -    Y   M     None     *  Y    N    Y    Y       EXT        Y    -    M   R    Reload     *  Y    N    Y    Y       XML        M    -    Y   Y   Redeploy     *  Y    Y    N    N       WAR        Y    M    -   -    Reload     *  Y    Y    N    N       XML        M    Y    -   -   Redeploy     *  Y    Y    N    Y       DIR        Y    Y    -   M     None     *  Y    Y    N    Y       WAR        Y    M    -   -    Reload     *  Y    Y    N    Y       XML        M    Y    -   Y   Redeploy      */
//  Simulate an error 
// how many times to search for an available socket 
//  -------------------- 
//  Could be a typo. Don't default to NONE since that is not   secure. Force user to fix config. Could default to REQUIRED   instead. 
//  previous error 
//  The preface must be fully read before being validated 
//  ------------------------------------------------- Session Public Methods 
//  change session id 
//  Assemble info about our own stratum (JSP) using JspLineMap 
// main part. 
//  -------------------- Generic methods -------------------- 
//  Start listening on the server socket 
//  Invoke fragment, unless fragment is null 
//  Expect 3 messages: headers, body, end for a valid request 
/*  TLS v1.2 ciphersuites  */
//  Not null 
//  Circular 
/*      * @deprecated Use {@link #subtract(char[],int,int)}.     *             This method will be removed in Tomcat 10      */
//  If an empty absolute ordering element is present, fragment processing 
//  Set up new buffer for the method 
//  Validate the characters in the URI. %nn decoding will be checked at 
//  Ignore. The async error handling will deal with this. 
//  Remove sockets 
// ------------------------------------------------------------------------------                CONSTRUCTORS / DESTRUCTORS  ------------------------------------------------------------------------------ 
/*                  * For code that processes {, the behavior will be ... if I do                 * not encounter a closing } - then I ignore the {                  */
//  don't have to do anything; needed only for instantiation 
/*  destroy global TCN's APR pool     * This has to be the last call to TCN library.      */
//  Query string 
//  Identical to ConstantString except for the name 
//  Currently this is effectively a NO-OP but needs to be called to 
//  If we got this far, all is good. Accept the connection. 
//  estimate of 3 which is the worst case for small headers. 
/*  If the request length exceeds the size of the output buffer,             flush the buffer and then write the data directly.  In this             way buffered streams will cascade harmlessly.  */
/*  * Servlet output stream that gobbles up all its data.  */
//  Pass uncompressed frames straight through. 
//  No need to declare Java variables, if we inside a   JspFragment, because a fragment is always scriptless. 
//  If the port is not explicitly specified, compute it based on the 
/*      * private fields for 1.2 info      */
//  No (or invalid?) certificate chain was provided for the cert 
/*  PSK cipher suites from RFC 4785  */
//  Ping frames 
//  Reinitializing if something went wrong 
//  closing the stream will raise an exception 
//  could happen   set the new channel non-blocking 
//  Clear the objTable map 
//  Measure against memory leaking if references to the session   object are kept in a shared field somewhere 
//  Report the number of bytes read 
/*  Note CGI spec says CONTENT_LENGTH must be NULL ("") or undefined             * if there is no content, so we cannot put 0 or -1 in as per the             * Servlet API spec.              */
//  Cipher 6A 
//  index of next available tag handler 
//  long[] 
//  The setter for the "value" attribute 
//  Do a POST that won't be affected by the above limit 
//  Remove path parameters 
//  Remove the top node 
//  If the collection is now empty, remove it 
//  Create a temp dir. 
//  Prefer loop back over link local since on some platforms (e.g.   OSX) some link local addresses are not included when listening on 
//  Explicit OpenSSL path may also need explicit lib path   (e.g. Gump needs this) 
//  Output is content of resource   Check to see if conversion is required 
//  First request for protected resource gets the login page 
//  length. These assumptions are valid for these tests. 
//  Fix for bugzilla 41606   Set JspServletWrapper.servletClassLastModifiedTime after successful compile 
//  Create an object pool to contain our PooledConnections 
//  Library present but failed to load 
// ------------------------------------------------------------------------------                METHODS TO OVERRIDE 
//  Not an OpenSSL cipher name 
//  to null 
//  Set the context class loader of newly created threads to be the class   loader that loaded this factory. This avoids retaining references to   web application class loaders and similar. 
//  First '@' is in the path segments so no userinfo 
//  Second request should result in redirect without a body 
/*  Second step: Try to locate in cache  */
//  Retrieving the range header (if any is specified 
/*      * Test the interaction between gzip and flushing. The idea is to: 1. create     * an internal output buffer, response, and attach an active gzipoutputfilter     * to the output buffer 2. set the output stream of the internal buffer to     * be a ByteArrayOutputStream so we can inspect the output bytes 3. write a     * chunk out using the gzipoutputfilter and invoke a flush on the     * InternalOutputBuffer 4. read from the ByteArrayOutputStream to find out     * what's being written out (flushed) 5. find out what's expected by writing     * to GZIPOutputStream and close it (to force flushing) 6. Compare the size     * of the two arrays, they should be close (instead of one being much     * shorter than the other one)     *     * @throws Exception      */
//  Pass 1 - the directives 
//  Hosts Row Section 
//  Buffer not big enough 
//  encodings and weights can be ignored. 
/*  TCN_VERSION_STRING  */
//   -------------------------------------------------------- expire 
/*  JavaCC - OriginalChecksum=9ba0db3918bffb8019f00da1e421f339 (do not edit this line)  */
//  number of response codes >= 400 
//  seed the generator 
//  Edge case   If the request has too many headers it won't be   possible to create the host header. Ignore this as   processing won't reach the point where the Tomcat   internals expect there to be a host header. 
//  Wait for the threads to die 
//  Do nothing here, just wait for it to get recycled 
//  Read first four bytes (or as many are available) and determine   encoding 
//  make buffer empty  did we get a package 
//  Cipher 6C 
// we are completed, should we read an ack? 
// there could have been contention around the queue 
/*  SC_REQUEST_ENTITY_TOO_LARGE  */
//  Should not happen 
/*          * Work-around known a JRE bug.         * https://bugs.openjdk.java.net/browse/JDK-8194653         *         * Pre-load the default file system. No performance impact as we need to         * load the default file system anyway. Just do it earlier to avoid the         * potential deadlock.         *         * This can be removed once the oldest JRE supported by Tomcat includes         * a fix.          */
// we can't unwrap anything 
/*      * Exception indicating that a DOCTYPE declaration is present, but     * validation is turned off.      */
/*      * Receives notification of the start of an element.     *     * This method assigns the given tag attributes to one of 3 buckets:     *     * - "xmlns" attributes that represent (standard or custom) tag libraries.     * - "xmlns" attributes that do not represent tag libraries.     * - all remaining attributes.     *     * For each "xmlns" attribute that represents a custom tag library, the     * corresponding TagLibraryInfo object is added to the set of custom     * tag libraries.      */
//  Specify the attributes to be retrieved 
//  generate .class again from the new .java file just generated. 
//  ------------------------------------------------------------ Properties 
//  Check for failed sockets and hand this socket off to a worker 
/*      * Generates tag handler preamble.      */
/*      * Async has been processed. Whether or not to enter a long poll depends on     * current state. For example, as per SRV.2.3.3.3 can now process calls to     * complete() or dispatch().      */
//  clear Resultset 
//  The first request will fail - but we need to extract the nonce 
//  see http://greenbytes.de/tech/webdav/webdav-redirector-list.html 
//  Trim leading white spaces 
//  Cipher 6B 
//  lookup major type match (e.g. "text") 
//  empty. 
//  Calculate the current log file name 
//  If isOuboundDone is set, then the data from the network BIO   was the close_notify message -- we are not required to wait 
//  Attribute escaping does not apply inside EL expressions 
//  60-6f a-o   70-7a p-z 
//  Determine prefix and local name components 
//  what's unavailable   needs admin action?   unavailability estimate 
//  field names given in the list of exposed headers. 
//  Restore the beans to their default state 
//  Flush and close the output stream 
// offset += addr.length; //addr data 
//  seems a bit silly to encode a null string, but easy to deal with. 
//  Add a parameter 
//  -------------------- Processing -------------------- 
//  Bug 55921 
//  Caller ensures last == true if this branch is used 
//  Set the attribute and Forward to hello.jsp 
//  These characters are disallowed in Windows file names and   there are known problems for file names with these characters   when using File#getCanonicalPath().   Note: There are additional characters that are disallowed in         Windows file names but these are not known to cause         problems when using File#getCanonicalPath(). 
/*  for multicasting stuff  */
// -------------------------------------------------------- listWebAppPaths() 
//  Continue writing data using a gathering write 
//  return unchanged data 
//  Gump includes some JARs on classpath - skip them 
//  check the input - what are you doing here?? 
//  next, a set of tests where the server Context uses cookies,   but the client refuses to return them and tries to use   the session ID if carried as a url path parameter 
//  Update the latch that enforces this 
/*                  * ASSERT: AccessControl method has already set the appropriate                 * HTTP status code, so we do not have to do anything special                  */
// will show as '03' instead of ' 3' 
/*      * PluginTags ::= ( '<jsp:params' Params S? )? ( '<jsp:fallback' Fallback?     * S? )?      */
//  Shouldn't be necessary but acts as a check that sub-classes are   doing what they are supposed to. 
//  While this code is only used on Java 9 and later, it needs to compile   with Java 8 so use reflection for now. 
//         Review if this should cause a warning/error 
//  Check the deny patterns, if any 
//  Should be processed 
//  Coerce the two child nodes to string and then concatenate 
//  Clear the server side block and prevent further blocks to allow the 
//  jar:file:... 
//  exact match pattern: /a/foo.jsp 
//  -------------------- Input Buffer -------------------- 
//  Remainder 
//  Set this artificially small to trigger 
//  DBCP-372. clearBatch with throw an exception if called when the 
//  Don't call any notification if replacing with the same value   unless configured to do so 
//  Something went wrong - assume modification 
//  Add the main read buffer in the destinations and try again 
//  Annotation processing 
// add to the global counter 
//  Bind the authorization credentials to the request 
//  Class import 
//  Look up the SingleSignOn implementation in our request processing   path, if there is one 
//  5 second timeout 
//  Add the sub-delims 
//  We're parsing the outer multipart 
//  Need to check for a directory that should not be   there 
//  Close any sockets not in the poller performing blocking   read/writes. Need to do this before destroying the poller since 
//  Open a new connection (This will re-use the previous pooled connection) 
/*      * Expect failure as it is not possible to identify which method named     * "testA()" is intended.      */
//  Default constructor required by reflection 
//  Comment this line out if the originals needs to be exported. 
//  Populate the initial list of HTTP headers 
//  request without session change 
//  Merged web.xml that is published as MERGED_WEB_XML context attribute   in the simplest case consists of webapp's web.xml file 
/*          * If the current uri is matched by a pattern specified in a         * jsp-property-group in web.xml, initialize pageInfo with those         * properties.          */
//  The object is a custom action with an associated   VariableInfo entry for this name.   Get the class name and then introspect at runtime. 
//  Log our server identification information 
//  This may disabled keep-alive to check before working out the 
//  Unsupported method 
//  Stop our thread 
//  Test references to non-existent fragments 
//  lock-free optimistic-locking maximum 
// optimized, only use a lock when there is concurrency 
//  Failing a toCanonicalPath on a file that   exists() should be a JVM regression test,   therefore we have permission to freak uot 
//  Initialize our defined Connectors 
//  This is the root directory of a mounted ResourceSet   Need to return the mounted name, not the real name 
//  Note: Block is ignored for this test class. Reads always block. 
//  Standard clone() method will copy the array object. Replace that 
//  Ensure we don't get multiple write registrations if   ServletOutputStream.isReady() returns false during a call to 
//  s1 and s2 are the same as before. 
//  Checking that   (1) Headers plus request line size does not exceed its limit   (2) There are enough bytes to avoid expanding the buffer when   reading body   Technically, (2) is technical limitation, (1) is logical   limitation to enforce the meaning of headerBufferSize   From the way how buf is allocated and how blank lines are being   read, it should be enough to check (1) only. 
//  Test with "addConnectorPort" but port not in pattern 
// If it's the root context, then there is no context element   to remove,   ie:   '/file1.shtml' vs '/appName1/file1.shtml' 
// should we cache it 
//  TextMessageSendHandler will update stateMachine when it completes 
//  start with first element 
//  Report this property change to interested listeners 
// the flag caught should be set true; 
//  Configure logging 
/*          * Leave timeouts in the hands of the upgraded protocol.          */
//  directives we validated in pass 1 
//  if we have it. 
//  Read class attributes 
//  Load unloaded sessions, if any 
//  Settings are only valid on stream 0 
//  triggered. 
//  Short circuit 
//  ignored 
//  current refaddr to be set 
//  Set defaults 
//  Non-running contexts should be ignored. 
// perform the wrap 
//  PortComponent 
//  FormatType.SDF 
//  NO-OP. 
//  PUT without POST-style parsing 
//  Skip the end quote 
//  These were removed in 1.1.0 so won't be available from that   version onwards. 
//              throw new NullPointerException(); 
//  Once the close code has been added there are a maximum of 123 bytes   left for the reason phrase. If it is truncated then care needs to be   taken to ensure the bytes are not truncated in the middle of a   multi-byte UTF-8 character. 
//       Append a readable representation of the log level. 
//  TLD has already been parsed as a result of processing web.xml 
//  Ignore the async specific parameters 
//  If catalina.properties is missing, protect all by default. 
//  No state change. Checks that receiving the frame type is valid for   the current state of this stream. 
//  Use a non-link local, non-loop back address by default 
//  it works (although it shouldn't) 
//  Other attributes can be repeated if and only if the values   are identical 
//  The property has its default value 
//  OpenSSL does support authentication after the initial handshake 
//  Just within default maxHttpHeaderSize   per header overhead plus standard 3 headers 
//  Cipher 69 
//  If the entry is a reference, resolve it 
//  Sends complete request in 3 packets 
//  finally 
//  Store session count 
//  Send response token on success and failure 
//  if the semaphore is already acquired, it means that the   request thread got unstuck before we interrupted it 
//  Units (required) 
//  --------------------------------------------------------- Constructors 
//  Bugzilla 33636 
//  TLS handshake 
//  Start the Valves in our pipeline (including the basic), if any 
//  --------------------------------------------------------- receiver   messages 
//  Set the socket to nonblocking mode 
//  boolean[] 
//  then try to continue using the expired session to get the   protected resource once more. 
// we only grow slowly 
//  Should never happen - signature error in lookup? 
//  Check for an '=' -- This could also be a name-only   cookie at the end of the cookie header, so if we   are past the end of the header, but we have a name 
//  Continue processing on another thread 
//  The digester cannot differentiate between null and "".   Unfortunately, some key stores behave differently with null   and "".   JKS key stores treat null and "" interchangeably.   PKCS12 key stores (Java 7 onwards) don't return the cert if   null is used.   Key stores that do not use passwords expect null   Therefore:   - generally use null if pass is null or ""   - for JKS or PKCS12 only use null if pass is null 
//  The window update for the padding could occur anywhere since it   happens on a different thead to the response. 
//  -------------------- Per-Request "notes" -------------------- 
//  Retrieving an already existing lock on that resource 
//  Make sure the message was logged 
/*      * Block with properties expected in a DataSource This props will not be listed as ignored - we know that they may     * appear in Resource, and not listing them as ignored.      */
//  If force mode, the length and MIME type checks are skipped 
//  Cipher 68 
//  Nothing to do 
//  Ensure that the random seed is consistent with that used for SSL init 
//  Store nested <PostResources> elements 
//  which won't see this dispatch 
//  Need to make sure we see a leak for the right reasons 
//  __end toStringMethod 
//  a very minor one) in a profiler. 
//  There is an increment 
//  Make sure non-multipart works properly 
//  Some more zero compression for localhost addresses 
/*          * Sets the XML-style 'name' attribute          */
//  Loading handler Class 
/*          * At this point, 'isExternal' or 'isXml' is FALSE.         * Search for jsp:root action, in order to determine if we're dealing         * with XML or standard syntax (unless we already know what we're         * dealing with, i.e., when 'isExternal' is TRUE and 'isXml' is FALSE).         * No check for XML prolog, since nothing prevents a page from         * outputting XML and still using JSP syntax (in this case, the         * XML prolog is treated as template text).          */
//  o.a.catalina.tribes.test.membership 
//  ---------------------------------------------------- SingleSignOn Methods 
//  a is not set, b is set, c is the same as b 
//  Start the context 
//  Reset everything 
//  Ensure all threads have their own instance of the servlet 
//  position before it was called 
//  Should trigger an error since stream 3 should have been implicitly   closed. 
//  deny-uncovered-http-methods 
//  created. 
//  Check for unbalanced standard actions 
//  Public Methods 
//  Skip the previous auto-generated content 
//  __end introspectMethod 
//  Obtain the absolute docBase in String and File form 
//  pad to 20 chars 
//  Close our opened connection 
//  Check lower size limit is enforced 
//  ---------------------------------------------------------- Realm Methods   ------------------------------------------------------ Protected Methods 
//  --------------------------------------------- Inner Class 
//  Set this before we de-register currently known naming resources to   avoid timing issues. Duplication de-registration is not an issue. 
// in page scope should be removed 
//  Check third byte if present and expected 
// Try to scan in memory 
//  Everything else in order 
/*      * Negative test, when a non-CORS request arrives, with an origin header.      */
/*  SC_SERVICE_UNAVAILABLE  */
//  Note: No defaults here 
/*  5 == length("javax")  */
//  Store nested <CredentialHandler> element 
//  default to now 
//  enumeration of all refaddr 
//  This is deliberately unused. The reference is retained so that a   reference chain is established and maintained to the OpenSSLContext while   there is a connection that is using the OpenSSLContext. Therefore, the   OpenSSLContext can not be eligible for GC while it is in use. 
//  Wrapper is mapped for mapping method used by forward or include dispatch 
//  Using a test from testBug49922() to check that the webapp is running 
//  Populated the encoded (i.e. undecoded) requestURI 
//  No host information (HTTP/1.0) 
//  Construct an event with the new value 
//  The tests are from TestTomcat#testSingleWebapp(), #testJsps() 
//  multiple calls to close is OK 
//  Cipher 65 
//  Validation returns true   Validation returns false   Validation throws an unexpected exception 
//  Make sure the natural ordering is broadly consistent with equals   although this will break down if distinct objects have the same   identity hash code.   see java.lang.Comparable Javadocs 
//  Build a WINDOW_UPDATE frame if one is required. If not, create an   empty byte array. 
// Make sure we have nice window decorations. 
// ------------------------------------------------------------------   Iterator safe from concurrent modification exceptions 
//  JSP.5.1, Semantics, para 1 - lock not required for request or   page scope 
//  Configure the constraints to use in the tests 
//  a later test as per JSP.5.3 
//  Logger 
//  been parsed 
//  Empty body must be treated as "" 
/*  original content/structure of this section taken from             * http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4216884             * with major modifications by Martin Dengler              */
/*      * Sets a standard set of headers to reduce response variation which in turn     * is intended to aid caching.      */
// create an exit thread that forces a shutdown if the JVM wont exit cleanly 
//  If specified, Implementation version must be >= required 
//  Just here to trigger the error 
//  args[i] can't be null due to earlier checks 
// register OP_WRITE to the selector 
//  Set the parameters 
//  All characters in the string are used. Check if only '*'s are   left in the pattern. If so, we succeeded. Otherwise failure. 
//  Set token header 
//  Solve problem with three colons in IPv4 in IPv6 format 
//  unwrap encapsulated SizeException 
// prep the buffer for the close message 
// bit not set, we want the lower part of the tree 
/*  Methods that do terminate lines  */
//  assert that our long query takes longer than one second to run 
//  RFC2617 says algorithm is token. <">token<"> will also be accepted 
//  reading frames ... 
//  Build the transformations 
//  Cipher 64 
/*      * Verifies that the same Content-Length is returned for both GET and HEAD     * operations when a static resource served by the DefaultServlet is     * included.      */
/*  JavaCC - OriginalChecksum=a95de353974c2c05fa5c7d695a1d50fd (do not edit this line)  */
//  Read some data into the network input buffer so we can peek at it. 
//  Other headers 
//  Reset connection window size after intial response 
//  30-3f 0-9 
//  parameters can't trigger NPE 
//  ------------------------------------------------ Parameter Stack Methods 
//  Save the locale for use by getLocale() 
//  Empty string 
/*      * BZ https://bz.apache.org/bugzilla/show_bug.cgi?id=57142     * javax.servlet, javax.servlet.http and javax.servlet.jsp should be     * imported by default.      */
//  Generate a list of abandoned objects to remove 
//  Strip leading '/' 
//  Gather the results... 
// do nothing, happens in the socket sender itself 
/*      * Parses a page directive with the following syntax: PageDirective ::= ( S     * Attribute)*      */
//  Swallow the periods 
//  includes setting the context 
//  JSSE 
//  Client sent Expect: 100-continue but received a   non-2xx final response. Disable keep-alive (if enabled)   to ensure that the connection is closed. Some clients may   still send the body, some may send the next request.   No way to differentiate, so close the connection to   force the client to send the next request. 
//  This is an 'uncontrolled' failure so put the component into the   FAILED state and throw an exception. 
//  When the message exceeds the buffer size, the WebSocket is   closed. The endpoint ensures that the latch is cleared when the   WebSocket closes. However, the session isn't marked as closed   until after the onClose() method completes so there is a small   window where this test could fail. Therefore, wait briefly to   give the session a chance to complete the close process. 
//  notify ContainerListeners 
//  Digester will check there is only one of these 
//  Cipher 67 
// http://localhost/status?cmd=update&mime=txt&w=node1&l=lb&wf=1&wd=false&ws=false   must be configured 
//  ---------------------------------------------------- PrintWriter Methods 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=61232 
//  Wrap 
/*  GOST R 34.10-2001  */
//  resource-env-ref was added in 2.3 so should be excluded in 2.2 
//  keep track of current line position   if currentPos == 0 we are at the start of a line, so don't add CRLF 
//  Elicit an LDAP bind operation 
//  This compilation needs to use the current tagJar.   Compilation may be nested in which case the old tagJar 
//  Special case for zero length files, which would cause a 
//  Ignore warnings in generated code 
//  Ignore attribute added by Eclipse for its internal tracking 
/*  * Test FORM authentication for sessions that do and do not use cookies. * * 1. A client that can accept and respond to a Set-Cookie for JSESSIONID *    will be able to maintain its authenticated session, no matter whether *    the session ID is changed once, many times, or not at all. * * 2. A client that cannot accept cookies will only be able to maintain a *    persistent session IF the server sends the correct (current) jsessionid *    as a path parameter appended to ALL urls within its response. That is *    achievable with servlets, jsps, jstl (all of which which can ask for an *    encoded url to be inserted into the dynamic web page). It cannot work *    with static html. *    note: this test class uses the Tomcat sample jsps, which conform. * * 3. Therefore, any webapp that MIGHT need to authenticate a client that *    does not accept cookies MUST generate EVERY protected resource url *    dynamically (so that it will include the current session ID). * * 4. Any webapp that cannot satisfy case 3 MUST turn off *    changeSessionIdOnAuthentication for its Context and thus degrade the *    session fixation protection for ALL of its clients. *    note from MarkT: Not sure I agree with this. If the URLs aren't *      being encoded, then the session is going to break regardless of *      whether or not the session ID changes. * * Unlike a "proper browser", this unit test class does a quite lot of * screen-scraping and cheating of headers and urls (not very elegant, * but it makes no claims to generality). *  */
//  the decoder the input has ended 
//  Remove trailing comma 
//  starting the context 
//  Oldest resource should be first (so iterator goes from oldest to   youngest. 
// stop the channel 
//  Cannot wrap a null adaptee. 
//  Document the servlet context attributes 
//  Current index of the expression 
//  will be written here. 
//  <any US-ASCII character (octets 0 - 127)>   <any US-ASCII control character (octets 0 - 31) and DEL (127)> 
//  Cipher 66 
//  Open an output writer for the new configuration file 
//  set CATALINA_BASE to test so that the file with persistent providers will be written in test/conf folder 
//  idx will be the smallest positive index ( first % or + ) 
/*  Cipher 0     * TLS_NULL_WITH_NULL_NULL     * Must never be negotiated. Used internally to represent the initial     * unprotected state of a connection.      */
//  Pre-population of the cache means this must be invalid 
//  Remove the context 
//  Switching to write 
//  Need to call onError using the web application's class loader 
//  Generate postamble: 
//  watched inside it 
//  rulesList = (List) this.cache.get(key); 
//  Check for path prefix matching 
//  Rotating a log file will always trigger a new file to be opened so   when a new file is opened, check to see if any old files need to be 
/*  Any non timeup or interrupted error is critical  */
//  priming read 
//  Draw an ellipse. 
//  Add the Servlet 
//  Filter the discovered container SCIs if required 
//  ClassLoader 
//  message-destination-ref names must be unique within a   web(-fragment).xml 
//  One request should be sufficient 
//  Use the default encoding? 
//  going to be thrown. 
//  JAAS throws exception different than LoginException so mark the   realm as unavailable 
//  can still be accessed with an authentication header. 
//  Calculate average 
//  Call the handler completed method with the   consumed bytes number 
//  no big deal 
//  Should there be a default size different than what this ctor provides? 
//  Not in RFC6455   return CloseCodes.TRY_AGAIN_LATER; 
//  Cipher 61 
//  set up our start/end 
//  byte values are signed i.e. -128 to 127   The values are used unsigned. 0 to 31 are CTLs so they are   filtered (apart from TAB which is 9). 127 is a control (DEL).   The values 128 to 255 are all OK. Converting those to signed   gives -128 to -1. 
//    Reading the URI   
//  skipLine() will handle the error 
//  Mainly set to reduce timeouts during async tests 
//  Connection header 
//  Special handling for ContainerServlet instances   Note: The InstanceManager checks if the application is permitted 
//  Long.MAX_VALUE - 1 
//  If the resource is a class just being loaded, decorate it   with any attached transformers 
/*  Is the TCP_NODELAY socket option inherited from listening sockets?      */
//  Swallow the \ 
//  Create a connection for this command 
//  Initialize local variables used in this method. 
//  periodic event 
//  Example 13-5   @ServletSecurity((httpMethodConstraints = {       @HttpMethodConstraint(value = "GET", rolesAllowed = "R1"),       @HttpMethodConstraint(value = "POST", rolesAllowed = "R1",       transportGuarantee = TransportGuarantee.CONFIDENTIAL) 
//  Has bot just created a session, if so make a note of it 
//  JSP (standard) syntax. Use encoding specified in jsp-config   if provided. 
//  Get iterator to loop over all instances of this data source. 
// domain - dlen bytes 
/*  Read httpd answer  */
//  --------------------------------------------------- OutputStream methods 
//  per-servlet state 
//  There should be nothing left unless we missed something 
//  Cipher 60 
//  Don't change the status code for IOException since that is almost   certainly a client disconnect in which case it is preferable to keep   the original status code http://markmail.org/message/4cxpwmxhtgnrwh7n 
//  Reset the docBase to trigger re-expansion of the WAR. 
//  Remove the end of stream and end of headers flags 
//  Work around java.net.URL bug 
//  We first check handshakeFinished to eliminate the overhead of extra JNI call if possible. 
/*  4 == length("org/")  */
//  "metadata" contains "name", "uid" and "creationTimestamp" 
//  -------------------------------------------------- ObjectFactory Methods 
//  Cipher 63 
//  Use the engine name first 
//  anything 
//  Method not annotated 
//  Does nothing. This factory does not cache user credentials. 
// default value, always process 
//  private high surrogate, no effing clue, so skip it 
// if the target is a map, then put the result into the map with the key property 
//  Need to know if TLS 1.3 has been explicitly requested as a warning needs   to generated if it is explicitly requested for a JVM that does not 
//  The semaphores are only created if async IO is enabled 
//  For incomplete sequences at the end of the input need to tell 
//  __begin lookupReadMethodMethod 
/*      * XMLExpressionBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<'))     * CDSect?)* ETag ) | <TRANSLATION_ERROR>      */
//  Class   String   MethodType 
//  Determine the target object for the method call 
//  Add a default servlet to return 404 for not found resources 
//  Take advantage of the fact that the message uses characters that   are represented as a single UTF-8 byte so won't be split across   binary messages 
//  Disable caching 
//     and that error has not been reported. 
// catch 
//  uri is of the form "urn:jsptld:path" 
//  Internal objects to represent array + offset, and specific methods 
// FIXME add Pool of Arraylists 
//  Makes 1 digit 
//  Cipher 62 
//  Disable blocking, polling will be used 
//  Configure an authenticator if we need one 
//  In memory session ID list 
//  Must be binary 
//  etag headers will vary depending on when the source was   checked out, unpacked, copied etc so use the same default as   for date headers 
/*      * Check real path for directories ends with File.separator for consistency     * with previous major versions.      */
/*          * Appends the attributes of the given Node to the XML view.          */
//  Given how the entry name is used, there is no requirement to convert   the name for a multi-release entry to the corresponding base name. 
//  should we add this object as a listener or the pool.   consider the validateObject method in decision 
//  Handle case where no match at all was found 
//  Warning: Java String quoting vs. JSP attribute quoting 
/*      * When testing on markt's desktop each iteration was taking ~1420ns when     * using String.replaceAll().     *     * Switching the implementation to use pre-compiled patterns and     * Pattern.matcher(input).replaceAll(replacement) reduced this by ~10%.     *     * Note: Given the very small absolute time of a single iteration, even for     *       a web application with 1000 JARs this is only going to add ~3ms.     *       It is therefore unlikely that further optimisation will be     *       necessary.      */
//  Need to explicitly execute dispatches on the StreamProcessor   as this thread is being processed by an UpgradeProcessor 
/*      * POJO auto deployment followed by programmatic on same path.      */
//  Clear any references retained in the serialization caches 
//  Always put a timeout in 
//  No obvious status fields for javax.servlet.http   Could hack something with HttpUtils...   No obvious status fields for javax.servlet.jsp   Wild card (package) import 
//  -------------------- utils 
//  Yes -- Acknowledge the request, validate the specified credentials 
// only write if we were registered for a write  write the data 
//  time before giving up. 
//  Something went wrong - bad request 
//  add 
// *********************************************************************   Public entry points 
// ------------------------------------------------------------------   Count down latch that can be used to exchange information 
//  Stage 4. Decouple the groups so the ordering requirements for            each fragment in the group only refer to other fragments            in the group. Ordering requirements outside the group            will be handled by processing the groups in order.            Note: Only after ordering requirements are considered. 
//  Implement JspSourceDependent 
//  This should be in the 'could never happen' category but handle it   to be safe. 
//  not using content length, so just read it line by line 
//  build the list of available extensions if necessary 
//  we need 
//  Declare implicit objects. 
//  Declare attributes 
//  Look for session ID in cookies and SSL session 
//  the decoder writes directly to an output stream. 
// leadership change 
//  Nesting level of Tag dependent bodies 
/*      * Parses the given file included via an include directive.     *     * @param fname The path to the included resource, as specified by the     * 'file' attribute of the include directive     * @param parent The Node representing the include directive      */
//  Turn the classPath into URLs 
//  Check the start character that has more restrictions 
//  Check source/target JDK versions as the newest versions are allowed   in Tomcat configuration but may not be supported by the ECJ version 
//  a false branch 
//  Use a ThreadLocal to work around 
//  Skip non-public classes 
//  Must be waiting to receive the close_notify message 
//  Note: Release branches 1.0.1 and earlier are no longer supported by         the OpenSSL team so these tests don't support them either. 
//  Cross-site scripting filter protection 
//  Do nothing if there is no opened connection 
//  don't want to trigger a series of reloads. 
//  NO-OP   Non-blocking post-processing may attempt to flush 
//  and a dumb insert sort 
//  This is a general check that aims to catch problems early   Detailed checking of each part of the request target will 
//  If this is an error page, get the original URI 
/*      * Directive attributes      */
/*      * Checks class loader for the server endpoint during onOpen and onMessage      */
//  Check the container's parent for the specified attribute 
/*      * TODO     * @return TODO      */
//  but not long enough for the NonLogin session expiry. 
//  The time taken to shutdown the executor can vary between systems. Try   to avoid false test failures due to timing issues. Give the executor 
//  set up SSI processing 
/*  TLS 1.3  */
//  Some Wrappers (from global and host web.xml) may be   overridden rather than generating a conflict 
//  There will now only be one Vary header 
/*  The Ephemeral DH ciphers  */
//  Make sure you have read the big comment before the loop above. It is   possible that the timing of the server threads is such that there are 
//  Allowed roles should be the union of the roles in the constraints   * is any app role   User role is a non-app constraint role 
//  Must always be followed by a settings frame 
//  Wait for the next connection 
/*          * There are a few places where a) the behaviour of the Java API depends         * on the underlying platform and b) those behavioural differences have         * an impact on Tomcat.         *         * Tomcat therefore needs to be able to determine the platform it is         * running on to account for those differences.         *         * In an ideal world this code would not exist.          */
//  also be tolerant of multiple SP and/or HT. 
//  maximum length zero group, if there is more then one, then first one 
// check to see if it is a ping message, if so, process = false 
//  we can control log categories even during runtime 
//  Test that configuring servlet security constraints programmatically   does work. 
//  BitSet elements will default to false 
// request.getLocalName()  request.getLocalPort()  request.getScheme()  request.getRequestURL()  request.getContextPath()  request.getServletPath()  request.getPathInfo()  request.getPathTranslated()  request.getUserPrincipal()  request.getCharacterEncoding()  request.getLocale()  request.getRequestedSessionId()  request.isRequestedSessionIdFromCookie()  request.isRequestedSessionIdFromUrl()  request.isRequestedSessionIdValid() 
//  Java 7 JVM decoder does not report error until all 4 bytes are 
//  Erase if necessary, and redraw 
/*  Generated By:JJTree: Do not edit this line. AstOr.java  */
//  No service name, return null which will trigger the use of the 
//  When tripCount is greater than zero, a circular   dependency exists. The circularly dependent tag   file is compiled in prototype mode, to avoid infinite   recursion. 
//  Re-add the same context, but different list of wrappers 
// tmp.getMessage().append(XByteBuffer.toBytes(count),0,4); 
//  Check for WARs with /../ /./ or similar sequences in the name 
//  encoding that doesn't give the expected result so be explicit 
/*  empty slot: +11  */
//  We're included   Spec doesn't say what to do in this case but a FNFE seems   reasonable 
// -------------------- Getting headers -------------------- 
//  Fully covered. Ignore any partial coverage 
//  We don't close the PrintWriter - super() is not called,   so the stream can be reused. We close ob. 
//  Session not previously added 
//  Check that the URI is still normalized 
//  Shutdown our room. 
/*      * Is generation of X-Powered-By response header enabled/disabled?      */
//  we continue parsing from here...we allow parsing errors to fall through 
//  ----------------------------------------------------- Manifest constants 
//  Edge cases around zero   Unlimited 
//  Store nested <LocalEjb> elements 
//  NO-OP. Just need a class that implements SCI. 
/*      * Section Section 6.2.7     *     * @throws ServletException     * @throws IOException      */
// We subtract two from the column number to  account for the '[$,#]{' that we've already parsed 
//  Set of all element and attribute prefixes used in this translation unit 
//  JASPIC uses raw types 
//  Expected on some platforms 
//  ---------------------------------------- NotificationBroadcaster Methods 
//  Step through each file and convert. 
//  This file was included. Throw an exception as 
//  class loading should still work, no weaving 
//  Field   Method   InterfaceMethod   Integer   Float   NameAndType   InvokeDynamic 
//  Cipher Suites 
//  This *might* be match for a HandlesType. 
//  Resource content not directly available,   use InputStream 
//  Get the permissions for the web app context 
//  Ensure the application buffers (which have to be created earlier) are 
//  Need to use reflection to access lock since it is a private field 
//  Skip the remaining response headers 
//  Internal (primarily state) attributes 
//  Settings frames 
// populate number 
//  Refill. 
//  Set "ant.home" if requested 
//  Parse the list of properties 
//  If more than one UA header - assume not a bot 
//  Check the types 
//  Use the same domain as the connector 
//  ==================== protected methods ==================== 
//  Hide default constructor   Singleton pattern to ensure there is only one instance of this   factory 
//  Check for an absolute-URI less the query string which has already 
//    Reading the method name   Method name is a token   
/*      * Receives notification of the start of a Namespace mapping.      */
//  ------------------------------------------------ ContextList Inner Class 
//  all local addresses. 
// and record the begin index. default begin place is 0. 
//  -------------------------------------------- HttpServletResponse Methods 
//  Instantiate service with proxy class 
/*  Fortezza  */
//  Create the MBeans for each defined User 
//  Allocate to the specified stream 
//  NEW will occur if Context is defined in server.xml   At this point getObjectKeyPropertiesNameOnly() will trigger an   NPE.   INITIALIZED will occur if the Context is defined in a context.xml   file   If started now, a second start will be attempted when the context   starts 
//  call implicit and app resolvers 
/*          * Determine page encoding from directive of the form <%@ page %>,         * <%@ tag %>, <jsp:directive.page > or <jsp:directive.tag >.          */
//  There was no pending data in the network BIO -- encrypt any application data 
//  Settings have to be a multiple of six 
//  protect against protocol overflow attack vector 
//  Note: Throwable required because methods like _jspx_meth_* 
//  We should now have enough to extract the var name 
//  Date headers will always change so use a hard-coded default 
//  Quit the while loop 
/*  * Creates {@link ConnectionFactory} instances. * * @since 2.7.0  */
//  %xx decoding of the URL 
//  Calculate the enabled protocols 
//  Speed up the test by reducing the timeout 
//  Default constructor 
//  then. -1 means no timeout. 
/*  Timestamp format  */
//  TODO Test header processing and window size processing for ignored        streams 
/*  APR_VERSION_STRING  */
//  TODO: Deprecate offset and use start 
/*      * Check that a ServletContainerInitializer can install a     * {@link ServletContextListener} and that it gets initialized.     * @throws Exception      */
// remove it from the cache since it is used 
//  Tweak the header to set the reserved bit 
//  Use a ThreadLocal to work around   https://bugs.openjdk.java.net/browse/JDK-8195096 
//  ---------------------------------- JSSE specific configuration properties 
//  Look for a manifest 
// ----------------------------------------------------------------------- 
//  Should list POST as a method 
/*      * Run some sanity checks without an established SSO session     * to make sure the test environment is correct.      */
//  Inner classes 
//  Plotpoints allows calculation to only cover 45 degrees of the circle, 
//  Close the client session, primarily to allow the 
//  ------------------------------------------------ HTTP specific properties   ------------------------------------------ managed in the ProtocolHandler 
//  ---------------------------------------------------------- Valve Methods 
//  Clear the output buffer else data may be lost when   calling complete 
//  Check status 
//  Remove the generated .java file 
//  at most for pollTime before being polled 
//  If we include the port, even if it is 80, then MS clients will use   a WebDAV client that works rather than the MiniRedir that has   problems with BASIC authentication 
//  Alternate config reader and console format 
//  Downgrade the lock 
/*  SSL_OP_ALL: various bug workarounds that should be rather harmless.     *             This used to be 0x000FFFFFL before 0.9.7.  */
//  Check for "//" 
//  and add this to the text. 
//  Prevents IAE 
//                 indent++; 
//  (0.2) Try loading the class with the system class loader, to prevent         the webapp from overriding Java SE classes. This implements 
//  Set because we don't want duplicates   LinkedHashSet to retain the order. It is the order of the   WebResourceSet that matters but it is simpler to retain the order   over all of the JARs. 
//  c.addBeforeOrderingOthers(); 
/*      * NOTE: There is no maintenance of state or checking for valid transitions     * within this class. It is expected that the connector will maintain state     * and prevent invalid state transitions.      */
//  Setting up the socket 
//  Should have been encoded in fewer octets 
//  Convert decoded byte data into a string. 
//  The last portion of text should be there 
//  First, parse <jsp:attribute> elements: 
//  Only need to filter keys by alias if there are key managers to filter   and the original key store was used. The in memory key stores only 
//  Must be waiting on the peer to send more data 
//  returned even if it is invalid 
/*  && ctxt.hasEL()  */
//  The connection is closing. Close the associated streams as no   longer required (also notifies any threads waiting for allocations). 
//  still a delegate present close it 
//  Make the WAR appear to have been created earlier 
//   BITS_PER_BYTE   3 bytes = 24 bits = 4 * 6 bits to extract 
//  Spec says single SP but also be tolerant of multiple and/or HT 
//  correctly escaped. 
// remove attribute from certain scope. 
//  Deallocate and add to the idle instance pool 
//  Extend timeout to 5 mins for debugging 
//  assuming separator is just one char, if there are use cases with 
//  Deserialize the scalar instance variables (except Manager)   Transient only 
//  Handle when the response was committed before a serious   error occurred.  Throwing a ServletException should both   set the status to 500 and set the errorException.   If we fail here, then the response is likely already   committed, so we can't try and set headers. 
//  Check for '\' and 0 
//  Stream ID 
//  Create and initialize a filter chain object 
//  Window size 
//  If multiple methods have the same matching number of parameters   the match is ambiguous so throw an exception 
//  Walk the class loader hierarchy. Stop at the system class loader.   This will add the shared (if present) and common class loaders 
//  IOException after close. Assume this is a variation of the user   closing their browser (or refreshing very quickly) and ignore it. 
//    to do that) 
//  available 
/*      * Processes the given JSP parse error.     *     * @param errMsg Parse error message     * @param exception Parse exception      */
// get the name of the method for comparison 
//  Rerun to reject occasional failures, e.g. because of gc 
//  No need to even execute if we are nested in 
//  private data 
//  was close invoked? 
//  These HTML sections are broken in relatively small sections, because of   limited number of substitutions MessageFormat can process   (maximum of 10). 
//  Reset the password on the factory if using CPDSConnectionFactory 
//  Default config for the test is to allow any origin 
//  Now go over frame header 
//  We need to use the same hash function 
// we're faking it  Assert.assertTrue((end - start) > 1000); 
/*      * (non-Javadoc)     *     * @see java.lang.Object#equals(java.lang.Object)      */
//  Doesn't matter that this JAR doesn't exist - just as   long as the URL is well-formed 
//  part of some other name or value 
//  Paint is the main part of the program 
//  domain == engine name 
//  If the getUserByPattern() call fails, try it again with the   credentials of the user that we're searching for 
// end of stream 
//  Welcome files with path parameters at start 
// perform another unwrap? 
//  Get the HTTP upgrade handler 
//  Get encoding settings from request / connector if   possible 
//  print element with attributes 
//  the var attribute 
//  Attributes 
// set up the default state, unless we expect the interceptor to do it 
//  Reset any output that has been buffered, but keep headers/cookies 
//  Reset context 
//  Remove translated values for keys that have been removed 
//  400 
//  Does not work outside of 0-127 
//  Locking a collection (and all its member resources) 
/*      * Gets this Node's xmlns attributes that represent tag libraries (only     * meaningful for Nodes parsed from XML syntax)      */
//  If xa data source is not specified a DriverConnectionFactory is created and wrapped with a   LocalXAConnectionFactory 
//        Descriptor descriptor = null; 
//  If no content type specified, use default for POST 
//  next, try to access the protected resource while not providing   credentials. This confirms the server has not retained any state   data which might allow it to authenticate the client. Expect 
/*      * Placeholder Charset implementation for entries that will be loaded lazily     * into the cache.      */
//  Client address 
//  Redirects between web applications 
// if the current param is the first one, add a "?" ahead of it 
/*  Fortezza ciphersuite from SSL 3.0 spec     * Neither OpenSSL nor Java implement these ciphers and the IDs used     * overlap partially with the IDs used by the Kerberos ciphers    // Cipher 1C    SSL_FORTEZZA_DMS_WITH_NULL_SHA(            "FZA-NULL-SHA",            KeyExchange.FZA,            Authentication.FZA,            Encryption.eNULL,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.STRONG_NONE,            false,            0,            0,            null,            null    ),    // Cipher 1D    SSL_FORTEZZA_DMS_WITH_FORTEZZA_CBC_SHA(            "FZA-FZA-CBC-SHA",            KeyExchange.FZA,            Authentication.FZA,            Encryption.FZA,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.STRONG_NONE,            false,            0,            0,            null,            null    ),    // Cipher 1E - overlaps with Kerberos below    SSL_FORTEZZA_DMS_WITH_RC4_128_SHA(            "FZA-RC4-SHA",            KeyExchange.FZA,            Authentication.FZA,            Encryption.RC4,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.MEDIUM,            false,            128,            128,            null,            null    ),      */
//  already closed 
// initialize the target 
//  Unknown setting (should be ack'd) 
//  Should not ever have an empty path component, since that is /{DN} 
//  Edge case trying to trigger ArrayIndexOutOfBoundsException 
//  Methods have different non-matching parameters   Result is ambiguous 
//  Add the Realm to the Context 
/*  JavaCC - OriginalChecksum=96680d397165a1214a1ad1f24011d5c1 (do not edit this line)  */
//  No link so still should be null 
/*      * Returns the localized error message corresponding to the given error     * code.     *     * If the given error code is not defined in the resource bundle for     * localized error messages, it is used as the error message.     *     * @param errCode Error code to localize     * @param args Arguments for parametric replacement     *     * @return Localized error message      */
//  Indicates that the trailing valid byte is included in replacement of the 
/*  -------------------------------- *     * Validation whileIdle              *     * --------------------------------  */
//  Cancel the task.   Note that it can happen that the TimerTask is just about to execute (from   the Timer thread) but waits until all players are gone (or even until a new   player is added to the list), and then executes. This is OK. To prevent it,   a TimerTask subclass would need to have some boolean "cancel" instance variable and   query it in the invocation of Room#invokeAndWait. 
//  Initialize adapter 
//  Trying to guess the docBase according to the path 
//  Create a new array of the correct type 
//  Some header values vary so ignore them 
//  Let's 
//  Default 
//  Only create a new SSO entry if the SSO did not already set a note   for an existing entry (as it would do with subsequent requests 
// get the total messages 
//  Fill the cache & populate the expected values 
/*  SSK_kPSK   - PSK  */
//  No auth constraint == allow access for all 
//     public static void fillDataPackage(byte[] data, int doff, int dlength, XByteBuffer buf) {          int pkglen = getDataPackageLength(dlength); 
//  Render the page footer 
//  First locate all unique functions in this EL 
//  the name 
/*      * Test https://bz.apache.org/bugzilla/show_bug.cgi?id=50413 Serving a     * custom error page      */
//  log the exception so we know it's there. 
// flags 
//  Swallow   Significant API changes would be required to propagate this 
//  Cannot happen: no timeout 
//  Parse error - assume invalid content 
//  Keep a note of sessions that are expired 
//  Flip the compressed payload ready for writing 
//  __end convertMethod 
//  Restore delimiter. 
// ===========================================================================================                    NIO SSL METHODS  =========================================================================================== 
//  ------------------------------------------------------------ Table & cols 
//  Set up the TLS client 
//  -------------------- Metadata --------------------   methods from 1.0 
//  Request may complete before listener has finished processing so wait   up to 5 seconds for the right response 
//  Could be a host/FQDN 
//  An ellipsis is a single character that looks like three periods in a row   and is used to indicate a continuation. 
//  Needs to be set early to avoid NPE during call to containsAlphabetOrPad() below 
//  zero length VariableInfo array 
//  Read the header value 
//  Need to skip escaped characters 
// https://bz.apache.org/bugzilla/show_bug.cgi?id=48613 
//  Could support cancellation by closing the connection 
//  Write out the providers to the temporary new file 
//  Note that there is a similar test:   org.apache.catalina.valves.TestAccessLogValve.testBug54044() 
//  For array types, this is the array 
//  Take copies to avoid threading issues 
//  Now check body size 
//  no leak 
//  other worker conrecte lb's 
//  anti click-jacking 
//  tests context.getResource then the content 
//  __begin convertMethod 
//  ----------------------------------------------------- Instance Variables 
//  Stop the context 
//  Try a field match if no setter match 
//  notify HttpSessionIdListener 
//  entire byte array. This is expensive if only a small subset of the   bytes will be used. The code below is from Apache Harmony. 
// if we timed out, or got interrupted   remove ourselves from the waitlist 
//  noop 
//  If this is an async request then the request ends when it has   been completed. The AsyncContext is responsible for calling   endRequest() in that case. 
//  Log this request, as it has probably skipped the access log.   The log() method will take care of recycling. 
/*      * Expected behaviour for the addition of files.     *     * Artifacts present   copyXML  deployXML  Artifact   Artifacts remaining     * XML  WAR  EXT  DIR                       Added      XML  WAR  EXT DIR   Action     *  N    Y    N    N      N        Y         DIR        -    Y    -   A     None     *  N    N    N    Y      N        Y         WAR        -    A    -   R   Redeploy     *  Y    N    N    N      N        Y         DIR        Y    -    -   A     None     *  N    N    N    Y      N        Y         XML        A    -    -   Y   Redeploy     *  Y    N    N    N      N        Y         WAR        Y    A    -   -    Reload     *  N    Y    N    N      N        Y         XML        A    Y    -   -   Redeploy     *  Y    Y    N    N      N        Y         DIR        Y    Y    -   A     None     *  Y    N    N    Y      N        Y         WAR        Y    A    -   N    Reload     *  N    Y    N    Y      N        Y         XML        A    Y    -   Y   Redeploy     *  Y    N    Y    N      N        Y         DIR        Y    -    Y   A     None     *  Y    N    Y    N      N        Y         WAR        Y    A    Y   -     None     *  N    N    N    Y      N        Y         EXT        A    -    A   R   Redeploy     *  N    Y    N    N      N        Y         EXT        A    Y    A   -   Redeploy     *     *  N    N    N    Y     Y/N       N       DIR+XML      -    -    -   Y   Redeploy (failed)     *  N    N    N    Y      Y        Y       DIR+XML      A    -    -   Y   Redeploy     *  N    N    N    Y      N        Y       DIR+XML      -    -    -   Y   Redeploy     *     * Addition of a file  is treated as if the added file has been modified     * with the following additional actions:     * - If a WAR is added, any DIR is removed and may be recreated depending on     *   unpackWARs.     * - If an XML file is added that refers to an external docBase any WAR or     *   DIR in the appBase will be removed. The DIR may be recreated if the     *   external resource is a WAR and unpackWARs is true.     * - If a DIR is added when a WAR already exists and unpackWARs is false,     *   the DIR will be ignored but a warning will be logged when the DIR is     *   first detected. If the WAR is removed, the DIR will be left and may be     *   deployed via automatic deployment.     * - If a WAR is added when an external WAR already exists for the same     *   context, the WAR will be treated the same way as a DIR is treated in     *   the previous bullet point.      */
//  Ping ack (only for second ping) 
//  synchronized (fis) { 
//  ServerEndpointConfig 
//  Make sure DefaultServlet is serving resources relative to the   context root regardless of where the it is mapped 
//  One for the client, one for the server 
//  ==================== Manipulating the class ==================== 
//  Text decoder - ignore it 
//  Trigger the creation of the AWT (AWT-Windows, AWT-XAWT,   etc.) thread. 
//  Missing uriRoot will be handled in the caller. 
//  Store nested <Valve> element 
//  relative to the map/mount point 
//  NO-OP - No body to echo 
//  If using the async handler can't get the thread name from the   current thread. 
//  A duplicate Alias for the same Host.   A harmless redundancy. E.g.   <Host name="localhost"><Alias>localhost</Alias></Host> 
//  Skip this pattern 
//  Standard command to list the ciphers 
//  First check the lists have the same entries 
//  ALPN requires TLS so if TLS is not enabled, ALPN cannot be supported 
//  Removing welcome files 
//  Still more headers to write, need to flush 
//  Query Request Processors 
//  Acquire the set of application notifications 
//  Make the underlying array of ThreadLoad.ThreadLocalMap.Entry objects 
//  Skip: JSP.7.3.1 
//  ----------------------------------------------------- Internal properties 
//  Avoid adding the close header twice 
//  Remove this childless stream 
// we have idle threads, just add it to the queue 
//  Retrieving the OpenEJB factory 
// *********************************************************************   Private utilities 
//  0xa0 = 160 = &nbsp; character 
//  No flags   Stream is zero   Payload 
//  Potential to remove key   Upgrade to write lock 
//  If node is null then it's just a group marker 
//  Start our child containers, if not already started 
//  Wait for the threads to finish 
// =========================================================================   OVERRIDE THESE METHODS TO IMPLEMENT THE REPLICATION 
//  NOOP - Trust everything 
//  Removing security role 
//  On context stop this can be called multiple times.   NO-OP is the ticker thread is not set   (i.e. stop() has already completed) 
//  No need to declare Java variables, if we inside a   JspFragment, because a fragment is always scriptless.   Thus, there is no need to save/ restore/ sync them.   Note, that JspContextWrapper.syncFoo() methods will take   care of saving/ restoring/ sync'ing of JspContext attributes. 
//  There is only one stratum (JSP) so skip to the start of the file 
//  Delay accepting of new connections until data is available   Only Linux kernels 2.4 + have that implemented 
//  Result will likely be smaller than this 
//  NO-OP 
// return cached result, if we have it 
//  response body. 
//  Validate the data 
// parse the CRLF immediately 
//  Process the requested command 
//  Only wrap if needed 
//  Basic linking and unlinking operations, called only while holding lock 
//  Skip the blank after the 100 Continue response 
//  Calculate chunk header 
//  Configure the content encoding for compressed content 
//  The smaller the increment, the larger the overhead 
//  comma, semi-colon and space as defined by netscape 
/*  Obtaining the last modified time opens an InputStream and there is no         * explicit close method. We have to obtain and then close the         * InputStream to avoid a file leak and the associated locked file.          */
//  a is set, b is not, c is empty 
//  Assume false on failure for safety 
/*      * Flag as error if an unbalanced end tag appears by itself.      */
//  A value of more than 1 here is unlikely but possible depending on   how threads are scheduled. This has been observed as high as 12 
//  Does this web application delegate first for class loading? 
//  Start the instance 
//  in a fragment or in a tag file. 
//  Erase any previous groups and users 
//  that was just substituted. 
//  ----------------------------------------------------------- Data members 
// the temp variables name 
//  Add the new instance to its parent component 
//  Determines the CORS request type. 
//  N.B. Streams.copy closes the input stream 
//  ----------------------------------------------- Class/Instance Variables 
//  For a given Java line number, provide the associated line number   in the JSP/tag source 
/*  Third step: not found in cache, adjust cache and add item  */
//  Perform new deployment 
//  Can't embed EL in a script expression 
//  case but it makes tracking the current cache size easier. 
//  Should never happen - all JVMs are required to support UTF-8 
//  If not SingleThreadModel, no action is required 
//  There is a count 
//  ALPN 
//  This will map the the latest version by default 
//  IPv4 inside IPv6 
//  Post work directory 
/*      * Expected behaviour for deployment of a DIR with an embedded XML file.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *     N        Y/N       Y/N           N    N    Y     *     Y         N        Y/N           N    N    Y     *     Y         Y        Y/N           Y    N    Y      */
/*              * Password must have changed -> destroy connection and keep retrying until we get a new, good one,             * destroying any idle connections with the old password as we pull them from the pool.              */
/*      * Verify the timeout mechanism works for BASIC sessions. This test     * follows the flow of testBasicLoginSessionPersistence (above).      */
//  Need to start the newly found resources 
//  We need to extend MemoryRealm to avoid class cast 
//  Add any additional headers 
//  Document the servlet context properties 
//  Verify there are no Catalina MBeans 
//  Output footer: 
//  Store nested <Receiver> element 
//  Never trust the client 
// make sure that any old values get removed 
//  Return the information we have gathered in a new object 
//  Registering ELResolver with JSP container 
//  Valid new stream reduces the overhead count 
//  Set because we don't want duplicates 
//  make sure the listeners know about it. 
//  Stage 3. Separate into three groups 
/*  Permit unsafe legacy renegotiation  */
// catch incoming 
//  Normalization 
//  Reset the response (keeping the real error code and message) 
//  Skip surrounding quotes if there are any 
//  included in the defaults so it may be configured. 
//  Compile (if necessary) and load the tag files referenced in 
//  web-application. 
/* --Instance Getters/Setters-------------------------------- */
//  Construct and cache the Principal for this user 
//  Might not be an IPv4 address. Could be a host name or a FQDN with   fully numeric components. Go back to the start and parse as a   host / FQDN. 
//  Jasper 
//  Check null args are OK 
// createStatement 
//  Return true because it is always safe to make a read attempt 
// We can't assume the included servlet flushed its output 
// if we need more network data, then bail out for now. 
//  This should trigger a connection error 
//  Read class methods, i.e., the functions in the class 
//  Store nested <Alias> elements 
//  Make sure WebdavServlet is serving resources 
//  selector pool for blocking operations 
//  Undeploy application 
/*  If set, a server will allow a client to issue an SSLv3.0 version number     * as latest version supported in the premaster secret, even when TLSv1.0     * (version 3.1) was announced in the client hello. Normally this is     * forbidden to prevent version rollback attacks.  */
//  Test "addConnectorPort" and with port matching only in deny 
//  Ignore token which only consists of prefix character 
//  Make sure we get a 405 response which indicates that test.jsp is   complaining about being called with the PUT method. 
//  On subsequent exceptions, start the delay at 50ms, doubling the delay 
//  As per EG discussion, all other empty segments are   invalid 
//  First try resolving using the publicId 
//  transaction completes 
// default scope is "page". 
//  This should be a Request attribute... 
//  Add an SCI with an interest in Objects - i.e. everything 
//  IDEA_128_CBC_WITH_MD5 
//  check to see if we are about to execute a query 
/*      * invalid decoded credentials cases      */
//  If the processor has set the scheme (AJP does this, HTTP does this if   SSL is enabled) use this to set the secure flag as well. If the 
//  Operation 
//  Need to be holding the stream lock so releaseBacklog() can't notify   this thread until after this thread enters wait() 
//  These are the same settings as the default   AsynchronousChannelGroup 
//  Now check the potentially uncovered patterns 
//  receive member start 
//  No flags   Stream ID 0 
//  Over-ridden methods to improve performance 
//  Process the property setting change 
//  org.apache.catalina.tribes.TesterMulticast 
//  key: attribute val: setter method 
//  Severity 
/*              * The non-writer use cases read the target file as bytes. These             * cases therefore reduce to can the bytes from the target file be             * included in the output without corruption? The character used in             * the tests has been chosen so that, apart from iso-8859-1 and             * cp1252, the bytes vary by character set.             * (Assuming any BOM is always skipped in the included output.)              */
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=60116 
//  does not change the order. 
/*                      * Use the filename of the tag file, without the .tag or                     * .tagx extension, respectively, as the <name> subelement                     * of the "imaginary" <tag-file> element                      */
//  Expire any associated sessions 
//  Parsing timeout header 
// compact the buffer 
//  Document the servlet context initialization parameters 
//  If there is a previous match for the same property, remember 
/*      * write an attribute in the HttpSession - %{xxx}s      */
//  Build window update frame for stream 0 
//  Small buffer to make the process slow 
//  File.lastModified() has a resolution of 1s (1000ms). The last   modified time has to be more than 1000ms ago to ensure that   modifications that take place in the same second are not   missed. See Bug 57765. 
/*      * Choreograph the steps of the test dialogue with the server     *  1. while not authenticated, try to access a protected resource     *  2. respond to the login challenge with good credentials     *  3. after successful login, follow the redirect to the original page     *  4. repeatedly access the protected resource to demonstrate     *     persistence of the authenticated session     *     * @param resourceMethod HTTP method for accessing the protected resource     * @param redirectMethod HTTP method for the login FORM reply     * @param useContinue whether the HTTP client should expect a 100 Continue     * @param clientShouldUseCookies whether the client should send cookies     * @param serverWillUseCookies whether the server should send cookies     *      */
//  These are TLS v1.3 cipher suites   Java does not currently support these so they are excluded from the   testing.   Note: If OpenSSL is used then some of these may be available         depending on the OpenSSL version used and the defaults for that 
//  Print entries for each defined role, group, and user 
//  Empty value (not necessarily valid but checking edge cases in filter) 
//  Avoid overflow 
//  applies to the request path 
//  This is the junit assertion being thrown 
//  Servlet 4.0 
//  Also remove the cookie header since it will be regenerated 
//  Document the session attributes 
//    - convert the decodedURI to bytes 
// read in the status 
//  willDecode() method means this decoder may or may not   decode a message so need to carry on checking for   other matches 
/*  A single item can either be of the form name=method                         * or just a property name (and we will use a standard                         * setter)  */
// not correct, we need to maintain the map 
//  Use a POST no role - should be blocked 
//  Serialize 
//  Configure logging filter to check leak message appears 
//  Record length 0 (correct, but not legal) 
/*      * Initializes this JspServlet.      */
//  Store nested <Loader> elements 
//        version 
//  Check for resources modification to trigger redeployment 
//  Timeout thread (where used) checks for timeout every second 
//  ------------------------------------------------------ Private Classes 
//  Enable pre-emptive auth 
//  Null the hard reference in the parent 
//  What did we run out of? 
//  Store nested <ClusterListener> elements 
//  avoid possible resource leak 
// ============================================================================================================                OVERRIDDEN METHODS FROM CHANNEL INTERCEPTOR BASE 
//  Tracking the base name and the latest valid version found is   sufficient to be able to create the renaming map required 
//  Limits 
//  transaction was rolled back... proceed as if there never was a transaction 
//  --------------------------------- SocketWithOptionsProcessor Inner Class 
//  Persist Configuration Section 
//  Evaluate conditions 
// add the EOS bytes if we have not finished on a single byte 
//  Should not happen. To late to send batched messages now since   the session has been closed. Complain loudly. 
//  Change stream Id and re-use 
//  Don't know which MS client it is - try the redirect with an   explicit port in the hope that it moves the client to a different   WebDAV implementation that works 
/*      * Tests the that supports credentials may not be enabled with any origin,     * '*'.     *     * @throws ServletException      */
//  multiple headers 
//  Convert to array form of class name 
//  Add Tag 
//  18 bits = 8 + 8 + 2 
/*      * Checks an element's given URI, qname, and attributes to see if any     * of them hijack the 'jsp' prefix, that is, bind it to a namespace other     * than http://java.sun.com/JSP/Page.     *     * @param uri The element's URI     * @param qName The element's qname     * @param attrs The element's attributes      */
// ---------------------------------------- 
//  welcome-file-list merge control 
//  Deploy the web application for this user 
//  Forward 
//  Compute attribute value string for XML-style and named 
//  ignore access or connection open errors 
//  Double checked locking. OK because instance is volatile. 
//  End 
//  set non-blocking mode for the listening socket 
//  Java 8 doesn't support multi-release so default to false 
//  CCM ciphersuites from RFC6655 
//  An async request was started during the forward, don't close the   response as it may be written to during the async handling 
/*      * Marker class used because null values are not permitted in a     * ConcurrentHashMap.      */
//  Parse range specifier 
//  Always set secure if the request is secure 
//  each item into the map using the PooledObject object as the   key. It then gets sorted based on the idle time 
//  Check that the right number of bytes were received 
//  The bytes processed are only updated in the completion handler 
//  Retrieving the lock associated with the lock-null resource 
//  Based on report from users list that ':' was encoded and breaking   the redirect 
//  Constant for "no parameters" when invoking a JMX operation 
//  Explicitly overwrite value to ensure data consistency in   current thread 
//  match found 
//  Clear out authenticated user ready for next iteration 
//  Return the pool if we have already created it   This is double-checked locking. This is safe since dataSource is   volatile and the code is targeted at Java 5 onwards. 
//  Construct a digester to read the XML input file 
//  ------------------------------------------- NotificationListener Methods 
//  ------------------------------------------------------- Lifecycle methods 
//  Long   Double 
//  Cache the authentication information in our request 
//  Write from main buffer first 
//  XXX - Returns boolean because if a tag is invoked from   within this fragment, the Generator sometimes might   generate code like "return true". This is ignored for now,   meaning only the fragment is skipped. The JSR-152   expert group is currently discussing what to do in this case. 
//  Special case for the Context Root mapping which is   treated as an exact match 
// do catch 
//  If a read is pending, reading is not possible until a notification is sent 
//  Select only Rules that match on the specified namespace URI 
// package looks like  start package TRIBES_MBR_BEGIN.length  package length - 4 bytes  alive - 8 bytes  port - 4 bytes  secure port - 4 bytes  udp port - 4 bytes  host length - 1 byte  host - hl bytes  clen - 4 bytes  command - clen bytes  dlen - 4 bytes  domain - dlen bytes  uniqueId - 16 bytes  payload length - 4 bytes  payload plen bytes  end package TRIBES_MBR_END.length 
//  Do something 
// MapMessage 
//  register the xa resource for the connection 
//  Monitoring methods 
//  not valid. 
// should actually return OP_READ if we have NEED_UNWRAP 
//  Close the socket since this is   the end of the not keep-alive request. 
//  Java supported character sets do not use BOMs longer than 4 bytes 
// mimic APR behavior 
//  1 * error (could be in any order) 
//  If modified date or length change - resource has changed / been   removed etc. 
// reduce byte copy 
//  Setup the minimal response information 
//  Invoke the next Valve in our pipeline 
//  Always reset the flag to false so the optimisation is not applied   inappropriately 
//  No flags 
//  Deal with the firewalls that tend to drop the inactive sockets 
//  to be null 
//  Expand the stream window too much to trigger an error 
//  Collect "load on startup" servlets that need to be initialized 
//  Guard against multiple destroyPools() calls triggered by construction exception and finalize() later 
//  Check the position and contents 
//  Create worker collection 
//  Some calling code assumes buffer will not be compacted 
//  Unexpected dispatch type for this test 
//  ----------------------------------------------------- DataSource Methods 
//  Bug 57446. Same ServletContext should be presented as at init 
//  Set certificate 
//  write result 
//  Base assumption in Java 7 
//  And the handling for 404 responses 
/*      * stop cluster wide deployments     *     * @see org.apache.catalina.ha.ClusterDeployer#stop()      */
//  If an async request was started, is not going to end once   this container thread finishes and an error occurred, trigger 
//  Now stop the connectors 
//  should not happen, just ignore 
// if the escapeXml is specified, assign the value to it; 
//  Not a parameter - values must match 
//  Don't reset anything that is read from a <Context.../> element since   <Context .../> elements are read at initialisation will not be read   again for this object 
//  > 11110111 
//  Add Section 
//  Long.MAX_VALUE + 3 
//  Make sure GET works properly 
//  b.addBeforeOrderingOthers(); 
//  Read upto 128 bytes and then return a 403 response 
//  First byte is special case 
//  Add missing components as necessary   (1) Required by Loader 
// Create and set up the content pane. 
//  Trim trailing white spaces 
// unable to get buffer size 
/*  Generated By:JJTree: Do not edit this line. AstDotSuffix.java  */
//  --------------------------------------------------- OutputStream Methods 
//  and the trailer fields sent 
//  - 101 response acts as acknowledgement of the HTTP2-Settings header   Need to read 5 frames   - settings (server settings - must be first)   - settings ack (for the settings frame in the client preface)   - ping   - headers (for response)   - data (for response body) 
// switch  for 
//  Trim provided encoding name and convert to lower case since transfer   encoding names are case insensitive. (RFC2616, section 3.6) 
//  Access rights of parsed class   Names of implemented interfaces   collection of constants   "RuntimeVisibleAnnotations" attribute defined in the class 
//  Append the message 
//  In these three cases processing is on a container thread so no   need to transfer processing to a new container thread 
//  Skip non serializable attributes 
//  Check to see if the engine wrote data into the network BIO 
//  Terminating CRLF 
//  save values collected so far 
//  setup both NonLogin, Login and digest webapps 
//  If there are not sessions left in the SingleSignOnEntry, 
//  Invalid UTF-8 
//  grow in larger chunks 
//  Create a new byte buffer if anything changed 
// catch the el exception and throw it as a JspException 
//  Check all received messages to make sure they are not corrupted 
//  No %nn sequences, so return string unchanged 
//  Establish a LoginContext to use for authentication 
//  Record length 4 
//  Set up standard connection characteristics 
//  abs_uri, this was not found in the taglibMap so raise an error 
//  Attempt to consume any leftover byte if something bad happens,   such as a socket disconnect on the servlet side; otherwise, the   external process could hang 
//  Is parent a SimpleTag? 
//  by a non annotated method in clazzPojo, they should be ignored 
//  TODO Allocate anyway and ignore eviction test 
//  Unknown stage 
//  Aborted upload or similar.   No point reading the remainder of the request. 
//  v2 cookie attributes - skip them 
//  Version should never be null 
//  VERIFY IMAGE/GIF 
//  Default implementations for BodyTag methods as well   just in case a tag decides to implement BodyTag. 
//  print(Node) 
//  "normal" attributes 
/*  * Implementation notes: * * Any operation that acts on a single element of the database (e.g. operations * that create, read, update or delete a user, role or group) must first obtain * the read lock. Operations that return iterators for users, roles or groups * also fall into this category. * * Iterators must always be created from copies of the data to prevent possible * corruption of the iterator due to the remove of all elements from the * underlying Map that would occur during a subsequent re-loading of the * database. * * Any operation that acts on multiple elements and expects the database to * remain consistent during the operation (e.g. saving or loading the database) * must first obtain the write lock.  */
//  Long.MAX_VALUE + 1 
//  Name cannot be null 
//  These are the resource types for determining effect error messages 
// return to cache 
//  if type is unspecified, use "class" as type of bean 
//  Change the database on the disk and reload 
//  Numbers 
//  Transient only          setId((String) stream.readObject()); 
//  No UA or starts with non MS value   Hope everything just works... 
//  Declare writer used for storing result of fragment/body invocation 
//  Deregister from the old Context (if any) 
// else look at Host config 
//  session.lastAccessedTime, so call it only once before other work. 
//  Load our defined Principals 
//  add unescaped portion 
//  This means there are no registered listeners 
// This shouldn't happen, since all the variable names must   have values 
//  Store the assembled class path as a servlet context attribute 
//  Get the FilterChain Here 
//  Validate the input parameters 
//  Do not configure more than once 
//  Check to see if this element has been removed too quickly 
//  If either lock is exclusive, the lock can't be   granted 
// allow everything to shutdown 
// don't do anything--we just wanted to skip a char 
//  Check an exact match. Simple case as there are no templates. 
//  Add a single Access-Control-Allow-Origin header, with the value   of the Origin header as value. 
//  Error handling 
//  Wait for the sendfile thread to exit, otherwise parallel   destruction of sockets which are still in the poller can cause 
//  Move back to start of EL 
/*  * Listener to provider informations to mod_heartbeat.c * *msg_format = "v=%u&ready=%u&busy=%u"; (message to send). * send the multicast message using the format... * what about the bind(IP. port) only IP makes sense (for the moment). * BTW:v  = version :-)  */
//  bind address will be null which means any/all local addresses   which should be safe 
//  task 
/*      * Try to access an unprotected resource in a webapp that     * has a BASIC login method defined.     * This should be permitted without a challenge.      */
//  First byte ED, second byte 80..9F 
//  @ServletSecurity(@HttpConstraint(EmptyRoleSemantic.DENY)) 
//  5 minutes 
//  Stick it on the resolved node stack 
//             TestThread t = new TestThread();              t.setName("tomcat-pool-validate-"+i);              t.d = this.c3p0Datasource;              t.start();          }          latch.await();          long delta = System.currentTimeMillis() - start; 
//  Response has been committed - need to see if chunked is being used 
//  use StatusTransformer to output status 
//  Prevent further writes to the response 
//  Simple dispatch with query strings 
//  Add it to the queue 
//  Unrecognised version.   Ignore this header. 
//  Allowed roles should be the union of the roles in the constraints   * is any app role   User has no role 
//  TimerThread can be stopped safely so treat separately   "java.util.TimerThread" in Sun/Oracle JDK 
//  Build the simple request on an old stream 
/* -             * PATH_INFO should be determined by using sCGIFullName:             * 1) Let sCGIFullName not end in a "/" (see method findCGI)             * 2) Let sCGIFullName equal the pathInfo fragment which             *    corresponds to the actual cgi script.             * 3) Thus, PATH_INFO = request.getPathInfo().substring(             *                      sCGIFullName.length())             *             * (see method findCGI, where the real work is done)             *              */
//  Prepare OpenSSL to work in server mode and receive handshake 
//  first try with existing connection 
// TRIBES_MBR_BEGIN 
// If we are here, then we have already stopped processing, so all   is good 
//  ----------------------------------------------------------- getManifest() 
//  __end lookupReadMethodMethod 
//  Default servlet 
//  (2) Search local repositories 
//  that were registered as a side-effect of this code. 
// -------------------------------------------------------------- Properties 
//  Last guess: iterate over all attributes, to find a java.security.Principal or javax.security.auth.Subject 
//  Calculate no of objects needed to be created, in order to have 
//  Need to use a different algorithm to the other tests otherwise if one   of the other tests is called first it will initialise the   ConcurrentDigest for that algorithm. 
//  The last pad amount is left in the buffer.   Boundary can't be in there so signal an error   condition. 
//  Seems like there is no way to explicitly disable SSLv2Hello 
//  Found the start of a %nn sequence. Copy everything from the last   end to this start to the output. 
//  In case the sendfile thread is in the idle wait 
// perform a blocking read  register OP_WRITE to the selector 
//  Write out contents to a temporary file 
//  Servlet 3.1 non-blocking I/O 
//  Ignore. Enjoy the irony. 
//  An ellipsis is three bytes in UTF-8 
//  Disable any regular write notifications caused by registerWriteInterest 
//  are any whitespace characters significant?  Append 'em if we've got 'em. 
//  Requires a 6GB heap (on markt's desktop - YMMV) 
//  If no content length was set, just write the bytes 
//  Flags. end of stream (0x01) 
//  Should not fail 
//  JspC is not affected by annotations so skip that processing, proceed to merge 
//  Should list GET and POST as omitted methods 
//  Domain Name - invalid 
//  Current value of jsp:id attribute 
/*  * This class implements a parser for EL expressions. * * It takes strings of the form xxx${..}yyy${..}zzz etc, and turn it into a * ELNode.Nodes. * * Currently, it only handles text outside ${..} and functions in ${ ..}. * * @author Kin-man Chung  */
//  Parse conditions 
// *********************************************************************   Methods to add mapping information 
//  Deallocate the allocated servlet instance 
//  Host should never be null 
//  Add protected servlet to the context 
/*          * Gets this custom tag's custom nesting level, which is given as the         * number of times this custom tag is nested inside itself.          */
//  No secureRandomClass or creation failed. Use SecureRandom. 
//  Effectively unlimited for this test 
//  needed 
//  Swallow silently - it should be recoverable 
//  handles <jsp:setProperty> with EL expression for 'value' attribute 
/*          * Add the primitive converter method if we need to.          */
//  Load the collected "load on startup" servlets 
//  Continue reading frames 
//  if this event occurred because we were validating, ignore it   otherwise return the connection to the pool. 
//  Can't use Class<?> because API needs to match specification 
/*  JavaCC - OriginalChecksum=7f2694086a9ba64558ee39d1cd719db1 (do not edit this line)  */
//  Assume that the return type and the name are separated by   whitespace. Given the use of trim() above, there should only   be one sequence of whitespace characters. 
//  HTTP 1.0 test 
//  mb is either CHARS or BYTES.   this is either CHARS or BYTES   Deal with the 4 cases ( in fact 3, one is symmetric) 
//  Check the result 
/*      * Currently this is only called from the background thread so we could just     * call clearHandler() with useDispatch == false but the method parameter     * was added in case other callers started to use this method to make sure     * that those callers think through what the correct value of useDispatch is     * for them.      */
/*                  * On some platforms (e.g. Linux) it is not possible to bind                 * to the multicast address. In this case only bind to the                 * port.                  */
/*  If set, always create a new key when using tmp_eddh parameters  */
//  Set the default URL caching policy to not to cache 
/*      * Parses an include directive with the following syntax: IncludeDirective     * ::= ( S Attribute)*      */
//  -------------------- Actions -------------------- 
//  Deregister the destroyed instance 
//  Make sure we have a memory leak 
/*  * A potential future enhancement is to allow writing to any ResourceSet, * not just the main ResourceSet although that adds all sorts complications * including: * - which ResourceSet to write to * - unexpected behaviour when deleting a resource from one ResourceSet since *   that may unmask a resource in a lower priority ResourceSet so what was a *   delete looks like a replace with the user having no idea where the 'new' *   resource came from * - how to handle PUT when the target is read-only but it could be written to *   a higher priority ResourceSet that is read-write  */
/*  Headers are first parsed and stored in the order they are   received. This is based on the fact that most servlets will not   directly access all headers, and most headers are single-valued.   ( the alternative - a hash or similar data structure - will add   an overhead that is not needed in most cases )   Apache seems to be using a similar method for storing and manipulating   headers.   Future enhancements:   - hash the headers the first time a header is requested ( i.e. if the   servlet needs direct access to headers).   - scan "common" values ( length, cookies, etc ) during the parse   ( addHeader hook ) */
//  The session was closed during onOpen. No need to register it. 
//  Open a new connection 
//  Make sure the lock is removed 
//  HTML decoding 
//  Have to support old JSP EL API 
//  compile with debug info 
//  XXX Get it from tag file name 
//  For primitive types and string type, this points to the value entry in   the cpool   For 'class' this points to the class entry in the cpool 
//  Validate our current state information 
/*          * This ensures that the context response encoding is represented by a         * unique String object. This enables the Default Servlet to         * differentiate between a Response using this default encoding and one         * that has been explicitly configured.          */
//  No need to get the tagLibInfo objects. This alos suppresses   parsing of any tag files used in this tag file. 
// we temporarily change strftime. Since SSIMediator is inherently   single-threaded, this  isn't a problem 
//  No Range header is the same as ignoring any Range header 
//  Use NIO by default 
/*  Tracks the current position of the parser in the input String.  */
//  Only prune every 10 new streams 
//  Value finished 
//  Fire "begin" events for all relevant rules 
//  EBCDIC   a la xerces1, return CP037 instead of EBCDIC here 
//  See if we need to replace the query string 
//  The legacy processor removes the quotes for domain and path 
// else assign the result to the target.property 
//  Stop our application listeners 
//  If something went wrong, delete expanded dir to keep things   clean 
/*      * Get the connection to a point where 1k of 8k response body has been     * read and the flow control for the stream has no capacity left.      */
//  This one collides with HTTP 1.1   "418 Reauthentication Required" 
//  Performance short-cut available when running on Tomcat 
//  set up response, InternalOutputBuffer, and ByteArrayOutputStream 
//  Not HTTP/1.1 - no Host header so generate one since   Tomcat internals assume it is set 
//  The HTTP/2 specification recommends a minimum default of 100 
/*      * TemplateTextBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.'     * XMLDirectiveBody ) | ( '<%!' <TRANSLATION_ERROR> ) | ( '<jsp:declaration'     * <TRANSLATION_ERROR> ) | ( '<%=' <TRANSLATION_ERROR> ) | ( '<jsp:expression'     * <TRANSLATION_ERROR> ) | ( '<%' <TRANSLATION_ERROR> ) | ( '<jsp:scriptlet'     * <TRANSLATION_ERROR> ) | ( '<jsp:text' <TRANSLATION_ERROR> ) | ( '${'     * <TRANSLATION_ERROR> ) | ( '<jsp:' <TRANSLATION_ERROR> ) | TemplateText      */
//  Register endpoint (as ThreadPool - historical name) 
/*          * Known behaviours of reverse proxies that are handled by the         * processing below:         * - mod_header converts the '\n' into ' '         * - nginx converts the '\n' into multiple ' '         *         * The code assumes that the trimmed header value starts with         * '-----BEGIN CERTIFICATE-----' and ends with         * '-----END CERTIFICATE-----'.         *         * Note: As long as the BEGIN marker and the rest of the content are on         *       separate lines, the CertificateFactory is tolerant of any         *       additional whitespace.          */
//  thread so give that thread a chance to complete its work. 
//  Trying to read data beyond the end of the AJP message 
/*      * Test attempting to access special paths (WEB-INF/META-INF) using WebdavServlet      */
/*  Import needed classes  */
//  Check that a WAR or DIR in the appBase is not 'hidden' 
//  Should be a header message 
//  Need more data before the partial data can be   processed and some output generated 
//  Start the threads 
/*      * Tests if a GET request is treated as simple request.     *     * @See http://www.w3.org/TR/cors/#simple-method     * @throws IOException     * @throws ServletException      */
//  Recycle response object 
//  Won't happen 
//  Request terminator 
//  autoCommit may have been changed directly on the underlying 
//  Check for fileID 
//  Ping 
//  Flag indicating whether we have already determined the parent 
//  Is a new connection coming in? 
//  No TLS handshaking required. Let the handler   process this socket / event combination. 
//  Will use management operations to configure the valve dynamically 
//  Any host in the request line must be consistent with   the Host header 
//  Is this an exploded web application? 
//  Copy data in oldRevisionContent to contentFile 
//  Rule 4b -- Welcome resources processing for prefix match 
//  Parse the substitution 
//  Expose filter via JMX 
//  There are two known issues with XML parsing that affect   Java 8+. The issues both relate to cached Exception   instances that retain a link to the TCCL via the   backtrace field. Note that YourKit only shows this field   when using the HPROF format memory snapshots.   https://bz.apache.org/bugzilla/show_bug.cgi?id=58486   https://bugs.openjdk.java.net/browse/JDK-8146961 
//  Need non-zero 1st and 6th tokens 
//  Check ordering, for BZ 54391 
// class CGIEnvironment 
//  Need a Context, Loader and ClassLoader for checkHandleTypes 
//  Warning: JSP attribute escaping != Java String escaping   Warning: Attributes are always unescaped before passing to the EL 
//  FIXME 
//  Note: This also matches the terminating '}' at which point         nesting will be set to -1 - hence the test for 
/*      * Gets this Node's attributes.     *     * In the case of a Node parsed from standard syntax, this method returns     * all the Node's attributes.     *     * In the case of a Node parsed from XML syntax, this method returns only     * those attributes whose name does not start with xmlns.      */
/*  JavaCC - OriginalChecksum=ce956594ca572a4e452fe4f084a03099 (do not edit this line)  */
//  to be challenged with 401 SC_UNAUTHORIZED. 
//  It's a regular expression and the end is the next unescaped / 
// check add suspects members if they are alive now, 
//  Include the specification if provided 
//  Parse the comma separated list. "identity" codings are ignored 
/*      * After a failed authentication, add the record of the failed     * authentication.      */
//  until the timeout kicks in 
//  do not throw this exception because we are in the middle   of handling another exception. But record it because   it potentially leaks connections from the pool. 
//  Loader will be null for FailedContext instances 
//  Check for ping OPTIONS * request 
//  e.addAfterOrderingOthers(); 
//  Connection level attributes 
// continue to unwrapping as long as the input buffer has stuff 
// if the message was accepted by an RPC channel, that channel  is responsible for returning the reply, otherwise we send an absence reply 
// get the step value from "step" if specified. 
//  Remove the specified alias 
//  Copy headers 
//  for TLD 2.0 and later, jsp-version is set by version attribute 
//  Check the user's credentials 
// wrap should always work with our buffers 
//  Populate the extension validator with JARs from common and shared 
//  Parse and remove a prefix (prefix start with a digit, such as   "10WebappFooHandler.") 
//  Name finished. Value starts from next character 
//  Connection was closed by Tomcat 
//  Otherwise throw the exception wrapped inside a ServletException.   Set the exception as the root cause in the ServletException   to get a stack trace for the real problem 
//  PooledSender Attributes 
//  Check for nested jsp:body or jsp:attribute 
//  Test message. The message size is random. 
//  Section 6.2.3 
//  Looking up the package 
//  separate attributes 
//    Note that this means NO servlet supports whatever   method was requested, anywhere on this server.   
//  avoid temporary adding member. 
//  Method has wrong number of parameters 
//  Ran out of input data - get some more 
// AttributeInfo - in an array 
/*      * Open a temporary file     * @param templ The template to use when creating a temp file.     * @param flags The flags to open the file with. If this is zero,     *              the file is opened with     *              APR_CREATE | APR_READ | APR_WRITE | APR_EXCL | APR_DELONCLOSE     * @param pool The pool to allocate the file out of.     * @return The apr file to use as a temporary file.     *     * This function  generates  a unique temporary file name from template.     * The last six characters of template must be XXXXXX and these are replaced     * with a string that makes the filename unique. Since it will  be  modified,     * template must not be a string constant, but should be declared as a character     * array.     * @throws Error An error occurred      */
//  Populate the corresponding properties of the top object 
/*  * Ensures the Stockticker is shut down cleanly when the context stops. This * also covers the case when the server shuts down.  */
//  Need at least one SSL enabled connector to use the SSL session ID. 
//  Process the P2 list 
//  Call the servlet the second time with a request parameter 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=63246   Take a local copy as the dispatch may complete the   request/response and that in turn may trigger recycling of this   object before the in-progress count can be decremented 
//  backlog. 
//  Swallow response message 
//  Check to see if the processor is in an error state. If it is, 
//  No destination. 
//  Store the beginning of this element 
//  So first, subtract the current timestamp 
//  One way or another, response.sendError() will have been called before   execution reaches this point and suspended the response. Need to 
//  helper class 
//  calling close twice should have no effect 
//  Section 6.2.2 
//  TCK signature test fails with annotation 
// this means that there are no available workers 
// end of stream, and no more packages to process 
//  Add RuleSets for nested elements 
//  the currentThreadCount could be 0 before the threads are created...   Integer iready = (Integer) mBeanServer.getAttribute(objName, "currentThreadCount"); 
//  create a new Selector for use below 
//  Responses with certain status codes are not permitted to include a 
//  Cipher 0x00FF  TLS_EMPTY_RENEGOTIATION_INFO_SCSV 
//  skip '<' 
//  Connection factory properties 
//  Special handling for XML settings as the context setting must   always override anything that might have been set by an application. 
//  Add init parameter to specify JSP file 
//  Set the system properties for an HTTP proxy on 192.168.0.100:80   I used an httpd instance configured as an open forward proxy for this   Update the IP/hostname as required 
//  Log pre-service information 
//  Anti click-jacking 
//  NOTE: Keys must always be removed from both poolMap and         poolKeyList at the same time while protected by         keyLock.writeLock() 
//  Response will have cookie deleted 
//  The spec does not define this but the TCK expects the first   definition to take precedence 
//   ----------------------------------------------------- Public Properties 
//  note that all links are created to be relative. this   ensures that we can move the web application that this   servlet belongs to a different place in the url   tree and not have any harmful side effects. 
//  flushes with no content-length set but sets Connection: close header 
//  Close immediately to signal to the client that something went 
//  lookup content-type without charset match (e.g. "text/html") 
// ------------------------------------------------------------------------------                GROUP COM INTERFACES 
//  expand in place 
//  transaction is hosed 
//  Name is known but the Charset is not in the cache 
//  Too small should fail 
//  This is a resource JAR 
//  We know roughly how big the class will be (~ 1K) so allow 2k as a   starting point 
//  ------------------------------------- InputStreamInputBuffer Inner Class 
//  If oname is not null then registration has already happened via   preRegister(). 
//  we found an encoded character.  Reduce the 3 char sequence to one.   but first, make sure we have two characters to work with. 
//  Parse leftover if any are present 
//  May be an EmptyBody, depending on whether   There's a "<jsp:body" before the ETag 
//  Locate bean from context 
/*  Init parameter is in seconds, locally we use milliseconds  */
//  The async dispatch includes a sleep 
//  Read the payload 
//  Allow the JSP to access org.apache.jasper.runtime.HttpJspBase 
//  We don't generate the closing "}" for the "if" here because there   may be whitespaces in between <c:when>'s.  Instead we delay   generating it until the next <c:when> or <c:otherwise> or   <c:choose> 
//  Just log. Still want to destroy. 
// forces the item onto the queue, to be used if the task is rejected 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=60722 
/*      * Uses essentially the same logic as {@link ContainerBase#logName()}.      */
//  Process padding before sending any notifications in case padding   is invalid. 
//  Rule 1 -- Exact Match 
//  Always a fatal IO error 
//  A read only connection should not be committed 
//  Don't need to expand if it already exists 
//  Make sure isReady() and onWritePossible() have a consistent view of   fireListener when determining if the listener should fire 
//  WebSocket key 
/*              * Check to see if the requested JSP has been the target of a             * RequestDispatcher.include()              */
//  for DIGEST and SSL authenticated contexts) 
//  make sure file doesn't exist 
//  Duplicate mapping. As per clarification from the Servlet EG,   deployment should fail. 
//  value being present 
//  Limit access to users in the Tomcat role 
//  than the earliest possible moment 
//  -------------------- -------------------- 
// ----------------- Public methods. 
/*    Issues:   - exceptions - too many "throws Exception"   - double check the interfaces   - start removing the use of the experimental methods in tomcat, then remove     the methods ( before 1.1 final )   - is the security enough to prevent Registry being used to avoid the     permission checks in the mbean server ? */
/*  Now arrange all ciphers by preference:  */
// noop 
//  Skip - nothing to merge 
// perform the unwrap function 
/*      * When this test fails, it tends to enter a long running loop but it will     * eventually finish (after ~70s on a 8-core Windows box).      */
// first make sure all the files are listed in our current status 
//  Open an input stream to the specified pathname, if any   Load the previously unloaded active sessions 
//  blocks until response has been read 
//  BZ 49218: The test fails if JreMemoryLeakPreventionListener is not   present. The listener affects the JVM, and thus not only the current,   but also the subsequent tests that are run in the same JVM. So it is   fair to add it in every test. 
//  Pass 2 - the whole translation unit 
//  Unrecognised. Ignore it. 
//  Complete the message 
//  A Cookie subclass that knows how to compare itself to other Cookie objects 
//  fail to send the authentication cookie to the other webapp. 
//  ejb-local-ref was added in 2.3 so should be excluded in 2.2 
//  Stop our child containers, if any 
// initialise the pool itself 
//  Peek at next character to enable correct method to be called 
//  Need to scan this JAR 
//  pattern is fully covered. 
//  Note if isDeferredSyntaxAllowedAsLiteral==true, \# will   not be treated as an escape 
//  Section 6.2.6 
/*  ------- No validation query -----  */
//  Set back socket to blocking mode 
//  Setting config options doesn't really change the page 
//  Blocking read 
//  - the message is complete 
//  Initialize methods annotations 
// noop for already closed. 
//  Write the 2nd request 
//  Have to get this via a callback as that is the only link we have back   to the defining Realm. Can't use the system property as that may not   be set/correct in an embedded scenario 
//  Takes ~1s on markt's laptop. If this takes more than 5s something   probably needs looking at. If this fails repeatedly then we may need   to increase this limit. 
//  Use random free port 
//  ---------------------------------------------------- Instance Variables 
//  Default timeout for these tests 
//  Used to ensure that only one thread writes to the socket at a time and   that buffer is consistently updated with any unwritten data after the   write. Note it is not necessary to hold this lock when checking if buffer   contains data but, depending on how the result is used, some form of 
//  then any optional http headers 
//  Chains of deleted nodes ending in null or self-links   are possible if multiple interior nodes are removed. 
//  Default connection window size is 64k - 1. Initial request will have 
//  Rethrow any exception that has occurred 
//         createDataPackage(data,doff,dlength,buf.getBytesDirect(),buf.getLength());      } 
//  This one collides with HTTP 1.1   "207 Partial Update OK" 
//  Section 6.2.5 
//  Note: this.jspBeginLineNum is set at the end of this method as it may         be modified (corrected) during the execution of this method 
//  Unknown cookie, complain 
//  Cache has "max=1". The following tests BZ 54732. 
//  read next 2 digits 
//  Don't add or poll if the poller has been stopped 
//  +1 is for the payload byte used to define the padding length 
//  Check for an all roles(role-name="*") 
/*      * Try to access an unprotected resource without an     * established SSO session.     * This should be permitted.      */
//  Getters for basic configuration settings 
//  after the application has finished with the resource 
//  Add all extra arguments to the list of files 
//  Parameter of an @OnError call 
//  Normalize the argument strings 
//  Now that the request/response pair is back under container   control lift the suspension so that the error handling can 
//  Accumulate the names of serializable and non-serializable attributes 
//  1*<any CHAR except CTLs or separators> 
//  NOOP for AJP 
/*  Index of "first" in the cyclic cache  */
//  Rewriting may have denormalized the URL 
// logger 
//  RFC2617 says response is <">32LHEX<">. 32LHEX will also be accepted 
//  array base, Integer response 
/*      * This is also tested implicitly in numerous places elsewhere in this     * class.      */
//  ------------------------------------------------ Session Package Methods 
//  This is a file - strip leading "META-INF/resources" 
//  Section 6.2.4 
//  Skip whitespace 
//  continue with next class to load 
/*          * The spec allows some latitude on when to send the version attribute         * with a Set-Cookie header. To be nice to clients, we'll make sure the         * version attribute is first. That means checking the various things         * that can cause us to switch to a v1 cookie first.         *         * Note that by checking for tokens we will also throw an exception if a         * control character is encountered.          */
//  Methods here 
//  The code that was notified is now writing its data 
//  TODO: Tapestry 4+ 
//  Hide default constructor 
//  ==================== Removal ==================== 
//  Variation on bug 54068 
//  No need to return a valid SSO session ID 
//  Check if WAR needs to be re-expanded (e.g. if it has   changed). Note: HostConfig.deployWar() takes care of   ensuring that the correct XML file is used.   This will be a NO-OP if the WAR is unchanged. 
// register interest op 
//  c.addAfterOrdering("b"); 
//  Look up and remove the corresponding SingleSignOnEntry 
//  Check for incompatible Browser 
// defaultInstance(bean); 
//  Creating war tracker parent (normally META-INF) 
//  prev cannot be null 
//  If we know we are closing the connection, don't drain   input. This way uploading a 100GB file doesn't tie up the   thread if the servlet has rejected it. 
//  5s should be plenty here but Gump can be a lot slower so allow 60s. 
//  In java 6, proxiesHeaderValue should be declared as a java.util.Deque 
//  Has a protocol been specified 
/*  First step: if we have seen this timestamp               during the previous call, return the previous value.  */
//  Init commonly used algorithms 
//  If first byte is invalid, tail will be set to -1 
//  Turn back on output and mark the branch 
//  Enable blocking by default 
//  Don't extract JAR files unless the application is deployed as a   packed WAR file. 
//        requested write has been fully allocated 
//  Ensure XMLInputFactory is loaded with Tomcat's class loader 
//  Whitespace between method and target 
//  Nothing was written 
//  since the loader just started, the webapp classloader is now 
//  The stack always contains the object of the current level 
//  ArrayList of AT_BEGIN scripting variables 
//  Consume the open quote: 
//  WEB-INF/classes will also be included in the URLs returned   by the web application class loader so ensure the class path   scanning below does not re-scan this location. 
//  This is unusual. This name will be ignored. Log the fact. 
/*      * Following cached for speed / reduced GC      */
/*      * PUT is not an allowed request method.     *     * @throws ServletException     * @throws IOException      */
//  Write the number of active sessions, followed by the details 
//  Handle an HTTP path based include 
//  We want something of the form   out.print( " blah=\"" + ... + "\"" ); 
/*      * Get the set of current threads as an array.     * Copied from WebappClassLoaderBase      */
/*      * Receives notification of the end of a Namespace mapping.      */
/*      * Since class loader hierarchies can get complicated, this method attempts     * to apply the following rule: A class loader is a web application class     * loader unless it loaded this class (StandardJarScanner) or is a parent     * of the class loader that loaded this class.     *     * This should mean:     *   the webapp class loader is an application class loader     *   the shared class loader is an application class loader     *   the server class loader is not an application class loader     *   the common class loader is not an application class loader     *   the system class loader is not an application class loader     *   the bootstrap class loader is not an application class loader      */
//  Note: This class is not used for HTTP upgrade so only need to test 
//  If the servlet has been loaded either singleThreadModel will be true   or instance will be non-null 
/*      * Determines the type of expression by looking for the first unquoted ${     * or #{.      */
//  In Tomcat, the order the listeners are set controls the order   that the first calls are made. In this case, the read listener   will be called before the write listener. 
// Cluster configuration start 
/*      * Test case for https://bz.apache.org/bugzilla/show_bug.cgi?id=37794     * POST parameters are not returned from a call to     * any of the {@link HttpServletRequest} getParameterXXX() methods if the     * request is chunked.      */
//  Clients always use JSSE 
//  the point of decoding. 
//  Send the request data (if any) 
/*      * Implemented as a simple doubly-linked list protected by a     * single lock and using conditions to manage blocking.     *     * To implement weakly consistent iterators, it appears we need to     * keep all Nodes GC-reachable from a predecessor dequeued Node.     * That would cause two problems:     * - allow a rogue Iterator to cause unbounded memory retention     * - cause cross-generational linking of old Nodes to new Nodes if     *   a Node was tenured while live, which generational GCs have a     *   hard time dealing with, causing repeated major collections.     * However, only non-deleted Nodes need to be reachable from     * dequeued Nodes, and reachability does not necessarily have to     * be of the kind understood by the GC.  We use the trick of     * linking a Node that has just been dequeued to itself.  Such a     * self-link implicitly means to jump to "first" (for next links)     * or "last" (for prev links).      */
/*                  * The only place that sets JSP_EXCEPTION is                 * PageContextImpl.handlePageException(). It really should set                 * SERVLET_EXCEPTION, but that would interfere with the                 * ErrorReportValve. Therefore, if JSP_EXCEPTION is set, we                 * need to set SERVLET_EXCEPTION.                  */
//  no big deal, just assume it was off 
//  pool is closed, so close the connection 
//  Configure our directory context environment. 
//  distributable 
//  for now we don't write out the Detailed state in XML 
//  Set our delegate to the shared connection. Note that this will   always be of type C since it has been shared by another 
//  Not valid for request target.   Combination of multiple rules from RFC7230 and RFC 3986. Must be   ASCII, no controls plus a few additional characters excluded 
//  For the Top level page, add include-prelude and include-coda 
//  ----------------------------------------------------------- Properties 
//  perform close cleanup 
// shouldn't happen 
//  Create the credentials PreparedStatement string 
//  check state 
//  Set up context 
//  created for the same channel. 
//  CRLF terminates the request 
//  Add AprLifecycleListener if we are using the Apr connector 
//  NO-OP - connection closing 
/*  * This method is split out into a separate class to make it easier to track the * various permutations and combinations of client and server endpoints. * * Each test uses 2 client endpoint and 2 server endpoints with each client * connecting to each server for a total of four connections (note sometimes * the two clients and/or the two servers will be the sam)e.  */
//  Outputs 
//  --------------------------------------------------------------------- JMX 
//  Are there any defined security constraints? 
// skip this if we are being called from the constructor, and this has   already   been set 
//  Variable mapper 
//  Host name 
//  Create the root APR memory pool 
//  Should be a deny constraint 
//  Does not return 
//  Stop resources 
//  Start our thread 
//  Will never happen because swallow() is called with mustBeZero set   to false 
//  Partial UTF-8 
//  ---------------------------------------------------- HttpSession Methods 
//  Check to see if non-blocking writes or reads are being used 
// we published out to a backup, mark the test success 
//  Reuse a previous map if possible 
//  could only be one of these 
//         log( "Converting a char chunk "); 
//  Determine full path for uploaded WAR 
//  OK 
// file has changed - timestamp 
//  Register this principal with our SSO valve 
//  An explicit cookie processor hasn't been specified; use the default 
/*  refresh the connector information and send it  */
// standing for value, escapeXml and default attribute 
//  Decode 
//  Extract the signed file(s) from the ZIP 
//  No need for target to exist. 
//  inefficient 
//  The parser will remove surrounding '"' but will not   unquote any \x sequences. 
//  set output bytes 
//  Can write directly 
/*          * For a CustomTag, the codes that are generated at the beginning of the         * tag may not be in the same buffer as those for the body of the tag.         * Two fields are used here to keep this straight. For codes that do not         * corresponds to any JSP lines, they should be null.          */
//  Creating the comp subcontext 
//  Remove the specified file 
//  As expected 
//  Shortcut 
//  If we have <jsp:attribute> but something other than   <jsp:body> or the end tag, translation error. 
/*      * Performance test. Comment out @Ignore to run the test.      */
//  in modification time that HostConfig can detect. 
//  Message was compressed 
//  Deploy endpoints 
// we got interrupted, but we haven't received notification from the poller. 
//  return it 
//  Parse system properties 
//  TODO correct second try after app is in service! 
//  --------------------------------------------- Container Listener methods 
//  Cleanup just in case an old deployment is lying around 
// end if 
//  Close the output stream if used 
//  ----------------------------------------------- LexicalHandler Methods 
//  Update the last modified time. Make sure that the OS reports a change 
//  The call to expire() may not have been triggered by the webapp.   Make sure the webapp's class loader is set when calling the 
//  May be caused by a | being used instead of a : in an absolute   file URI on Windows. 
/*      * write a specific response header - %{xxx}o      */
//  Setup the minimal request information 
/*  Generated By:JJTree: Do not edit this line. AstLessThanEqual.java  */
//  SSL context 
//  Make sure the error stream reader has finished 
//  Short timeouts for now. May need to increase these for CI systems. 
//  It's a quoted string and the end is the next unescaped quote 
//  Destroy the context 
//  Milli-seconds in a second 
//  Resolve the supplied systemId against the base 
//  now provide the harvested session cookie for authentication 
// we shouldn't allow invalid, non hex characters  in the chunked header 
//  Open the current log file 
//  Try GET 
//  Remove the specified constraint 
//  ECHDE should beat AES 
//  NO-OP. Fragments unpacked in WEB-INF classes are not handled,   mainly because if there are multiple fragments there is no way to   handle multiple web-fragment.xml files. 
// 15 seconds 
/*                      * Note: Resolving the relative URLs from the manifest has the                     *       potential to introduce security concerns. However, since                     *       only JARs provided by the container and NOT those provided                     *       by web applications are processed, there should be no                     *       issues.                     *       If this feature is ever extended to include JARs provided                     *       by web applications, checks should be added to ensure that                     *       any relative URL does not step outside the web application.                      */
//  Cache the result for next time 
// messageReceived 
//  register it with the selector 
//  Send the message 
//  httpOnly are met 
//  MethodHandle 
//  Loop if endpoint is paused 
//  Synchronizing on jsw enables simultaneous loading   of different pages, but not the same page. 
//  We only know how to deal with <code>javax.naming.Reference</code>s 
//  end the SMAP 
//  Extension length 
//  End is the next whitespace character 
//  Do not block more if maxWaitTimeMillis is set. 
//  Full PUT 
/*  AJP attributes result in Coyote Request attributes, which are         * not listed by request.getAttributeNames(), so SnoopServlet         * does not see them. Delete attributes before result comparison.  */
//  Data is from the client so it should be masked 
//  Still in the error state. The error page did not call   complete() or dispatch(). Complete the async processing. 
//  Force session to expire one second from now 
//  Initializing project 
// message.length 
//  Don't warn about remaining JVM controlled threads 
//  Stage 0. Check there were no fragments with duplicate names 
/*              * The address first...              */
/*      * buffer      */
//  (if any) 
//  Only useful for hosts 
//  Create the new document base directory 
//  Append char array declarations 
//  security-role 
//  Create and return a corresponding request dispatcher 
//  Parameters without annotations are not permitted 
//  Process the connection 
/*      * ELExpressionBody. Starts with "#{" or "${".  Ends with "}".     * See JspReader.skipELExpression().      */
//  Indicates that at invalid sequence is detected four characters later 
//  Client certificate verification based on custom trust managers 
//  Look for the generic interface 
//  Store nested <ResourceEnvRef> elements 
// not sure what a good value for this is, but the spec says we need to provide an upper bound 
//  Unlock the thread if is is blocked waiting for input 
//  Get the full URL of the resource that caused the error 
//  --- DataSource methods ----------------------------------------- 
//  Simple case 
//  TransformerFactory are not loaded from the web application. 
/*      * write a specific cookie - %{xxx}c      */
//  Stack trace 
//  WSDL 
//  add previous error to error vector 
//  Web application library manifests 
//  Reallocate the current poller 
//  Should be possible to construct a canonical path for a resource   that doesn't exist given that a resource that does exist in the   same directory has a URL with the file protocol 
/*      * EmptyBody ::= '/>' | ( '>' ETag ) | ( '>' S? '<jsp:attribute'     * NamedAttributes ETag )      */
//  Zero length message. 
// assume we can read  start the timeout timer 
//  process next metacharacter 
//  invalid login - the above is only used once. 
//  There are no makeObject() calls in progress so the   pool is at capacity. Do not attempt to create a new   object. Return and wait for an object to be returned 
//  Very unlikely 
//  Handle an HTTP named dispatcher include 
//  Wild card (package) import 
//  JSP 2.2 
//  Cipher 45 
//  Write (or try to write) 16MB 
/*          * @return true if this custom action is supported by a tag file, false         * otherwise          */
//  Add the global redeploy resources (which are never deleted) at 
//  Added extra log statement for Bugzilla 36630:   https://bz.apache.org/bugzilla/show_bug.cgi?id=36630 
//  but there is only 56k - 1 available. 
//  Identify the request parameters that we need   By obtaining the command from the pathInfo, per-command security can   be configured in web.xml 
//  Very careful not to overflow - probably not necessary 
//  Put as much data as possible into the write buffer 
//  Second request replies to the login challenge 
/*      * This is the same as testAcceptProtectedBasic (above), except     * using an invalid authentication method.     *     * Note: the container ensures the Basic login method is called.     *       BasicAuthenticator does not find the expected authentication     *       header method, and so does not extract any credentials.     *     * The request is rejected with 401 SC_UNAUTHORIZED status. RFC2616     * says the response body should identify the auth-schemes that are     * acceptable for the container.      */
//  on every subsequent exception until the delay reaches 1.6 seconds. 
//  Some forwards, eg from valves will not set original values 
//  Bugzilla 31288, 33077: add support for authentication. 
//  This is a method 
/*      * Adds the given prefix to the set of prefixes of this translation unit.     *     * @param prefix The prefix to add      */
//  Then close all active connections if any remain 
//  Currently, we do not delegate SSL computation tasks 
//  Silent catch 
//  Read end of string marker 
//  Cipher 44 
//  Scan attribute list for expressions 
//  the existing transaction context ended (or we didn't have one), get the active transaction context 
//  Local copy to avoid possible NPE due to concurrent change 
//  JSP 2.1 
/*  ECC ciphersuites from draft-ietf-tls-ecc-01.txt (            Mar 15, 2001)  */
//  pull out the word token. 
//  The session is open. The future has been registered with the open   session. Normal processing continues. 
/*  * See https://bz.apache.org/bugzilla/show_bug.cgi?id=60482  */
//  directly 
//  sessionid will be restored 
// strong>NOTE</strong> - This header will be overridden   automatically if a <code>RequestDispatcher.forward()</code> call is   ultimately invoked.   HTTP 1.0   HTTP 1.1   0 means now 
/*      * Cleanup     *     * Cleanups are performed in the reverse order they were registered.  That is:     * Last In, First Out.  A cleanup function can safely allocate memory from     * the pool that is being cleaned up. It can also safely register additional     * cleanups which will be run LIFO, directly after the current cleanup     * terminates.  Cleanups have to take caution in calling functions that     * create subpools. Subpools, created during cleanup will NOT automatically     * be cleaned up.  In other words, cleanups are to clean up after themselves.      */
//  switch to read mode 
//  not instantiable 
//  Message Section 
//  client ip 
//  Make sure we don't miss any threads 
//         // Make the resource aware of the model mbean. 
//  Function prefix   Function name 
//  If there's no content length   (broken HTTP/1.0 or HTTP/1.1), assume   the client is not broken and didn't send a body 
//  There may be some aborted requests.   When connector shuts down, the request and response will not   be reused, so there is no issue to warn about here. 
//  only call complete if we have emptied the buffer 
//  Ensure allocations made in other threads are visible 
//  Start poller thread 
//  Deploy XML descriptors from configBase 
//  Check filter is only called once 
//  as the next character is a non-significant WS. 
//  Kill any session cookie that was found 
//  RFC6265 will parse explicit version 0 using RFC2109 
//  All other instances of Throwable will be silently swallowed 
//  ---------------------------------------------- ContainerListener Methods 
//  Cipher 0x050080 (SSLv2) 
/*      * Tests if a POST request is treated as simple request.     *     * @See http://www.w3.org/TR/cors/#simple-method     * @throws IOException     * @throws ServletException      */
//  Blocking 
// findStream().setError(); 
//  session-config 
//  When running under a SecurityManager, deployXML may be overridden   on a per Context basis by the granting of a specific permission 
// ------------------------------------------------------------ Constructors 
//  Suppress warnings generated because the code is trying to put the   wrong type of values into the Map 
//  -------------------- debug -------------------- 
//  lookahead position 
//  Retrieve leftover input 
//  then disable output and return 
//  ------------------------------------------ SocketOutputBuffer Inner Class 
//  JSP 2.3 
//  Cipher 46 
// when "end" is specified, if the "end" is more than the last index,  record the end place as the last index, otherwise, record it as "end"; 
//  test that here 
//  Validate the requested host name 
//  First compose the runtime output string 
//  Note that there is a similar test:   org.apache.juli.TestDateFormatCache.testBug54044() 
//  Will never be more than 2^31-1 
/*      * Constructs a new XByteBuffer.<br>     * TODO use a pool of byte[] for performance     * @param size the initial size of the byte buffer     * @param discard Flag for discarding invalid packages      */
//  Next 2 bytes are length of host name 
//  primary type ( whatever is set as original value ) 
//  Haven't consumed all the sets of parameters therefore   there were too many sets of parameters 
/*              * Append "xmlns" attributes that do not represent tag libraries              */
//  Cipher 41 
//  Initialise these classes when Tomcat starts 
//  Force re-calculation and disable listener since it won't   be re-used 
//  This file was included. Throw an exception as   a response.sendError() will be ignored by the   servlet engine. 
//  Invalid 
//  Message too long for the buffer   Need to trigger a 400 response 
//  clear() is illegal after any unbuffered output (JSP.5.5) 
//  from scratch. 
//  --- internal attributes ------------------------------------------------- 
//  Remove application originated attributes 
//  Make sure we aren't trying add the socket as well as close it 
//  Not robust but good enough 
//  If this is a comment, skip until its end 
//  resource-ref 
//  Note: Not permitted in fragments but we also use fragments for 
//  Remove as much as possible, log possible exceptions 
//  Check for small increments which are inefficient 
//  ---------------------------------------------- ThreadFactory Inner Class 
//  Note: Gump currently tests 9.0.x with OpenSSL master         (a.k.a 3.0.0-dev) 
//  Expect a stream reset 
//  Check for escapes 
//  r2, directory, first 
//  paths depend on mapping 
//  Allowed roles should be the union of the roles in the constraints   Constraint with empty auth section prevents all access   User matches all authenticated users 
//  necessary on all methods (including GET). 
//  Start Tomcat 
//  Reset this here so multiple notifies (possible with a   backlog containing multiple streams and small window updates)   are handled correctly (only the first should trigger a call   to stream.notify(). Additional notify() calls may trigger   unexpected timeouts. 
/* --Static Variables---------------------------------------- */
//  Cipher 40 
//  Use a fixed name for push body count, to simplify code gen 
/*      * Removes the URI at the top of the stack of URIs to which the given     * prefix is mapped.     *     * @param prefix The prefix whose stack of URIs is to be popped      */
//  Strictly, filtering this is an application 
/*  Start or restart sender  */
//  Special handling for Context Root mapped servlet 
//  Push an array to capture the parameter values if necessary 
//  Cookies 
//  lazy init for memory reasons 
//  Exact match 
//  In handshake or close_notify stages, check if call to unwrap was made 
//  Needs to be something RFC6265 allows, but strict naming does not. 
/*  JavaCC - OriginalChecksum=58f718af3466d6064ba0132bca4fbce2 (do not edit this line)  */
//  Validate host name and extract port if present 
// do nothing, might be a future unsupported method  so we better bail out and let the system continue 
//  Return the completed filter chain 
//  Not a valid status value 
//  Can't start with a single : 
//  Alternative approach would be to read the class file as per the   JLS. That would require duplicating a lot of BCEL functionality. 
// host 
// get the actual member with the correct alive time 
//  A notification has been sent, it is possible to read at least once 
//  headers, body 
//  Cipher 43 
//  Concurrent attempts to create the new Set. Make sure all   threads use the first successfully added Set. 
//  Double-check that some other thread or process hasn't made   the directory in the background 
//  Start ContainerBackgroundProcessor thread 
//  Closed, no children 
//  Processing the request so make sure the connection rather 
//  Skip registration if authentication credentials were   cached and the Principal did not change.   JASPIC API uses raw types 
//  Configure the parsing rules 
//  Clear the reference so it will not be queued, but replace with a   a new, non-registered reference so we can still track this object   in allReferences 
//  Interface el.parser.Node uses raw types (and is auto-generated) 
//  is performed under the web app's class loader 
//  short[] 
//  the correct context is found 
//  encapsulation. 
//  If the line number is less than one we couldn't find out 
//  decrement idx because break statement doesn't do it 
//  This is not a real close in order to support error processing 
//  don't process the command if we are processing   conditional   commands only and the   command is not conditional 
//  The relevant ABNF for the Sec-WebSocket-Extensions is as follows:        extension-list = 1#extension        extension = extension-token *( ";" extension-param )        extension-token = registered-token        registered-token = token        extension-param = token [ "=" (token | quoted-string) ]               ; When using the quoted-string syntax variant, the value               ; after quoted-string unescaping MUST conform to the               ; 'token' ABNF.     The limiting of parameter values to tokens or "quoted tokens" makes   the parsing of the header significantly simpler and allows a number   of short-cuts to be taken. 
//  -------------------- Request data -------------------- 
//  Set up security environment to bind as the user 
//  Draft: https://tools.ietf.org/html/draft-ietf-tls-chacha20-poly1305-04 
//  Client certificate verification based on trusted CA files and dirs 
//  -------------------- Information about the current request  -----------   This is useful for long-running requests only 
//  Special case for URL classloaders which are used in containers:   only look in the local repositories to avoid redefining loggers 20 times 
/*  create global TCN's APR pool     * This has to be the first call to TCN library.      */
//  Header names are case insensitive so always use lower case 
//  Cipher 42 
//  Visit tag body 
//  Store nested naming resources elements (EJB,Resource,...) 
//  unsigned byte, unsigned short 
//  Domain is more common, so it goes first 
//  save off the Request body 
/*  XP 64-bit SP2  */
//  RFC 7231 does not allow whitespace here but be tolerant 
//  Add any remaining messages to the queue 
/*  The quoted input string.  */
//  Client doesn't support TLS 1.3 so we have to use TLS 1.2 
//  Add last error to error vector 
//  Something else went wrong - re-throw 
//  Look for a default error page 
//  Extract the host name 
//  gzip handling is for backwards compatibility with Tomcat 8.x 
//  Simple best effort check 
//  common rules 
//  We know this is a byte value so this is safe 
//       PROPERTIES WHEN NOT USED WITH FACTORY 
//  Flags: End of stream 1, Padding 8 
//  Locate the response we should insert in front of 
//  Enable server push over and over again 
//  ----------------------------------------------------- JMX related methods 
/*  Use either SSL_VERIFY_NONE or SSL_VERIFY_PEER, the last 2 options     * are 'ored' with SSL_VERIFY_PEER if they are desired      */
//  Register global String cache   Note although the cache is global, if there are multiple Servers   present in the JVM (may happen when embedding) then the same cache 
//  This should not throw an Exception 
//  Example 13-8 is the same as 13-4   Example 13-9 is the same as 13-7 
/*  * Object factory for any Resource conforming to the JavaBean spec. * * <p>This factory can be configured in a <code>&lt;Context&gt;</code> element * in your <code>conf/server.xml</code> * configuration file.  An example of factory configuration is:</p> * <pre> * &lt;Resource name="jdbc/myDataSource" auth="SERVLET" *   type="oracle.jdbc.pool.OracleConnectionCacheImpl"/&gt; * &lt;ResourceParams name="jdbc/myDataSource"&gt; *   &lt;parameter&gt; *     &lt;name&gt;factory&lt;/name&gt; *     &lt;value&gt;org.apache.naming.factory.BeanFactory&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;driverType&lt;/name&gt; *     &lt;value&gt;thin&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;serverName&lt;/name&gt; *     &lt;value&gt;hue&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;networkProtocol&lt;/name&gt; *     &lt;value&gt;tcp&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;databaseName&lt;/name&gt; *     &lt;value&gt;XXXX&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;portNumber&lt;/name&gt; *     &lt;value&gt;NNNN&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;user&lt;/name&gt; *     &lt;value&gt;XXXX&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;password&lt;/name&gt; *     &lt;value&gt;XXXX&lt;/value&gt; *   &lt;/parameter&gt; *   &lt;parameter&gt; *     &lt;name&gt;maxLimit&lt;/name&gt; *     &lt;value&gt;5&lt;/value&gt; *   &lt;/parameter&gt; * &lt;/ResourceParams&gt; * </pre> * * @author Aner Perez [aner at ncstech.com]  */
//  Look for the method that has the highest number of parameters where 
//  
//  Graal native images don't load any configuration except the VM default 
//  ------------------------------------------------- ServletContext Methods 
//  Consume extra bytes : parse the stream until the end chunk is found 
//  ------------------------------------------ HttpSession Protected Methods 
//  timeBetweenEvictionRunsMillis > maxAge to test that maxAge setting overrides it 
//  Elements not permitted 
//  If there is no prefix or no property match with the prefix try just 
//  will be created... 
//  Default max header count is 100 
//  Will never happen 
//  Don't try and use SSO to authenticate since there is no auth 
//  As per 'clarification' from the Servlet EG, filter definitions in the   main web.xml override those in fragments and those in fragments 
//  The following sets reload to true, if necessary 
//  External WAR - therefore XML in WAR will be ignored 
//  ----------------------------------------------------------- DoPrivileged 
//  Ten seconds 
/*      * Represents an ID token in EL      */
//  Make arguments from this expression available to any nested   expression 
// define a map name, unless one is defined as a parameters 
//  Destroy instance and update pool counters   Clear any other instances in this pool and kill others as they come back 
//  Error wasn't previously reported but we can't write an error   page because the response has already been committed. Attempt 
//  If the xml file exists then expandedDir must exists so no need to 
//  Short-cut if no headers have been set 
//  Method call at end of expression 
//  1111ouuu 
//  Quoting <% and %> 
//  THEN 
//  Flag indicating whether we are inside DTD declarations 
//  When using replay (e.g. after FORM auth) all the data to read has   been buffered so there is no opportunity to refill the buffer. 
//  getter method 
//  now pull out the encoding token the same way. 
//  Wrap the source data into the internal buffer 
//  Need an authenticator to support HttpServletRequest.login() 
//  Makes the difference between calling complete before   the request body is received of after. 
//  Always draw as arc to meet the behavior in the HTML5 Canvas. 
//  Check path mapping works 
//  Determine namespace associated with <root> element's prefix 
//  Matching patterns *.ext or /p/* 
//  Make sure that JspCompilationContext gets the latest TagInfo   for the tag file. TagInfo instance was created the last   time the tag file was scanned for directives, and the tag 
// dlen - 4 bytes 
//  then that process can hang. 
//  Process command line parameters 
//  End of string 
//  Set the authorization type 
//  unload it and release this instance 
//  Note: On Java 9 and above, the isStatic check becomes   unnecessary because the canAccess() call in Util.findMethod() 
//  any CHAR   except CTLs   or separators 
//  Standard clone() method will copy the lock object. Replace that 
//  remove any trailing parameters 
//  If a new error occurred while trying to report a previous   error allow the original error to be reported. 
//  -------------------------------------------------------- Support Methods 
//  Should not happen but for safety 
//  resource-env-ref was introduced in Servlet 2.3 
//  Create the pool for the server socket 
//  location to refer to a JavaEE schema 
/*      * Returns the localized error message corresponding to the given error     * code.     *     * If the given error code is not defined in the resource bundle for     * localized error messages, it is used as the error message.     *     * @param errCode Error code to localize     *     * @return Localized error message      */
//  Try a setFoo ( long ) 
//  (This implies 'isExternal' is TRUE.)   We know we're dealing with a JSP document (via JSP config or   ".jspx" suffix), so we're done. 
//  Use a GET no role - should be blocked as denyUncovered is true 
//  build sorted map of idle objects 
//  Check the bean is public, not an interface, not abstract 
//  child's container is Host 
//  Now use a settings frame to further reduce the size of the flow 
//  Not a valid status code 
/*          * TODO SERVLET 3.1          */
//  Check that the resource is absolute. This should always be the case. 
//  First remove query string 
// this could be the channel listener throwing an exception, we should log it  as a warning. 
//  finally provide helpful hints 
// resource-ref 
//  Java SE API (as of Java 8) does not expose the API to   control the Window size. It is effectively hard-coded   to 15 
//  AJP does not support trailers so return true so app can request the   trailers and find out that there are none. 
//  written. 
//  any local address 
//  Process socket timeouts 
//  If not absolute, make it absolute 
//  Validate that we can open our connection - but let tomcat   startup in case the database is temporarily unavailable 
//  the possibility of an Exception here. 
//  The test runs Tomcat twice, tests that it has started successfully,   and compares the counts of listeners registered on containers   after the first and the second starts.   Sample request is from TestTomcat#testSingleWebapp() 
//  Client hello size 0 (correct, but not legal) 
//  Prevent it from looking (if it finds one - it'll have dup error) 
// register to read the ack 
//  "java.util.concurrent" code is in public domain, 
//  Adjust read size if packetSize != default (Constants.MAX_PACKET_SIZE) 
//  Must be an invalid name. Use the defaults instead. 
/*      * setup two webapps for every test     *     * note: the super class tearDown method will stop tomcat      */
//  save off the current auto commit flag so it can be restored after the transaction completes 
// prepareCall 
//  No pending data to be sent to the peer 
//  This is an expanded directory 
//  --------------------------------------------------------- Private Methods 
//  If there is no data to process, trigger a read immediately. This is   an optimisation for the typical case so we don't create an 
//  Filter out cipher suites that OpenSSL does not implement 
//  Set to distributable else every app will be prevented from being   distributable when the Tomcat fragment is merged with the main 
//  Look to see if this request is an include 
//  Instantiate the indicated Options implementation 
//  size of a simple request (8k) 
//  DBCP-512: Avoid exceptions when closing a connection in mutli-threaded use case.   Avoid closing again, which should be a no-op, but some drivers like H2 throw an exception when   closing from multiple threads. 
/*  Internal function for loading APR Features  */
//  Need to create a new JarEntry so the certificates can be read 
// do nothing, this is normal, we don't want to block forever  since the receive thread is the same thread  that does membership expiration 
//  Just above default maxHeaderCount 
/* begin the actual statement cache */
//  Extension 'parsing'   Note that the chunk-extension is neither parsed nor   validated. Currently it is simply ignored. 
/* TLS_KRB5_WITH_DES_CBC_SHA(            "KRB5-DES-CBC-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.DES,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.LOW,            false,            56,            56,            null,            null    ),    // Cipher 1F    TLS_KRB5_WITH_3DES_EDE_CBC_SHA(            "KRB5-DES-CBC3-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.TRIPLE_DES,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.HIGH,            true,            112,            168,            null,            null    ),    // Cipher 20    TLS_KRB5_WITH_RC4_128_SHA(            "KRB5-RC4-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC4,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.MEDIUM,            false,            128,            128,            null,            null    ),    // Cipher 21    TLS_KRB5_WITH_IDEA_CBC_SHA(            "KRB5-IDEA-CBC-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.IDEA,            MessageDigest.SHA1,            Protocol.SSLv3,            false,            EncryptionLevel.MEDIUM,            false,            128,            128,            null,            null    ),    // Cipher 22    TLS_KRB5_WITH_DES_CBC_MD5(            "KRB5-DES-CBC-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.DES,            MessageDigest.MD5,            Protocol.SSLv3,            false,            EncryptionLevel.LOW,            false,            56,            56,            null,            null    ),    // Cipher 23    TLS_KRB5_WITH_3DES_EDE_CBC_MD5(            "KRB5-DES-CBC3-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.TRIPLE_DES,            MessageDigest.MD5,            Protocol.SSLv3,            false,            EncryptionLevel.HIGH,            false,            112,            168,            null,            null    ),    // Cipher 24    TLS_KRB5_WITH_RC4_128_MD5(            "KRB5-RC4-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC4,            MessageDigest.MD5,            Protocol.SSLv3,            false,            EncryptionLevel.MEDIUM,            false,            128,            128,            null,            null    ),    // Cipher 25    TLS_KRB5_WITH_IDEA_CBC_MD5(            "KRB5-IDEA-CBC-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.IDEA,            MessageDigest.MD5,            Protocol.SSLv3,            false,            EncryptionLevel.MEDIUM,            false,            128,            128,            null,            null    ),    // Cipher 26    TLS_KRB5_EXPORT_WITH_DES_CBC_40_SHA(            "EXP-KRB5-DES-CBC-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.DES,            MessageDigest.SHA1,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            56,            null,            null    ),    // Cipher 27    TLS_KRB5_EXPORT_WITH_RC2_CBC_40_SHA(            "EXP-KRB5-RC2-CBC-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC2,            MessageDigest.SHA1,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            128,            null,            null    ),    // Cipher 28    TLS_KRB5_EXPORT_WITH_RC4_40_SHA(            "EXP-KRB5-RC4-SHA",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC4,            MessageDigest.SHA1,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            128,            null,            null    ),    // Cipher 29    TLS_KRB5_EXPORT_WITH_DES_CBC_40_MD5(            "EXP-KRB5-DES-CBC-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.DES,            MessageDigest.MD5,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            56,            null,            null    ),    // Cipher 2A    TLS_KRB5_EXPORT_WITH_RC2_CBC_40_MD5(            "EXP-KRB5-RC2-CBC-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC2,            MessageDigest.MD5,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            128,            null,            null    ),    // Cipher 2B    TLS_KRB5_EXPORT_WITH_RC4_40_MD5(            "EXP-KRB5-RC4-MD5",            KeyExchange.KRB5,            Authentication.KRB5,            Encryption.RC4,            MessageDigest.MD5,            Protocol.SSLv3,            true,            EncryptionLevel.EXP40,            false,            40,            128,            null,            null    ), */
//    Skipping blank lines 
//  Need access to the ccl field of sun.rmi.transport.Target to find   the leaks 
//  The key is currently at capacity or in the process of   making enough new objects to take it to capacity. 
//  Path information not available so can only remove based on   name. 
//  NOOP. Could return logs[0].getRequestAttributesEnabled(), but I do   not see a use case for that. 
// to do, if a member disappears, only the coordinator can start 
//         yyyy-mm-dd hh:mm:ss          0123456789012345678 
//  validateHttp2InitialResponse() - modified 
//  Java 7 JVM decoder does not report error until all 3 bytes are available 
//  Avoid multiple timeouts 
//  Cipher 3F 
//  Finished looking up the class hierarchy without finding anything 
// message length 
//  For files that are statically included, isTagfile and directiveOnly   remain unchanged. 
//  Plenty of space - should pass 
//  Configure servlet context wide defaults 
//  ----------------------------------------------- Public Lifecycle Methods 
//  Ignore any whitespace (including spaces, carriage returns,   line feeds, and tabs, that appear at the beginning and at   the end of the body of the <jsp:attribute> action, if the   action's 'trim' attribute is set to TRUE (default).   In addition, any textual nodes in the <jsp:attribute> that   have only white space are dropped from the document, with   the exception of leading and trailing white-space-only   textual nodes in a <jsp:attribute> whose 'trim' attribute   is set to FALSE, which must be kept verbatim. 
//  Workaround for buggy WebLogic 5.1 classloader - ignore the exception upon first invocation. 
//  Try loading a class from OpenWebBeans to make sure it is available 
//  If the Authenticator is an instance of AuthenticatorBase then   it will check req.getRemoteUserNeedsAuthorization() and   trigger authorization as necessary. It will also cache the   result preventing excessive calls to the Realm. 
//  Treat instances of Number as a special case 
//  didn't find anything, give up now 
//  UTF-8 is only 3-byte BOM 
//  Still more data to write, need to flush 
//  Try a setFoo ( int ) or ( boolean ) 
// ============================================================================================================                COORDINATION HANDLING  ============================================================================================================ 
//  ------------------------------------------------------ Protected methods 
//  Pools exhausted 
//  Bugzilla 37781 Check to make sure we can write this output file 
//  just in case 
//  XXX check web.xml for custom error handler 
//  env-entry names must be unique within a web(-fragment).xml 
//  The IBM JRE will accept cipher suites names SSL_xxx or TLS_xxx but   only returns the SSL_xxx form for supported cipher suites. Therefore   need to filter the requested cipher suites using both forms with an 
//  No specific functionality for this class 
//  Return the class we have located 
//  Control messages may be sent in the middle of fragmented message   so they have no effect on the fragmented or text flags 
//  This is the normal case for this code 
//  Restart MapperListener to pick up new engine. 
//  Store ourselves as a request attribute (if requested) 
//  Not expected. 
//  Regardless of whether a non-secure wrapper was created for a   proxy CONNECT, need to use TLS from this point on so wrap the   original AsynchronousSocketChannel 
//  Retrieving the content-range header (if any is specified 
//  The call was not completed inline, so must start reading new frames   or process the stream exception 
//  Stateless so a static can be used to save on GC 
// if the entire message was written from the buffer 
//  Create this directory if necessary 
//  No other transition permitted 
//  No restrictions 
//  This will close the file too. 
//  This is what happens when context reload starts 
// backup request 
//  Now throw a RuntimeException to end this request 
//  Define the package (if null) 
//  HTTP Upgrade 
//  Non hex character 
/*      * JVMs may limit the maximum array size to slightly less than     * Integer.MAX_VALUE. On markt's desktop the limit is MAX_VALUE - 2.     * Comments in the JRE source code for ArrayList and other classes indicate     * that it may be as low as MAX_VALUE - 8 on some systems.      */
// prepare the results to be written 
//  Support for the factory methods 
//  First try the Servlet 2.2 javax.servlet.context.tempdir property 
/* begin properties for the statement cache */
//  pad to 8 to make it more readable 
//  If it fails, we try to get a Writer instead if we're   trying to serve a text file 
// Enums 
//  compliant) user agents are very particular 
//  This tests that if a Filter init() fails then the web application   is not put into service. (BZ 46243)   This also tests that if the cause of the failure is gone,   the context can be started without a need to redeploy it. 
//  Then normalize 
//  ------------------------------------------------------------- Attributes 
//  default 
//  Cipher 3C 
//  build the HTTP request while assembling the uri 
// match the rest of the bytes - they have to match 
//  Append text to text buffer 
/*  Note: Package private to enable testing without reflection  */
//  Dispatch to "/error" will end up here 
//  Filter names must be unique within a web(-fragment).xml 
//  Optimise internal processing 
//  OpenSSL can handle multiple certs in a single config so the reference to   the context is at the virtual host level. JSSE can't so the reference is 
// we did receive some data, add it to our total 
//  expected 
//  set up params for copying everything but sign bit 
//  and then mirror 
//  Expect the "next" Valve to fire   Next 2 lines are basically EasyMock.expect(next.invoke(req,res)) but for a void method 
//  Next two bytes are major/minor version. We need at least 3.1. 
//  Greater than or equal 
//  Create a new StandardHost instance 
//  Cipher 1305 
//  First line is output file name 
//  Check partial input is rejected once it is known to be all available 
//  Process command line options 
// left over membership messages 
//  No attributes 
//  tell the transaction manager we are read only 
//  if needed 
// inputLineCount, if possible 
//  If both input and output are exhausted, return UNDERFLOW 
//  Cipher 3B 
//  Note: Calling method has checked the obj is an array. 
//  Look for first char 
/*                  * Errors processing the cert chain do not affect the client                 * connection so they can be logged and swallowed here.                  */
//  Don't try something we know won't work 
//  Standard syntax 
//  Empty or null path can't point to anything useful. The assumption is   that the value is deliberately empty / null so leave it that way. 
//  %n rather than %nn should throw an IAE according to the Javadoc 
//  The next table contains information about UTF-8 charset and   correspondence of 1st byte to the length of sequence   For information please visit http://www.ietf.org/rfc/rfc3629.txt     Please note, o means 0, actually.   -------------------------------------------------------------------   0 1 2 3 Value   -------------------------------------------------------------------   oxxxxxxx                            00000000 00000000 0xxxxxxx   11oyyyyy 1oxxxxxx                   00000000 00000yyy yyxxxxxx   111ozzzz 1oyyyyyy 1oxxxxxx          00000000 zzzzyyyy yyxxxxxx   1111ouuu 1ouuzzzz 1oyyyyyy 1oxxxxxx 000uuuuu zzzzyyyy yyxxxxxx 
//  Nothing to do. 
//  magic min/maj version 
//  Check to see if we received a close_notify message from the peer 
//  annotations 
//  as expected 
/*      * Test for enabling JNDI.      */
//  Guarded by writeCompletionHandler 
//  Check for the things that require a v1 cookie 
/*          * OK, we do have a netmask specified, so let's extract both the address         * and the CIDR.          */
//  Add this filter mapping to our registered set 
//  Check the Context class 
//  The socket write buffer capacity is socket.appWriteBufSize 
/*  (non-Javadoc)     * @see java.util.Comparator#compare(java.lang.Object, java.lang.Object)      */
// reconnect 
//  Invalid provider / algorithm 
//  Cipher 3E 
//  Build the union of methods for this pattern 
//  Wait (but not too long) until all expected entries appear (access log   entry will be made after response has been returned to user) 
//  Info for now as we may need to increase DEFAULT_NET_BUFFER_SIZE 
//  If property name is not in the properties list, we haven't warned on it   and it is not in the "silent" list, tell user we are ignoring it. 
//  Only do a logfile switch check once a second, max. 
/*          * Constructor for custom action implemented by tag handler.          */
//  Non-standard charset that browsers won't be using   Likely something used internally by the JRE 
//  Return the resulting Principal for our authenticated user 
// buffer overflow can happen, if we have read data, then  empty out the dst buffer before we do another read 
//  Breakpoint B required on following line 
// Recycling old buffer 
//  Resources 
//  Don't set a content length if something else has already   written to the response or if conversion will be taking place 
//  Check if user-agent supports gzip encoding   Only interested in whether gzip encoding is supported. Other 
//  Since parsing of attributes and var   substitution is done in separate places, 
//  Cipher 3D 
//  The response should not have been committed but check it   anyway to be safe 
/*  Attach the realm to the appropriate container, but role mapping must         * always succeed because it is evaluated at context level.          */
/*  File lock types/flags  */
//  Stop further HTTP output 
//  Nested 
/*      * Tracks the current async generation when a timeout is dispatched. In the     * time it takes for a container thread to be allocated and the timeout     * processing to start, it is possible that the application completes this     * generation of async processing and starts a new one. If the timeout is     * then processed against the new generation, response mix-up can occur.     * This field is used to ensure that any timeout event processed is for the     * current async generation. This prevents the response mix-up.      */
/*      * Generates the setter method name for the given attribute name.      */
/*      * Peeks at the initial network bytes to determine if the SNI extension is     * present and, if it is, what host name has been requested. Based on the     * provided host name, configure the SSLEngine for this connection.      */
// addr data 
//  Abnormal close: underlying connection closed unexpectedly, so we   must destroy this proxy 
//  Cipher 1302 
/*      * Receives notification of a non-recoverable error.      */
//  Set read timeout in case of failure so test doesn't hang 
//  Ensure we are specification compliant 
//  Protocol 
//  First, process a request on stream 17. This should consume both 
//  digested password. 
//  Ok, no setXXX found, try a setProperty("name", "value") 
//  Servlet/run-as was added in 2.3 so should be excluded in 2.2 
//  --------------------------------------------- WebdavResolver Inner Class 
//  and redirect to the error page if they are not correct 
//  This consistently ~10 times faster than the equivalent regular 
//  thread.stop() 
//  JVM controlled threads 
//  If an async request is in progress and is not going to end once this 
//  Initialize SSL if needed 
//  Time and log the subsequent processing 
//  -------------------- I18N -------------------- 
//  to not map between types. 
//  Tomcat.addServlet does not respect annotations, so we have   to set our own MultipartConfigElement.   Choose upload file size limit. 
//  skip implicit resolver only 
//  Unsupported URL protocol 
//  Check to see if there are any more attributes for the specified tag. 
//  tag-file 
//  Need to combine these enumerations. The order in which the   Enumerations are combined depends on how delegation is configured 
//  Loaf a while if the current instance is allocated 
//  Individual Cipher and SecureRandom objects need no explicit teardown 
//  was there a transaction? 
//  If the methods are not on clazzPojo and they are overridden 
// info.setDescriptor(descriptor); 
//  first, a set of tests where the server uses a cookie to carry   the current session ID during and after authentication, and   the client is prepared to return cookies with each request 
/*      * Test for enabling JNDI and using global resources.      */
// O and E are modifiers, they mean to present an alternative representation of the next char  we just handle the next char as if the O or E wasn't there 
//  which saves the relatively expensive call to notifyAll() 
//  Cache the authentication information in our session, if any 
//  Cipher 1301 
//  Retrieve the certificate chain for this client 
//  Subsequent rounds 
//  Error probably occurred during a non-blocking write 
// compact the buffer, this is an optional method, wonder what would happen if we didn't 
//  First byte EE..EF, second byte 80..BF 
//  resource-ref element 
//  00-0f 
//  May be zero -> class is java.lang.Object 
//  Look for a zero-arg close() method 
//  env-entry 
//  It is not permitted to load new classes once the web application has   been stopped. 
//  Cipher 1304 
//  Hide the default constructor 
//  Serve the requested resource, including the data content 
//  Get attributes to retrieve from user entry 
/*      * apr_wait_how_e enum      */
//  Write end chunk 
//  Malformed. Use quality of zero so it is dropped. 
//  This is a must, so that we don't have multiple threads messing with the socket 
/*  ==================== Methods to override ====================  */
//  Set the shared extensions class loader 
//  Cipher 3A 
// we are right on target. process orders 
//  Sleep for 1500 ms which should mean the all of request 1 has been 
//  Attributes for control messages   Control messages can appear in the middle of other messages so need 
//  Parse the pattern 
/*      * Hostname (with port and user) is included in the request line, but Host     * header is empty.     * Added for bug 62739.      */
//  JSP Servlet defined.   Use same JSP Servlet class name 
//  Currently a NO-OP as upgrade processors are not recycled. 
//  Ask this Host to process this request 
//  Simple dispatch with trailing path parameters at start 
//  Flags. End of headers 
//  upto 10 seconds to close down. 
//  Test addContextVersion() followed by addHost() 
// sk.cancel(); 
//  webappPath will be null for JARs containing TLDs that are on   the class path but not part of the web application 
//  This half-closes the stream since it includes the end of stream flag 
//  relative links 
//  Cipher 1303 
//  if there is no mapping, then the original name is used.  Many of the MIME character set 
//  Set extra flag so that write nesting does not cause multiple notifications 
//  Static method so base should be null 
//  It is not absolute-ordering, so there may be other jars in the list 
//  VERIFY VIDEO/MPEG 
//  Close the socket now that we are done with it 
//  Bug 54395 
//  check for container level optional packages 
//  do nothing, internalProxies IPs are not appended to the 
//  These methods are always allowed. They may return a 404 (not a 405)   if the resource does not exist. 
//  If authentication was not successful, just return false 
//  First services API 
//  separators as defined by RFC2616 
// only used while building the tree 
/*  * Based on * https://bz.apache.org/bugzilla/show_bug.cgi?id=62635 * * Note: Calling blocking I/O methods (such as flushBuffer()) during *       non-blocking I/O is explicitly called out as illegal in the Servlet *       specification but also goes on to say the behaviour if such a call is *       made is undefined. Which means it is OK if the call works as expected *       (a non-blocking flush is triggered) :). *       If any of these tests fail, that should not block a release since - *       while the specification allows this to work - it doesn't require that *       it does work.  */
//  listeners 
//  TODO: security-role-ref/description (multiple with language) is ignored 
//  RFC6454, section 4. "If uri-scheme is file, the implementation MAY   return an implementation-defined value.". No limits are placed on 
//  Deploy POJOs 
//  return the delegating connection that created this 
//  Re-throw to let caller handle this - will result in a 404 
//  file. 
//  Perform new deployment and remove internal HostConfig state 
//  If no attributes are requested, no need to look for them 
//  No more bytes left to be read : return -1 and clear the   buffer 
//  Not set. Must be JSSE based. 
//  Perform the request 
//  ----------------------------------------------------- Static Initializer 
//  This can happen if the transaction is already timed out 
//  Rethrow original exception, as it can have more information   about why the class was not found. BZ 48007 
//  BZ 57762. A dropped connection will get reported as EOF   rather than as an error so handle it here. 
//  ArrayList of NESTED scripting variables 
//  Reset application context 
//  There is a chance the the resource was only missing   temporarily eg renamed during a text editor save 
//  Resource links 
//  Write decrypted data to dsts buffers 
//  A complete TLS record header is required before we can figure out 
//  The socket read buffer capacity is socket.appReadBufSize 
//  Note \ is escaped as \\ in Java source code 
//  Fast for valid request target characters, slower for some incorrect   ones 
//  Accumulate the list of roles for this user 
//  ---------------------------------------------- Request processing methods 
//  Current and previous are same path - current will always   be a later version 
/*      * @deprecated Use {@link #subtractB()}.     *             This method will be removed in Tomcat 10      */
//  Insert generated content here 
//  Allocate the pong message array 
/*  Generated By:JJTree: Do not edit this line. AstGreaterThanEqual.java  */
//  Validate the proposed filter mapping 
/*  * Implementation note: * * A number of these tests involve the rewrite valve returning an HTTP Location * header that include un-encoded UTF-8 bytes. How the HTTP client handles these * depends on the default character encoding configured for the JVM running the * test. The tests expect the client to be configured with UTF-8 as the default * encoding. Use of any other encoding is likely to lead to test failures.  */
//  Create a new WebappLoader instance 
//  Jar has been changed 
//  space characters were translated to '_' on encode, so we need to translate them back. 
/*  PSK auth  */
// locale.getDisplayName(); 
//  Also add any modules 
//  Call the filter chain for this request 
//  True if the helper class should be generated. 
//  Future developers: if you discover any other   rare-but-nonfatal exceptions, catch them here, and log as 
//  Cancelling the task is not supported 
//  NIO2 can sometimes send window updates depending timing 
//  Add the newly created compressed part to the set of parts 
/*                              * Not using include so ignore outputEncoding,                             * callSetCharacterEncoding and useWriter                             *                             * Tests that do not use include are always expected to                             * pass.                              */
//  always put an empty line after the headers 
// latch countdown has happened 
//  Now build the cookie header 
/*          * Constructor          */
//  <0 - don't set anything - use the implementation default 
//  If the property was not found, and the current classloader had no   configuration (property list is empty), look for the parent classloader   properties. 
//  Additional checks required 
//  Spec says if jsp_precompile=false, the request should not   be delivered to the JSP page; the easiest way to implement   this is to set the flag to true, and precompile the page anyway.   This still conforms to the spec, since it says the   precompilation request can be ignored.   ?jsp_precompile=false 
//  Enums 
//  Retrieved on 30 July 2014 from 
//  Flag to ask to reallocate the pool 
//  point 
//  Construct and seed a new random number generator 
//  Avoid NPE if bundle is null and treat it like an MRE 
//  There should still be some Tomcat MBeans 
//  for zero 
// --- Usage tracking support ----------------------------------------------- 
/*  APR_PATCH_VERSION  */
//  Second pass 
// we are maxed out on threads, simply queue the object 
//  No comma found 
//  to 15 
//  Nothing is passed as varargs 
/*  apr_kill_conditions_e enumeration  */
/*  The RSA ciphers  */
//  Buffer full - double size 
//  Need to force loading of all web application classes via the web 
//  failing a toCanonicalPath on a file that   exists() should be a JVM regression test,   therefore we have permission to freak out 
//  Ensure support for jar:war:file:/ URLs will be available (required   for resource JARs in packed WAR files). 
//  throw Throwable. 
// if the var specified, the exception object should 
/*      * Creates a page-scoped variable for each declared tag attribute. Also, if     * the tag accepts dynamic attributes, a page-scoped variable is made     * available for each dynamic attribute that was passed in.      */
//  pattern must be "*", or of the form "*.jsp" 
//  Ignore whitespaces at the end of the line 
//  register jmx 
//  ------------------------------------------------------ Poller Inner Class 
//  Zone ID   e.g. fe80:0:0:0:f0f0:c0c0:1919:1234%4 
//  Step through each file and check. 
/*  * An implementation of the W3c Extended Log File Format. See * http://www.w3.org/TR/WD-logfile.html for more information about the format. * * The following fields are supported: * <ul> * <li><code>c-dns</code>:  Client hostname (or ip address if * <code>enableLookups</code> for the connector is false)</li> * <li><code>c-ip</code>:  Client ip address</li> * <li><code>bytes</code>:  bytes served</li> * <li><code>cs-method</code>:  request method</li> * <li><code>cs-uri</code>:  The full uri requested</li> * <li><code>cs-uri-query</code>:  The query string</li> * <li><code>cs-uri-stem</code>:  The uri without query string</li> * <li><code>date</code>:  The date in yyyy-mm-dd  format for GMT</li> * <li><code>s-dns</code>: The server dns entry </li> * <li><code>s-ip</code>:  The server ip address</li> * <li><code>cs(XXX)</code>:  The value of header XXX from client to server</li> * <li><code>sc(XXX)</code>: The value of header XXX from server to client </li> * <li><code>sc-status</code>:  The status code</li> * <li><code>time</code>:  Time the request was served</li> * <li><code>time-taken</code>:  Time (in seconds) taken to serve the request</li> * <li><code>x-threadname</code>: Current request thread name (can compare later with stacktraces)</li> * <li><code>x-A(XXX)</code>: Pull XXX attribute from the servlet context </li> * <li><code>x-C(XXX)</code>: Pull the first cookie of the name XXX </li> * <li><code>x-O(XXX)</code>: Pull the all response header values XXX </li> * <li><code>x-R(XXX)</code>: Pull XXX attribute from the servlet request </li> * <li><code>x-S(XXX)</code>: Pull XXX attribute from the session </li> * <li><code>x-P(...)</code>:  Call request.getParameter(...) *                             and URLencode it. Helpful to capture *                             certain POST parameters. * </li> * <li>For any of the x-H(...) the following method will be called from the *                HttpServletRequest object </li> * <li><code>x-H(authType)</code>: getAuthType </li> * <li><code>x-H(characterEncoding)</code>: getCharacterEncoding </li> * <li><code>x-H(contentLength)</code>: getContentLength </li> * <li><code>x-H(locale)</code>:  getLocale</li> * <li><code>x-H(protocol)</code>: getProtocol </li> * <li><code>x-H(remoteUser)</code>:  getRemoteUser</li> * <li><code>x-H(requestedSessionId)</code>: getRequestedSessionId</li> * <li><code>x-H(requestedSessionIdFromCookie)</code>: *                  isRequestedSessionIdFromCookie </li> * <li><code>x-H(requestedSessionIdValid)</code>: *                  isRequestedSessionIdValid</li> * <li><code>x-H(scheme)</code>:  getScheme</li> * <li><code>x-H(secure)</code>:  isSecure</li> * </ul> * * * * <p> * Log rotation can be on or off. This is dictated by the * <code>rotatable</code> property. * </p> * * <p> * For UNIX users, another field called <code>checkExists</code> is also * available. If set to true, the log file's existence will be checked before * each logging. This way an external log rotator can move the file * somewhere and Tomcat will start with a new file. * </p> * * <p> * For JMX junkies, a public method called <code>rotate</code> has * been made available to allow you to tell this instance to move * the existing log file to somewhere else and start writing a new log file. * </p> * * <p> * Conditional logging is also supported. This can be done with the * <code>condition</code> property. * If the value returned from ServletRequest.getAttribute(condition) * yields a non-null value, the logging will be skipped. * </p> * * <p> * For extended attributes coming from a getAttribute() call, * it is you responsibility to ensure there are no newline or * control characters. * </p> * * @author Peter Rossbach  */
//  Check to correct engine and host setup 
//  VERIFY DEFAULT CONFIGURATION 
//  Use negative values since null is not an option to indicate 'not set' 
//         }          this.run = false;          long delta = System.currentTimeMillis() - start;          printThreadResults(threads,"testC3P0Threads20Connections10",Driver.connectCount.get(),10);      } 
// this is an approximation, so it could use some tuning 
//  If the all roles mode exists, sets 
/*      * Start tomcat with a single context and one     * servlet - all programmatic, no server.xml or     * web.xml used.     *     * @throws Exception      */
//  Get the qualified name 
//  Setup the jsp config info for this web app. 
//  Doesn't actually need to do anything. 
//  Add protected servlet 
//  Create a new StandardManager instance 
//  NO-OP. Handled by the Http2UpgradeHandler 
//  Handler needs wrapping and requires decoder to convert it to one   of the types expected by the frame handling code 
//  Should be no more than 3 decimal places 
//  Commit if autoCommit is false 
//  Simple dispatch with directory traversal 
// $NON-NLS-1$ 
//  A notification is already being sent 
//  Source 
//  Write some data using sendfile 
//  Configure and call application filters 
//  the one that is more restrictive. 
//  Start searching for the next $ after the value 
//  Stats 
//  handle deferredValue and deferredValueType 
//  Read the 2nd response 
//  expect to fail using that sessionID in a different container 
//  If the servlet mod time is later, call doGet()   Round down to the nearest second for a proper compare   A ifModifiedSince of -1 will always be less 
//  -------------------- Future may be different -------------------- 
//  WebServices references 
//  Select the Context to be used for this Request 
//  Possible with empty settings frame 
//  never parse 
//  Did we find all expected MBeans? 
//  stream to the print writer that SSICommand uses. 
//  The internal executor should always be an instance of   j.u.c.ThreadPoolExecutor but it may be null if the endpoint is   not running.   This check also avoids various threading issues. 
/*      *     * @return TODO      */
//  the transaction has completed 
//  for ping thread 
/*      * Returns null if the input path is not valid or a path that will be     * acceptable to resources.getResource().      */
// print from the global counter 
//  Mark and parse the EL expression and create its node: 
//  Hitting limit stops processing further params but does   not cause request to fail. 
//  Need to check default 
/*      * A visitor class for traversing ELNodes      */
//  -------------------------------------------------- SocketInfo Inner Class 
/*  SC_REQUEST_URI_TOO_LONG  */
//  Indicate that we have successfully processed this custom page 
//  (silent) ISE when setting the output buffer size 
/*      * No more input will be passed to the application. Remaining input will be     * swallowed or the connection dropped depending on the error and     * expectation status.      */
//  Use resolvers from context from this point on 
//  Add the error handling page 
//  Cannot process 101 header 
//  Cipher 37 
//    Reading the protocol   Protocol is always "HTTP/" DIGIT "." DIGIT   
//  Process the initial settings frame 
//  We chunk the data into slices fitting in the buffer limit, although   if the data is written directly if it doesn't fit. 
//  Charset is available - populate cache entry 
//  Avoid NPE when unit testing 
/*  Done: return the first with the right port  */
//  Track 'overhead' frames vs 'request/response' frames 
//  make buffer empty  do we have at least one package? 
//  unknown input should be ignored 
//  Modify our current request to reflect the original one 
//  For now, sendfile is not supported with SSL 
// package private fields for unit tests 
//  Configure the rules we need for shutting down 
//  No need for overflow protection here. Decrement can never be larger   the Integer.MAX_VALUE and once windowSize goes negative no further   decrements are permitted 
//  local-encoding-mapping-list was added in 2.4 so should be excluded in 
//  note, that we can avoid (long -> Long) conversion 
//  POOL-324 org.apache.commons.pool2.impl.GenericObjectPool.getFactoryType() throws   java.lang.ClassCastException     A bit hackish, but we must handle cases when getGenericType() does not return a concrete types. 
//  Check for success 
//  Cipher 36 
//  Object[] 
// --Instance Variables-------------------------------------- 
/*      * Negative test, when a CORS request arrives, with no origin header.      */
//  This test requires that modificationTestInterval is set to zero in   web.xml. If not, a sleep longer that modificationTestInterval is   required here. 
// xsize length 
//  Too many cookies 
//  Expected to fail because when the RD processes this as unencoded it   sees /aa?bb=cc/target which it thinks is a query string. This is why   Tomcat encodes by default. 
//  Ignore Connector attribute used internally but set on Server 
//  Use the maximum possible 
//  Pool for the specified interval 
/*      * Code borrowed heavily from Jasper's EncodingDetector      */
/*          * This is only called from the SocketWrapper to ensure that it is only         * called once per socket. Calling it more than once typically results         * in the JVM crash.          */
//  It will be >0 if the standard error page handling has been   triggered 
/*  As server, disallow session resumption on renegotiation  */
//  Populate the TagLibraryInfo attributes   Never null. jspError always throws an Exception 
//  Mixed 
//  No allocation   Close the connection. Do this first since 
//  This seems wrong but it is what the spec says... 
//  it has stopped. 
//  Pool exhausted, nothing to do here 
/*  We only poll and run the runnable events when we start this             * method. Further events added to the queue later will be delayed             * to the next execution of this method.             *             * We do in this way, because running event from the events queue             * may lead the working thread to add more events to the queue (for             * example, the worker thread may add another RunnableAdd event when             * waken up by a previous RunnableAdd event who got an invalid             * SelectionKey). Trying to consume all the events in an increasing             * queue till it's empty, will make the loop hard to be terminated,             * which will kill a lot of time, and greatly affect performance of             * the poller loop.              */
//  Make the DIR appear to have been created earlier 
//  what we do now is push one parameter onto the top set of parameters 
//  case B: evaluate the identity against the ELResolver, again, must be 
/*  SSL_kDHE   - tmp DH key no DH cert  */
//  Socket was probably closed before client had a chance to read   response 
//  Unable to find way to avoid this 
//  Cipher 39 
/*  SC_REQUEST_TIMEOUT  */
//  Add this user and corresponding directory 
//  Clear the implTable map 
//  Start our child containers, if any 
//  Redirection to a folder 
//  copy const pool index zero not in class file 
//  Query Thread Pools 
//  Wildcard wrapper 
/*      * @deprecated Use {@link #subtract()}.     *             This method will be removed in Tomcat 10      */
//  multi-part-config added in Servlet 3.0 
//  Protected so unit tests can use it 
//  Make sure that HostConfig thinks the WAR has been modified. 
//  UTF-8 is up to 4 bytes per character   String constants are limited to 64k bytes 
/*      * A handle to the unique Library singleton instance.      */
//  Publish the ordered fragments. The app does not need to know   about container fragments 
//  Once this is called, the mapping from socket to wrapper will no   longer be required. 
//  Cipher 38 
//  Only delete resources in the appBase or the host's 
//  No need to be volatile. This is written and read in a single thread   (when stopping a context and firing the  listeners) 
//  needed objects 
/*                      * Page directive's 'import' attribute is considered                     * further down, and its 'pageEncoding' and 'contentType'                     * attributes are ignored, since we've already appended                     * a new page directive containing just these two                     * attributes                      */
/*      * See org.xml.sax.ext.LexicalHandler.      */
//  Skip test resources 
//  3. Default 
//  Reinvoke the whole request recursively 
//  Has this system identifier been registered? 
//  Split into in and out 
//  Let thread die 
/*      * STATE VARIABLES *      */
//  First byte E0, second byte A0..BF 
//  Cipher 33 
// *********************************************************************   Class for storing LineInfo data 
//  make buffer readable 
//  Copy the WAR file 
//  Get the last modified timestamp for the expanded dir 
//  Look up the cached Principal associated with this cookie value 
//  Expected to fail 
/*          * Points to the next available object in the stack          */
//  Required if the child is destroyed directly. 
//  Fourth - default 
// we still have data to write 
//  Read remaining frames 
/*  APR_MAJOR_VERSION  */
/*      * Handles an I/O error on the socket underlying the HTTP/2 connection when     * it is triggered by application code (usually reading the request or     * writing the response). Such I/O errors are fatal so the connection is     * closed. The exception is re-thrown to make the client code aware of the     * problem.     *     * Note: We can not rely on this exception reaching the socket processor     *       since the application code may swallow it.      */
//  Return the absolute path to our new document base directory 
//  Process characters before first star 
//  Zone ID 
// the SSL engine result 
/* org.apache.coyote.Constants.STAGE_PREPARE */
//  So the first compact does the right thing 
//  ---------------------------------------------------------- Class methods 
//  Endpoints are ordered by timeout expiry so if this point   is reached there is no need to check the remaining   endpoints 
//  catch InstanceNotFoundException when StoreConfig is not enabled instead of printing   the failure message 
//  Cipher 32 
/*      * Simulates a class that gets picked up for extending Endpoint and for     * being annotated.      */
/*      * Parses a attribute directive with the following syntax:     * AttributeDirective ::= ( S Attribute)*      */
//  Hide default constructor as this is a utility class 
//  ----------------------------------------Filter Config Init param-name(s) 
/*  no such ciphersuite supported!  */
// membership change 
// We start a literal, which we need to quote 
//  No explicit pages, we'll process all .jsp in the webapp 
//  The static final fields above are used for the original static byte[] methods on Base64.   The private member fields below are used with the new streaming approach, which requires   some state be preserved between calls of encode() and decode(). 
//  Can't happen with UTF-8 
//  Avoid protocol relative redirects 
// the boolean method had the wrong  parameter types. lets try the other 
//  Close the header reader 
//  Note: testing requires that ' ' is encoded as '+',   because that is what browsers will send us. 
//  If the canonicalDocBase ends with File.separator, add one to   docBase before they are compared 
//  that the body should always be treated as FORM data. 
//  Index page in sample is 100 bytes 
//  Indexed properties are not persisted 
//  EOF 
//  Deliberately do not use Vary.parseVary as it will skip invalid values. 
//  Need to set the fireListener flag otherwise when the   container tries to trigger onWritePossible, nothing will 
//  Check invalid input is rejected straight away 
//  Configure the security constraints 
//  Cipher 35 
//  Otherwise it's a string 
//  Zero length values deliberately trigger an exception 
/*  GCM based TLS v1.2 ciphersuites from RFC5289  */
//  Name only cookie 
//  EDH -> DHE 
//  Check this is a reference to a base and a property 
//  Get the context-relative resource path, so as to not   disclose any local filesystem details 
//  This could be blank, relative, absolute or canonical 
//  Actions for basic start/end processing. 
//  VERIFY IMAGE/JPG 
//  Note: This class is not used for HTTP upgrade so only need to test         for async 
//  Create cookies 
//  Allocate new ByteEntry for the lookup 
//  Sync on JspServletWrapper when calling ctxt.compile() 
//  Check the container for the specified attribute 
//  is this an allowed type for SSI processing? 
//  change ordering 
//  Reset the stream back to the start to allow the XML prolog detection 
//  Get the actual locale, which may be different from the requested one 
//  Start treating the rest as JSP Pages 
//  Assumption is that method parameters, if present, will be the last   child 
//  Cipher 34 
//  Need access to implementation methods for configuring unit tests 
// safe 
//  Add the remaining unreserved characters 
//  close channel on EOF, invalidates the key 
//  Throw away our current class loader if any 
//  maybe quoted printable. 
//  Some validation depends on correct public ID 
//  Configure a context with digest auth and a single protected resource 
//  This alias was introduced in 1.0.2 
//  Ignore (shouldn't happen) 
//  processing of further requests 
//  --------------------------------------------------- DynamicMBean Methods 
/*  * Servlet that enables remote management of the web applications installed * within the same virtual host as this web application is.  Normally, this * functionality will be protected by a security constraint in the web * application deployment descriptor.  However, this requirement can be * relaxed during testing. * <p> * This servlet examines the value returned by <code>getPathInfo()</code> * and related query parameters to determine what action is being requested. * The following actions and parameters (starting after the servlet path) * are supported: * <ul> * <li><b>/deploy?config={config-url}</b> - Install and start a new *     web application, based on the contents of the context configuration *     file found at the specified URL.  The <code>docBase</code> attribute *     of the context configuration file is used to locate the actual *     WAR or directory containing the application.</li> * <li><b>/deploy?config={config-url}&amp;war={war-url}/</b> - Install and start *     a new web application, based on the contents of the context *     configuration file found at <code>{config-url}</code>, overriding the *     <code>docBase</code> attribute with the contents of the web *     application archive found at <code>{war-url}</code>.</li> * <li><b>/deploy?path=/xxx&amp;war={war-url}</b> - Install and start a new *     web application attached to context path <code>/xxx</code>, based *     on the contents of the web application archive found at the *     specified URL.</li> * <li><b>/list</b> - List the context paths of all currently installed web *     applications for this virtual host.  Each context will be listed with *     the following format <code>path:status:sessions</code>. *     Where path is the context path.  Status is either running or stopped. *     Sessions is the number of active Sessions.</li> * <li><b>/reload?path=/xxx</b> - Reload the Java classes and resources for *     the application at the specified path.</li> * <li><b>/resources?type=xxxx</b> - Enumerate the available global JNDI *     resources, optionally limited to those of the specified type *     (fully qualified Java class name), if available.</li> * <li><b>/serverinfo</b> - Display system OS and JVM properties. * <li><b>/sessions</b> - Deprecated. Use expire. * <li><b>/expire?path=/xxx</b> - List session idle time information about the *     web application attached to context path <code>/xxx</code> for this *     virtual host.</li> * <li><b>/expire?path=/xxx&amp;idle=mm</b> - Expire sessions *     for the context path <code>/xxx</code> which were idle for at *     least mm minutes.</li> * <li><b>/sslConnectorCiphers</b> - Display diagnostic info on SSL/TLS ciphers *     that are currently configured for each connector. * <li><b>/start?path=/xxx</b> - Start the web application attached to *     context path <code>/xxx</code> for this virtual host.</li> * <li><b>/stop?path=/xxx</b> - Stop the web application attached to *     context path <code>/xxx</code> for this virtual host.</li> * <li><b>/threaddump</b> - Write a JVM thread dump.</li> * <li><b>/undeploy?path=/xxx</b> - Shutdown and remove the web application *     attached to context path <code>/xxx</code> for this virtual host, *     and remove the underlying WAR file or document base directory. *     (<em>NOTE</em> - This is only allowed if the WAR file or document *     base is stored in the <code>appBase</code> directory of this host, *     typically as a result of being placed there via the <code>/deploy</code> *     command.</li> * <li><b>/vminfo</b> - Write some VM info.</li> * <li><b>/save</b> - Save the current server configuration to server.xml</li> * <li><b>/save?path=/xxx</b> - Save the context configuration for the web *     application deployed with path <code>/xxx</code> to an appropriately *     named context.xml file in the <code>xmlBase</code> for the associated *     Host.</li> * </ul> * <p>Use <code>path=/</code> for the ROOT context.</p> * <p>The syntax of the URL for a web application archive must conform to one * of the following patterns to be successfully deployed:</p> * <ul> * <li><b>file:/absolute/path/to/a/directory</b> - You can specify the absolute *     path of a directory that contains the unpacked version of a web *     application.  This directory will be attached to the context path you *     specify without any changes.</li> * </ul> * <p> * <b>NOTE</b> - Attempting to reload or remove the application containing * this servlet itself will not succeed.  Therefore, this servlet should * generally be deployed as a separate web application within the virtual host * to be managed. * <p> * The following servlet initialization parameters are recognized: * <ul> * <li><b>debug</b> - The debugging detail level that controls the amount *     of information that is logged by this servlet.  Default is zero. * </ul> * * @author Craig R. McClanahan * @author Remy Maucherat  */
//  Should not be adding an alias for a host that doesn't exist but   just in case... 
//  if we have a transaction, out delegate becomes the shared delegate 
//  Confirm that a closed connection is closed 
/*      * Multiple instances of the same Host header      */
//  Need to convert the salt to bytes to apply it to the user's 
//  Normalize the name by running it through the name parser. 
//  Not obviously in OpenSSL format. May be a single OpenSSL or JSSE   cipher name. May be a comma separated list of cipher names 
//  Prepare context for the second attempt   Configuration was cleared on stop() thanks to   StandardContext.resetContext(), so we need to configure it again 
//  Always strip off the leading '/' to get the JAR path and make   sure it ends in '/' 
//  WebSocket extensions 
//  Should never happen, but just in case ... 
//    Reading the header value (which can be spanned over multiple lines)   
//  Special case for the root context 
//  At this point we need to determine if we have a WAR file in the   appBase that needs to be expanded. Therefore we consider the absolute   docBase NOT the canonical docBase. This is because some users symlink 
//  Initialize our defined Services 
//  Switch to WebSocket 
//  Double checked locking OK as threadMxBean is volatile 
//  the default relative url 
//  Single JSSE name 
//  The boolean we found is a payload, not a last flag 
//  this was a soft linebreak inserted by the encoding.  We just toss this away   on decode. 
//  Additive 
//  If the buffer is empty, it is possible to write to it 
//  Ignore 
//  We didn't get a socket 
//  Lazy eval - if we don't need to compile we probably don't need the project 
//  Handles a Pre-flight CORS request. 
//  Stops IDE complaining about possible NPE 
//             throw new IllegalArgumentException                  ("Error Page resource path must start with a '/'"); 
//  State 
//  Send the initial settings frame 
//  Regardless of success, so that we can do cleanup on configure_stop 
//  Run the cached runnables. 
//  Read the mechTypes into an ordered set 
//  This can occur if an async listener does a dispatch to an async   servlet during onTimeout 
//  Put a placeholder here for now, so other instances will not 
//  Return the results of this method invocation 
//    Reading the header name   Header name is always US-ASCII   
//  ---------------------------------------------------- FilterChain Methods 
//  Check that there are not more sets of parameters than there are 
//  Load Server key and certificate 
//  Load the contents of the database file 
// this should never happen 
// register to read new data, before we send it off to avoid dead locks 
//  {} will get parsed as an empty Set as there is nothing to hint to the   parser that Map is expected here. 
/*          * This method creates valid base64 blobs with optional trailing data          */
/*      * Cipher 0x5600  TLS_FALLBACK_SCSV     *     * No other ciphers defined until 0xC001 below      */
//  Cipher 31 
//  http, https 
//  Test that the end of literal in EL expression is recognized in   parseEL(), be it quoted with single or double quotes. That is, that   AttributeParser correctly switches between parseLiteral and parseEL   methods.     The test is based on the difference in how the '\' character is printed:   when in parseLiteral \\${ will be printed as ${'\'}${, but if we are still   inside of parseEL it will be printed as \${, thus preventing the EL   expression that follows from being evaluated. 
//  if the application doesn't define one)? 
//  Should never be called since handleException() called with a   Throwable in the generated servlet. 
/*      * Store nested Element Value Arrays     *     * @see org.apache.catalina.config.IStoreFactory#store(java.io.PrintWriter,     *      int, java.lang.Object)      */
//  May also see this with NIO   Make sure the test passes if we do 
//  --------------------------------------------------- OutputFilter Methods 
//  build the LineInfo 
/*  Process Resources annotation.         * Ref JSR 250          */
//  Add the Lock-Token header as by RFC 2518 8.10.1 
//  PooledConnection 
/*  Whether to use begin of request or end of response as the timestamp  */
//  An error this early means the URI is invalid. Ensure invalid data   is not passed to the mapper. Note we still want the mapper to   find the correct host. 
//  Installation logic (from Robert Field, JSR-045 spec lead) 
//  Protected fields 
//  These were implemented in 1.1.0 so won't be available in any   earlier version 
//  Added from Oracle JDK 10.0.2 
// if the max header size has been changed  records the smallest value of newMaxHeaderSize, as per section 4.1 
//  If TLSv1.3 is not implemented and not explicitly requested we can 
//  Cipher 30 
//  Set URI as "/" 
//  essentially same search algorithm as findCGI() 
// we are done reading 
//  Should be a body chunk message 
//  Not thread-safe but if one of multiple increments is lost   that is not a big deal since the fact that there was any   duplicate is a much bigger issue. 
//  Zero is a special case and negative values are invalid 
//  Deploy XML descriptor from configBase 
//  ------------------------------------------------------- Package Methods 
//  -------------------- Parameters -------------------- 
//  Initialize the attributes for this request 
// disconnect senders 
//  send ping 
//  Origin check 
//  Socket was closed in another thread while still in   the Poller but wasn't removed from the Poller before   new data arrived. 
//  Log only if processing was invoked. 
// content panes must be opaque 
//  Haven't finished reading the request so keep the socket   open 
//  thread to the thread checking the timeout. 
//  Treated as if parameters have been provided so src is ignored 
//  Encoded with 4 bytes. inIndex currently points   to the final byte. Move it back to first byte. 
//  Correct match is the first one that matches. 
//  no-op 
//  parse header   HEADER_VALUE_START 
//  Process the filesets and populate the list of files that need to be   signed. 
//  clear parameter 
//  If the ETag the client gave does not match the entity   etag, then the entire entity is returned. 
//  --------------------------------------------------- Instance Variables 
/*          * Anything and everything can override the global and host defaults.         * This is implemented in two parts         * - Handle as a web fragment that gets added after everything else so         *   everything else takes priority         * - Mark Servlets as overridable so SCI configuration can replace         *   configuration from the defaults          */
// if the session has been idle twice as long as allowed,  the primary session has probably crashed, and no other  requests are coming in. that is why we do this. otherwise  we would have a memory leak 
//  Parse flag which have substitution values 
//  Convert IP addresses to strings so they will be persisted 
//  the web application was stopped. 
//  JSP servlet (by class name - to avoid loading all deps) 
//  Ensure background processing for Contexts and Wrappers 
//  Scan the Principals for this Subject 
//  ============== JSP 2.0 TLD Information ======== 
// stops the test 
//  if the ? is the last character delete it, its only purpose was to   prevent the rewrite module from appending the query string 
//  NOOP - test code 
//  This setting means the connection will be closed at the end of the   request 
// ai.setGetMethodObj( gm ); 
//  XXX: Pool 3: move test   out of sync block 
//  Start our defined Services 
//  Never do this in production code. It triggers an XSS. 
//  Update binary text size handled by session 
// else the request went through before being marked as stuck, no need 
//  Add socket to the poller 
//  Need to write out the bytes and may need to read from   the source again to empty it 
//  Try all types to find an suitable alias 
/* end the cache size */
//  Simple SSO case 
//  This is effectively a NO-OP 
//  Skip any leading white space 
//  Configure default manager if none was specified 
//  System admin has explicitly changed the default 
//  413/414 aren't really correct here since the request body   and/or URI could be well below any limits set. Use the   default. 
//  Is redirecting disabled? 
// scope flag 
// perform any tasks if needed 
//  Avoid NPEs if selector is set to null on stop. 
/*  SC_INTERNAL_SERVER_ERROR  */
//  Add fragment mappings 
//  At the end the postconstruct annotated 
//  Cancels all remaining keys 
//  application has already set one 
//  Test all possible input orders since some bugs were discovered that   depended on input order 
//  Indicates that a compatible type could not be identified that   worked for all injection targets 
/*      * Expose data written for use by unit tests.      */
//  an ACK. For that use case coyoteRequest, protocol and stream will be null. 
//  CONNECT for proxy may return a 1.0 response 
//  help GC 
//  Store nested <Ejb> elements 
//  Make sure this constraint is currently present 
//  Connection window is zero.   Stream window is 8k 
/*      * Outermost (in the nesting hierarchy) node whose body is declared to be     * scriptless. If a node's body is declared to be scriptless, all its     * nested nodes must be scriptless, too.      */
/*      * A stack to keep track of the 'current base directory'     * for include directives that refer to relative paths.      */
//  Return the default 
//  First byte C2..DF, second byte 80..BF 
//  Construct the "class path" for this class loader 
//  Debug so no need for i18n 
//  body content declared in the TLD. 
//  Files visible in some configurations only 
//  Only 2.6.0 applications set this 
//  if 'varReader' or 'var' attribute is specified 
//  Use internal version to avoid loop when needConvert is true 
//  make sure we aren't already in another tx 
//  Added from OpenJDK 11.0.1 
//  Workaround for Adobe Read 9 plug-in on IE bug   Can be removed after 26 June 2013 (EOL of Reader 9)   See BZ 53814 
//  Destroy and reallocate the poller 
//  Access logging 
//  Broadcast the Draw Message. 
//  Step 3. Look for ServletContainerInitializer implementations 
//  The key was cancelled (e.g. due to socket closure)   and removed from the selector while it was being   processed. Count down the connections at this point   since it won't have been counted down when the socket   closed. 
//  Don't update the cache if an error occurs 
//  NO_OP 
/*          * The tests are all setup for HTTP so need to convert the protocol         * values to AJP.          */
//  Parameter of an @OnClose call 
//  1 for leading '/', 6 for ".class" 
//  Cannot instantiate the specified class, either a   compilation error or a runtime error will be raised,   depending on a compiler flag. 
//  Last accessed time 
//  stops the test 
// check to see if threads are waiting for an object 
//  initialised 
//  Give the in progress async requests a chance to complete 
//  And the default error handling 
//  '@' in the authority delimits the userinfo 
//  Optional publicId attribute 
//  Add sockets which are waiting to the poller 
//  Ignore messages preceding first error 
//  Create char array and copy chars 
//  Should not be the case but check to be sure 
/*      * fields      */
//  Special case where the read completed inline, there is no notification   in that case so it has to be done here 
//  Copy the text in buffer into the first template text node. 
//  Have to add in a separate loop since spec requires no updates at all   if there is an issue 
//  Setup realm 
// while 
//  The application is reading the HTTP request body which is   always a blocking operation. 
//  ActionBody 
//  to pass on to the next transformation. 
// 64MB 
/*                  * Instantiate the bean if it is not in the specified scope.                  */
//  Move the removed Stream's children to the removed Stream's   parent. 
/*  * Access <em>JMX</em> JSR 160 MBeans Server. * <ul> * <li>open more then one JSR 160 rmi connection</li> * <li>Get/Set Mbeans attributes</li> * <li>Call Mbean Operation with arguments</li> * <li>Argument values can be converted from string to * int,long,float,double,boolean,ObjectName or InetAddress</li> * <li>Query Mbeans</li> * <li>Show Get, Call, Query result at Ant console log</li> * <li>Bind Get, Call, Query result at Ant properties</li> * </ul> * * Examples: open server with reference and authorisation * * <pre> * *    &lt;jmxOpen *            host=&quot;127.0.0.1&quot; *            port=&quot;9014&quot; *            username=&quot;monitorRole&quot; *            password=&quot;mysecret&quot; *            ref=&quot;jmx.myserver&quot; *        /&gt; * * </pre> * * All calls after opening with same refid reuse the connection. * <p> * First call to a remote MBeanserver save the JMXConnection a referenz * <em>jmx.server</em> * </p> * All JMXAccessorXXXTask support the attribute <em>if</em> and * <em>unless</em>. With <em>if</em> the task is only execute when property * exist and with <em>unless</em> when property not exists. <br><b>NOTE * </b>: These tasks require Ant 1.6 or later interface. * * @author Peter Rossbach * @since 5.5.10  */
//  Initialize fd from data given 
//  this may block for a long time, upon return the   selected set contains keys of the ready channels 
//  Load classes now to prevent AccessControlExceptions later   A number of classes are loaded when getConnection() is called   but the following classes are not loaded and therefore require   explicit loading. 
// fall down to NEED_UNWRAP on the same call, will result in a  BUFFER_UNDERFLOW if it needs data 
//  HTTP date formats 
//  No change 
//  Listeners are invoked and access valve entries created on a different 
//  Context that we expect to get for that version 
//  Stop the evictor before the pool is closed since evict() calls   assertOpen() 
//  See comment in closeFragment() 
//  No user or no credentials   Can't possibly authenticate, don't bother doing anything. 
//  Ran out of message buffer - flush it 
// make sure we actually did clean up when the pool closed 
/*                      * In the case of a deferred accept / accept filters we need to                     * send data to wake up the accept. Send OPTIONS * to bypass                     * even BSD accept filters. The Acceptor will discard it.                      */
//  Sub-protocol 
//  No data received. 
//  handle deferredMethod and deferredMethodSignature 
//  Section 5.1.1 
//  JSP8.5.2: for a fragment type is fixed and rexprvalue is true 
//  Not possible 
//  Cipher 2F 
//  uri is passed to the constructor for ApplicationDispatcher and is   ultimately used as the value for getRequestURI() which returns   encoded values. Therefore, since the value passed in for path   was decoded, encode uri here. 
//  Check the expected type 
//  Print the file epilog 
//  startup) this saves an unnecessary check of the source. 
//  If there are no filter mappings, we are done 
//  Process in bytes (this is default format so this is normally a NO-OP 
//  Switching to read 
//  Configure cipher suite that requires an RSA certificate on the server 
//  more, the notion of separator might be introduced 
//  Cipher 2E 
//  async-supported added to Servlet and Filter in 3.0 
/*  JavaCC - OriginalChecksum=7da4e668c47dee63e10c9b008699a2ca (do not edit this line)  */
/*      *  This flag forces the rewriting engine to skip a rewriting rule if the     *  current request is an internal sub-request. For instance, sub-requests     *  occur internally in Apache when mod_include tries to find out     *  information about possible directory default files (index.xxx). On     *  sub-requests it is not always useful and even sometimes causes a     *  failure to if the complete set of rules are applied. Use this flag to     *  exclude some rules. Use the following rule for your decision: whenever     *  you prefix some URLs with CGI-scripts to force them to be processed by     *  the CGI-script, the chance is high that you will run into problems (or     *  even overhead) on sub-requests. In these cases, use this flag.      */
//  key: operation val: invoke method 
//  Get the sendfile state 
//  Requested name isn't in the list so it isn't in this   package so move on to next package. This allows the   class loader look-up to be skipped. 
//  one. 
//  Defaults to DriverConnectionFactory 
//  Greater than 
//  Create and return a new information object 
//  Send the image as binary message. 
//  We cheat a little and start an artificial   group right away. It makes finishing easier. 
//  Stop our defined Container second 
/*      * Helper method that returns the directory where Tomcat build resides. It     * is used to access resources that are part of default Tomcat deployment.     * E.g. the examples webapp.      */
/*      * Return the logon password of this user, optionally prefixed with the     * identifier of an encoding scheme surrounded by curly braces, such as     * <code>{md5}xxxxx</code>.      */
// Now we have 3 initialized busy connections 
//  Case 1 - Exact Match 
//  Note: cannot be static, as we need to reference things like   _jspx_meth_* 
//  -------------------------------------------------------- Private methods 
//  Use a Deque so URLs can be removed as they are processed   and new URLs can be added as they are discovered during 
//  ---------------------------------------------------- ClassLoader Methods 
//  Cipher 2D 
//  Start our defined Container first 
/*                  * If both class name and beanName is not specified, the bean                 * must be found locally, otherwise it's an error                  */
/*      * Verify that "*" and "identity" values are handled correctly in accept-encoding header.      */
//  Reload catches and logs exceptions 
//  parse header   HEADER_VALUE 
//  :: represents at least one h16 block 
//  Need to do this with the right thread context class loader else the   first web app to call this will trigger a leak 
/*      * Helper method that returns the path of the temporary directory used by     * the test runs. The directory is configured during {@link #setUp()}.     *     * <p>     * It is used as <code>${catalina.base}</code> for the instance of Tomcat     * that is being started, but can be used to store other temporary files as     * well. Its <code>work</code> and <code>webapps</code> subdirectories are     * deleted at {@link #tearDown()}. If you have other files or directories     * that have to be deleted on cleanup, register them with     * {@link #addDeleteOnTearDown(File)}.      */
//  A socket can only be added to the poller   once. Adding it twice will return an error   which will close the socket. Therefore make   sure the socket we are about to add isn't in   the poller. 
// uniqueId length 
/*              * Netscape style plugin part              */
//  ejb-local-ref was introduced in Servlet 2.3 
//  Chances of a size change between these lines are small enough that a   sync is unnecessary. 
/*  * This class represents a front-end httpd server. *  */
// make client parsing easier 
//  Assume starts with L, ends with ; and uses / rather than . 
//  Close this database connection, and log any errors 
//  &quot; 
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#isReadOnly(javax.el.ELContext)      */
//  Sendfile support 
/*      * Not completely thread-safe but good enough for this use case. I couldn't     * see a simple enough way to make it completely thread-safe that was not     * likely to compromise performance.      */
//  Generate content with a simple known format that will exceed the   default flow control window for a stream. 
/*          * verify the server response html body is the page we expect,         * based on the dialogue position within doTest.          */
//  Loop until one char is encoded or there is a encoder error 
//  Check timeouts if the poller is empty. 
//  Short-cut if only * has been set 
//  Now the service method 
//  Create the runnables & threads 
//  SSL certificate extraction is lazy, moved to JkCoyoteHandler 
//  Streams currently active. Individual streams have   timeouts so keep the connection open. 
/*                  * Several components end up calling:                 * sun.awt.AppContext.getAppContext()                 *                 * Those libraries / components known to trigger memory leaks                 * due to eventual calls to getAppContext() are:                 * - Google Web Toolkit via its use of javax.imageio                 * - Batik                 * - others TBD                 *                 * Note tha a call to sun.awt.AppContext.getAppContext() results                 * in a thread being started named AWT-AppKit that requires a                 * graphical environment to be available.                  */
//  Only warn if the attribute has been explicitly configured 
//  Then try URI. 
//  The buffer wasn't fully flushed so re-register the   stream for write. Note this does not go via the   Response since the write registration state at   that level should remain unchanged. Once the buffer   has been emptied then the code below will call   dispatch() which will enable the   Response to respond to this event. 
//  Use fast, insecure session ID generation for all tests 
//  Create a reference to the EJB. 
//  Stack methods 
// We need to fetch this value each time, since it may change   during the   loop 
//  write a chunk out 
//  PUT requests are normally blocked for JSPs 
//    Make sure POST works properly   
/*      * For unit testing.      */
//  getQuotedValue returns the position before   at the last quote. This must be dealt with 
//  Figure out which files are sessions 
//  Release the remaining body 
//  BZ 62596 
//  to be passed from an authenticator 
//  Configure app for BASIC auth 
//  Add the path info, if there is any 
//  Additive apart from welcome pages 
/*      *  Note: Package private to enable testing without reflection      */
//  DES_192_EDE3_CBC_WITH_MD5 
//  Spec says single SP but also be tolerant of multiple SP and/or HT 
//  Add all fragments not named explicitly at this point 
//  Get compiler version 
//  Get interface information, i.e., implemented interfaces 
//  Remove the specified listener 
//  are we calling isClosed? 
/*              * Tomcat Native stores a count of the completed handshakes in the             * SSL instance and increments it every time a handshake is             * completed. Comparing the handshake count when the handshake             * started to the current handshake count enables this code to             * detect when the handshake has completed.             *             * Obtaining client certificates after the connection has been             * established requires additional checks. We need to trigger             * additional reads until the certificates have been read but we             * don't know how many reads we will need as it depends on both             * client and network behaviour.             *             * The additional reads are triggered by returning NEED_UNWRAP             * rather than FINISHED. This allows the standard I/O code to be             * used.             *             * For TLSv1.2 and below, the handshake completes before the             * renegotiation. We therefore use SSL.renegotiatePending() to             * check on the current status of the renegotiation and return             * NEED_UNWRAP until it completes which means the client             * certificates will have been read from the client.             *             * For TLSv1.3, Tomcat Native sets a flag when post handshake             * authentication is started and updates it once the client             * certificate has been received. We therefore use             * SSL.getPostHandshakeAuthInProgress() to check the current status             * and return NEED_UNWRAP until that methods indicates that PHA is             * no longer in progress.              */
//  and get handled as normal text. 
//  ---------------------------------------------------- Wrapper Inner Class 
//  Read goes before write 
//  These two lines just mean EasyMock.expect(response.addCookie) but for a void method 
//  HTTP 1.0   HTTP 1.1   0 means now 
//  Make sure socket/processor is removed from the list of current 
//  Authentication 
//  --------------------------------------------------------- SendHandler 
//  Need to override the default for maxConnections to align it with what 
//  Save the body text accumulated for our surrounding element 
//  First group checks for '*' or '/foo*' style patterns   Second group checks for *.foo.bar style patterns 
//  allow close to be called multiple times 
//  Data should be the value 9 
//  should result in chunking on HTTP 1.1 
/*      * Checks that the unit tests are running with a version of OpenSSL that     * includes all the expected ciphers and does not include any unexpected     * ones.      */
//  Must only call this once else the usage counting will break 
/*  Given that findClass() has to be called for every imported             * package and that getResource() is a lot faster then loadClass()             * for resources that don't exist, the overhead of the getResource()             * for the case where the class does exist is a lot less than the             * overhead we save by not calling loadClass().              */
//  Verify there are the correct Tomcat MBeans 
//  Generate mapping 
//  save the current pool parameters to restore them later 
//  Disable the following of redirects for this test only 
//  Expected to handle message types of <String> only 
//  Check the imports 
//  Configure a JSP page to handle the 500 error response   The JSP page will see the same method as the original request (PUT) 
//  -------------------- Statistical data  -------------------- 
//  URI of the request that took maxTime 
//  Need to use the content length here as variations in Connector and   JVM+OS behaviour mean that in some circumstances the client may see   an IOException rather than the response body when the server closes 
//  wraps a SizeException, re-throw as it will be unwrapped later 
//  Check end of quote, skip closing quote: 
//  connection is marked as closed. 
//  Offset the current time by the resolution of File.lastModified() 
//  Negotiate a login via this LoginContext 
//  The characters that are normally not permitted for which the   restrictions may be relaxed when used in the path and/or query 
//  UTF-8 with a BOM 
//  Add host aliases 
//  Removing Ejbs 
//  Set this every time in case limit has been changed via JMX 
//  save "setProperty" for later 
//  Anything in the java or javax package that 
//  Avoid duplicate timeout calls 
//  Included resource, add to dependent list 
//  We don't know the encoding, so use BOM to determine it 
//  Now use a settings frame to reduce the size of the flow control 
//  Once the state is set to STOPPING, the Context will report itself as 
//  Unregister with MBean server 
//  Diagnostics section 
// ============================================================================================================                HELPER CLASSES FOR COORDINATION  ============================================================================================================ 
//  Don't override a previously set content type 
//  instance variable just in case it needs to vary later 
//  Click-jacking protection 
//  Implementation of integer encoding used for crypto 
//  ------------------------------------------------------- FileItem methods 
//  Cipher 2C 
//  Get the representation of the TLD 
//  Component not pre-registered so register it 
//  Special case since   javax.servlet.jsp.el.ScopedAttributeELResolver will   always return Object.class for type 
//  host and port 
//  No q value just whitespace 
//  After recycling, only instances of UpgradeProcessorBase   will return true for isUpgrade().   Instances of UpgradeProcessorBase should not be added to   recycledProcessors since that pool is only for AJP or   HTTP processors 
//  Requires an 11GB heap (on markt's desktop - YMMV) 
// and finally check the footer of the package END_DATA 
/*  NOOP  */
//  Internal use only - don't worry about immutability 
//  Accessor methods 
//  Static data for getDependants() 
//  Cache the principal (if requested) and record this authentication 
//  Shouldn't happen. Skip registration if it does. 
//  Create the folder that will trigger the redirect 
//  In the middle of processing a request/response. Keep the   socket associated with the processor. Exact requirements   depend on type of long poll 
/*  Is the O_NONBLOCK flag inherited from listening sockets?      */
//  type 0 (data) 
//  Handle primitives 
//  Short-cut if "*" is added 
/*      * Checks to see if the given page contains, as its first element, a <root>     * element whose prefix is bound to the JSP namespace, as in:     *     * <wombat:root xmlns:wombat="http://java.sun.com/JSP/Page" version="1.2">     *   ...     * </wombat:root>     *     * @param reader The reader for this page     *     * @return true if this page contains a root element whose prefix is bound     * to the JSP namespace, and false otherwise      */
// get the context 
//  When the server starts, configure JMX/RMI 
//  ---------------------------------------------------- Manifest Constants 
//  Reconfigure the enabled ciphers 
// is the channel closed? 
//  Expected if mount point is zero length 
/*  empty slot: +17  */
//  Same as connector but Mapper rather than Connector 
//  Ignore: Expected if not running on Tomcat. Not a problem since           this just allows a short-cut. 
//  If we swallow whitespace, make sure it counts towards the   limit placed on trailing header size 
//  Want output in range 0 to 255, not -128 to 127 
/*      * Sets the Last-Modified entity header field, if it has not     * already been set and if the value is meaningful.  Called before     * doGet, to ensure that headers are set before response data is     * written.  A subclass might have set this header already, so we     * check.      */
//  We need to explicitly write the message to the log, because   long BuildException messages may be trimmed. E.g. I observed   this problem with Eclipse IDE 3.7. 
//  ----------------------------------------------------- Manifest Constants 
//  Remove all those extra users 
//  -------------------------------------------------------------------   Properties 
/*  no such ciphersuites supported!  */
//  Server name 
//  See also StandardContext.resourcesStart() for   WEB-INF/classes/META-INF/resources configuration 
// default 5 seconds, same as send timeout 
//  No change if currently OPEN 
//  Get the session ID if there was one 
//  DCL requires servletClassLastModifiedTime be volatile   to force read and write barriers on access/set   (and to get atomic write of long) 
//  Fire "finish" events for all defined rules 
//  Saves a couple of calls to getClassLoader() on every request. Under high   load these calls took just long enough to appear as a hot spot (although 
//  Super class defines hashCode() and equals(). Probably not used in 
//  Check for the final resource 
//  11oyyyyy 
//  private fields for 2.0 info 
//  -------------------- JMX  -------------------- 
//  Ensure that if concurrent threads execute this block they   all end up using the same ConcurrentSkipListMap instance 
/*  Are we big endian?  */
/*      * Reverse of Introspector.decapitalize      */
/* org.apache.coyote.Constants.STAGE_ENDOUTPUT */
//  - gone 
/*          * Assumes server is listening on any local address          */
//  Implementation note: userFactories is a   CopyOnWriteArrayList, so items are removed with   List.remove() instead of usual Iterator.remove() 
//  decoded string output 
//  wrap 
/*  Internal function for loading APR sizes  */
//  If the value for beanName was specified via   jsp:attribute, first generate code to evaluate   that body. 
//  Failure to send a close message is not unexpected in the case of   an abnormal closure (usually triggered by a failure to read/write   from/to the client. In this case do not trigger the endpoint's 
//  no new line 
//  No exception is expected 
/*          * Don't concatenate text across body boundaries          */
//  look at each key in the selected set 
//  We chunk the data into slices fitting in the buffer limit, although   if the data is written directly if it doesn't fit 
//  Pass control on to the next filter 
//  priority tree 
/*      * Large request will fill buffer so timeout will occur in application code     * during response write (when Tomcat commits the response and flushes the     * buffer as a result of the buffer filling).      */
//  Can't create objects, no reason to think another call to   create will work. Give up. 
//  Change location of XML file to config base 
// this sucks, but we need to put the length first  and we don't really have any option but to calculate it in advance to make sure we have left enough room  so we end up iterating twice 
//  name-given specified 
//  Filter out SSLv2 from the list of implemented protocols (just in case   we are running on a JVM that supports it) since it is no longer   considered secure but allow SSLv2Hello.   Note SSLv3 is allowed despite known insecurities because some users 
//  the end so they don't interfere with the deletion process 
//  Send 505; Unsupported HTTP version 
//  Simple case - blocking IO 
//  remove locally 
//  If ejb-link has been specified, resolving the link using JNDI 
//  We should have an avpair or name-only cookie at this   point. Perform some basic checks to make sure we are   in a good state. 
//          emptyRoleSemantic = EmptyRoleSemantic.DENY)) 
//  ------------------------------------------------------ HTTP Status Codes 
//  multicast member 
/*   Open and read in file in one fell swoop to reduce chance         *  chance of leaving handle open.          */
//  can't be found 
//  Wait for the poller thread to exit, otherwise parallel   destruction of sockets which are still in the poller can cause   problems. 
//  Some JREs (Gump) construct a class path that includes JARs that   reference additional JARs via the Class-Path attribute of the   Manifest. These JARs are not returned in ClassLoader.getURLs().   Therefore, this test looks for at least as many JARs as there are   URLs but it can't check for an exact match. 
//  Retain the original, user specified character encoding so it can be 
//  APR specific.   Could push this down but not sure it is worth the trouble. 
//  Add an SCI with an interest in Servlets 
//  Loop until we run out of headers 
//  finally, do BASIC reauthentication and get another session 
//  Initialize the digester 
//  Introductory RFC 5952 examples 
//  support it. Uses a set so it is extensible for TLS 1.4 etc. 
//  results buffer 
//  run attrValue through the expression interpreter 
//  Safe to skip the remainder of this method. 
//  Max size of WebSocket header is 14 bytes 
//  Implies tomcatAuthentication == false 
//  -------------------- Access informations -------------------- 
/*      * autoFlush      */
//  Connection aborted or response 400 
//  Release this context 
//  WebSocket 1.1, section 2.1.5 requires this to be CLOSED_ABNORMALLY if   the container initiates the close and the close code from the client   if the client initiates it. When the client resets the TCP connection   after sending the close, different operating systems react different   ways. Some present the close message then drop the connection, some   just drop the connection. Therefore, this test has to handle both   close codes. 
//  ------------------------------------------------ ServletResponse Methods 
/*      * Test for https://bz.apache.org/bugzilla/show_bug.cgi?id=47866      */
//  Calling the container 
//  jchar2 is a low-surrogate. 
//  Buffer was fully written last time around 
//  Non-token characters are illegal in header names   Parsing continues so the error can be reported in context 
//  map to avoid duplicated searching or loading descriptors 
//  Handle poll critical failure 
//  step over the white space characters. 
//  As soon as the operation uses the poller, it is no longer inline 
//  Add dummy proxy sessions 
//  Set the properties on that object (it doesn't matter if extra 
//  Zero compression (2.2) 
// ejb-ref 
// JAAS throws exception different than LoginException so mark the realm as unavailable 
// command - clen bytes 
//  If it's not a collection, then it's an unknown   error 
//  Check for ending with "/." or "/.." 
//  Check for pending data in the network BIO 
//  logic from the super class. 
/*              * If file permissions were going to be set on the newly created             * directory, this is the place to do it. However, even simple             * calls such as File.setReadable(boolean,boolean) behaves             * differently on different platforms. Therefore, setBaseDir             * documents that the user needs to do this.              */
/*      * Try to access an unprotected resource in a webapp that     * does not have a login method defined.     * This should be permitted.      */
//  HTTP header contents 
// default on   default off, valid only when SSLEngine="on" 
//  javax.servlet.jsp.jstl.core.Config.FMT_LOCALE 
//  Note if request times out before this   exception is thrown and the complete call   below is made, the complete call below will   fail since the timeout will have completed   the request. 
//  IOExceptions are normal 
//  File is in directory listing but doesn't appear to exist   Broken symlink or odd permission settings? 
//  null warning suppressed 
//  Only returns non-null iterator if there are   dispatches to process. 
//  Case 2 - Path Match ("/.../*") 
//  Timestamp 
//  A dispatch is always required.   If on a non-container thread, need to get back onto a container   thread to complete the processing.   If on a container thread the current request/response are not the   request/response associated with the AsyncContext so need a new   container thread to process the different request/response. 
// empty operation 
//  BOMs are at least 2 bytes 
//  Look for the attribute in NamedAttribute children 
//  Override anything requested in the URL 
//  DES_64_CBC_WITH_MD5 
/*              * If the template text came from a JSP page written in JSP syntax,             * create a jsp:text element for it (JSP 5.3.2).              */
/*          * Create the GUI and show it.  For thread safety,         * this method should be invoked from the         * event-dispatching thread.          */
//  Roles 
//  handle entity reference nodes 
//  During reloading / redeployment the parent is expected to be   available. Parent is not available so this might be a JVM   shutdown. 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=61120      */
//  .class file 
// There's no way to specify this with SimpleDateFormat 
//  Skip this URL it has already been processed 
//  Remember the prefix for later error checking 
//  send replication 
//  -------------------- Removing -------------------- 
//  Not perfect, but good enough to avoid returning strange values due to   concurrent updates. 
//  Initialize the byte buffer 
//  yet 
/*  implicit  */
//  Found a match 
//  Should trigger an error - can't do both 
//  Background thread, not the thread that triggered the   write so no need to use a dispatch 
//  ------------------------------------------- Connection handler base class 
// return the item we received, can be null if we timed out 
//  Processing this parameter will push us over the limit. ISE is   what Request.parseParts() uses for requests that are too big 
//  Stage 2. Make all fragments that are implicitly before/after            others explicitly so. This is iterative so the next 
//  Implementation of the Encoder Interface 
//  Default ports. Do not include port in host header 
//  Disabled until Bug 62912 is addressed 
//  Before digester - it may be needed 
/*      * Simple test to see how many outgoing connections can be created on a     * single machine.      */
//  Remove this session from our manager's active sessions 
//  Just echo the parameters and values back as plain text 
//  session.setId(sessionId); Only if new ??? 
//  File has been removed. Let caller handle this. 
/*          * 'true' if the syntax (XML or standard) of the file is given         * from external information: either via a JSP configuration element,         * the ".jspx" suffix, or the enclosing file (for included resources)          */
//  copy out a fragment of JSP to display to the user 
//  Cause the cache to roll-around by one and then confirm 
//  Allow static access to default 
//  If 'Origin' header is a case-sensitive match of any of allowed   origins, then return true, else return false. 
//  Does this user have a web application to be deployed? 
//  assert next != null; 
// if we are calling anything else, bail out 
//  Step 1. Identify all the JARs packaged with the application and those   provided by the container. If any of the application JARs have a   web-fragment.xml it will be parsed at this point. web-fragment.xml 
// @javax.websocket.server.ServerEndpoint("/websocket/echoAsyncAnnotation") 
//  There is some duplication in the tests below - it is easier to   check the tests are complete this way. 
//  Log must be non-static as loggers are created per class-loader and this   Filter may be used in multiple class loaders 
//  Retrieve our parent (normally a host) name 
//  Assert that web.xml was parsed and is not empty. Default servlet is known to be there. 
//  Add the CGI environment variables 
//  Look up our global naming context 
//  True if this node is to be trimmed, or false otherwise 
/*      * language      */
//  ----------------------------------------------------------- Serialization 
//  ---------------------------------------------------------- Attributes 
// if the header (START_DATA) isn't the first thing or 
/*      * errorPage      */
//  Start manager 
//  Stream 1 is closed. This should trigger a connection error 
/*      * For UseBean: StdActionContent ::= Attributes OptionalBody      */
//  Get the length of the file used for this test   It varies by platform due to line-endings 
//  JAAS configuration file location 
//  must not be static 
//  JSR45 Support 
/*      * Character translation tables.      */
//  Send j2ee.state.stopped notification 
//  Only returns public methods. Java 9+ access is checked below. 
//  Remove (partially) folders and files created by antiLocking 
//  20-2f + /   30-3f 0-9 
//     @Test 
//  have /../ like sequences in it 
//  Multiple servlets may not be mapped to the same url-pattern 
//  Don't modify the secure, scheme and serverPort attributes   of the request 
//  BZ 63311   Support http and https locations as the move away from http and   towards https continues. 
//  must occur if specified. 
//  Downgrade to read-lock. This ensures the writer remains valid   until the log message is written 
/*      * info      */
//  Document the servlet configuration properties 
//  Recalculate nesting 
// set up the datagram channel 
//  In case queue was already empty. Should only be one   thread waiting but use notifyAll() to be safe. 
//  ::: is not allowed 
//  the individual session expiry time and keep the SSO session alive 
//  default to same as property 
//  Clear the entry so that multiple calls to this method for the   same entry will result in a new InputStream for each call   (BZ 60798) 
//  If this is a bot, is the session ID known? 
//  Send j2ee.object.created notification 
// -------------------------------------------------------------------   functions to convert builtin Java data types to string.  ------------------------------------------------------------------- 
//  User provided eviction policy could throw all sorts of   crazy exceptions. Protect against such an exception 
//  Expected response is a 200 response followed by an incomplete chunked 
// if we have reached max connections, wait 
//  Servlet mappings 
//  Configure the digester 
//  This available optional package satisfies the requirements 
//  Multiple Host headers are not permitted 
//  valve cluster can access manager - other cluster handle turnover   at host level - hopefully! 
//  This might be the name of an imported class 
//  Duplicate path mappings 
//  "status" contains "phase" (which must be "Running") and "podIP" 
//  Insert the context if   1. this valve is associated with a context   2. the url starts with a leading slash 
//  Context failed to start. This checks that automatic transition 
/*      * Implementation note:     * Validation applicable to all incoming frames should be implemented here.     * Frame type specific validation should be performed in the appropriate     * readXxxFrame() method.     * For validation applicable to some but not all frame types, use your     * judgement.      */
//  Need an additional checks for asyncIO as the end of stream   might have been set on the header frame but not processed   yet. Checking for this here so the extra processing only   occurs on the potential error condition rather than on every   request. 
//  Handles a CORS request that violates specification. 
//  Recover the body text from the surrounding element 
//  Ignore - validation failure is more important 
//  The WebResources implementation caches references to JAR files. On   some platforms these references may lock the JAR files. Since web   application start is likely to have read from lots of JARs, trigger 
//  Failure to initialize FIPS mode is fatal 
//  Remove the ShutdownHook first so that server.stop()   doesn't get invoked twice 
//  Get 'base' name 
//  Less than 
/*  Only support OFF and SERVER for now  */
//  Allowed roles should be the union of the roles in the constraints   * is any app role   User role is not in any constraint 
//  strip " 
//  Decoded and normalized URI 
/*                          * self directory in path                         * foo/./bar -> foo/bar                          */
//  Must be pre-Java 9 
//  held here on the certificate. 
//  In terms of finding the end of the value, quoting EL is equivalent to 
/*                      * a single dot at the end of the path - we are done.                      */
//  the name of the tag 
/*      * Separate method to allow Http2AsyncUpgradeHandler to call this code     * without synchronizing on socketWrapper since it doesn't need to.      */
/*  Last step: format new timestamp either using                 * parent cache or locally.  */
//  Make sure no special avpairs can be attributed to   the previous cookie by setting the current cookie 
//  See class javadoc for explanation of this magic number (128) 
//  Force a recompilation attempt on next access 
//  --------------------------------------------------------- Server Methods 
//  Cipher C5 
//  Swallow any request body since we will be replacing it   Need to do this before headers are restored as AJP connector uses   content length header to determine how much data needs to be read for 
//  Parse 'CustomActionBody' production:   At this point we are committed - if anything fails, we produce   a translation error. 
//  Checking if a resource exists at this path 
//  Remove the specified security role 
// if we have data to read, read it 
/*      * Expected behaviour for deployment of an XML file that points to an     * external DIR.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *    Y/N       Y/N       Y/N           Y    N    N     *     * Notes: Any context.xml file embedded in the external DIR file is ignored.      */
//  Default connection window size is 64k-1.   Initial request will have used 8k leaving 56k-1.   Stream window will be 64k-1.   Expecting   1 * headers   56k-1 of body (7 * ~8k) 
//  Return the corresponding MBean name 
/*      * "http://tomcat.apache.org" is an allowed origin and     * "http://tomcat.apache.org:8080" is not, because ports doesn't match     *     * @throws ServletException     * @throws IOException      */
//  Close server socket 
//  Token 
/*      * (non-Javadoc)     *     * @see javax.el.ValueExpression#getType(javax.el.ELContext)      */
//  Use same init parameters 
//  Extra aggressive rootCause finding 
//  We need to break-apart the algorithm name e.g. AES/CBC/PKCS5Padding   take just the algorithm part. 
//  Only allowed one :: sequence 
//  singleton is a boolean so slightly different handling 
//  Validate our current component state 
/*  Page/Tag directive attributes  */
//  servlet/run-as was introduced in Servlet 2.3 
//  Read class fields, i.e., the variables of the class 
//  Build list of potential resource JARs. Use same ordering as ContextConfig 
//  Replace any remaining / 
//  swallowed 
//  End of lock block 
//  NO-OP. Leave state as is. 
//  Set the content-length header for the request 
//  Use the first virtual result if no real result was found 
// addr length  System.arraycopy(xbuf.getBytesDirect(),offset,addr,0,addr.length); 
/*          * The rules for annotation scanning are not as clear-cut as one might         * think. Tomcat implements the following process:         * - As per SRV.1.6.2, Tomcat will scan for annotations regardless of         *   which Servlet spec version is declared in web.xml. The EG has         *   confirmed this is the expected behaviour.         * - As per http://java.net/jira/browse/SERVLET_SPEC-36, if the main         *   web.xml is marked as metadata-complete, JARs are still processed         *   for SCIs.         * - If metadata-complete=true and an absolute ordering is specified,         *   JARs excluded from the ordering are also excluded from the SCI         *   processing.         * - If an SCI has a @HandlesType annotation then all classes (except         *   those in JARs excluded from an absolute ordering) need to be         *   scanned to check if they match.          */
//  Write buffer full and input message not fully read.   Output and start new compressed part. 
// add end 
//  ***********************************************************************   java.sql.ConnectionEventListener implementation   *********************************************************************** 
//  Attempt to debug intermittent test failures 
/*  Move ciphers without forward secrecy to the end  */
//  Increment the index and try again 
//  this is a local (one phase) only connection, so we can't prepare 
//  No methods even through there are some common methods 
//  We are probably already being shutdown. Ignore this error. 
//  Can still return the current context 
//  Call the load() method 
//  For debug purposes 
//  ----------------------------------------- Unimplemented Processor methods 
//  Create a new Player and add it to the room. 
/*              * Don't want the HashMap to be expanded beyond LOCALE_CACHE_SIZE.             * Expansion occurs when size() exceeds capacity. Therefore keep             * size at or below capacity.             * removeEldestEntry() executes after insertion therefore the test             * for removal needs to use one less than the maximum desired size             *              */
//  Now construct the re-ordered mechType list 
//  Populate the env properties used to create the server 
//  Find resource JARs 
//  First build the lists of covered patterns and those patterns that   might be uncovered 
//  <param > for java_code 
//  Invalid cookie. Ignore it and skip to the next semi-colon 
//  give a hint about what's wrong 
//  Set parent 
//  Ignore ourselves 
//  Ignore user information from reverse proxy 
//  Cipher 0x060040 (SSLv2) 
//  Close tls startResponse if used 
//  Destroy any Executors 
//  Unlock and free this instance 
//  Parameter parser can handle null input 
//  Login servlet just needs to respond "OK". Client will handle   creating a valid response. No need for a form. 
//  Should not be an error so should be nothing to read 
//  escapedBuffer cannot be null 
//  VALIDATE X-FORWARDED-FOR 
//  Manually add some version specific features to ensure that these do   not cause problems for the merged web.xml 
//  __begin toStringMethod 
//  IGNORE 
//  encoding is guessed very late ) 
//  Copy the input stream to the output stream 
//  Find the most loaded pool that could take a new instance 
//  setup to capture output 
//  Save all of our configuration parameters 
//  satisfied. 
// don't change the allocation strategy 
//  happen in Http11Processor#prepareRequest() 
/*      * Define IDs for the temporary RSA keys and DH params      */
//  Construct a class loader based on our current repositories list 
//  If the Acceptor is still running force   the hard socket close. 
//  Cipher C2 
//  Set our properties from the initialization parameters 
//  JTA spec doesn't let us register with a transaction marked rollback only   just ignore this and the tx state will be cleared another way. 
//  Limit based on a control frame with a full payload 
//         this.datasource.getPoolProperties().setMaxActive(10);          this.datasource.getPoolProperties().setTestOnBorrow(true);          this.threadcount = 10;          this.transferPropertiesToC3P0();          this.c3p0Datasource.getConnection().close();          latch = new CountDownLatch(threadcount);          long start = System.currentTimeMillis(); 
// sleep for 50 sec, let the other messages in 
//  OpenSSL is compatible with the JSSE configuration, so use it if APR is available 
//  Sessions 
/*      * write an attribute in the ServletRequest - %{xxx}r      */
//  mark if the next symbol is hex before the actual read 
// there is a good chance that we got here  because the TcpReplicationThread called  selector wakeup().  if that happens, we must ensure that that  thread has enough time to call interestOps                      synchronized (interestOpsMutex) {  if we got the lock, means there are no  keys trying to register for the  interestOps method                      }   nothing to do 
// through the characters. 
//  e.g. [myname="value] 
//  additional frame needs to be read 
//  Before we send the next message, have to wait for the previous   message to complete 
//  Set the body 
//  Attempt to add an instance to the most loaded pool 
/*      * Generates getters for     * - instance manager     * - expression factory     *     * For JSPs these methods use lazy init. This is not an option for tag files     * (at least it would be more complicated to generate) because the     * ServletConfig is not readily available.      */
//  Firefox 45 Accept-Encoding 
//  OpenSSL supported ALPN 
//  JSP 2.1 Table JSP.8-3 
//  At this point the connection window should be 1k and any new stream   should have a window of 1k as well 
//  Cipher C1 
//  Invalid cookie value. Skip to the next semi-colon 
/*          * Prepare the resource request HTTP headers and issue the request.         * Three kinds of uri are supported:         *   1. fully qualified uri.         *   2. minimal uri without webapp path.         *   3. null - use the default protected resource         * Cookies are sent if available and supported by the test. Otherwise, the         * caller is expected to have provided a session id as a path parameter.          */
//  Add the eventual unpacked WAR and all the resources which will be 
//  Move the current file out of the way 
//  the signal an error 
//  If status is not found yet, cont to check whether connection is keep-alive or close 
//  If data is being read on a non-container thread a   dispatch with status OPEN_READ will be used to get   execution back on a container thread for the   onAllDataRead() event. Therefore, make sure   onDataAvailable() is not called in this case. 
//  Create the MBean for the UserDatabase itself 
//  Note, the Unicode scalar value n is defined   as follows:   n = (jchar-0xD800)*0x400+(jchar2-0xDC00)+0x10000   Where jchar is a high-surrogate, 
/*                  * Several components end up opening JarURLConnections without                 * first disabling caching. This effectively locks the file.                 * Whilst more noticeable and harder to ignore on Windows, it                 * affects all operating systems.                 *                 * Those libraries/components known to trigger this issue                 * include:                 * - log4j versions 1.2.15 and earlier                 * - javax.xml.bind.JAXBContext.newInstance()                 *                 * https://bugs.openjdk.java.net/browse/JDK-8163449                 *                 * Java 9 onwards disables caching for JAR URLConnections                 * Java 8 and earlier disables caching for all URLConnections                  */
//  only start with the sender 
//  Supports async 
//  Adding the additional parameters, if any 
//  expression irrespective of input length. 
//  Step 7b. Apply global defaults   Have to merge defaults before JSP conversion since defaults 
//  img stuff not req'd for source code html showing 
//  to establish the session 
//  Switch to read mode. 
//  call bean and the rest of resolvers 
//  Resource injection 
// no op for now, should not cancel out any keys  can create serious sync issues  all TCP connections are cleared out through keepalive  and if remote node disappears 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=50413 
//  Append data specified in ranges to existing content for this   resource - create a temp. file on the local filesystem to   perform this operation 
//  assertOpen() 
// if we add it here, then add it upwards too  check to see if it is alive 
/*          * construct the common authorization header          */
//  expected as %_{ is invalid 
//  find out what's expected by writing to GZIPOutputStream and close it 
/*  JavaCCOptions:  */
//  List the ciphers that the client is permitted to negotiate 
//  ClassLoader pinning we're about to do. 
//  Cipher C4 
/*      * extract and save the server cookies from the incoming response      */
//  while   Not Null 
/*  Maximum number of arguments for create process call  */
// perform the close, since we called sslEngine.closeOutbound 
//  For now, simply skip registration 
//  Used to track if certificateVerificationDepth has been explicitly set 
//  Cipher 0x030080 (SSLv2) 
//  check if object was created   this only happens if an exception was thrown and we're ignoring them 
//  We found ourselves, ignore 
//  Buffer overflow can happen if we have read data. Return   so the destination buffer can be emptied before another   read is attempted 
//  Send him the current number of players and the current room image. 
//  URI needs to include the context path 
//  Not for handling by this resolver 
//  Fully qualified class name to error page 
//  Exclude any resource in the /WEB-INF and /META-INF subdirectories   (the "toUpperCase()" avoids problems on Windows systems) 
/*      * Tests if a HEAD request is treated as simple request.     *     * @See http://www.w3.org/TR/cors/#simple-method     * @throws IOException     * @throws ServletException      */
// reset counters - lock free 
//  Has the user already been authenticated? 
//  Log failure by default 
//  Has this stream been granted an allocation 
//  else error? 
//  Allow if deny is specified but allow isn't 
//  Cipher C3 
//  Check we have the right number 
//  get an iterator over the set of selected keys 
// We can't assume that Servlet.log( message, null )  is the same as Servlet.log( message ), since API  doesn't seem to say so. 
// check to see if we need to send out an access message 
//  Check if any threads previously reported as stuck, have finished. 
//  Must be SimpleTag - no other types defined. 
//  service-ref was added in 2.4 so should be excluded in 2.3 and earlier 
//  Both specifies a *.ext, keep the first one 
//  The Connection we're returning is a handle on the XAConnection.   When the pool calling us closes the Connection, we need to 
//  Filter the results 
//  Set revocation 
//  17-7k-body, 19~8k-body, 21~8k-body 
//  This clear removes any idle objects 
//  XML syntax or unknown, (auto)detect encoding ... 
//  function 
//  Used by websockets 
//      httpMethodConstraints = @HttpMethodConstraint("GET")) 
//  Calculate rate 
/*  Returns the root node of the AST.  It only makes sense to call     this after a successful parse.  */
// listens to with the local membership settings 
/*      * This test and the previous just swap the order in which the server certs     * are configured to ensure correct operation isn't dependent on order.      */
//  If external docBase, register .xml as redeploy first 
//  Note if this fails for all listeners check multicast is working with 
//  ------------------------------------------------------------- Constructor 
//  fields   methods 
//  <-- Should be threadsCount (3) here 
//  Valve pipeline is only established after tomcat starts 
//  No authentication no need to buffer POST body during TLS handshake so 
//  This setting means the connection will be closed at the end of the 
//  expected as $_{ is invalid 
//  If allow linking is enabled, files are not limited to being located 
//  Volatile because I/O and setting the timeout values occurs on a different 
//  TODO: Test always accounting for changes in flow control windows even if         the frame is in error. 
//  It will also set a shutdown hook to stop the Server when needed 
//  Note tg.enumerate(Thread[]) silently ignores any threads that   can't fit into the array 
//  Not available for now in Tomcat (needs to be passed during engine creation) 
//  Mark this session as "being expired" 
//  Try to read some data 
/*  APR_IS_DEV_VERSION  */
//  Upgrade to writeLock before we switch 
//  Listeners were introduced in Servlet 2.3 
//  SSL request attribute support 
//  No alternate URL. Re-throw the exception. 
/*                  * multiple path separators.                 * 'foo///bar' -> 'foo/bar'                  */
//  IPv6 - valid 
//  jsp:text must not have any subelements 
//  Closeout the current group 
//  Copy remaining notifications as reported by the application 
//  Cipher C0 
//  Check correct messages were received 
//  Class is NO-OP. It is only used to 'host' the annotation. 
//  Always false - test code 
//  Client certificate verification 
//  Write out capacity and any hidden stuff 
//  ---------------------- Properties that are passed through to the EndPoint 
/*          * Return the specified URL with the nonce added to the query string.          */
//  Release everything and read all the remaining data 
//  Leave level set to null 
//  Bumping into maxHttpHeaderSize 
//  ejb-ref 
//  Utility class. Hide default constructor 
//  Initialize logger again. Other components might have used it 
/*      * Null base should be a NO-OP rather than an exception      */
//  Test ASCII characters from 32 to 126 inclusive 
//  UTF-16, big-endian 
//  If this servlet has been marked permanently unavailable, 
//  not sure what the state is, so assume the connection is open. 
/*  Are deferred expression treated as literals  */
// whether the corresponding attribute is specified 
//  Determine which custom tag needs to declare which scripting vars 
// dont spew out stack traces for IO exceptions unless debug is enabled. 
//  ----------------------------------------------------------------------   Inherited abstract methods 
//  high surrogate, insert low surrogate before putting it in 
//  No initialisation required 
//  Rule 3 -- Extension Match 
//  Don't visit body of this tag - we already did earlier. 
//  If a branch was already taken in this if block 
//  If not specified on the Wrapper, check the Context 
//  Trying to go outside our context 
//  ok, restore the state of the queue and pool 
//  Bug 63210. DBCP2 DataSources require an explicit close. This goes   further and cleans up and AutoCloseable DataSource by default. 
//  portNames to be set on 
/*  Generated By:JJTree: Do not edit this line. AstMinus.java  */
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=59925      */
//  To advance the read position 
// remove the first element in the queue 
//  Send several pings else server will block waiting for the client 
//  Generate a call to this method 
//  read from the ByteArrayOutputStream to find out what's being written 
//  NPE not possible 
//  Assumes "ant release" has been run   Will need to be updated as new releases are made 
//  Swallow output if needed 
//  Check that the decoder is using the table right 
//  Name-only cookie with an '=' after the name token   This may not be RFC compliant 
//  Register a new provider that will impact some existing registrations 
// We try to mimic Apache here, as we do everywhere  All the 'magic' numbers are from the util_script.c Apache source file. 
//  Note: If this logic changes, also update Node.TemplateText.rtrim() 
// If we are setting on of the date variables, we want to remove   them from the   user  defined list of variables, because this is what Apache does 
//  Clear the classloader reference in common-logging 
//  If processing reaches this far, the response might be compressed. 
//  Need to keep processor associated with socket 
//  Switching to non-blocking. Don't know if data is available. 
//  If scheme for URI is null, return false. Return true otherwise. 
//  Identify the appBase of the owning Host of this Context 
//  See if password has changed by attempting connection 
//  Parsing destination header 
//  Always return null 
//  -------------------- State -------------------- 
//  Delegate utility execution to the Service 
//  Ensure that the file is not outside the fileBase. This should not be   possible for standard requests (the request is normalized early in   the request processing) but might be possible for some access via the   Servlet API (RequestDispatcher, HTTP/2 push etc.) therefore these   checks are retained as an additional safety measure   absoluteBase has been normalized so absPath needs to be normalized as 
// get the scope 
//  We use 11 to make sure we have enough room for the   variable length integers 
// sync 
//  verify the SSO sessionID was not encoded 
//    Methods for accessing the delegate connection   
/*  First step: if we have seen this timestamp                   during the previous call, and we need CLF, return the previous value.  */
//  Call maintain for the sendfile poller 
// test changes in username password 
//  error-page 
// context update max table size change 
//  Don't need to flush since trigger for log message is after the   response has been committed 
// Literal Header Field never indexed 
//  the destination path 
//  RC4_128_WITH_MD5 
//  tagFileInfo can't be null after initial test 
/*      * Try to access a protected resource without an established     * SSO session.     * This should be rejected with SC_FORBIDDEN 403 status.      */
//  Not present (so will do a full PUT, replacing the existing) 
//  Third system property 
//  instance 
//  Don't declare "x-forwarded-proto" 
//  Should now have two larger body frames. One has already been read. 
//  is there anything to do? 
//  Bad request 
//  PreparedStatement pool properties 
/*      * See Bug 58284      */
// execute tasks if we need to 
//  Set URI as "/". Use 6 as it will always be a '/'.   01234567   http://   https:// 
//  disable output otherwise enable it. 
/* end the actual statement cache */
// max size for a datagram packet 
//  excluded in 2.2 
//           call the factory 
//  Copy leftover bytes to the beginning of the buffer 
//  Overhead will vary. The main concern is that lots of small headers   trigger the limiting mechanism correctly. Therefore, use an overhead 
// the index is one based, but our table is zero based, hence -1  also because of our ring buffer setup the indexes are reversed  index = 1 is at position firstSlotPosition + filledSlots 
//  Simple dispatch for each type 
//  Use up the remaining connection window. These requests require 56k 
//  This is the match 
//  Put back delimiter '<%=' and '%>', since they are needed if the 
//  Static initializations here 
/*      * Checks to see if the current user is locked. If this is associated with     * a login attempt, then the last access time will be recorded and any     * attempt to authenticated a locked user will log a warning.      */
//  If it has no references or HTML entities then no work   need to be done 
/*      * Send the component parts of the request     * (be tolerant and simply skip null entries)      */
//  -------------------- Background Thread -------------------- 
//  value can't be null here 
//  Not thread safe. Concurrent requests to this servlet will   over-write all the results but the last processed. 
//  Cipher BE 
//  First byte E1..EC, second byte 80..BF 
//  Here, we have seen an odd number of backslash's followed by a 'u' 
/*  Read busy and ready  */
//  In OpenSSL 1.1.0-dev, TLSv1 refers to those ciphers that require   TLSv1 rather than being an alias for SSLv3 
//  JarFile.getJarEntry is version aware so use it 
//         return createDataPackage(cdata.getDataPackage());  avoid one extra byte array creation 
//  Check the right timestamp was used in the dependency 
//  BackgroundProcessManager to shut down. 
//  Skip - not tested 
//                         cancelledKey(key);                      }                  } 
//  Get class information 
//  If currently no Broadcast Timer Task is scheduled, then we need to create one. 
//  Skip any non-String values since any value we are interested in   will be a String. 
/*      * For Forward: StdActionContent ::= Attributes ParamBody      */
//  now clear the error code - to prevent double handling. 
//  Process the Stream 
//  Assume that the cache entry will always include the content unless the   resource content is larger than objectMaxSizeBytes. This isn't always the 
//  Ignore notify 
//  Static text 
//  ---------------------------------------------- Constructors 
//  The log pattern uses TLS attributes. Ensure these are populated   before the request is processed because with NIO2 it is possible   for the connection to be closed (and the TLS info lost) before   the access log requests the TLS info. Requesting it now causes it   to be cached in the request. 
//  See Bugzilla 30949 
//  Cipher BD 
//  short-circuit if not monitoring stuck threads 
//  Check OpenSSLConfCmd if used 
//  Introduce delay if necessary 
//  This is a 'controlled' failure. The component put itself into the   FAILED state so call stop() to complete the clean-up. 
//  couldn't make space 
//  Return a "Forbidden" message denying access to this resource 
//  -------------------- Registration -------------------- 
//  Called through trusted manager interface. If running under a 
/*  The length of the quoted input string.  */
/*      * Section Section 6.2.5     *     * @throws ServletException     * @throws IOException      */
//  Cipher 1B 
// ------------------------------------------------------------ getResource() 
// make sure pool cleaner starts/stops when it should 
//  Use the substitution to rewrite the url 
//  Response is committed - including the error page is the   best we can do 
//  nested expressions. 
//  is the token encoded?  decode the word 
//  Remove the entry from the cache so the new resource is visible 
//  No new constraints if denyUncoveredHttpMethods is false 
/*      * Generates implementation of     * javax.servlet.jsp.tagext.DynamicAttributes.setDynamicAttribute() method,     * which saves each dynamic attribute that is passed in so that a scoped     * variable can later be created for it.      */
// there was an error 
//  List<ElementValuePair> evps = ae.getElementValuePairs(); 
//  skip character following '\' within quotes   No need to update 'last', as neither of these characters   can be the closing '}'. 
//  On slow systems (Gump) may need to be higher 
//  Should be impossible but just in case since timeout will 
/*          * Sequence number for temporary variables.          */
// TODO Spec breaking enhancement to ignore this restriction 
//  1: Set socket options: timeout, linger, etc 
//  Output the result 
//  Client side uses the client endpoint instance 
//  Case 3 - Extension Match 
// give the object to the thread instead of adding it to the pool 
//  This is Tomcat 9 with a minimum Java version of Java 8.   Look for the highest supported JVM first 
//  Document the session properties 
/*  empty slot: +3  */
//  request line parsing 
//  jsp:attribute, prepare those values first. 
//  If there is a problem reading the header, disable compression 
//  Match still ambiguous 
//  Is the global JNDI resources context available? 
//  Check QSA before the final reply 
//  Cookie name value pairs are ';' separated.   Session IDs don't use ; in the value so don't worry about quoted   values that contain ; 
/* org.apache.coyote.Constants.STAGE_PARSE */
// we are resetting, reset our defaults 
//  Removing resource links 
//  Only unload the drivers this web app loaded 
//  URL-SAFE skips the padding to further reduce size. 
//  if ?XML=true, set the mode to XML 
//  set the referer header 
//  Send request 
// check to see if we are about to execute a query 
//  if the connection is read-only, then the resource is read-only   NOTE: this assumes that the outer proxy throws an exception when application code   attempts to set this in a transaction 
// port 
//  Container should be an instance of Server or Context. If it is anything 
//  Support ends 2019-09-11 
//  No actions necessary 
//  Example 13-7   @ServletSecurity(value = @HttpConstraint(rolesAllowed = "R1"),       httpMethodConstraints = @HttpMethodConstraint(value="TRACE", 
// let max be the upper limit 
/*  XP 32-bit SP3  */
// we are complete if we have delivered the last package 
//  Cipher BF 
//  skip '=' 
//  create a pool for our connections 
//  Write to the socket, if there is anything to write 
//  Set up 
//  Parse the file 
//  If we hit the end without seeing a quote 
//  Check to see if a response body is present 
//  Ignore any entries targeting for a later version than   the target for this runtime 
//  Cipher BA 
//  If there is no acceptable candidate, uriRoot will   remain null. 
// unget the byte 
//  Return the existing filter instance, if any 
// bad: shouldn't mask an exception the following way:     str = "[cannot find message associated with key '" + key +           "' due to " + mre + "]";       because it hides the fact that the String was missing       from the calling code.  good: could just throw the exception (or wrap it in another)        but that would probably cause much havoc on existing        code.  better: consistent with container pattern to        simply return null.  Calling code can then do        a null check. 
//  If attrs==null, len == 0 
//  this is definitely a decoded token. 
//  Any method can transition to failed   startInternal() permits STARTING_PREP to STARTING   stopInternal() permits STOPPING_PREP to STOPPING and FAILED to 
//  Loop if poller is empty 
//  Ignore all exceptions 
//  No entity body sent here 
/*      * When Tomcat expects data from the client, this is the time Tomcat will     * wait for that data to arrive before closing the connection.      */
//  Start 
//  No threads/tasks available, do nothing, the selection   loop will keep calling this method until a   thread becomes available, the thread pool itself has a waiting mechanism   so we will not wait here. 
//  Control messages have fixed message size so   TransformationResult.OVERFLOW is not possible here 
//                 indent--; 
//  The buffer wasn't fully flushed so re-register the   socket for write. Note this does not go via the   Response since the write registration state at   that level should remain unchanged. Once the buffer   has been emptied then the code below will call   Adaptor.asyncDispatch() which will enable the   Response to respond to this event. 
//  Add a parameter with two values 
// ------------------------------------------------------------------------------                INSTANCE VARIABLES 
//  or browsers as caching can provide a security hole 
//  Register the MBeanFactory 
//  No endpoint registered for the requested path. Let the   application handle it (it might redirect or forward for example) 
//  configuration is translated into an init-param for this servlet. 
//  First choice - direct match 
//  Return the current session if it exists and is valid 
//  An I/O error occurred on a non-container thread. This includes:   - read/write timeouts fired by the Poller (NIO & APR)   - completion handler failures in NIO2 
//  Authenticate the specified certificate chain 
//  Set up the search controls 
//  resource-ref/res-sharing-scope was added in 2.3 so should be excluded 
//  Resource is located in the appBase so it may be deleted 
//  Do not release any SSLContexts associated with a replaced   SSLHostConfig. They may still be in used by existing connections   and releasing them would break the connection at best. Let GC   handle the clean up. 
/*      * Test whether aborted POST correctly handle connection draining.      */
//  Need to check existing layer registrations   (and default)   Need to check registrations for all layers 
//  Just for debugging 
//  The error occurred on a non-container thread during async   processing which means not all of the necessary clean-up will   have been completed. Dispatch to a container thread to do the   clean-up. Need to do it this way to ensure that all the necessary   clean-up is performed. 
//  Because the error did not occur on a container thread the   request's error attribute has not been set. If an exception   is available from the socketWrapper, use it to set the   request's error attribute here so it is visible to the error   handling. 
//  Release the filter chain (if any) for this request 
//  3 items because parser automatically inserts TrapException interceptor to front of list 
//  Stage 5. Order each group            Note: Only after ordering requirements are considered. 
//  Truncate, do not round up 
//  Initialise the upgrade handler (which may trigger   some IO using the new protocol which is why the lines   above are necessary)   This cast should be safe. If it fails the error   handling for the surrounding try/catch will deal with 
//  Initialize the JSP Runtime Context   Check for a custom Options implementation 
//  Check partial input is rejected 
//  Only if the Host has started. If it has not, then it will   have its own "after_start" event later. 
/*          * Get the attribute value from this named attribute (<jsp:attribute>).         * Since this method is only for attributes that are not rtexpr, we can         * assume the body of the jsp:attribute is a template text.          */
//  Cipher BC 
//  Only unregister with AsyncChannelGroupUtil if this instance   registered with it 
//  Overridden to make it visible to other classes in this package 
//  Get error location 
//  Some blocking IO occurred, so iterate 
/*  Generated By:JJTree: Do not edit this line. AstNot.java  */
//  Break out after the finally block 
//  Validate the requested context path 
//  Write buffer full and input message not fully read.   Output and get more data. 
//  Merge rules vary from element to element. See SRV.8.2.3 
//  Object with property at end of expression 
//  engine closing before initial handshake 
//  @ServletSecurity 
//  Instantiating a new instance of the correct object type, and   initializing it. 
//  Invalid IPv6 netmasks 
//  Cipher 1A 
//  Ack 
//  Container will handle any errors 
//  Finish up the response 
/*      * Parses a directive with the following syntax: Directive ::= S? ( 'page'     * PageDirective | 'include' IncludeDirective | 'taglib' TagLibDirective) S?     * '%>'     *     * TagDirective ::= S? ('tag' PageDirective | 'include' IncludeDirective |     * 'taglib' TagLibDirective) | 'attribute AttributeDirective | 'variable     * VariableDirective S? '%>'      */
//  Threads should not be created by the webapp classloader 
//  ---------------------------------------------- Http2Parser.Output methods 
// we have written everything, or we are starting a new package 
//  Cipher BB 
//  Skip clearing the work directory if Tomcat is being shutdown 
//  Digest field types.   Note: These are more relaxed than RFC2617. This adheres to the         recommendation of RFC2616 that servers are tolerant of buggy         clients when they can be so without ambiguity. 
//  setSocketOptions() will hand the socket off to   an appropriate processor if successful 
//  Finish the response if not done yet 
//  session was not accessed, so no save will be performed 
//  No classes have been modified 
/*  Generated By:JJTree: Do not edit this line. AstLambdaExpression.java Version 4.3  */
/*                  * Classic tag handler: Generate code for start element, body,                 * and end element                  */
//  without any parameters. 
//  Add the page that generates the error 
//  Remove the data read into the overflow buffer 
//  Assumes that the spec is absolute and starts war:file:/... 
//  Concatenate names of imported classes/packages 
// always start at 1 for incoming 
//  Add the pseudo header for status 
//  to be slower on Linux 
//  Step 11. Apply the ServletContainerInitializer config to the 
// *********************************************************************   Private state 
//  ----------------------------------------------HttpSession Public Methods 
//  Guarded by readCompletionHandler 
//  get requested jvmRoute. 
//  Stop our defined Services 
//  env-entry element 
//  can't happen 
//  No obvious static fields for javax.servlet.http   Could hack something with HttpUtils...   No obvious static fields for javax.servlet.jsp 
//  Failed to create home directory 
//  JRE doesn't provide a suitable constructor for multi-prime   keys 
//  JSP 7.3.1: in /WEB-INF/tags only consider implicit.tld 
/*  4 == length("org.")  */
//  Now we have the context, we can parse the session ID from the URL   (if any). Need to do this before we redirect in case we need to 
//  Output via a writer so can't use sendfile or write   content directly. 
//  Cipher 1E - overlaps with Fortezza above 
//  Just included but no conversion 
//  Note: BufferedReader.readLine() strips new lines         ServletInputStream.readLine() does not strip new lines 
/*          * This method is synchronized so that it is not possible for a socket         * to be added to the Poller's addList once this method has completed.          */
/*      * <p>Reads the <code>header-part</code> of the current     * <code>encapsulation</code>.     *     * <p>Headers are returned verbatim to the input stream, including the     * trailing <code>CRLF</code> marker. Parsing is left to the     * application.     *     * <p><strong>TODO</strong> allow limiting maximum header size to     * protect against abuse.     *     * @return The <code>header-part</code> of the current encapsulation.     *     * @throws FileUploadIOException if the bytes read from the stream exceeded the size limits.     * @throws MalformedStreamException if the stream ends unexpectedly.      */
//  Open files: 
//  Reset maintain time. 
//  Force a GC to clear out unloaded class (first JSP) 
//  expand header list array 
//  A new connection is open 
//  CORS requests (SIMPLE, ACTUAL, PRE_FLIGHT) set the following headers   although non-CORS requests do not need to. The headers are always set   as a) they do no harm in the non-CORS case and b) it allows the same   response to be cached for CORS and non-CORS requests. 
//  De-register with JMX 
//  Tomcat.addServlet does not respect annotations, so we have   to set our own MultipartConfigElement. 
// add the total nr of messages 
//  Allowed roles should be the union of the roles in the constraints   ** is any authenticated user   User has no role 
/*      * Gets this Node's xmlns attributes that do not represent tag libraries     * (only meaningful for Nodes parsed from XML syntax)      */
//  Thread 
//  Should not happen since filtering to build   enabled protocols removes invalid values. 
//  Check the results 
//  If the Principal is cached in the session JASPIC may simply return it 
// static byte[] buf = new byte[32871]; 
//  Session ID (single byte for length) 
//  Excludes '/' since configuration controls whether or not to treat '/' as   a separator 
//  Wait until o.a.c.connector.Request.recycle() completes,   as it updates lastAccessedTime. 
//  Maintain runs at most once every 1s, although it will likely get   called more 
//  Check message type, process right away and break if 
//  logical Connection from the PooledConnection must be closed   before another one can be requested and closing it will   generate an event. Keep track so we know not to return   the PooledConnection 
//  Trying to go outside context root 
//  Expected response is a 200 response. 
//  If not the first fragment, it is a continuation with opCode of zero 
//  Need to be careful here. If sendError() is called the   response body should be provided by the standard error page   process. But, if the output of the CGI process isn't read 
//  overhead protection so disable it. 
//  Add a test servlet so there is something to generate a response if 
//  No engine or no engine name, use the service name 
//  All checks passed. Add the cookie, start with the 
//  int[] 
//  generate elContext reference 
//  that value so treat all file URIs as valid origins. 
//  Stop our subordinate components, if any 
//  Ignore. Impossible if init() has been successfully called   first. 
//  <name-given>   <name-from-attribute>   <class>   <declare>   <scope> 
//  Action 
//  Frame not complete - we ran out of something   Convert bytes to UTF-8 
//  This notification tells us that the application server is done using this   connection for the time being. The connection is still associated with an   open transaction, so we must still wait for the commit or rollback method 
// if the position counter is about to roll over we iterate all the table entries  and set their position to their actual position 
//  Wait for the ack 
//  Any IOExceptions during close will have been caught and the   onError method called. 
// during the offer, we will grab the main lock 
//  the output (this method closes the stream) 
//  Inverting buffer 
//  RFC2617 says qop is token. <">token<"> will also be accepted 
//  Invoke the required method on the top object 
//  Copying one extra space in the buffer (since there must   be at least one space inserted between the lines) 
//  Test the target file first. Unless there is an error checking the   last modified time of the source (unlikely) the target is going to   have to be checked anyway. If the target doesn't exist (likely during 
// ------------------------------------------------------ Constructor 
//  Validate the format of the specified argument 
/*      * returns the event type     * @return one of the event types EVT_XXXX      */
//  when the bytes are copied into the cookie 
//  headerReadBuffer in write mode 
//  Special case. Use the Apache Harmony based UTF-8 decoder because it   - a) rejects invalid sequences that the JVM decoder does not   - b) fails faster for some invalid sequences 
//  We have some spare bits remaining   Output all whole multiples of 8 bits and ignore the rest 
//  and avoid an extra copy 
//  negative 
//  ----------------------------------------------- BackgroundProcess methods 
//  HTTP status code to error page 
//  We need pos to advance 
/*  ARIA ciphers 0xC03C to 0xC04F     * Unsupported by both Java and OpenSSL      */
//  If something goes wrong, reset the header buffer so the error   response can be written instead. 
//  dispatched requestURI 
//  private static final String DEFAULT_COOKIE_NAME = "JSESSIONID"; 
// Try getting it externally first, if it fails, try getting the   'built-in'   value 
//  Path=path 
/*  11 == length("org/apache/")  */
//  Add this parameter to our defined set if not already present 
//  Used to detect abusive clients sending large numbers of small 
//  server to shutdown cleanly 
//  Can't happen 
//  (if null or true, leave default of true) 
//  Despite what the OpenSSL docs say, DEFAULT also excludes SSLv2 
/*      * Test returning an empty list as a bean property.      */
//  Add this alias to the list 
//  No filters. Assume request is not finished. EOF will signal end of   request. 
//  leave it to be expired by the manager 
/*      * Provide access to just the cluster component attached to this container.      */
//  @GuardedBy("this") 
//  Send application start events 
// remove the total messages 
//  The following holds true for the arguments passed to   JspRuntimeLibrary.handleSetPropertyExpression():   - 'pageContext' is a VariableResolver.   - 'this' (either the generated Servlet or the generated tag   handler for Tag files) is a FunctionMapper. 
//  Flags. end of headers (0x04) 
//  Initialize access count 
//  Root 
//  Cipher B9 
/*      * Send a TCP RST instead of a TCP closing handshake      */
//  timeout 
// the value of the "var" 
//  Allow if denies specified but not allows 
/*      * Request line host is an exact match for Host header (with port)      */
/*      * Verifies that the same Content-Length is returned for both GET and HEAD     * operations when a Servlet includes content from another Servlet      */
//  com.sun.org.apache.xerces.internal.dom.DOMNormalizer 
//  No JSP servlet currently defined.   Use default JSP Servlet class name 
//  Simple dispatch with path parameters at start 
//  No match 
//  Parse useParentHandlers to set if the logger should delegate to its parent.   Unlike java.util.logging, the default is to not delegate if a list of handlers 
// Mark representing the start of the current element.  Note  that locator.getLineNumber() and locator.getColumnNumber()  return the line and column numbers for the character  immediately _following_ the current element.  The underlying  XMl parser eats white space that is not part of character  data, so for Nodes that are not created from character data,  this is the best we can do.  But when we parse character data,  we get an accurate starting location by starting with startMark  as set by the previous element, and updating it as we advance 
//  The class name for the javamail MimeMessageDataSource 
//  org.springframework.web.servlet.i18n.SessionLocaleResolver.LOCALE_SESSION_ATTRIBUTE_NAME 
//  o.a.catalina.tribes.test.channel 
//  Cipher 17 
//  <prefix>:root must be the first element 
//  Closing the Connection ensures that if anyone tries to use it,   an error will occur. 
//  Non-positive port values have special meanings and the offset should   not apply. 
//  Use potentially wrapped request from this point 
//  been made to use one 
// $FALL-THROUGH$ 
//  DATA frames reduce the overhead count ... 
//  Skip threads that have already died 
//  No functional change 
/*      * {@link FileInputStream#read(byte[])} and related methods are all native     * methods so it isn't immediately obvious if they are thread-safe or not.     *     * <pre>     * Windows JDK 1.6.0_22_x64 - Thread safe     * OSX     JDK 1.6.0_22_x64 - Not thread safe     * OSX     JDK 1.7.0_51_x64 - Not thread safe     * </pre>     *     * Therefore, have to assume that {@link FileInputStream#read(byte[])} is     * not thread safe.      */
//  ping
//  Sub-protocols 
//  handle ordered libs directly, ... 
//  now compute some delays - beware of the units! 
//  Cipher B8 
//  Log APR flags 
//  Server Header Section 
//  -------------------------------------------------------- stats attributes 
//  Special case   This is a directory resource so the path must end with / 
/*          * While the implementations for blocking and non-blocking writes are         * very similar they have been split into separate methods:         * - To allow sub-classes to override them individually. NIO2, for         *   example, overrides the non-blocking write but not the blocking         *   write.         * - To enable a marginally more efficient implemented for blocking         *   writes which do not require the additional checks related to the         *   use of the non-blocking write buffer          */
//  Copied from ExceptionUtils since that class is not visible during start 
//  bad shortcut - it'll convert to string ( too early probably, 
//  if "SourceDebugExtension" symbol not there add it 
//  May happen under a security manager. Ignore it and try loading   the class normally. 
//  Add a single Access-Control-Allow-Origin header. 
/*      * Receives the document locator.     *     * @param locator the document locator      */
/*      * XMLScriptletBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<'))     * CDSect?)* ETag ) | <TRANSLATION_ERROR>      */
//  Cipher 16 
/*  * The unit test is independent of OpenSSL version and does not require OpenSSL * to be present.  */
//  -------------------- encoding/type -------------------- 
//  N.B. this is eventually closed in MultipartStream processing 
//  Override if the proxyPort/proxyHost are set 
//  Should send quickly until the network buffers fill up and then block 
//  Empty Host header so set sever name to empty string 
//  are presented if the application requests them. 
//  16 bits = 6 + 6 + 4 
//  Obtain BEAN01 again 
// map start request 
//  Using an authentication only configuration and no role store has   been defined so don't spend cycles looking 
//  Is a default web.xml specified for the Context? 
//  The test fails if JreMemoryLeakPreventionListener is not   present. The listener affects the JVM, and thus not only the current,   but also the subsequent tests that are run in the same JVM. So it is   fair to add it in every test. 
//  close of try 
//  a.addAfterOrdering("b"); 
/*  Default library names  */
//  Search for a descriptor in the same package 
// should never happen 
/*          * Determine whether to use the expected type's textual name or, if it's         * a primitive, the name of its correspondent boxed type.          */
//  Increase the Window size (50% of total body) 
//  Cipher 19 
// --- internal attributes -------------------------------------------------- 
//  With concurrent calls for the same path, the entry is only removed   once and the cache size is only updated (if required) once. 
//  Unexpected ACK. Log it. 
// election already running, I'm not allowed to have two of them 
//  Advance to the next response in the chain 
/*      * Implementation note: This method assumes that it is always preceded by a     * call to hasNext() in order for whitespace handling to be correct.     *     * @return The next token in the EL expression buffer.      */
// create a remove value button 
//  clear any residual data before starting on this response 
//  will never be null 
//  If the resource supports credentials, add a single   Access-Control-Allow-Credentials header with the case-sensitive 
//  >= 1 
//  Create a new Session inside a doPrivileged block, so that JavaMail   can read its default properties without throwing Security   exceptions.   
//  These get reset in processInitialHeader()   fin, rsv, opCode, payloadLength, mask 
/*      * Tests the connection to the server and returns the CPONG response.      */
//  this method isn't synchronized so the   calculateDeficit is done at the beginning   as a loop limit and a second time inside the loop   to stop when another thread already returned the 
//  Skip the terminating \0 
//  40-4f A-O   50-5f P-Z _ 
//  At this point 17 is blocked because the stream window is zero and   19 & 21 are blocked because the connection window is zero.     To test allocation, the connection window size is increased by 1.   This should result in an allocation of 1 byte each to streams 19 and   21 but because each stream is processed in a separate thread it is   not guaranteed that both streams will be blocked when the connection   window size is increased. The test therefore sends 1 byte window   updates until a small body has been seen from each stream. Then the   tests sends a larger (1024 byte) window update and checks that it is   correctly distributed between the streams.     The test includes a margin to allow for the potential differences in   response caused by timing differences on the server.     The loop below handles 0, 1 or 2 stream being blocked   - If 0 streams are blocked the connection window will be set to one     and that will be consumed by the first stream to attempt to write.     That body frame will be read by the client. The stream will then be     blocked and the loop will start again.   - If 1 stream is blocked, the connection window will be set to one     which will then be consumed by the blocked stream. After writing     the single byte the stream will again be blocked and the loop will     start again.   - If 2 streams are blocked the connection window will be set to one     but one byte will be permitted for both streams (due to rounding in     the allocation). The window size should be -1 (see below). Two     frames (one for each stream will be written) one of which will be     consumed by the client. The loop will start again and the Window     size incremented to zero. No data will be written by the streams     but the second data frame written in the last iteration of the loop     will be read. The loop will then exit since frames from both 
// get the msg nr 
//  Should send client preface here 
//  Re-throw fatal errors 
/*    * Constructors of various flavors follow.    */
//  Add the error page 
//  Force seeding to take place 
//  Must be Graal 
/*      * Character type tables.      */
//  3 bytes in, one byte out 
//  If there was an error, make sure the request is counted as 
//  Deserialize 
//  Cipher 18 
/*              * x2 - One descriptor for the socket, one for the event(s).             * x2 - Some APR implementations return multiple events for the             *      same socket as different entries. Each socket is registered             *      for a maximum of two events (read and write) at any one             *      time.             *             * Therefore size is actual poller size *4.              */
//        generation. 
//  Cipher 13 
//  connection from the same pool. 
//  Put leftovers in the leftovers char buffer 
//  Handle dynamically clearing welcome files 
/*  Create sessionIdGenerator if not explicitly configured  */
//  single set of method parameters 
//  Get dfc.cache.cache field 
//  Configure and call application event listeners 
//  Round 1 
//  Don't use the defaults in this case. They may be less secure   than the configuration the user intended.   Force the failure of the connector 
//  If the CGI servlet is explicitly configured to handle one of   these methods it will be handled in the previous condition 
//  The event notification executor 
//  Check if the conditions specified in the optional If headers are 
//  to pad w/ nulls as per spec 
//  Cipher B4 
//  add HostConfig for active reloading 
//  Enter standard imports 
//  continue to unwrap as long as the input buffer has stuff 
//  only those 2 methods need to change to use a different direct logger. 
//  Note: Internally, the Mapper does not use the leading * on a         wildcard host. This is to allow this shortcut. 
/*  A definite node is constructed from a specified number of     children.  That number of nodes are popped from the stack and     made the children of the definite node.  Then the definite node     is pushed on to the stack.  */
//  If this JAR was in a web application, this is equivalent to how it 
//  unregister this component 
/*      * Confirm the Basic parser tolerates excess white space around     * the username within the base64 blob.     *     * RFC2617 does not define the separation syntax between the auth-scheme     * and basic-credentials tokens. Tomcat should tolerate any reasonable     * amount of white space.      */
//  Extract path param from decoded request URI 
//  Buffer for entire helper class 
//  Allocate a servlet instance to process this request 
//  Cipher 12 
// whenever there's exception caught, 
//  Split out 
//  Configure connection to require a certificate. This requires a   re-handshake and must block until the re-handshake completes.   Therefore, make sure socket is in blocking mode. 
//  Try resolving with the supplied systemId 
//  Identify the name of the class to instantiate 
//         }      } 
/*      * Confirm that, as far as ObjectName is concerned, the order of the key     * properties is not significant.      */
//  try 
// =================================================================         POOL STATS  ================================================================= 
//  Clear the second map 
//  More complicated than the ideal as the canonical path may or may   not end with File.separator for a directory 
//  TODO - enabling this means initializing the classloader first in JspC 
//  Append the query string to the url if there is one and it 
//  up to 5 seconds for the right response 
//  And the handling for 500 responses 
// last message received war file is completed 
//  Cipher B3 
//  ------------------------------------------------------------ Initializer 
// --Instance Getters/Setters-------------------------------- 
// define all the temp variables' names 
//  Use common object to save memory 
//  - env (note: this sets a request attribute) 
//  ------------------------------------------------------------------------------   member message to send to and from other memberships 
/*              * As per RFC 6455, a WebSocket connection is considered to be             * closed once a peer has sent and received a WebSocket close frame.              */
//  Forward only needs hresponse 
//  Cipher B7 
//  Should not take very long 
//  Set version 
//  NO-OP   The connection is already closing so no need to process additional   errors 
// note that zero is not used 
//  various scenarios 
//  should the expression be evaluated before passing to 
//  Clean up the reader 
//  Destroy in reverse order to create, although it should not matter 
/*      * Tracks the current generation of async processing for this state machine.     * The generation is incremented every time async processing is started. The     * primary purpose of this is to enable Tomcat to detect and prevent     * attempts to process an event for a previous generation with the current     * generation as processing such an event usually ends badly:     * e.g. CVE-2018-8037.      */
//  Then block access to the examples to test redirection 
//  To not start Context automatically, as we have to configure it first 
//  --------------------------------------------------- WebConnection methods 
//  Cipher 15 
/*          * Creates a tag variable name by concatenating the given prefix and         * shortName and encoded to make the resultant string a valid Java         * Identifier.          */
//  Create the filter chain for this request 
//  Set the getBody message buffer 
//  This property does not exist for a native image 
//  Swallow the same again before closing the connection. 
//  do nothing, might be a future unsupported method   so we better bail out and let the system continue 
//  This doesn't actually happen in the Catalina adapter implementation 
//  POST with separate GET and POST parameters 
//  Might be quoted 
//  Cipher 14 
//  Does nothing 
//  Cipher B6 
//  UpgradeProcessorInternal instances can utilise AsyncIO.   If they do, the processor will not pass through the   process() method and be removed from waitingProcessors   so do that here. 
//  resolve systemId against baseURI if it is not absolute 
//  Perform another priming read 
// loop until complete, an error happens, or we timeout 
//  in 2.2 
//  shutting down the executor 
//  not regular request processing 
//  @SuppressWarnings("deprecation") Java 9 
//  Whitespace between target and protocol 
//  Beware of clients that try to send the whole request body before   reading any of the response. They may cause this test to lock up. 
//  Cipher B5 
//  save it 
//  \\ Is *not* an escape sequence in XML attributes 
//  use our mock driver   Required to trigger validation query's execution 
//  org.apache.struts.Globals.LOCALE_KEY 
//  $0 is not used 
// process the message 
//  Remove the extracted JARs from the work directory 
//  Manager Section 
// timestamp 
//  Cipher C034 
// while  end if 
/*      * This test is looking at the cost of looking up a class when the standard     * JSP package imports are present:     * - java.lang     * - javax.servlet     * - javax.servlet.http     * - javax.servlet.jsp     *     * Before optimisation, this test took ~4.6s on markt's desktop     * After optimisation, this test took ~0.05s on markt's desktop      */
//  Process ServletSecurity annotation 
//  ------------------------------------------------- SendHandler methods 
//  Skip all synthetic methods.   They may have copies of annotations from methods we are   interested in and they will use the wrong parameter type   (they always use Object) so we can't used them here. 
//  Throw cached compilation exception 
//  Perform instance-specific initialization 
//  role1. 
//  We need to multiply by 1000 as OpenSSL uses seconds and we need milliseconds. 
//  Not in RFC6455   return CloseCodes.SERVICE_RESTART; 
//  Call the next filter if there is one 
//  Ignore the call from java.util.logging.LogManager.Cleaner,   because we have our own shutdown hook 
//  Must be ready to write data if onWritePossible was called 
//  If the session has expired - as opposed to just being removed from   the manager because it is being persisted - update the expired stats 
//  Validate the name argument 
//  Following test also ensures included resources   are converted if an explicit output encoding was 
//  See if there is a new 9 byte header and continue parsing if possible 
//  rewriteUrl(contextPath) is expensive. cache result for later reuse 
//  Cipher B0 
/*      * Check that methods returned by OPTIONS are consistent with the return     * http status code.     * Method not present in options response -> 405 expected     * Method present in options response     -> anything other than 405 expected      */
//  If session tracking via cookies has been disabled for the current   context, don't go looking for a session ID in a cookie as a cookie   from a parent context with a session ID may be present which would   overwrite the valid session ID encoded in the URL 
//  Disabled by default in 1.1.20 windows binary (2010-07-27) 
//  Notify our interested LifecycleListeners 
//  delete in case file is corrupted 
// process expired messages or empty out the queue 
//  Close any open directory server connection 
//  rtexprvalue is fixed to "true" and a translation error 
//  Cipher C033 
//  new to spec 
/*      * trimDirectiveWhitespaces      */
//  Ignore, the VM default will be used 
//  Checking sealing 
//  Check the parameters 
//  Servlet attempts to read parts which will trigger an ISE 
//  null if security restricted 
//  Make sure this watched resource is currently present 
//  Finally get the string from the constant pool 
//  Load and initialize our instance if necessary 
//  Warm up 
// turn off two phase commit  this wont work if the interceptor has 0 as a flag  since there is no flag to turn off  msg.setOptions(msg.getOptions() & (~getOptionFlag())); 
//  can't be null - I think 
//  First check that the resulting path is under the provided base 
/*              * Fallback              */
/*                  * ASSERT: Authenticator already set the appropriate HTTP status                 * code, so we do not have to do anything special                  */
//  Convert to internal representation 
//  Object was abandoned and removed 
//  Ignore this. It will always fail for non-file based includes 
//  that the thread is still active when the context stops. 
//  Cipher 11 
//  This is fatal for the connection. Ignore it here. There will be   further attempts at I/O in upgradeDispatch() and it can better   handle the IO errors. 
//  -------------------- Other attributes --------------------   We can use notes for most - need to discuss what is of general interest 
//  Cipher C036 
//  Add the parents as well 
//  ELExpressionBody.    Starts with "#{" or "${".  Ends with "}".    May contain quoted "{", "}", '{', or '}' and nested "{...}" 
//  (added 17 including one host alias. Three duplicates do not increase the count.) 
// there are no backups 
//  Verify message signature 
//  Update the state   State machine looks like this        -------->--------     |      (CR)       |     |                 |    CR1--->---         |     |        |        |     ^(CR)    |(LF)    |     |        |        |   CHAR--->--LF1--->--EOH        (LF)  |  (LF)  |              |(CR)    ^(LF)              |        |            (CR2)-->--- 
//  We're using chunking   Round up to nearest multiple 
// in case the nodes in the cluster are out of  time synch, this will make sure that we have the  correct timestamp, isValid returns true, cause 
//  Don't fire listeners during async processing (the listener   fired for the request that called startAsync()).   If a request init listener throws an exception, the request   is aborted. 
//  Validate the rest of the headers and reject the request if that 
//  Assume a 'complete' ServletRegistration is one that has a class and 
// 100MB 
//  Since padding is zero length, response looks like there is none. 
//  Before init the domain is null 
//  Cipher B2 
//  The super class constructor calls this method earlier than our   fields are initialized. Ignore the call. 
//  process each "cookie" header 
//  Fake re-deploy resource to detect if a context.xml file is   added at a later point 
//  Initiate handshake 
//  Check role names used in <security-constraint> elements 
//  no value is empty string which is how   java.util.Properties works 
/*          * Converts the scope string representation, whose possible values are         * "page", "request", "session", and "application", to the corresponding         * scope constant.          */
//  Handles an Actual CORS request. 
//  This is neither decoded nor normalized 
//  Find the longest key, ie more discriminant 
//  Configure this test 
//  Cipher C035 
//  Cipher 10 
//  Re-parse TLD 
//  Initial HTTP request becomes stream 1. 
//  Remove the specified filter mapping 
//  Import ambiguity is handled at resolution, not at import   Whether the package exists is not checked,   a) for sake of performance when used in JSPs (BZ 57142),   b) java.lang.Package.getPackage(name) is not reliable (BZ 57574),   c) such check is not required by specification. 
//  ------------------------------------------------------- Protected Methods 
//  first read. 
//    Configuration parameters   
/*  ARIA ciphers 0xC070 to 0xC071     * Unsupported by both Java and OpenSSL      */
//  Should never be called for StreamProcessor as isReadyForRead() is   overridden 
//  javax.servlet 
//  block until the timeout kicks in 
/*      * Parses OptionalBody, but also reused to parse bodies for plugin and param     * since the syntax is identical (the only thing that differs substantially     * is how to process the body, and thus we accept the body type as a     * parameter).     *     * OptionalBody ::= EmptyBody | ActionBody     *     * ScriptlessOptionalBody ::= EmptyBody | ScriptlessActionBody     *     * TagDependentOptionalBody ::= EmptyBody | TagDependentActionBody     *     * EmptyBody ::= '/>' | ( '>' ETag ) | ( '>' S? '<jsp:attribute'     * NamedAttributes ETag )     *     * ActionBody ::= JspAttributeAndBody | ( '>' Body ETag )     *     * ScriptlessActionBody ::= JspAttributeAndBody | ( '>' ScriptlessBody ETag )     *     * TagDependentActionBody ::= JspAttributeAndBody | ( '>' TagDependentBody     * ETag )     *      */
/*                  * An alias has been specified. We use 'nameGiven' to hold the                 * value of the alias, and 'nameFromAttribute' to hold the name                 * of the attribute whose value (at invocation-time) denotes the                 * name of the variable that is being aliased                  */
//  Once the stream has been read, read the certs 
//  to work with all values but it will for this test value) 
//  Cipher B1 
/*  Generated By:JJTree: Do not edit this line. AstAssign.java Version 4.3  */
//  Parse the query string from the dispatch target 
//  The latches above are meant to ensure the correct   sequence of events but in some cases, particularly with   APR, there is a short delay between the client closing /   resetting the connection and the server recognising that   fact. This loop tries to ensure that it lasts much longer   than that delay so any close / reset from the client   triggers an error here. 
/*      *  Wrapper for getting the response.      */
//  WebConnection is not used so passing null here is fine   Might not be necessary. init() will handle that. 
// return 0 if we are complete, otherwise recurse to process the task 
//  Draw the RoomMessage onto our Room Image. 
//  Simple dispatch with invalid directory traversal 
/*  Indicates if the last character returned by nextChar() was escaped.  */
//  Assume anything using conditionals was modified by it 
//  the request 
//  Back 1 to fill in the gap 
//  Check for a change of date 
//  add the test user and role to the Realm 
//  HTTP method, GET = 2 
//  Get first message of the request 
//  Encrypt the data 
//  Cipher C030 
//  or other non-token character 
//  Implementation never throws IOE but can't change the signature   since it is part of the JSP API 
/*      * See RequestUtil.getRequestURL()      */
//  Don't enforce the limit when not running as attributes may get set in   any order. 
//  a single object. 
//  If everything works instantly this should be 256 but allow a   fairly large margin for timing differences 
//  Write begin tag, using XML-style 'name' attribute as the 
//  Break point A required on following line 
//  so all implementations are similar 
//  Create a config and write it out 
//  First 2 bytes are size of the protocol list 
//  Get the entry's attributes 
/*  Set to always use the tmp_rsa key when doing RSA operations,     * even when this violates protocol specs  */
//  indexOf() does not work outside of 0-127 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=43400 
//  Make sure that the necessary methods have been called on the   response. (It is possible a component may just have set the   Throwable. Tomcat won't do that but other components might.)   These are safe to call at this point as we know that the response   has not been committed. 
// if the default has been specified, then assign the value to it; 
//  Step through the methods in reverse order looking for calls to any   CoyoteAdapter method. All request threads will have this unless   Tomcat has been heavily modified - in which case there isn't much we 
//  Validate and create appBase 
//  Make the Context and Realm visible to the Authenticator 
//  Check for unbalanced custom actions 
//  Protect against nulls and unexpected types as these values   may be set by untrusted applications 
//  Per user pool properties 
//  Remove context attributes as appropriate 
//  Check for a known token start 
//  %: back reference to condition or server variable 
//  Add debug information 
// listen for membership notifications 
//  TLS 1.3 ciphers (draft - v26) 
//  If the user is currently locked, authentication will always fail 
/*      * Logon to access a protected resource using BASIC authentication,     * which will establish an SSO session.     * Then try to access a protected resource in the NonLogin     * webapp by sending the JSESSIONID from the redirect header.     * The access request should be rejected because the Basic webapp's     * sessionID is not valid for any other container.      */
//  TaglibInfo for this uri already established in   startPrefixMapping 
//  This is used when scanAllDirectories is enabled and one or more   JARs have been unpacked into WEB-INF/classes as happens with some   IDEs. 
//  Bugzilla 32867 
//  Allocate the end message array 
//  Must have a real docBase. Don't use java.io.tmpdir as it may not be 
/*  Indicates, that the given number of bytes have been read from             * the input stream.              */
/*  Low priority for MD5  */
//  Might as well do the first write on this thread 
// any arguments should produce an error 
//  Write out sessions 
//  Set keep alive timeout for next request 
//  private fields 
/*      * Define the SSL Protocol options      */
//  Calculate current pool objects 
// if var is not specified, just print out the url string 
//  Add method mapping to user properties 
//  Set the remote principal 
//  Protected resource 
//  This ensures the Stream processing thread has control of the socket. 
//  Cipher C032 
//  Create a new UserDatabaseRealm instance 
//  Number of tries is the number of attempts to connect to the database   during this login attempt (if we need to open the database)   This needs rewritten with better pooling support, the existing code   needs signature changes since the Prepared statements needs cached   with the connections.   The code below will try twice if there is an SQLException so the   connection may try to be opened again. On normal conditions (including 
//  Avoid warnings on deserialization 
//  Parameter 
//  duplicate. 
//  If we are here, means we have other stuff to do   Do a non blocking select 
//  ignore and try to close others. 
//  Create a populated InstanceManager 
//  50-5f P-Z _   60-6f a-o 
//  NOTE:  Race condition is harmless, so do not synchronize 
//  Removing errors pages 
//  NOOP since this filter will be providing the request body 
//  optimize 
//  ------------------------------------------------------------- Common code 
//  Handle arrays 
//  Note client window size is not an issue for the   server since the server will assume 15 and if the   client uses a smaller window everything will   still work 
/*  Set the jmvRoute using the system property jvmRoute  */
//  Synchronize AT_END scripting variables 
//  Successful authentication means removal from the list of failed users 
//  Second fall-back. Use current directory 
//  No options left. Just return null. 
/*      * APR_STATUS_IS Status Value Tests     * <br><b>Warning :</b> For any particular error condition, more than one of these tests     *      may match. This is because platform-specific error codes may not     *      always match the semantics of the POSIX codes these tests (and the     *      corresponding APR error codes) are named after. A notable example     *      are the APR_STATUS_IS_ENOENT and APR_STATUS_IS_ENOTDIR tests on     *      Win32 platforms. The programmer should always be aware of this and     *      adjust the order of the tests accordingly.     *      */
//  Warning: JSP attribute escaping != Java String escaping 
//  The getResource() trick won't work for this class. We have to   try loading it directly and accept that we might get a 
//  Recycle thread local data at the end of the request so references   are not held to a completed request as there is potential for   that to trigger a memory leak if a context is unloaded. 
//  Avoid NPE for case where Context is defined in server.xml with only a   docBase 
/*  GET == 2  */
//  Set error manager 
//  Similar strategy to NOT_EQ above, except this   is NOT less than 
/*  Remove a JMX notificationListener     * @see javax.management.NotificationEmitter#removeNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)      */
//  did we compute the hashcode ? 
//  Disable any regular read notifications caused by registerReadInterest 
// leader 
// flag to empty out the queue when it larger than maxQueue 
// we can't do any checks 
//  Must be a file 
//  Name is first part 
//  Add the Filter 
//  The following efficient algorithm is known as memberOf Algorithm, as described in "Practices in   Directory Groups". It avoids group slurping and handles cyclic group memberships as well.   See http://middleware.internet2.edu/dir/ for details 
//  Cipher C031 
//  --------------------------------------------------- AutoCloseable methods 
//  limit < buf.length (the buffer is already big) 
// options 
//  Note: Servlet Spec =< 3.0 only refers to Netscape and RFC2109, not RFC2965 
// *********************************************************************   Methods to retrieve information 
//  Initialize the annotations 
//  @ServletSecurity(@HttpConstraint(rolesAllowed = "R1")) 
//  Tapestry 3.0: Engine stored in session under "org.apache.tapestry.engine:" + config.getServletName() 
// extract the query string 
//  Unit tests need to access this class 
//  This is a token 
//  Merge annotations into fragment - fragment takes priority 
//  Copy the available data to the buffer 
//  string 
//  Bug 53584 
//  Need to check this again here in case the response was   committed before the error that requires the connection   to be closed occurred. 
/*      * The name of the inner class to which the codes for this node and its body     * are generated. For instance, for <jsp:body> in foo.jsp, this is     * "foo_jspHelper". This is primarily used for communicating such info from     * Generator to Smap generator.      */
/*          * Scan the server response body and extract the given         * url, including any path elements.          */
//  Bug 60232   500ms per frame write delay to give server a chance to process the   stream reset and the connection reset before the request is fully   sent. 
//  Make casual multipart request to "regular" servlet w/o config   We expect an error 
//  Protocols 
//  define proxy in class loader of non-public interface(s), if any 
//  Cipher 0F 
/*      * A collection of low level parse methods dealing with character in the EL     * expression buffer.      */
//  Collected at the end of each request. 
//  Handles cases where the quoted value is   unterminated and at the end of the header, 
//  There should be no Catalina MBeans and no Tomcat MBeans 
//  Some extensions/transformations may buffer messages so it is possible   that no message parts will be returned. If this is the case the   trigger the supplied SendHandler 
//  Make sure coder has flushed all output 
//  makeSpace will grow the buffer to the limit,   so we have space 
/*                      * If the uri value is a plain uri, a translation error must                     * not be generated if the uri is not found in the taglib map.                     * Instead, any actions in the namespace defined by the uri                     * value must be treated as uninterpreted.                      */
//  Create the pooling data source to manage connections 
//  configBase 
/*  * A response wrapper for use in (dumb) "HEAD" support. * This just swallows that body, counting the bytes in order to set * the content length appropriately.  All other methods delegate to the * wrapped HTTP Servlet Response object.  */
// =================================================================         POOL NOTIFICATIONS  ================================================================= 
//  Note server window size is not an issue for the   client since the client will assume 15 and if the   server uses a smaller window everything will   still work 
/*      * Block with obsolete properties from DBCP 1.x. Warn users that these are ignored and they should use the 2.x     * properties.      */
//  Trigger loading of catalina.properties 
//  Recycle filters 
//  - cookie 
//  Silent catch. Probably an object is already bound in   the context. 
//  No need for i18n - this isn't going to get logged anywhere 
//  Cipher 0E 
//  classloader to the Context classloader 
//  All digested passwords are the digested form of "password" 
//  If any origin is allowed, return header with '*'. 
//  If really fatal - re-throw 
//  if any 
//  can do. 
// $NON-NLS-1$   Call the property getter and return the value 
//  Cipher AF 
//  Check a directory listing 
//  Clear the current token val 
/*  Move anonymous ciphers to the end.  Usually, these will remain disabled.         * (For applications that allow them, they aren't too bad, but we prefer         * authenticated ciphers.)  */
/*      * Returns true if the method that is being invoked matches one of the method names passed in     * @param names list of method names that we want to intercept     * @param method the method being invoked on the proxy     * @param process boolean result used for recursion     * @return returns true if the method name matched      */
//  The transformation handles both input and output. It only needs to be   closed once so it is closed here on the output side. 
//  - When content length > 0, AJP sends the first body message     automatically.   - When content length == 0, AJP does not send a body message.   - When content length is unknown, AJP does not send the first     body message automatically. 
/*   APR Feature Macros  */
//  Must be a read-write primitive or String 
//  Random 
//  mime-mapping 
//  Close the socket 
//  Cache the message handler in force when the message starts so it is used 
// ============================================================================    ============================================================================ 
//  There might be a data that was left in the buffer when   the read has been suspended.   Consume this data before reading from the socket. 
//  Compacts buffer 
//  Status.BUFFER_UNDERFLOW - only happens on unwrap   Status.CLOSED - unexpected 
//  Create the JavaMail properties we will use 
//  In case the poller thread is in the idle wait 
//  Make sure the  socket isn't in the poller before we close it 
// adds an entry from the static table. 
//  It doesn't matter if existing object gets over-written. This object   holds minimal state and that state will be the same for all objects 
//  img stuff not req'd for source code html showing   relative links everywhere! 
//  Name Only 
// body length 
/*      * write local or remote port for request connection - %p and %{xxx}p      */
//  Checking to see if the context classloader is the current context   classloader. If it's not, we're saving it, and setting the context 
//  ----------------------------------------------------- Property accessors 
//  Don't adjust lines for the nested tags that   are also generated in buffers, because the   adjustments will be done elsewhere. 
//  ErrorReportValve in Tomcat 8.0.9+ flushes and aborts the   connection when an unexpected error is encountered and response   has already been committed. It results in an exception here:   java.io.IOException: Premature EOF 
//  If the incoming request has a valid session ID, no action is required 
//  Slightly convoluted so the @SuppressWarnings has minimal scope 
//  Should never reach this code but in case we do... 
//  jsp-file gets passed to the JSP Servlet as an init-param 
//  Create and add the chunked filters. 
//  This approach is used to reduce GC from toString conversion 
//  All ISO-8859-1 
/*      * Test the presence of specific origin in response, when '*' is not used.     *     * @throws IOException     * @throws ServletException      */
//  ... and disable the connection timeout 
// throw new SsiCommandException( "No expression specified." ); 
//  sync on the wrapper so that the freshness   of the page is determined right before servicing 
// ------------------------------------------------------------------------------                  map message to send to and from other maps  ------------------------------------------------------------------------------ 
//  is taken for this test 
//  If an If-None-Match header has been specified, if modified since   is ignored. 
//  for the access logs. The default is fine. 
//  Unwrap the Exception for clearer error reporting 
//  Cipher AC 
//  Local variable declarations 
//  Block access to special subdirectories.   DefaultServlet assumes it services resources from the root of the web app   and doesn't add any special path protection   WebdavServlet remounts the webapp under a new path, so this check is 
//  Parse 'CustomActionEnd' production: 
//  ignore, leave label empty 
//  Make sure an async timeout doesn't fire 
/*  SSL_kECDHr - ECDH cert, RSA CA cert  */
//  look for hidden newlines inside strings 
//  Note: there's always an initial read event at the moment (reading should be skipped since it ends up in the internal buffer) 
//  Can't be less than zero since the result of the byte->long conversion   will never be negative 
//  Post-mortem cleanup looks for this specific Reference   instance 
/*      * For every custom tag, determines the scripting variables it needs to     * declare.      */
//  Cipher 0A 
/*          * Note: There are all sorts of horrible uses of statics in this test         *       because the API uses classes and the tests really need access         *       to the instances which simply isn't possible.          */
//  LTS   Support ends 2019-12-31 
//  Make sure that constrained resources are not cached by web proxies 
//  Number of tries is the number of attempts to connect to the database   during this login attempt (if we need to open the database)   This needs rewritten with better pooling support, the existing code   needs signature changes since the Prepared statements needs cached   with the connections.   The code below will try twice if there is an SQLException so the   connection may try to be opened again. On normal conditions (including   invalid login - the above is only used once. 
//  Create list of attributes to be removed 
//  Need to localize this. 
//  Bug 55917 / Bug 55918 
//  Taglibs Servlet 2.4 onwards 
//  Remove wrappers for enqueued references from idle and allReferences lists 
//  The only characters that can be escaped inside a String literal 
//  NO-OP since this is the terminal transformation 
//  Java 8 doesn't support modules so default to true 
//  This should throw an Exception 
//  Ensure pages are all relative to the uriRoot.   Those that are not will trigger an error later. The error   could be detected earlier but isn't to support the use case   when failFast is not used. 
//  true if the tag and its body 
//  Does the <jsp:element> have nested tags other than 
/*  RC4 is sort-of broken -- move the the end  */
//  Trigger chunking 
//  Cipher AB 
//  Look for a params node and prepare its param subelements: 
//  Create a new StandardContext instance 
//  Tomcat specific hack to see if TRACE is allowed 
//  kind of backwards on naming.  In the map, each key is the   PooledObject because it has the ordering with the timestamp   value.  Each value that the key references is the key of the   list it belongs to. 
//  ref cannot be null 
//  allocate an unbound server socket channel 
//  Something else went wrong 
//  NOTE - Not relevant for selecting filters 
//  Prepare our response, eating all exceptions 
//  ignoring it. 
//  This will fail on JDK 1.2. Ignoring, as Tomcat can run   fine without the shutdown hook. 
//  that will also destroy the root pool for these sockets. 
//  Cipher C02F 
//  Error page check needs to come before special path check since   custom error pages are often located below WEB-INF so they are 
/*      * Reads a message from the server.      */
//  Start sendfile thread 
//  This map is populated by iterating the methods (which end up as   values in the Map) and obtaining the key from the value. It is 
//  For backward compatibility 
//  '\' is only an escape character inside a StringLiteral 
//  Fill in entry for attribute change notifications          descriptor = new DescriptorSupport              (new String[] { "name=ATTRIBUTE_CHANGE",                              "descriptorType=notification",                              "log=T",                              "severity=5", 
//  an extra check for "/", "+", etc 
//  Serialize the attribute count and the Serializable attributes 
/*          * Indicates whether we need to revert from temporary usage of         * "ISO-8859-1" back to "UTF-8"          */
//  If writer is null, it's an indication that the response has   been hard committed already, which should never happen 
/*              * Outside the try/catch because we want I/O errors during             * renegotiation to be thrown for the caller to handle since they             * will be fatal to the connection.              */
/*      * Maps the given prefix to the given URI.     *     * @param prefix The prefix to map     * @param uri The URI to be associated with the given prefix      */
//  string is default 
//  current token   previous token 
/*      * extends      */
//  assert lock.isHeldByCurrentThread(); 
//  Setting up filters, and parse some request headers 
//  The cookie header value generated by the CookieProcessor was   originally intended for the Set-Cookie header on the response.   However, if passed a Cookie with just a name and value set it   will generate an appropriate header for the Cookie header on the   pushed request. 
//  value we just calculated 
//  Cipher 0D 
//  Replace existing header(s) to ensure any invalid values are removed 
//  Is this the action request from the login page? 
//  Expect 3 messages: headers, body, end 
//  BZ 62667 
//  Note: Nested arrays will result in nested calls to this method. 
//  Check all the status codes and update the FarmDeployer 
// listen for shutdown 
//  Parsing global web.xml is relatively expensive. Use a sync block to   make sure it only happens once. Use the pipeline since a lock will 
//  Create a file read permission for web app context directory 
//  Context root redirect 
//  The requirements of RFC 7230 are being   applied. If the host header and the request   line do not agree, trigger a 400 response. 
//  Stream concurrency control 
//  More data to write   Copy bytes to new write buffer 
//  Cipher 0C 
//  Select the Wrapper to be used for this Request 
//  Cipher AE 
//  10-1f   20-2f + / 
//  Can clear the whole backlog 
/*      * Constructor.      */
//  There is pending data in the network BIO -- call wrap 
//  Configure cipher suite that requires an EC certificate on the server 
/*  Generated By:JavaCC: Do not edit this line. JSONParserTokenManager.java  */
//  Override the default servlet with our own mappings 
//  Invalid with unknown type 
//  Store nested <JarScanFilter> element 
//  If JULI is being used, re-enable JULI's shutdown to ensure   log messages are not lost 
//  Print tag reuse 
//  Cipher AD 
//  Do not call super.reset(). It should be a NO-OP as all loggers should   have been registered via this manager. Very rarely a   ConcurrentModificationException has been seen in the unit tests when   calling super.reset() and that exception could cause the stop of a   web application to fail. 
/*          * We don't want a negative CIDR, nor do we want a CIDR which is greater         * than the address length (consider 0.0.0.0/33, or ::/129)          */
//  Start the new component if necessary 
//  Reset size for new request if the buffer was previously expanded 
//  RefAddr values associated with this Reference 
//  Wrap the exception and re-throw 
//  Set defaults that can't be (easily) set when defining the fields. 
/*      * Additional test following on from SPR-7350 above to check files that     * contain JNDI reserved characters can be served when caching is enabled.      */
//  Duplicate valve earlier in pipeline   increment sequence number 
// so we know something is already in the table 
//  Tomcat but for safety, override them here. 
//  Can't load the class so no point continuing 
//  NO-OP   HTTP/2 has to swallow any input received to ensure that the flow   control windows are correctly tracked. 
//  TODO isRuntimeVisible 
//  Use a prepared statement for validation, retaining the last used SQL to 
//  Not an error on HP-UX so log as a warning   so it can be filtered out on that platform   See bug 50273 
//  just a marker, we don't use the value 
//  Use pre-generated digest 
//  It should be possible to send a request that generates an empty 
//  Cipher 0B 
//  Shouldn't get used for good performance, but is needed for   compatibility with Sun JDK 1.4.0 
//  Setup the PermissionCollection for this web app context   based on the permissions configured for the root of the   web app context directory, then add a file read permission   for that directory. 
//  message-destination-ref was added in 2.4 so should be excluded in 2.3 
//  Ignored 
//  Register with timeout thread 
//  add a Smap for this line 
//  Setup 
//  effectively performs the same check 
/*          * LiteralExpressions can only contain ${ or #{ if escaped with \         * \ is not an escape character in any other circumstances including \\          */
//  (read only attributes will be left in place) 
//  Closed when channel is closed 
//  Append servlet or tag handler path to scratch dir 
//  No collection included in this constraint matches this request 
// There's no way to specify this with SimpleDateFormat  translate.put("W","week in year with first Monday as first day..."); 
// we don't have this one in our membership, check to see if he/she is alive 
//  Cipher C02C 
//  for an empty map. The parser will always parse {} as an empty set. 
//  If the top node has a lower precedence then 
//  It isn't possible for the manager to stop itself 
//  open a new directory context. 
//  Reported as failing during 8.0.11 release vote by Ognjen Blagojevic   EDH was introduced in 1.0.0 
//  Rename the current fragment so it doesn't clash 
//  Block deployment as META-INF/context.xml may contain security   configuration necessary for a secure deployment. 
//  if this gives a parsing failure, treat it like a non-encoded word. 
//  Accept the first preference that the endpoint is able to support 
//  Taglibs pre Servlet 2.4 
//  There is data to write but go via Response to   maintain a consistent view of non-blocking state 
//  Delay the UTF_16LE check if there are more that 2 bytes since it 
//  Set this before we register currently known naming resources to avoid   timing issues. Duplication registration is not an issue. 
//  default JSP error page can be used. 
// stop the thread 
//  Let it fill its branches 
//  -------------------------------------------------------- Replication   Methods 
//  Standard clone() method will copy the map object. Replace that 
//  Use the default client TLS config 
//  store all <Host> elements 
//  Old and new are both null == no change 
//  Servlet 3.1 HTTP Upgrade 
//  Start the new server 
//  Bugzilla 34818, alternating row colors 
//  Log post-service information 
//  NESTED 
//  No additional implementation - just need a class that extends AA for   testing EL methods calls 
//  Append data specified in ranges to existing content for this   resource - create a temp. file on the local filesystem to   perform this operation   Assume just one range is specified for now 
//  Reset the interrupt status so it is visible to callers 
//  custom action 
//  -------------------- ID registry -------------------- 
//  Start up this component 
//  -------------------------------------------------- ByteEntry Inner Class 
//  Cipher C02B 
//  Session may have been closed unexpectedly in the middle of   sending a fragmented message closing the endpoint. If this   happens, clearly there is no point trying to send the rest of   the message. 
// if we timed out, remove ourselves from the waitlist 
/*  Number of cached entries  */
//  Are we configured to do role searches? 
//  Move the data to the beginning of the buffer. 
//  a= s* pi/2 - pi/2 (to switch 0,0 from 3:00 to 12:00)   x = r(cos a) + xcenter, y = r(sin a) + ycenter 
//  Defaults to no limit 
//  unsigned short, unsigned short 
//  We do allow the transactionSynchronizationRegistry to be null for non-app server environments 
//  Confirm that the current web application is currently configured   to access the specified global resource 
//  Superclass implements interface and defines unknown type for   the interface of interest   Map that unknown type to the generic types defined in this class 
//  Only need to scan for @HandlesTypes matches if any of the   following are true:   - it has already been determined only @HandlesTypes is required     (e.g. main web.xml has metadata-complete="true"   - this fragment is for a container JAR (Servlet 3.1 section 8.1)   - this fragment has metadata-complete="true" 
//  Get the CA subject the server should send us for client cert selection 
//  Store nested <JarScanner> elements 
//  Month 
//  Don't mess with x's links.  They may still be in use by   an iterator. 
//  Cipher AA 
//  -------------------------------------------- Extended WebDav status code 
//  Hotdeploy applications 
//  Ignore the first empty segment as the path must always   start with '/'   Ending with a '/' is also OK for instances used for   matches but not for parameterised templates. 
//  No need to issue any JNI calls if the mode is the same 
//  there is data to process 
//  Bug 63026 
//  Negotiation phase 1. By default this simply filters out the   extensions that the server does not support but applications could 
/*  SSL_kDHd   - DH cert, DSA CA cert  */
//  An error occurred, don't return corrupted content 
//  ------------------------------------------------------ getCanonicalPath() 
//  Can we write into buffer ? 
//  Cipher C02E 
//  Registering the host will register the context and wrappers 
//  Always merge imports 
//  Close any socket remaining in the add queue 
/*              * General case. Also used for:             * - javax.resource.cci.InteractionSpec             * - javax.transaction.UserTransaction              */
//  Proceed with the retry below 
//  expressions, not just the current expression 
//  where in the JSP things went wrong 
//  setCorePoolSize(0) wakes idle threads 
//  Optimization: concatenate contiguous template texts. 
//  Wait for the receiver thread to finish 
//  Fire "end" events for all relevant rules in reverse order 
//  Can't expand the buffer as there is no way to signal   to the caller that the buffer has been replaced. 
//  Allocating a new context and binding it to the appropriate   name 
//  Clear the classloader reference in the VM's bean introspector 
//  Checking the first character of the new line. If the character   is a LWS, then it's a multiline header 
//  RC2_128_CBC_EXPORT40_WITH_MD5 
//  Children - if any - must be JSP attributes 
//  Timing tests need an error margin to prevent failures. 
//  processing. 
//  --------------------------------------------------------- Rule Methods 
/*      * Following copied from org.apache.taglibs.standard.tag.common.core.Util v1.1.2      */
//  Reset the branch status for any outer if blocks,   since clearly we took a branch to have gotten here 
//  Cipher C02D 
//  JAAS checked LoginExceptions are successful authentication   invocations so mark JAAS realm as available 
//  Expression 
//  Can process 100 headers 
//  ----------------------------------------------- SendfileData Inner Class 
//  URLs passed to class loaders may point to directories that contain   JARs. If these URLs are used to construct URLs for resources in a JAR   the URL will be used as is. It is therefore necessary to ensure that   the sequence "!/" is not present in a class loader URL. 
//  Parse the input 
//  certLength == -1 indicates an error unless TLS session tickets   are in use in which case OpenSSL won't store the chain in the   ticket. 
/*  Since we walked more than one character  */
//  If the line contains the opening of a multi-line scriptlet   block, then the JSP line number we got back is probably 
//  Swallow the '{' 
//  Output additional mappings in the text 
//  not matched; 
//  Duplicate attribute 
//  Figure out and set the parent root 
//  Add each byte one at a time. The decoder should fail as soon as 
//  Add socket to the list. Newly added sockets will wait   at most for pollTime before being polled. 
//  Parameters with no value are assigned a value of the empty string 
//  Make sure default extensions are always included 
//  NOTE: Calling a fake read is necessary before calling pendingReadableBytesInSSL because   SSL_pending will return 0 if OpenSSL has not started the current TLS record 
//  Call the valueUnbound() method if necessary 
//  Need to overwrite constraint for this pattern 
//  isn't this why we are running jspc? 
//  For external docBases, the context.xml will have been   added above. 
//  Must be OK 
// for debugging  for debugging 
//  At least one byte of the request has been received. 
// connection previously connect with default 
//  Ensure both server and client have shutdown 
//  Check if we are in the shutdown phase 
//  set up a scratch/output dir if none is provided 
/*  Generated By:JJTree: Do not edit this line. AstListData.java Version 4.3  */
//  Handle an HTTP named dispatcher forward 
//  Add resolvers in order 
//  This is an array. Count the dimensions 
// start the thread 
//  Send additional requests. Connection window is empty so only headers 
/*  Multicast IP  */
//  Store nested <Channel> element 
//  directives) have been changed. 
//  No need to unregister - life-cycle listener will handle this when   the child stops 
// no-op 
//  Wait for first request to get as far as it can 
//  object was bound to JNDI via Referenceable API. 
//  Implementation is copied from ClassLoaderLogManager.replace(),   but added special processing for catalina.home and catalina.base. 
//  Cipher 09 
//  Wait for the thread to stop. This prevents warnings in the logs 
//  This object will no longer be visible or used. 
//  Expand the WAR into the new document base directory 
//  Ignore. Some valid file URIs can trigger this. 
//  Change components if necessary 
//  Notify interested session event listeners 
//  always currently true with the JSSE 1.1.x 
//  Put the headers into a map, and process interesting ones 
// ------------------------------------------------------------------   USED BY CONPOOL IMPLEMENTATION  ------------------------------------------------------------------ 
//  no config file, default to this loader - we might be in a 'single' env. 
//  If var is specified and the body contains an EL, then sycn 
//  Stop capturing the System.err output for this thread 
//  Cipher 08 
//  Connection 
//  Log via the host or engine in that case. 
//  Request mapping. 
//  Collection 
//  Map the async servlet to /simple so we can re-use the HTTP/2 handling 
//  Look up the current SSLSession 
//  Strip off any leading "/" 
//  Remove active (primary and backup) session IDs from full list 
//  Do sendfile as needed: add socket to sendfile and end 
//  Convert destination name from collection (with trailing '/')   to file (without trailing '/') 
//  Group the discovered classes by type 
//  Some directories and databases prefix the password with the hash   type. The string is in a format compatible with Base64.encode not   the normal hex encoding of the digest 
//  ------------------------------------------------------------- Properties 
//  Check right number of classes were noted to be handled 
//  Remove any version information and use the mapper 
//  Will never be more than 2 types 
//  PCF must have a pool of PCs 
//  Cipher C02A 
/*      * Checks the given URI and qname to see if they hijack the 'jsp' prefix,     * which would be the case if qName contained the 'jsp' prefix and     * uri was different from http://java.sun.com/JSP/Page.     *     * @param uri The URI to check     * @param qName The qname to check      */
//  body. 
//  Recycle or create a Session instance 
//  Read new bytes if needed 
//  Form the dn from the user pattern 
//  Configure the Login config 
//  deregister the entry. 
//  These are the socket level timeouts 
//  we've read everything there is 
//  Restore the context ClassLoader 
// file was added 
//  SERVLET RESPONSE interface methods 
//  Make it canonical if possible 
//  Monitoring (primarily JMX) related methods 
//  Name is just used for ordering 
//  Impossible 
/*      * This test and the next just swap the order in which the server certs are     * configured to ensure correct operation isn't dependent on order.      */
// If we don't find a format, treat it as a literal--That's what apache does 
//  Load NewThreadPrivilegedAction since newThread() will not be able   to if called from an InnocuousThread.   See https://bz.apache.org/bugzilla/show_bug.cgi?id=57490 
//  ----------------------------------------------------- Logging Properties 
//  ------------------------------------------------------ Container Methods 
//  We want logger as soon as possible 
// empty constructor for the digester 
//  Stop when we reach the bootstrap class loader 
//  or we already have space XXX 
//  Initialize occurrence count to one 
//  Jar has been added 
//  jspURI _must_ be relative to the context 
//  Note: This method will never be called if cgiMethods is "*" so that         case does nto need to be handled here. 
//  Safe to downcast at this point. 
//  Read the opening quote 
//  Flags 
//  Make sure that HostConfig thinks all newly copied files have   been modified. 
//  -------------------- Registration  --------------------   XXX We can add some method patterns here- like setName() and   setDomain() for code that doesn't implement the Registration 
//  Set the managed resource (if any) 
//  Indicates that at invalid sequence is detected two characters later than 
// the time of the last request 
//  String matches against pattern 
/*  return global TCN's APR pool  */
//  In this case, handlers of the parent logger(s) will not be used 
//  Initialize any Executors 
//  125 is maximum size for the payload of a control message 
/*              * The following will result in a welcome file of "" so don't add             * that to the context             * <welcome-file-list>             *   <welcome-file/>             * </welcome-file-list>              */
//  FIXME - Assumes we call listeners in reverse order 
//  This check is derived from the check in Apache Commons Lang 
/*  Generated By:JJTree: Do not edit this line. AstNegative.java  */
/*          * Append IPv4 from IPv4-in-IPv6 format or Zone ID          */
//  Are we allowed to compress ? 
//  Need a web application with a protected and unprotected URL   No file system docBase required 
//  Should be found in resources.jar 
//  Cipher A7 
//  Set up utility classes 
//  Locate the request we should insert in front of 
//   -------------------------------------------------------- message receive 
/*  Socket errors  */
//  this section is identical to testAuthMethodCaseBasic 
/*      * Session that is currently getting swapped in to prevent loading it more     * than once concurrently      */
//  Non-blocking IO requires async 
//  Global JspServlet 
//  Was the session destroyed as the result of a timeout or context stop?   If so, we'll just remove the expired session from the SSO. If the   session was logged out, we'll log out of all session associated with   the SSO. 
//  Check if host exists 
//  Use the class name (pre-2.6.0 compatible) 
//  Doesn't matter 
//  Ignore any entry for which we have already found   a later version 
//  Cipher 05 
//  The URL must start with '/' 
/*  Last step: format new timestamp either using             * parent cache or locally.  */
/*      * List of pool keys - used to control eviction order. The list of keys     * <b>must</b> be kept in step with {@link #poolMap} using {@link #keyLock}     * to ensure any changes to the list of current keys is made in a     * thread-safe manner.      */
//  Due to typo in method name. 
//  Not used directly.   Here to ensure properties are injected in preference to fields 
/*                  * Requested JSP has not been the target of a                 * RequestDispatcher.include(). Reconstruct its path from the                 * request's getServletPath() and getPathInfo()                  */
// should get ignored by the underlying components 
//  Nothing added at the moment so should be null 
//  Look for a setter match first 
//  Skip length and MIME type checks 
//  -------------------- Associated response -------------------- 
// mismatch, there is no package 
//  Return an input source to our alternative URL 
//  Cipher A6 
/*      * For SetProperty: StdActionContent ::= Attributes EmptyBody      */
//  If we were using a shared connection, clear the reference now that 
/*      * TODO     * @param urlPatterns The URL patterns that this Servlet should be mapped to     * @return TODO     * @throws IllegalArgumentException if urlPattern is null or empty     * @throws IllegalStateException if the associated ServletContext has     *                                  already been initialised      */
//  Declare AT_BEGIN scripting variables 
//  Cipher 04 
//  c.addBeforeOrdering("b"); 
//  is there data to read on this channel? 
//  jspFile may be configured as an init-param for this servlet instance 
//  Value determined by observation of what the SSL Engine requested in   various scenarios 
//  Simple dispatch with directory traversal and path parameters   Note comments in Request.getRequestDispatcher(String) that   explain why the path parameter abcde=fghij is not present on the 
// regular shutdown 
/*  Second used to retrieve CLF format in most recent invocation  */
//  Don't bother checking the domain - this is the only option 
//  Write this chunk 
/*      * Test attempting to access special paths (WEB-INF/META-INF) using     * DefaultServlet.      */
//  Some extensions/transformations may buffer messages so it is possible   that no message parts will be returned. If this is the case simply   return. 
//  ignore 
//  ----------------------------------------------------- Context Properties 
//  Container is being started/stopped/removed   Force re-calculation and disable listener since it won't   be re-used 
/*  Generated By:JJTree: Do not edit this line. AstMult.java  */
//  Authenticate the specified username if possible 
//  Make sure WebdavServlet isn't exposing special directories   by remounting the webapp under a sub-path 
// next 4 bytes are compress flag not needed for count packages 
//  Cipher A9 
//  UTF-16, little-endian, no BOM   (or could turn out to be UCS-2... 
//  Create an object pool to contain our active connections 
//  Can we process this request? 
//  application for processing. 
//  Set portOffset on all the connectors based on portOffset in the Server 
//  Log debugging messages as necessary 
//  Request URI 
/*      * Receives notification of a recoverable error.      */
//  If we're caching principals we no longer need the username   and password in the session, so remove them 
//  Window updates for padding 
//  Cipher 07 
//  BlockingDeque methods 
//  Trigger the error handler and close the session 
//  LTS   Supported until at least 2023-09-11 
//  but delete known subdirectories of it. 
//  Clear any custom URLStreamHandlers 
//  Debugging Gump failure 
//  Check extension mapping works 
//  Cipher A8 
// this happens after the request 
//  This should be delayed until the original container   thread exists 
//  Remove this listener from the Context else it will run every 
//  Get set to actually test 
//  ---------------------------------------------- Properties 
//  Add the application services after the container services to ensure 
//  found it 
//  transient as serialization is primarily for values via, e.g. JMX 
//  Last guess: iterate over all attributes, to find a Locale 
//                     //only timeout sockets that we are waiting for a read from                      ObjectReader ka = (ObjectReader) key.attachment();                      long delta = now - ka.getLastAccess(); 
//  if bigInt is exactly byte-aligned, just skip signbit in copy 
//  Cipher 06 
//  Check to see what kinds of element we see as child elements 
/*          * Compare with superclass that uses SocketWrapper         * A sync is not necessary here as the window sizes are updated with         * syncs before the dispatches are executed and it is the window size         * updates that need to be complete before the dispatch executes.          */
//  Triggers reload 
//  Retrieve and set the server 
//  check package and parent packages 
//  Constructs to make iteration over all WebResourceSets simpler 
//  Failed to create base directory 
/*          * DriverManager.getDrivers() has a nasty side-effect of registering         * drivers that are visible to this class loader but haven't yet been         * loaded. Therefore, the first call to this method a) gets the list         * of originally loaded drivers and b) triggers the unwanted         * side-effect. The second call gets the complete list of drivers         * ensuring that both original drivers and any loaded as a result of the         * side-effects are all de-registered.          */
//  lookup exact content-type match (e.g.   "text/html; charset=iso-8859-1") 
//  Cipher 01 
//  Cipher C026 
//  add rest of unescaped portion 
// make sure we don't pass down any flags that are unrelated to the bottom layer 
//  cannot resolve 
//  TLS/SSL channel is slightly different 
// find the request that was passed into the service method 
//  send the response to the original request over HTTP/2. 
//  Have to dispatch as this will be executed from a non-container   thread. 
//  Cipher A2 
//  If any of the params have their values specified by 
//  checked in call above 
//  --------------------------------------------------------- Static Methods 
//  Finish parsing the rules 
//  retain strong references 
// we don't have enough data to validate it 
//  Should list GET as an omitted method 
//  Only need to copy the host name up to the : 
//  Failed to negotiate agreeable terms 
//  Disable background thread 
//  Cipher C025 
//  Need to exclude the TLSv1.3 ciphers 
//  @GuardedBy("keyLock") for write access (and some read access) 
//  Subsequent requests should return in the protected page.   Our role parameter should be appear in the page. 
// no more matches possible 
/* begin the cache size */
//  Note this issue is fixed in Java 8 update 05 onwards. 
//  Welcome files with trailing path parameters at start 
//  test listing all possible paths for a classpath resource 
//  Cipher A1 
//  Can't end on a single ':' 
/*      * Notes from RFC2617     * H(data) = MD5(data)     * KD(secret, data) = H(concat(secret, ":", data))     * A1 = unq(username-value) ":" unq(realm-value) ":" passwd     * A2 = Method ":" digest-uri-value     * request-digest  = <"> < KD ( H(A1),     unq(nonce-value)                                    ":" nc-value                                    ":" unq(cnonce-value)                                    ":" unq(qop-value)                                    ":" H(A2)                                   ) <">      */
//  --------------------------------------------------------- Public Methods 
//  make sure driver is registered 
//  -------------------- Adding headers -------------------- 
//  Jump ahead far enough that the entire cache will need to be cleared 
//  For any value other than 'true' this will be false. 
//  Preserve xmlns attributes 
//  child's container is Engine 
//  Depending on what is presented, JSSE may also throw   KeyStoreException or IOException if it doesn't understand the   provided file. 
//  Send the headers 
//  Size 
// $NON-NLS-1$ //$NON-NLS-2$ 
//  This is what happens when context reload completes 
/*  New AES ciphersuites  */
//  Cipher C028 
//  get the real connection and XAResource from the connection 
//  Should never happen. Test will fail if it does. 
//  <param > for java_archive 
//  Static so it can be used by Stream to build the MimeHeaders required for 
//  Cipher 03 
//  Cipher A5 
//  *********************************************************************   Private utility methods 
//  Create sorted map of host names. 
/*      * Logon to access a protected resource using DIGEST authentication,     * which will establish an SSO session.     * Wait until the SSO 0session times-out, then try to re-access     * the resource.     * This should be rejected with SC_FORBIDDEN 401 status, which     * will then be followed by successful re-authentication.      */
//  Make sure isReady() and onWritePossible() have a consistent view   of buffer and fireListener when determining if the listener 
/*  Generated By:JJTree: Do not edit this line. AstBracketSuffix.java  */
//  Instantiate the required listeners 
//  Set available status depending upon startup success 
//  Consume extra bytes. 
//  numActive has changed
//  Now at the start of the mechType list. 
//  Check for leaks triggered by ThreadLocals loaded by this class loader 
// ------------------------------------------------------------------------------                CONSTRUCTORS  ------------------------------------------------------------------------------ 
//  Unknown parameter 
//  out (flushed) 
//  This may fill the write buffer in which case the   isReadyForWrite() call below will re-register the socket for   write 
//  next, a set of tests where the server Context is configured to never   use cookies and the session ID is only carried as a url path parameter 
//  Cipher A4 
//  Take care of the quoting here. 
//  Cipher C029 
//  Expected because the server is going to drop the connection. 
//  Default values for these depend on whether either of them are set on 
//  Root element 
//  Declare bean 
//  Configure the client 
//  Create a reference to the resource env. 
//  Mixing types should throw an error 
//  Cipher C027 
//  continue and check the flag 
//  find local member from static members 
//  Cipher 02 
//  Usage of DriverManager is not possible, as it does not   respect the ContextClassLoader   N.B. This cast may cause ClassCastException which is   handled below 
//  Skip any LWS and position to read the next character. The next character   is returned as being able to 'peek()' it allows a small optimisation in 
//  ---------------------------------------------------------- Constructors 
//  Is there enough data in the read buffer to satisfy this request?   Copy what data there is in the read buffer to the byte array 
//  The JVM is being shutdown. Make sure all loggers for all class   loaders are shutdown 
//  Add the remaining literals 
//  barfs on it (see Bugzilla 30869 bug report). 
//  Excessive but allows for slow systems 
//  If the Server failed to start, the mapperListener won't have been 
//  Trim '(' and ')' 
//  e.addBeforeOrderingOthers(); 
//  There is never any O/P on stream zero but it is included in   the backlog as it simplifies the code. Skip it if it appears   here. 
//  The initial accept will be called in a separate utility thread 
// add the entry to the dynamic table 
//  Cipher A3 
//  Force the use of local ports if required 
//  if we are calling anything else, bail out 
//  Ensure SecureRandom has been initialised 
//  at least we could connect 
//  If everything works instantly this should be 768 but allow a   fairly large margin for timing differences 
/*      * Test whether size limited uploads correctly handle connection draining.      */
//  Always register the future. 
// clear the buffer if we have emptied it out on data 
//  Cipher C022 
//  check if SSL_read returned <= 0. In this case we need to check the error and see if it was something 
//  NOOP - App called complete() or dispatch() between the the   timeout firing and execution reaching this point 
//  Use the default Options implementation 
//  There should be one Servlet MBean registered 
//  Circle is just Bresenham's algorithm for a scan converted circle 
//  Uppercase or lowercase (2.3) 
//  Pointless method call so there is somewhere to put a break point   when debugging 
// ------------------------------------------------------------------------------                  Map Entry class 
//  Make sure that HostConfig thinks the xml has been modified. 
//  Wrap with a buffer if necessary 
//  WAR must have been modified. Remove expanded directory. 
//  Possibly registered with a different MBeanServer 
//  the original cookie 
//  If there is no servlet to execute, return null 
//  create file 
//  A parallel request has called session.invalidate() which has   removed the session from the Manager. 
//  Continue processing the socket on the current thread 
//  Fix for Bug 10040   Always associate a session with a new SSO reqistration.   SSO entries are only removed from the SSO registry map when   associated sessions are destroyed; if a new SSO entry is created   above for this request and the user never revisits the context, the 
//  Check if compression is enabled 
//  Must be followed by '/' 
//  -------------------------------------------------------------- Variables 
//  If everything is OK, so complete 
//  ByteBuffer is used throughout this parser as it allows the byte[] 
//  Make sure appBase does not contain a conflicting web application 
//  message-destination-ref, message-destination were introduced in 
//  Release here since there will be no   notify/dispatch to do the release. 
/*      * Obtain a value for the given HTTP header.     * TODO Servlet 4.0     * Clarify the behaviour of this method     *     * @param name  The name of the header whose value is to be returned     *     * @return The value of the given header. If multiple values are defined     *         then any may be returned      */
//  conflicting post-construct definitions 
//  Only need to reset the old request if it is going to be pooled.   Otherwise let GC do its thing. 
//  Cipher C021 
//  Start with roles retrieved from the user entry 
//  Many calls can't do infinite timeout so use Long.MAX_VALUE if timeout is <= 0 
//  Fast for valid user info characters, slower for some incorrect   ones 
/*          * The purpose of this sync and these locks is to make sure that a         * session is only loaded once. It doesn't matter if the lock is removed         * and then another thread enters this method and tries to load the same         * session. That thread will re-create a swapIn lock for that session,         * quickly find that the session is already in sessions, use it and         * carry on.          */
//  stay silent 
/*      * # '<' CustomAction CustomActionBody     *     * CustomAction ::= TagPrefix ':' CustomActionName     *     * TagPrefix ::= Name     *     * CustomActionName ::= Name     *     * CustomActionBody ::= ( Attributes CustomActionEnd ) | <TRANSLATION_ERROR>     *     * Attributes ::= ( S Attribute )* S?     *     * CustomActionEnd ::= CustomActionTagDependent | CustomActionJSPContent |     * CustomActionScriptlessContent     *     * CustomActionTagDependent ::= TagDependentOptionalBody     *     * CustomActionJSPContent ::= OptionalBody     *     * CustomActionScriptlessContent ::= ScriptlessOptionalBody      */
//  According to JSP 2.0, if the body of the <jsp:attribute>   action is empty, it is equivalent of specifying "" as the value   of the attribute. 
//  Create the XADataSource instance using the configured class name if it has not been set 
//  the actual element name is either in localName or qName, depending 
//  I only care about console - that's what's used in default config anyway 
//  Load the ModelMBean implementation class 
//  Construct the class loader itself 
//  noroot_rel_uri, resolve against the current JSP page 
//  Check for compression 
//  Note: Test string is also Java escaped 
//  Resource is an xml file in the configBase so it may be deleted 
//  See also https://bz.apache.org/bugzilla/show_bug.cgi?id=63690   The buffering behaviour of some clients means that small data frames   are much more frequent (roughly 1 in 20) than expected. Use an 
//  Assume one value per attribute 
//  Cipher C024 
//  Only users with application roles (role1 or role2 so user1 or user2) 
//  Trace - assume disabled unless we can prove otherwise 
//  There can only be one 'import' attribute per tag directive 
// add to queue 
//  Remove the entry from the cache 
// ===============================================================================    Expose JMX attributes through Tomcat's dynamic reflection  =============================================================================== 
//  At the moment, setting the timeout is useless, but it could get   used again as the normal poller could be faster using maintain.   It might not be worth bothering though. 
//  so that configuration is not lost. 
//  Tell the class loader the root of the context 
//  Set the attributes 
//  POOL-363 - Required for applications using Runtime.addShutdownHook(). 
/*      * Parse the body as JSP content. @param tag The name of the tag whose end     * tag would terminate the body @param bodyType One of the TagInfo body     * types      */
//  Not expected. Rethrow. 
//  Cipher A0 
//  Note: We do not fail early so the client has a chance to   read the response before the connection is closed. See:   https://httpd.apache.org/docs/2.0/misc/fin_wait_2.html#appendix 
//  Don't try and evaluate expressions that depend on variables or functions 
//  Flags. End of stream 
//  --------------------------------------------------- OutputBuffer Methods 
//  must search for name s. Spec Servlet API 3.0 - 8.2.3.3.n.ii page 81 
//  Set up the factory we will use (passing the pool associates   the factory with the pool, so we do not have to do so   explicitly) 
/*      * Accumulate the response headers into a map, and extract     * interesting details at the same time      */
//  Stream has been closed and removed from the map 
/*              * Need to be careful here. The test wants the exact content length             * in bytes.             * This will vary depending on where the test is run due to:             * - The length of the version string that appears once in the error             *   page             * - The status header uses a UTF-8 EM dash. When running in an IDE             *   the UTF-8 properties files will be used directly rather than             *   after native2ascii conversion.             *             * Note: The status header appears twice in the error page.              */
//  Stash the SavedRequest in our session for later use 
//  Ciphers is stored in OpenSSL format. Convert the provided value if   necessary. 
//  This filter only needs to handle WebSocket upgrade requests 
//  Cipher C023 
//  Reset frames 
//  Deal with exceptions to the standard rule 
//  Edge cases around actual content length 
//  Set the fin bit 
//  Version 0 (Netscape) attributes 
//  Create a place for the normalized path 
//  Note: This depends on Endpoint instances being added         before POJOs in WsSci#onStartup() 
//  Normal Cookie 
//  Session has been invalidated.   Ignore and fall throw to application scope. 
//  Register the properties as system properties 
//  cast once 
//  if we are executing, get the current time 
//  No method parameters   Can only invoke the expression if none of the lambda expressions   in the nesting declare parameters 
//  loader is reached. 
//  Removing any lock-null resource which would be present at 
//  Processing error. parseContentRange() set the error code 
//  Create the warTracker file and align the last modified time 
//  These are the stream level timeouts 
//  Set encoding 
//  Response line 
//  Skip to the end of the headers 
//  file:... 
//  JULI's log manager looks at the current classLoader so there is no   need to use the passed in classLoader, the default implementation   does not so calling reset in that case will break things 
//  Check for primitives 
//  Always have to invoke the outer-most expression 
//  wait long enough for the BASIC session to expire, 
//  Remaining BOMs are at least 3 bytes 
//  Validate the user's credentials 
//  Replace the var name with its value 
//  Should be async at this point 
/*      * For a generic parameter, return either the Class used or if the type     * is unknown, the index for the type in definition of the class      */
/*      * Filters authenticated principals to ensure that <code>null</code> is     * returned for any user that is currently locked out.      */
//  the session has timed out 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=57559 
//  Cookies with leading and trailing whitespace 
//  EL Resolvers 
//  Just enough should pass 
//  If one isn't available, generate a new one 
//  Can use ''' inside '"' when quoting with '"' and vice versa without 
//  Send request in two parts 
//  If our authentication was not successful, just return false 
//  using the salt 
//  Client hello is handshake type 1 
//  Check the timeout wasn't too long 
//  Last check so use a short-cut 
//  Deserialize the attribute count and attribute values 
// translate.put("w","E"); 
// if there is data to be written 
/*  System property that controls if the strict white space rules are     * applied.      */
//  Ensure that a Realm is present before any attempt is made to start   one. This will create the default NullRealm if necessary. 
/*              * First call to this loads all drivers visible to the current class             * loader and its parents.             *             * Note: This is called before the context class loader is changed             *       because we want any drivers located in CATALINA_HOME/lib             *       and/or CATALINA_HOME/lib to be visible to DriverManager.             *       Users wishing to avoid having JDBC drivers loaded by this             *       class loader should add the JDBC driver(s) to the class             *       path so they are loaded by the system class loader.              */
// nop 
//  Delete other redeploy resources 
/*      * Load using arguments      */
//  Use defaults for unspecified values 
//  Factory class. Hide public constructor. 
//  message-destination-ref 
// Incorporate each LineInfo into the previous LineInfo's 
// member - 30  running- 10  coord - 30  view-id - 24  view count - 8 
/*      * Visitor which scans the page and looks for tag handlers that are tag     * files, compiling (if necessary) and loading them.      */
//  Make sure value doesn't contain any of the delimiters since   that would indicate something went wrong 
//  Save the inherited Principal in this session so it can remain   authenticated until it expires. 
//  Pass along the DER encoded certificates of the accepted client   certificate issuers, so that their subjects can be presented   by the server during the handshake to allow the client choosing 
/*      * Make this possible to override so sub-class can more easily test proxy      */
/*      * java.lang should be imported by default      */
//  Upgrade 
//  1 byte - too small should fail 
//  Cipher C020 
//  OK if size is too big briefly 
//  keep sort order 
//  Settings 
//  Note: this uses the main "net" package strings as many are common with APR 
//  verify the SSOID exists as a cookie 
//  Check no further entries were found 
//  servlet is not detected 
//  Instantiate and record a FilterConfig for each defined filter 
//  Removing Mime mappings 
/*  TCN_MAJOR_VERSION  */
//  Use fall-back for checking the error occurred 
//  Look up the actual operation to be used 
//  Standard package where we know all the class names 
//  Replace or add this attribute 
//  deal with the Exception 
//  List is in alphabetical order of normalised templates. 
//  From the Tomcat 3.3 HTTP/1.0 connector 
//  unable to support. 
//  Check if we have a Close message 
//  Same size as the WsFrame input buffer 
//  Prepare and return our response, eating all exceptions 
//  Removing filter defs 
/*      * State for non-blocking output is maintained here as it is the one point     * easily reachable from the CoyoteOutputStream and the Processor which both     * need access to state.      */
/*  ARIA ciphers 0xC05E to 0xC05F     * Unsupported by both Java and OpenSSL      */
//  Find the pattern between padIdxStart & padIdxTmp in str between 
/*              * Try to reauthenticate using data cached by SSO. If this fails,             * either the original SSO logon was of DIGEST or SSL (which we             * can't reauthenticate ourselves because there is no cached             * username and password), or the realm denied the user's             * reauthentication for some reason. In either case we have to             * prompt the user for a logon              */
//  Caching Filter) 
// -------------------------------------------------------- Lifecycle methods 
//  Version=1 ... required 
//  Required to trigger validation query's execution 
//  If an error has occurred that prevents further I/O, don't waste time   producing an error report that will never be read 
//  No query string 
//  Instead of starting a real acceptor thread, this will instead call   an asynchronous accept operation 
//  Same processing order as InputBuffer / CoyoteAdapter 
//  Deploy the application in this directory 
//  no such attribute 
// protect against buffer overwrite 
//  Lazt init 
//  ------------------------------------- 
//  Test without ports 
//  It is possible to read directly from the buffer contents 
//  time the Context is stopped. 
//  print processing instruction 
//  Do nothing if there is no reason phrase for the specified status code and 
//  Reading the "catalina.useNaming" environment variable 
// Add the error page 
//  with a new object. 
//  17-headers, 17-1k-body 
//  a name 
//  so no context could be mapped. 
/*          * Remove BOM before checking content         * BOM (should be) removed by Tomcat when file is included          */
//  Only web application JARs are checked for web-fragment.xml   files.   web-fragment.xml files don't need to be parsed if they are never   going to be used. 
// make sure connection is valid 
//  performance 
/*  Generated By:JJTree: Do not edit this line. AstNotEqual.java  */
//  --------------------------------------------------------- Protected Methods 
//  Absolute paths aren't allowed so block it 
//  Inner multipart terminated -> Return to parsing the outer 
//  Store nested <Executor> elements 
//  As long as every omitted method as a corresponding method the 
//  Not atomic. Increments may be lost. Not a problem. 
//  Tell JspServletWrapper to ignore the reload attribute while this 
//  set transport to smtp 
//  IPv6 - invalid 
//  not matched 
//  -------------------- Static methods --------------------   Factories 
//  Need to allow time (but not too long in case the test fails) for 
//  Ensure open sockets etc. are cleaned up if something goes   wrong during bind 
//  If the principal is null then this is a logout. No need to change   the session ID. See BZ 59043. 
//  Case sensitivity check   The normalized requested path should be an exact match the equivalent   canonical path. If it is not, possible reasons include:   - case differences on case insensitive file systems   - Windows removing a trailing ' ' or '.' from the file name     In all cases, a mis-match here results in the resource not being   found     absPath is normalized so canPath needs to be normalized as well 
//  See BZ 62603. 
//  Body not allowed 
//  Bugzilla 35252: https://bz.apache.org/bugzilla/show_bug.cgi?id=35252 
//             // this mbean is associated with a source - maybe we want to persist              source.updateField(oname, name, value);          } 
//  Invoke handling of the message in the room. 
//  locale-encoding-mapping-list was introduced in Servlet 2.4 
//  We know the params start with '(', check they end with ')' 
//  Two bytes per entry 
//  jspName is validated in addServlet() 
/*  Camellia ciphersuites from RFC4132 (            256-bit portion)  */
//  If we forward, the response is suspended again 
//  If we know that the request is bad this early, add the 
//  Read the response status line 
//  Tell to close the socket 
// add the action 
//  the poll timed out, it gives an opportunity to stop the current   thread if needed to avoid memory leaks. 
//  Acquire a Principal object for this user 
//  use a custom configurator to do more than this. 
// we have an unbounded queue, so always return true 
//  Put the SecureRandom back in the poll 
//  Build the byte array 
//  jsp-config/taglib or taglib (2.3 and earlier) 
//  protected fields 
//  Always add these in lower case 
// don't allow cancel for now 
//  Store nested <SessionIdGenerator> element 
/*      * Expect that the buffered results are slightly slower since Tomcat now has     * an internal buffer so an extra one just adds overhead.     *     * @see "https://bz.apache.org/bugzilla/show_bug.cgi?id=52328"      */
/*              * Inform all the processors associated with current connections             * that the endpoint is being paused. Most won't care. Those             * processing multiplexed streams may wish to take action. For             * example, HTTP/2 may wish to stop accepting new streams.             *             * Note that even if the endpoint is resumed, there is (currently)             * no API to inform the Processors of this.              */
// invalidate the previous primary 
//  See https://www.openssl.org/docs/manmaster/man3/SSL_pending.html 
//  Skip any user info 
/*          * ... if there are bits left to test. There aren't any if lastByteShift         * is set to 0.          */
//  Set the container for sub-realms. Mainly so logging works. 
//  Process incoming messages very slowly 
/*  Interfaces are implicitly abstract, the flag should be set         * according to the JVM specification.          */
//  Add to the existing 
//  Query Global Request Processors 
/*  JavaCC - OriginalChecksum=6a7910e58a583371769800554113a8d3 (do not edit this line)  */
//  Array must be remove: Current master request send endAccess at recycle.   Don't register this request session again! 
//  Since this runnable is not executing as a result of a socket   event, we need to ensure that any registered dispatches are   executed. 
// set the status 
//  only if we have exactly _two_ dots. 
//  Check if limit is already exceeded 
//  Expect this to fail 
//  Config section 
//  No more data available. 
//  Ideally, this code should sync on stateLock so that the correct   action is taken based on the current state of the connection.   However, a sync on stateLock can't be used here as it will create the   possibility of a dead-lock. See BZ 61183.   Therefore, a slightly less efficient approach is used. 
//  Make sure the entire response has been read. 
//  Invalid cookie 
//  Check the validity of each certificate in the chain 
//  Deploy Section 
//  Note: Possible alternate behavior:   If there's non blocking abuse (like a test writing 1MB in a single   "non blocking" write), then block until the previous write is   done rather than continue buffering   Also allows doing autoblocking   Could be "smart" with coordination with the main CoyoteOutputStream to   indicate the end of a write 
//  Parsing depth header 
//  This is an error state. Make sure it is marked as such. 
//  Close the session. 
//  Make sure the background process has stopped. In some test   environments it will continue to run and break other tests that check 
/*  Generated By:JJTree: Do not edit this line. AstIdentifier.java  */
//  Passwords never need validating so always return null 
//  Check for alphabetical order of host names 
//  Serializable listeners 
/*  Value of CLF format retrieved in most recent invocation  */
//  10-1f   20-2f - 
//  Servlet 4.0 Push requests 
//  We have to do this so Tomcat will actually parse the cookies from the request 
//  Notify decoder of EOF. 
//  Reset connection window size after initial response 
//  Redeploy resources processing is hard-coded to never delete this file 
//  com.sun.org.apache.xml.internal.serialize.DOMSerializerImpl 
//  Source JVM 
//  Configure the appropriate authenticator 
//  Check state 
//  Long.MAX_VALUE 
// @GuardedBy("EvictionTimer.class") 
//  Set the class loader for the factory 
//  Old code:   out.flush();   Do not flush the buffer even if we're not included (i.e.   we are the main page. The servlet will flush it and close   the stream. 
//  Have to throw Error to force start process to be aborted 
//  https://en.wikipedia.org/wiki/X.690#BER_encoding   https://tools.ietf.org/html/rfc8017#page-55 
//  At this point, always expire the entry and re-populating it is   likely to be as expensive as validating it. 
//  it's a comment, ignore it 
//  Assertion for text contained with <p></p>, e.g. printed by tags:echo 
//  This should fail 
//  Depends on the SSLImplementation. 
//  If there is a "kind", check it is "Pod" 
//  Check that there is a 0 arg constructor 
//  Update jsp line number 
//  zero payload 
//  Store nested <SSLHostConfigCertificate> elements 
//  write output 
/*          * Don't use fill(false) here because in the following circumstances         * BIO will block - possibly indefinitely         * - client is using keep-alive and connection is still open         * - client has sent the complete request         * - client has not sent any of the next request (i.e. no pipelining)         * - application has read the complete request          */
// register our OP_READ interest 
//  Cipher C01E 
//  jsp-config was added in Servlet 2.4 
//  Propagate value of scriptingElementSeen up. 
//  - chain (skip remaining chained rules if this one does not match) 
//  New text message 
/*  Whether the servlet/tag file needs reloading on next access  */
//  objectMaxSize must be < maxSize/20 
//  Ask the next valve to process the request. 
// don't store more than this amount of queries 
//  Deploy all WebSocket endpoints defined by annotations in the examples   web application. Filter out all others to avoid issues when running   tests on Gump 
//  Generation is not interruptible so any tasks that   have started will complete. 
//  Set the current settings for this socket 
//  Generate all fragment methods: 
//  presumes quotes are removed 
/*      * Expect the server to reply with 100 Continue interim response      */
//  --------------------------------------------------------- Utility methods 
//  Binding thread 
//  tag 
// the id of the scope 
//  does not have a defined mapping is excluded. 
//  ------------------------------------------------ HTTP/1.1 Output Methods 
//  If thread stopping is enabled, executor threads should have been   stopped above when the executor was shut down but that depends on the   thread correctly handling the interrupt. Give all the executor   threads a few seconds shutdown and if they are still running 
//  If realm doesn't start can't authenticate against it 
//  Shouldn't be necessary but acts as a check that sub-classes are 
//  Cipher C01D 
//  (note the == since we won't recognize JAVAX_*   from outside this module). 
//  Minimise pauses during test 
//             throw new InvalidTargetObjectTypeException(type); 
/*      * Test verifying that Tomcat correctly de-registers the MBeans it has     * registered.     * @author Marc Guillemot      */
//  Unknown annotation - ignore 
//  Append the declarations to the root node 
//  Write the pending data from the network BIO into the dst buffer 
//  If the thread has been started via an executor, try 
//  Configure output channel 
//  f.addBeforeOrderingOthers(); 
//  Note existing files will be deleted and then replaced 
//  big enough. 
//  Does the value contain a " ? If so must encode it 
//  Redundancy. Alias name = Host name. No error here. 
//  Get all the other parameters required from the standard system   properties. Only need to get the parameters that affect the creation   of the server port. 
//  NO-OP   Allow stop to complete since it is used for clean-up 
//  Both get changed 
//  Recycle the wrapper request and response 
//  Clean up if overall authentication failed 
//  Alpha and digit are safe by default 
//  Internal use only 
//  Based on code in Http11InputBuffer   Note: The actual request is not important. This code only checks that         the buffer contains a correctly formatted HTTP request line.         The method, target and protocol are not validated. 
//  Next three bytes (unsigned) are the size of the client hello. We need   all of it. 
//  Set up the object 
//  the .java file 
//  Checking was disabled 
// check to see if we have objects in the queue 
//  There is still data inside the main read buffer, it needs to be read first 
// Annotation Types 
//  Need to re-negotiate SSL connection 
//  If the value for setProperty was specified via   jsp:attribute, first generate code to evaluate   that body. 
//  ----------------------------------------------------------- Fields 
//  Started to read request line. 
//  Connection window update after reading request body 
//  And add force authentication to occur on the initial handshake 
//  Must have stopped already. Too late to ignore it. Assume not a   request processing thread. 
//  In both cases, return and let context init the namingResources   when it starts 
/*  * Sender to proxies using multicast socket.  */
//  used with a <jsp:element>, otherwise false 
//  Get remote host name using a DNS resolution 
//  No more data means no extensions present 
//  last resort: Always return a Class 
//  TODO: allow contexts without a base dir - i.e.   only programmatic. This would disable the default servlet. 
//  Cipher C01F 
/*  APR sets APR_FILES_AS_SOCKETS to 1 on systems where it is possible     * to poll on files/pipes.      */
//  URL re-writing is always enabled by default 
//  Implies klass is not null   Generate codes to instantiate the bean class 
//  Value 
//  it. 
//  Update the SSO session with the latest authentication data 
//  Second el.properties file 
//  --------------------------------------------- HttpServletRequest Methods 
//  Preserve the current context environment parameters 
//  ignore comments in the DTD 
// not necessary for full compliance 
//  Disable Nagle's algorithm to ensure packets sent immediately   TODO: Hoping this causes writes to wait for a TCP ACK for TCP RST 
//  try to resolve using system ID 
//  NO-OP: Accept anything the server sends for the unit tests 
//  Adds CORS specific attributes to request. 
//  Need to use more specific type 
//  End of compressed message. Drop EOM bytes and output. 
//  Response body varies. It is the response code that is of interest   in these tests. 
/*  Generated By:JJTree: Do not edit this line. AstConcatenation.java Version 4.3  */
//  Virtual body content types, to make parsing a little easier.   These are not accessible from outside the parser. 
//  Since flushing is true the socket must already be registered   for write and multiple registrations will cause problems. 
//  There is not enough space in buffer. Flush it ... 
//  Failed to generate server credential from user credential. Points to   a configuration issue. The root cause should have been logged in the 
//  Unable to buffer enough data to read SNI extension data 
//  Ensure all servlets and tags that need to be reloaded, are reloaded. 
//  Cipher C01A 
//  These are static because it is simpler than trying to inject them into   the endpoint 
//  Set-up 
//  The rest is to check it worked correctly 
//  If there is still data inside the main read buffer, it needs to be read first 
// This shouldn't be possible 
/*  * <b>XML Format </b> * * <pre> * {@code *       <Registry name="" encoding="UTF-8" > *         <Description *             tag="Server" *             standard="true" *             default="true" *             tagClass="org.apache.catalina.core.StandardServer" *             storeFactoryClass="org.apache.catalina.storeconfig.StandardServerSF"> *           <TransientAttributes> *             <Attribute></Attribute> *           </TransientAttributes> *           <TransientChildren> *             <Child></Child> *           </TransientChildren> *         </Description> *   ... *       </Registry> * } * </pre> * * * Convention: * <ul> * <li>Factories at subpackage <i>org.apache.catalina.core.storeconfig.xxxSF * </i>.</li> * <li>Element name are the unique Class name</li> * <li>SF for StoreFactory</li> * <li>standard implementation is false</li> * </ul> * other things: * <ul> * <li>Registry XML format is a very good option</li> * <li>Store format is not fix</li> * <li>We hope with the parent declaration we can build recursive child store * operation //dream</li> * <li>Problem is to access child data from array,collections or normal detail * object</li> * <li>Default definitions for Listener, Valve Resource? - Based on interface * type!</li> * </ul>  */
//  Is this the re-submit of the original request URI after successful 
//  Check for null byte 
//  Flags. end of headers (0x04). end of stream (0x01) 
//  in the first place. 
// check to see if it is a testMessage, if so, process = false 
//  JSP line for this tag 
//  Retrieve the MBean server 
//  Remove the old file 
//  they are excluded from the next allocation round. 
//  This works and uses only one timeout mechanism for everything, but the   non event poller might be a bit faster by using the old maintain. 
//  This is a property 
// ignore if we haven't started the sender 
//  Salt added to "password" is "salttoprotectpassword" 
//  Commit if not auto committed 
//  alias 
//  Make sure this alias is currently present 
//  Advertise support for client_max_window_bits   Client only supports some values so there will be some failures here   Note Autobahn returns a 400 response if you provide a value for   client_max_window_bits 
//  Interfaces 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=61932      */
//  Bind the server socket 
//  Collect page info 
//  Shouldn't happen:   an exception is thrown if hostname can't be resolved to IP, but we already provide an IP 
/*          * This method allows injection of cribbed base64 blobs,         * without any validation of the contents          */
//  Servlet 4.0 Trailers 
//  Generate alias map 
//  Possible the all data may have been read during service()   method so this needs to be checked here 
//  Try connecting to the alternate url. 
//  Take the maxTotal limit into account 
//  If watch is longer than 1 character this is a scripting   expression and EL is always ignored 
//  First create a session in the first context: the problem is   that the top level request is the only one which can   create the cookie safely 
//  Store nested <ResourceLink> elements 
//  may be skipped. 
/*      * When a non-preflight request is given to a pre-flight request handler.     *     * @throws IOException     * @throws ServletException      */
//  per the SRV.6.2.5 absence of any dispatcher elements is   equivalent to a REQUEST value 
//  Make sure an already closed socket is not added to the poller 
//  If a write is pending, writing is not possible until a notification is sent 
//  update counters 
//  Note: The coercion rules are that a null of any type can be coerced to a 
//  Cipher C01C 
//  Only send a close message on an IOException if the client   has not yet received a close control message from the server   as the IOException may be in response to the client   continuing to send a message after the server sent a close   control message. 
//  These were implemented in 1.1.1 so won't be available in any   earlier version 
//  -------------------- Parameter parsing --------------------   we are called from a single thread - we can do it the hard way 
//  Calculate the enabled ciphers 
//  Set up stream 3 
/*      * Happy path test, when a valid CORS Pre-flight request arrives.     *     * @throws ServletException      */
/*  ARIA ciphers 0xC062 to 0xC069     * Unsupported by both Java and OpenSSL      */
//  Make sure that after the cookie we have a separator. This 
//  If this connection was closed during the transaction and there is 
//  Change the specified file 
//  r1, directory, first 
//  Service Interface 
/*              * Check if bean is already there              */
//  Check for a role alias 
//  Then try sending some data (which should fail) 
//  ----------------------------------------- Common configuration properties 
//  Compression 
//  behaviour when the external resource is deleted 
//  Arbitrarily located in the init, could be in the initial read event, asynchronous, etc.   Note: the completion check used will not call the completion handler if the IO completed inline and without error.   Using a completion check that always calls complete would be easier here since the action is the same even with inline completion. 
//  Check the specific "*" special URL pattern, which also matches   named dispatches 
//  Skip the specified exceptions 
//  ordered list 
//  Always allows equals 
//  Validate the userinfo 
//  JSP document (XML syntax)   InputStream for jspx page is created and properly closed in   JspDocumentParser. 
//  -----------------Error State -------------------- 
//  Cipher C01B 
//  Create and return a suitable Principal for this user 
//  ----------------------------------------------------- ReplicatedMapEntry 
//  ----------------------------------------- PropertyChangeListener Methods 
/*                      * Note: Beans.instantiate throws ClassNotFoundException if                     * the bean class is abstract.                      */
// do nothing, the pool checks on every return 
//  Passing null for docBase means that no resources will be   watched. This will be logged at debug level. 
//  Initialize character set mapper 
//  Probably an UpgradeProcessor 
//  Set port number 
//  XP 64-bit SP2 
//  Store nested <Manager> elements 
/*      * ExpressionBody ::= (Char* - (char* '%>')) '%>'      */
//  https://bugs.openjdk.java.net/browse/JDK-8195096 
//  Step two, split the extension into the registered name and   parameter/value pairs using ';' as a separator 
//  Set the default if we don't have any overrides 
// this would lock up the test suite 
//  JARs are scanned unless the filter says not to.   Directories are scanned for pluggability scans or   if scanAllDirectories is enabled unless the 
/*              * Dispatch on new thread.             * Firstly, this avoids a deadlock on the SocketWrapper as Streams             * being processed by container threads lock the SocketProcessor             * before they lock the SocketWrapper which is the opposite order to             * container threads processing via Http2UpgrageHandler.             * Secondly, this code executes after a Window update has released             * one or more Streams. By dispatching each Stream to a dedicated             * thread, those Streams may progress concurrently.              */
//  Can't inherit from HttpConstraintElement as API does not allow it 
//  No method means no request line 
//  Deny this request 
//  On Windows '\\' is a separator so in case a Windows style   separator has managed to make it into the path, replace it. 
/*      * AllBody ::= ( '<%--' JSPCommentBody ) | ( '<%@' DirectiveBody ) | ( '<jsp:directive.'     * XMLDirectiveBody ) | ( '<%!' DeclarationBody ) | ( '<jsp:declaration'     * XMLDeclarationBody ) | ( '<%=' ExpressionBody ) | ( '<jsp:expression'     * XMLExpressionBody ) | ( '${' ELExpressionBody ) | ( '<%' ScriptletBody ) | ( '<jsp:scriptlet'     * XMLScriptletBody ) | ( '<jsp:text' XMLTemplateText ) | ( '<jsp:'     * StandardAction ) | ( '<' CustomAction CustomActionBody ) | TemplateText      */
//  Ignore - no option to log 
// create a change value button 
//  escaping 
//  swallowed as of Pool 2 
//  Use a POST with role - should be allowed 
//  ------------------------------------------------- ObjectFactory Methods 
//  Printing content 
//  This is a method call 
//  cached for performance 
//  flags 8 (padded) 
/*  request.getAuthType() will not trust the AJP                     * info if tomcatAuthentication is set.  */
//  Move beyond the '{' 
//  Pool properties 
//  Add version 1 specific information 
//  /**   * Sets the database password used when creating connections.   *   * @param password password used when authenticating to the database   * @since 3.0.0   */   void setPassword(char[] password); 
//  Configuration attributes 
/*  Generated By:JJTree: Do not edit this line. AstLambdaParameters.java Version 4.3  */
//  Return null since terminal transformations are not extensions 
/*                              * two dots in a path: go back one hierarchy.                             * foo/bar/../baz -> foo/baz                              */
//  skip stream, static and collection-based resolvers (map, 
//  Strip the trailing '/' character 
//  OpenSSL can return 0 or -1 to these calls if nothing was written 
//  platforms so use File to convert the path to a platform specific form 
//  Partial content response. 
//  Reset blocking state 
//  Handle context root 
//  Strip away quotation marks if necessary 
//  bytes is the only range unit supported (and I don't see the point 
//  Try and use one of the Servlet 3.0 methods that should be blocked 
//  Some key store types (e.g. hardware) expect the InputStream 
//  Try default classloader location 
//  in Win \r\n would cause handleOutput() to be called   twice, the second time with an empty string,   producing blank lines 
//  Single cookie 
//  ---------------------------------------------------- PrintStream Methods 
//  Skip *L 
//  IllegalArgumentException indicates that the host name is invalid 
//  User was not found in the database or the password was null   Waste a bit of time as not to reveal that the user does not exist. 
//  Invalid key 
/*      * Pushes the given URI onto the stack of URIs to which the given prefix     * is mapped.     *     * @param prefix The prefix whose stack of URIs is to be pushed     * @param uri The URI to be pushed onto the stack      */
//  Check for tasks 
//  Prevent removing our own host 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=58624     *     * This test requires three breakpoints to be set. Two in this file (marked     * A & B with comments) and one (C) at the start of     * WsRemoteEndpointImplServer.doWrite().     *     * With the breakpoints in place, run this test.     * Once breakpoints A & B are reached, progress the thread at breakpoint A     * one line to close the connection.     * Once breakpoint C is reached, allow the thread at breakpoint B to     * continue.     * Then allow the thread at breakpoint C to continue.     *     * In the failure mode, the thread at breakpoint B will not progress past     * the call to sendObject(). If the issue is fixed, the thread at breakpoint     * B will continue past sendObject() and terminate with a TimeoutException.      */
//  Request a page that triggers an error 
//  Put the current name in the global function map 
//  Dispatch to the appropriate parser 
//  Client has sent more data than permitted by Window size 
//  Implies klass is not null 
//  Change stream Id 
//  java.sql.Connection 
//  Public for unit tests 
//  problems. 
//  Java 7 JVM decoder does not report error until all 2 bytes are available 
//  Check values 
//  Create an array to hold the expected values 
//  Allowed roles should be the union of the roles in the constraints   ** is any authenticated user   User has app role 
//  Buffer is in write mode at this point. Record the current position so   the buffer state can be restored at the end of this method. 
//  Did this make the parent childless? 
//  NO-OP for Java 8. There is no module path. 
//  Need to override some of the previous settings 
//  shrink cookie list array 
//  -------------------- Per-Response "notes" -------------------- 
// ------------------------------------------------------------------- list() 
//  Get result for the first entry found 
// no leadership change 
// if "begin" specified, move the token to the "begin" place 
//  NOTE: load errors (including a servlet that throws   UnavailableException from the init() method) are NOT   fatal to application startup   unless failCtxIfServletStartFails="true" is specified 
//  else it won't find all the matching resources 
/*          * According to the spec, 'pageContext' must not be made available as an         * implicit object in tag files. Declare _jspx_page_context, so we can         * share the code generator with JSPs.          */
//  Use a GET with role - should be blocked as denyUncovered is true 
//  Check the InputFilters 
//  Check if host already exists 
//  completed transformation chain to the remote end point. 
// translate.put("C", "20"); 
//  If the destination exists, then it's a conflict 
//  if nested group search is enabled, perform searches for nested groups until no new group is found 
//  Getting epClass here and now best matches the caller's environment 
//  Skip it 
//  Get the last modified time for the WAR 
//  Sendfile in progress. If it fails, the socket will be   closed. If it works, the socket either be added to the   poller (or equivalent) to await more data or processed   if there are any pipe-lined requests remaining. 
//  The WebResources API expects all paths to start with /. This is a   special case for consistency with earlier Tomcat versions. 
//  Use raw socket so the necessary control is available after the HTTP 
//  Commons-logging likes having the context classloader set 
//  Cipher C019 
//  When parsed as EL in JSP the escaping of $ as \$ is optional 
//  10 seconds 
//  web.xml 
// 10kb 
//  Avoid duplicate stop calls 
//  Cipher C017 
//  Match against our command string 
/*      * This test isn't guaranteed to catch any multithreaded issues, but it     * gives a good exercise.      */
//  Ignore - return null 
//  reason phrase - bug 45026 
/*      * Force non-default behaviour for both Authenticators      */
//  Re-try 
//  Check constraints for uncovered HTTP methods   Needs to be after SCIs and listeners as they may programmatically 
//  Explicitly negotiated the default protocol.   Obtain a processor below. 
// here we should trap BUFFER_OVERFLOW and call expand on the buffer  for now, throw an exception, as we initialized the buffers  in the constructor 
//  Ignore - use default set above 
//  Didn't expect an exception 
//  we need to leave escape in the string 
//  make sure the connection isn't already closed 
//  the type matches exactly 
//  Cipher C018 
/*   Implementation note: This is deliberately not implemented using             *  switch. If a switch is used the compiler (at least the Oracle             *  one) will use a synthetic class to implement the switch. The             *  problem is that this class needs to be pre-loaded when using a             *  SecurityManager and the name of that class will depend on any             *  anonymous inner classes and any other synthetic classes. As such             *  the name is not constant and keeping the pre-loading up to date             *  as the name changes is error prone.              */
//  Reply modification 
//  Remove non refreshed members from the membership 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=60970 
//  Need more space than we can afford, need to flush buffer. 
//  Context mapping 
//  There is still data available in the response buffer   Return here so that the response buffer will not be   cleared and there will be no data read from the   socket. Thus when the read operation is resumed first   the data left in the response buffer will be consumed   and then a new socket read will be performed 
//  If app exists deployment can only proceed if update is true 
//  Skip introspection 
//  NOOP by default 
//  LF 
//  Tell children we are their new parent 
//  and earlier 
//  at least 1 of the sessions is invalidated 
//  Access a session (if present) to update last accessed time, based   on a strict interpretation of the specification 
//  Parse content-length header 
//  = "";   = -1;   = -1;   = 0; 
//  User should be found... 
//  __end introspecthelperMethod 
//  Removing resource env refs 
//  +1 is for the padding length byte we just read above 
//  Just invoke next - access logging happens via log() method 
// 5 seconds 
//  $: map lookup as ${mapname:key|default} 
//  (throws ClassNotFoundException if it is not found) 
//  Apps Header Section 
// reset the instance manager 
/*  * Move server.xml or context.xml as backup * * TODO Get Encoding from Registry  */
//  ---------------------------- Inner classes used with start/stop Executor 
//  Note existing WAR will be deleted and then replaced 
//   ----------------------------------------------------- Constructor 
//  create a tomcat server using the default in-memory Realm 
//  Write remaining attributes 
//  Waiting to send the close_notify message 
//  Instantiate and install an Authenticator of the requested class 
//  Set the configuration flag to avoid repeating 
//  Replace '\' with '/' 
//  Set up a POST request that echoes the body back 
//  Has a resource been inserted / removed in a different resource set 
/*          * Hashtable containing introspection information on tag handlers:         * <key>: tag prefix <value>: hashtable containing introspection on tag         * handlers: <key>: tag short name <value>: introspection info of tag         * handler for <prefix:shortName> tag          */
//  Step 7a 
//  next element 
//  Range entries 
//  Try also the superclass because of primitive types 
//  Require a new random number generator if we are restarted 
//  in case more requests will be issued 
//  Cipher C014 
//  Find the first stack frame that represents code generated by 
/*      * Some of these should probably be handled more cleanly by the parser, but a few known     * exception scenarios are presented here just to document current behavior.  In many cases     * failure in parsing will just be propagated to a definition that will fail later     * when instantiated.  Should we be failing faster (and with more detail)?      */
//  Don't use a Java 7 multiple exception catch so we can keep   the JNI code identical between Tomcat 6/7/8/9 
//  These need to be called after loading configuration, in case   useContextClassLoader appears after them in xml config 
//  Not possible or not necessary to switch class loaders. Return   null to indicate this. 
//  if our delegate is null, create one 
/*          * Handle the "IP only" case first          */
/*          * assert !(pool instanceof GenericObjectPool) :         * "GenericObjectPool is already thread-safe"; assert !(pool instanceof         * SoftReferenceObjectPool) :         * "SoftReferenceObjectPool is already thread-safe"; assert !(pool         * instanceof StackObjectPool) :         * "StackObjectPool is already thread-safe"; assert         * !"org.apache.commons.pool.composite.CompositeObjectPool"         * .equals(pool.getClass().getName()) :         * "CompositeObjectPools are already thread-safe";          */
//  first time in this transaction 
//  If using a shared selector, the NioSelectorPool will also try and   close the selector. Try and avoid the ClosedSelectorException   although because multiple threads are involved there is always 
//  No applicable security constraint was found 
//  wrong 
//  Have to read into a buffer because clients typically do not start   to read the response until the request is fully written. 
//  An ISE can occur if an attempt is made to write to a   WebSocket connection after it has been closed. The   alternative to catching this exception is to synchronise   the writes to the clients along with the addSnake() and   removeSnake() methods that are already synchronised. 
//  ---------------------------------------------------------- Public Methods 
// send a heartbeat through the channel 
/*      * ScriptletBody ::= (Char* - (char* '%>')) '%>'      */
// mysql  url = System.getProperty("url","jdbc:mysql://localhost:3306/mysql?autoReconnect=true");  driverClassName = System.getProperty("driverClassName","com.mysql.jdbc.Driver"); 
/*  Last second contained in cache  */
//  Non-anonymous class so that AsyncIOThreadFactory can load it 
//  Cipher C013 
//  Read some frames 
//  onDataAvailable() 
//  detect other types of Throwable and cancel this Timer 
//  Do not save exception in 'throwable', because we   do not want to do exception(request, response, e) processing 
//  Only need to process uncovered patterns 
//  Empty payload 
//  Build and return the list of session identifiers 
//  Read from main buffer first 
//  If the requested names ends in '/', the Java File API will return a   matching file if one exists. This isn't what we want as it is not 
//  issue as it is only used during stored password generation. 
//  Obtain the input stream we need 
//  Use these sets to track the different classes of streams 
//  Wait for polltime before doing anything, so that the poller threads   exit, otherwise parallel closure of sockets which are still   in the poller can cause problems 
/*      * The servlet / tag file needs a compilation check on first access. Use a     * separate flag (rather then theServlet == null / tagHandlerClass == null     * as it avoids the potentially expensive isOutDated() calls in     * ctxt.compile() if there are multiple concurrent requests for the servlet     * / tag before the class has been loaded.      */
//  Call the logout method 
//  might as well always convert 
//  Control the input order 
//  Cannot happen 
//  data that was just read 
//  Skip classes already known 
//  BASIC or FORM 
//  Account for classes of ciphers removed from DEFAULT in 1.1.0 
//  @GuardedBy("this") to ensure transitions are valid 
//  defaults vary between JSSE and OpenSSL. 
//  Check in the restricted list, and adjust the http11   and keepAlive flags accordingly 
//  Overly large ping 
//  Save the username and password as well 
//  Check connection header 
//  Odd number of characters 
/*      * For Include: StdActionContent ::= Attributes ParamBody     *     * ParamBody ::= EmptyBody | ( '>' S? ( '<jsp:attribute' NamedAttributes )? '<jsp:body'     * (JspBodyParam | <TRANSLATION_ERROR> ) S? ETag ) | ( '>' S? Param* ETag )     *     * EmptyBody ::= '/>' | ( '>' ETag ) | ( '>' S? '<jsp:attribute'     * NamedAttributes ETag )     *     * JspBodyParam ::= S? '>' Param* '</jsp:body>'      */
//  f.addBeforeOrdering("b"); 
//  Cipher C016 
//  pool stats 
//  Match full language_country_variant first, then language_country,   then language only 
//  Read the method 
//  Steps 4 & 5. 
//  ------------------------------------------------------------- Operations 
//  Call the servlet once 
//  Now set the value to null 
// make sure it hasn't been removed 
//  Discard the new message and close the session immediately. 
//  It's tempting to remove the ".tag" suffix here, but we can't.   If we remove it, the fully-qualified class name of this tag   could conflict with the package name of other tags.   For instance, the tag file   /WEB-INF/tags/foo.tag   would have fully-qualified class name   org.apache.jsp.tag.web.foo   which would conflict with the package name of the tag file   /WEB-INF/tags/foo/bar.tag 
//  Verify that "catalina.home" was passed. 
//  Exception does not exist prior to Java 9 
// gets set by handshake 
//  Pattern and string do not have the same size 
//  Similar strategy to NOT_EQ above, except this   is NOT greater than 
//  Special encoding for space 
//                             "displayName=jmx.attribute.change" }); 
//  This one DOES get an extra/empty definition 
//        per-Host and global defaults so they may appear there 
//  In handshake or close_notify stages, check if call to wrap was made 
//  Read reset frame 
//  Socket will be closed before the error handler runs. Closing the   socket triggers the client code's return from the doRequest() method   above so we need to wait at this point for the error handler to be 
// acquire the global lock until we know what to do 
//  !dest.hasRemaining() 
//  Declare NESTED scripting variables 
//  Cipher C015 
//  was pollerSize (before the two were merged) 
//  Check against the overall limit 
//  Copy virtual page scope of tag file to page scope of invoking   page 
// translate.put("s","seconds since epoch"); 
/*  Generated By:JJTree: Do not edit this line. AstTrue.java  */
//  throw the first to indicate there was an error during processing 
//  Can't load the type - will trigger a failure later so don't   fail here 
//  If sos is not ready to write data, the call to isReady() will   register the socket with the poller which will trigger a call to   onWritePossible() when the socket is ready to have data written   to it. 
//  Log any exception, since it can't be passed along 
//  No need to check other constraints for the current pattern 
//  Default max header count is 200 (need to keep under maxHeaderCount as well) 
//  Data to read in the buffer so not finished 
/*      * Parse a string in single or double quotes, allowing for escape sequences     * '\\', '\"' and "\'"      */
//  flushes with no content-length set 
//  Check filter and servlet aren't called 
/*  The format type  */
/*  The DH ciphers  */
//  Cipher C010 
// do finally 
//  Double check the connection is still open 
//  Remove the headers 
//  ----------------------------------------------------------- Private Classes 
//  TODO: icon (multiple) is ignored 
/*  When a request uses a sequence of multiple start(); dispatch() with     * non-container threads it is possible for a previous dispatch() to     * interfere with a following start(). This lock prevents that from     * happening. It is a dedicated object as user code may lock on the     * AsyncContext so if container code also locks on that object deadlocks may     * occur.      */
//  if the path points to a jar file, the TLD is presumed to be   inside at META-INF/taglib.tld 
// send out a map membership message, only wait for the first reply 
// ==============================JMX STUFF======================== 
//  Flag set to delay incrementing tagDependentNesting until jsp:body 
// no message to send, we can consider that complete 
//  bail out now. 
//  now, access the protected resource with good credentials 
//  Subtype (required) 
// initialize the map by receiving a fake message 
//  Host header 
//  Another thread added the entry to the cache   Make sure it is validated 
/*      * Considers the value to be secure if it exclusively holds forwards for     * {@link #protocolHeaderHttpsValue}.      */
//  Setting additional variables 
//  well, they did ask for it 
/*                  * Encapsulate body of custom tag invocation in JspFragment and                 * pass it to tag handler's setJspBody(), unless tag body is                 * empty                  */
//  Open up the flow control windows for stream 19 & 21 to more than the 
//  fall through 
//  Store nested <Engine> element 
//  Random lower case characters 
//  Comment 
//  No command == list 
//  Set up a server socket to wait on 
//  will need to be restored 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=57324 
//  and error, and update the statistics counter 
//  Setup page info area 
//  SETUP 
// outputLineIncrement, if possible 
//  Wait long enough for the buffers to fill and the send to timeout 
//  No good reason for this to happen. 
//  Translate the HTTP method code to a String. 
//  Flag to track if a message is completely empty 
//  hasn't been rewritten 
// package looks like  start package TRIBES_MBR_BEGIN.length  package length - 4 bytes  alive - 8 bytes  port - 4 bytes  secure port - 4 bytes  udp port - 4 bytes  host length - 1 byte  host - hl bytes  clen - 4 bytes  command - clen bytes  dlen - 4 bytes  domain - dlen bytes  uniqueId - 16 bytes  payload length - 4 bytes  payload plen bytes 
//  remember that we are using a shared connection so it can be cleared after the 
//  D'oh - end of string - pretend we never did this   and do processing the "old way" 
//  Cipher C012 
// the loop 
//  Should never happen. On that basis don't log it. 
// only read if we were registered for a read 
//  Before doing a blocking flush, make sure that any pending non   blocking write has completed. 
//  HTTP/0.9 style request 
//  t==null means the attribute was not set. 
/*          * Gets the scripting variables for the given scope that need to be         * declared.          */
//  May happen in unit testing and/or some embedding scenarios 
//  that the container services are loaded first 
//  Recheck the resource to see if it was really deleted 
//  Acquire the list of properties for this bean 
//  Flags. end of headers (0x04) and end of stream (0x01) 
//  finally, do it again with the cookie to be sure 
//  Ignore so the re-try below can proceed 
//  Not a match. Stop here 
//  String 
//  Client 
// ignore the message, it doesnt have the flag set 
//  Create OpenSSLConfCmd context if used 
//  Create and configure a MemoryUserDatabase instance based on the 
//  Prevent registering additional endpoints once the first attempt has 
//  Cipher C011 
//  already be held on the host by another thread 
//  Second request should succeed (if we use the server nonce) 
// only if we notify the pool itself 
//  Collection methods 
//  Source paths must be relative, not absolute, so we   remove the leading "/", if one exists. 
//  Some JMX statistics. This valve is associated with a StandardWrapper.   We expose the StandardWrapper as JMX ( j2eeType=Servlet ). The fields 
//  Classes 
//  Expected 
//  Realm doesn't recognise user. Create a user with no roles   from the authenticated user name 
// we're shutting down, send a shutdown message and close the socket 
//  Trigger the destroy method for any associated decoders 
//  Security check to catch attempts to encode /../ sequences 
//  Check each remaining character used is permitted 
//  Make absolutely sure this gets reset 
//  Parse 'CustomAction' production (tag prefix and custom action name) 
//  Webapp list 
/*                  * Set attribute for bean in the specified scope                  */
// get a list of all the session from this manager 
//  Put leftovers in the leftovers byte buffer 
//  next time findNext is called it will try the 
//  Validate the proposed context initialization parameter 
/*      * Creates an AnnotationEntry from a DataInputStream     *     * @param input     * @param constant_pool     * @throws IOException      */
//  -------------------- Data access --------------------   Access to the current name/values, no side effect ( processing ).   You must explicitly call handleQueryParameters and the post methods. 
//  Existence of ${catalina.base}/lib directory is optional.   Hide the warning if Tomcat runs with separate catalina.home   and catalina.base and that directory is absent. 
//  we are not a wrapper of anything 
//  with the PUT method. 
/*          * This method is called as part of the custom tag's end element.         *         * If the given custom tag has a custom nesting level greater than 0,         * restore its scripting variables to their original values that were         * saved in the tag's start element.          */
//  context 
//  Extract the name from the webAppPath 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=61682 
//  Simple case: no methods 
//  Must be followed by '=' 
//  Unprotected resource 
//  Recycle request if necessary (also BZ 30949) 
//  If trailer fields are set, always use chunking 
//  If the timestamp of the entity the client got differs from   the last modification date of the entity, the entire entity   is returned. 
//  Headers 
// printSendStats(LoadTest.messagesSent, LoadTest.messageSize, LoadTest.messageSendTime); 
//  Step 8. Convert explicitly mentioned jsps to servlets 
//  Sneak the regular node in. The NOT will   be resolved when the next opp comes along. 
//  Clear all application-originated servlet context attributes 
//  No need to lookup if the key is not in the map 
//  if MP JWT-Auth is available 
// literal never indexed 
//  Add this class to the cache 
//  If crossContext is enabled, can always return the context 
//  userinfo    = *( unreserved / pct-encoded / sub-delims / ":" ) 
// if the param tag has no parents, throw a exception 
/*                  * Since more bytes may have arrived since the buffer was last                 * filled, it is an option at this point to perform a                 * non-blocking read. However correctly handling the case if                 * that read returns end of stream adds complexity. Therefore,                 * at the moment, the preference is for simplicity.                  */
//  First pattern found will indicate if there is a   conflict since for any given pattern all matching   constraints will be from either the descriptor or   not. It is not permitted to have a mixture 
//  good determination of the encoding 
//  return current connection to the pool 
/*  The name to which the object is being bound or unbound  */
//  Compressed content length is unknown so mark it as such. 
/*  TCN_MINOR_VERSION  */
// we have run out of data  reset 
//  started 
//  Update the session last access time for our session (if any) 
//  Connection closed. OK to recycle the processor.   Processors handling upgrades require additional clean-up   before release. 
//  SSI requires a privileged Context 
//  Processing one char at the time 
//  Initialize the properties of the new session and return it 
// else add a "&" ahead of it 
//  Quick and dirty. Sufficient for this test but ignores lots of   edge cases. 
// source 
//  Just within default maxHeaderCount   Note request has 4 standard headers 
/*  NO-OP         * With AJP, Tomcat controls when the client sends request body data. At         * most there will be a single packet to read and that will be handled         * in finishResponse().          */
/*      * Log objects are not Serializable.      */
//  container thread finishes, do not process any error page here. 
/*  Returns the node on the top of the stack, and remove it from the     stack.   */
//  Get the entry's distinguished name.  For relative results, this means   we need to composite a name with the base name, the context name, and   the result name.  For non-relative names, use the returned name. 
//  Query protocol handlers 
//  Fragments use same value - no conflict 
//  VERIFY EXCLUDED RESPONSE STATUS CODES 
//    Check for blank line   
//  ----------------------------------------------------- NameParser Methods 
//  Initialize mapper listener 
//  Enable compression. Headers will have been set. Need to configure   output filter at this point. 
/*      * The trailing third "=" is illegal. However, the RFC says the decoder     * must terminate as soon as the first pad is detected, so no error     * will be detected unless the payload has been damaged in some way.      */
//  Object was borrowed in another thread   Don't count this as an eviction test so reduce i; 
//  Mark context as paused 
//  Need to ensure that:   - the one, correct entry is returned where multiple versions     are available   - that the order of entries in the JAR doesn't prevent the     correct entries being returned   - the case where an entry appears in the versions location     but not in the the base location is handled correctly 
//  Auth success clears the lock record so... 
//  Limit string constants here to 16k characters 
//  "RuntimeVisibleAnnotations" attribute defined in the class 
//  still 
//  Nothing - jasper generated servlets call the other constructor,   this should be used in future + init . 
/*      * Gets SAXParser.     *     * @param validating Indicates whether the requested SAXParser should     * be validating     * @param jspDocParser The JSP document parser     *     * @return The SAXParser      */
//  Should not be used in a close frame   return CloseCodes.TLS_HANDSHAKE_FAILURE; 
//  use container maxInactiveInterval so that session will expire correctly   in case of primary transfer 
//  Bug47080 - in rare cases this may be null or "" 
/*  Generated By:JJTree: Do not edit this line. AstCompositeExpression.java  */
/*      * Returns the URI to which the given prefix maps.     *     * @param prefix The prefix whose URI is sought     *     * @return The URI to which the given prefix maps      */
//  Limit the size of the trailing header 
//  Create an ordered set of all cached resources with the least recently   used first. This is a background process so we can afford to take the   time to order the elements first 
//  If the context was not started (for example an error   in web.xml) we'll still get to try to start 
//  Get paths for WAR and expanded WAR in appBase 
//  Find error 
/*      * Points to the next available object in the stack      */
/*  Process DeclareRoles annotation.         * Ref JSR 250, equivalent to the security-role element in         * the deployment descriptor          */
//  - needs extra output flushes due to buffering 
/*      * Force rapid timeout scanning for both webapps     * The StandardManager default service cycle time is 10 seconds,     * with a session expiry scan every 6 cycles.      */
//  If still processing async, don't try to store the session 
// get the url 
//  Render the result as a String of hexadecimal digits   Start with enough space for sessionIdLength and medium route size 
//  Not final as it may need to be re-sized 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=57326 
//  So the next request should process normally 
//  First line has the response code and should always be 200 
//  PREPARE 
// broadcast our map, this just notifies other members of our existence 
//  Interact with the user to retrieve the username and password 
//  Get local copy of current config so it is consistent for entire   method execution 
//  objectDeque == null is OK here. It is handled correctly by both   methods called below. 
//  Reload application 
/*      * JspServletWrapper for JSP pages.      */
// unknown state, should never happen 
//  Could do this in one go. Lots of casts so split out for clarity 
//  If the pattern did not conflict, add the new constraint(s). 
//  Add the JSTL (we need the TLD) 
//  locking the children object can cause problems elsewhere 
//  Remove the inactive session from SingleSignOnEntry 
//  step over the non white space characters. 
/*  ------- With validation query -----  */
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=58836      */
/*  A conditional node is constructed if its condition is true.  All     the nodes that have been pushed since the node was opened are     made children of the conditional node, which is then pushed     on to the stack.  If the condition is false the node is not     constructed and they are left on the stack.  */
//  Add one JspPropertyGroup for each URL Pattern.  This makes   the matching logic easier. 
//  Flush before startAsync means body is written in two packets so an 
//  Make sure this parameter is currently present 
//  See comments in When.java for the reason "}" is generated here. 
//  should no result in chunking on HTTP 1.1 
// connection previously connect with alternate 
//  RC2_128_CBC_WITH_MD5 
// we didn't recognize the message type, do nothing 
//  Ignore leading '/' and trailing CLASS_FILE_SUFFIX   Should be cheaper than replacing '.' by '/' in class name. 
//  Populate the creation stack trace 
//  set reference time 
//  Rule 7 -- Default servlet 
//  Decoding required 
//  Simple test 
//  Second example - use fragment a for no-id fragment 
//  5 items because parser automatically inserts TrapException interceptor to front of list 
//  Declare and synchronize AT_END scripting variables (must do this 
//  Create and add the gzip filters. 
//  Make sure the inner Parameter class behaves correctly 
//  following loop 
//  ServletContext.getRealPath() does not allow this to be thrown 
//  Async processing has probably been completed in another thread.   Trigger a timeout to make sure the Processor is cleaned up. 
//  Expected maximum typical number of cookies per request. 
// RemoteProcessException's are ok 
//  add any listeners defined in TLDs 
//  Cipher C00F 
//  The EL expression 
// add to the bottom of the wait list 
//  Has this stream been granted an allocation   Note: If the stream in not in this Map then the 
//  Is this the start of a "\$" or "\#" escape sequence? 
//  Validate the incoming property value 
//  Calculate the document base directory 
//  EmptyBody 
//  Assumes at least one custom header and that all headers are the same 
/*      * NOTE: This servlet is only intended to be used in single-threaded tests.      */
//  how many bytes there are in the record. 
//  Scan WEB-INF/classes 
// construct a diff message 
/*      * (non-Javadoc)     *     * @see java.io.Externalizable#readExternal(java.io.ObjectInput)      */
//  All the formats that use a timezone use GMT 
//  Load the contents of our configuration file 
//  The pool is currently at capacity or in the process of   making enough new objects to take it to capacity. 
//  TODO Make the socketWriteBuffer size configurable and align the        SSL and app buffer size settings with NIO & NIO2. 
//  Always instantiate parent loggers so that 
//  nothing to do if it fails since we are done with it 
// to sync against the semaphore 
//  The path is empty, redirect to "/" 
//  Header frames 
//  Various things that the client can get wrong that don't have 
//  This client only understands HTTP 1.   RFC2616 is case specific 
//  Perform the configured search and process the results 
//  Validate that we can add this Valve 
//  Calculate new payload length if necessary 
//  Set the appropriate servlet context attribute 
//  Unknown connection status 
//  Write failed 
//  Create context attributes that will be required 
// if threads are waiting grab the latch for that thread 
/*      * Type definitions mostly from mod_ssl      */
//  Protected for unit testing 
//  Removing empty parts 
//  Note: Unused for async IO 
//  Not perfectly thread-safe but good enough. Just needs to ensure that   once this.error is non-null, it can never be null. 
//  is sent before the next stream is created for a PUSH_PROMISE. 
//  Avoid division by zero 
// hint if we want disable loop back(local machine) messages 
//  Used more than once so keep a local copy so the value is consistent 
//  message-destination names must be unique within a   web(-fragment).xml 
//  Expect 2 messages: headers, end 
//  Return without writing anything. This will generate the   expected 200 response. 
//   this is a requirement for other tests to run properly 
//  ack that key has not been stored 
//  Now iterate created map and kill the first 15% plus one to account 
//  Ensure context is not null 
//  Return to 1 and confirm skipped value is null 
//  char[] 
//  Generate Strings as char arrays, for performance 
//  There is configuration issue with JAAS so mark the realm as   unavailable 
//  Log a warning we had a password issue 
//  Note: Although there will only ever be a maximum of one entry in this 
//  Super class 
//  Build the simple request 
//  finally, create the XAConnectionFactory using the XA data source 
/*      * XMLDeclarationBody ::= ( S? '/>' ) | ( S? '>' (Char* - (char* '<'))     * CDSect?)* ETag | <TRANSLATION_ERROR> CDSect ::= CDStart CData CDEnd     * CDStart ::= '<![CDATA[' CData ::= (Char* - (Char* ']]>' Char*)) CDEnd     * ::= ']]>'      */
//  Evaluate the expression 
//  Cipher C0AD 
// if var specified, the attribute it defines 
// get the value 
//  In this case, pathInfo should be same as servletPath 
//  Not a JSSE name. Maybe an OpenSSL name or alias 
//  Only used by test code so safe to keep this just a little larger than   we are expecting. 
//  set current JspContext on ELContext 
//  welcome-file-list 
//  Create the directory if necessary 
//  Convert all '/' characters to '.' in resourcePath 
//  Clear all existing deployments 
//  Nothing special about this date apart from it being the date I ran the   test that demonstrated that most HTTP/2 tests were failing because the   response now included a date header 
//  Store nested <Listener> elements 
//  Cipher C00C 
//  page can't be null 
//  Type is zero   No flags 
/*      * Test case for     * <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=38113">bug     * 38118</a>.      */
//  If the request method is GET, POST or HEAD and the query string   does not contain an unencoded "=" this is an indexed query.   The parsed query string becomes the command line parameters 
// always validate 
//  Cipher C0AC 
//  Implement JspSourceImports 
//  Null values are not persisted 
/*              * Constructor             *             * @param v Vector of tag handler pool names to populate              */
//  reset 
//  Ignore invalid value 
//  allOptionNames must be in order of the bits of the available options 
//  Get the parent context to determine if this is the first <c:when> 
/*                  * Several components end up calling                 * sun.misc.GC.requestLatency(long) which creates a daemon                 * thread without setting the TCCL.                 *                 * Those libraries / components known to trigger memory leaks                 * due to eventual calls to requestLatency(long) are:                 * - javax.management.remote.rmi.RMIConnectorServer.start()                 *                 * Note: Long.MAX_VALUE is a special case that causes the thread                 *       to terminate                 *                 * Fixed in Java 9 onwards (from early access build 130)                  */
//  Cipher C00B 
/*      * Verify serving of gzipped resources from context root.      */
//  Stop this realm, then the sub-realms (reverse order to start) 
//  entered as per bug 56339 
/*      * Determines page source encoding for page or tag file in JSP syntax,     * by reading (in this order) the value of the 'pageEncoding' page     * directive attribute, or the charset value of the 'contentType' page     * directive attribute.     *     * @return The page encoding, or null if not found      */
/*  Configure the connection for non-blocking  */
//  - skip (n rules) 
//  Evaluate any properties or methods before our target 
//  Allocate array of the right size 
/*          * scratchdir          */
//  This setting will break ssl configuration unless the custom   implementation is used. 
//  Enable schema validation 
//  (4) Resource was not found 
// create local data 
// reset our timeout timer  we successfully wrote, try again without a selector 
//  There should not be an end chunk 
//  Initialize fields annotations for resource injection if   JNDI is enabled 
//  shortcut out of here if we're at the end of the string 
//  Cipher C0AF 
//  Reproducing a failure observed on Gump with OpenSSL 1.1.x 
/*      * Invokes parserController to parse the included page      */
/*                  * Fixed in Java 9 onwards (from early access build 130)                  */
//  % decoded (if required) using UTF-8 
//  Populating the environment hashtable 
//  Foo 
/*      * Processes the given list of included files.     *     * This is used to implement the include-prelude and include-coda     * subelements of the jsp-config element in web.xml      */
/*          * Appends the tag directive with the given attributes to the XML         * view.         *         * If the given tag directive contains just a 'pageEncoding'         * attributes, we ignore it, as we've already appended         * a tag directive containing just this attributes.          */
//  Cipher C00E 
//  Delete the persistent storage file 
//  mode is flag for HTML or XML output 
/*  Default used if protocols are not configured, also used if         * protocols="All"          */
//  Check content type 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=57099      */
//  Search the package imports - note there may be multiple matches 
//  Log problem but give evictor thread a chance to continue   in case error is recoverable 
// add the msg nr 
//  Check servlet name mapping works 
//  Stream 
//  Cipher C0AE 
//  Add filters that match on servlet name second 
// Add the file information 
//  Get a reference to the SingleSignOn 
//  newCacheEntry was inserted into the cache - validate it 
//  Do we want a description if available? 
//  Problem events 
// for kicks 
//  --------------------------------------------------------- Support methods 
// addr.length 
//  Added from OpenJDK 13 ea15 
//  Make sure we read the entire POSTed body. 
//  Double \ is not an escape char anymore 
//  Per registry fields 
//  Cipher C00D 
//  Don't care about the body in this test 
// no need to keep in memory 
//  Pre-populate the cache 
//  No entity body 
//  string "true" as value. 
//  Evaluate and throw away 
//  Have to save the param object to the param stack frame here.   Can't wait until end(). Otherwise, the object will be lost.   We can't save the object as instance variables, as   the instance variables will be overwritten   if this CallParamRule is reused in subsequent nesting. 
//  Multiple files associated with this field name 
//  Domain and path have to match the original cookie to 'replace' 
//  --------------------------------------------------------- Reader Methods 
//  If on a container thread then the socket will be added to the   poller poller when the thread exits the   AbstractConnectionHandler.process() method so don't do a dispatch   here which would add it to the poller a second time. 
//  Not used 
//  first look for existing descriptor 
//  Notify interested application event listeners 
//  https://bz.apache.org/bugzilla/show_bug.cgi?id=57802 
//  ------------------------------------------------------- Reloader Methods 
//  Look to see if this class implements the generic interface 
//  Error will be logged further up the call stack 
//  Upgrade header 
//  Check fourth byte if present and expected 
//  Impossible. UTF-8 is a required character set 
/*      * Try to access a protected resource in a webapp that     * has a BASIC login method defined. The access will be     * challenged with 401 SC_UNAUTHORIZED, and then be permitted     * once authenticated.      */
//  Not supported 
// START_DATA.length+4+size+END_DATA.length 
//  &=foo& 
//  Bullet-proof to avoid anything else but problems from InstanceKeyDataSource#close(). 
//  if there is an active transaction context and it already has a shared connection, use it 
//  As long as MB isn't a char sequence or affiliated, this has to be   converted to a string 
// Literal Header Field with Incremental Indexing 
/*      * isELIgnored      */
//  the original request to be restored) 
/*  * <p>Implementation of <strong>Realm</strong> that works with a directory * server accessed via the Java Naming and Directory Interface (JNDI) APIs. * The following constraints are imposed on the data structure in the * underlying directory server:</p> * <ul> * * <li>Each user that can be authenticated is represented by an individual *     element in the top level <code>DirContext</code> that is accessed *     via the <code>connectionURL</code> property.</li> * * <li>If a socket connection cannot be made to the <code>connectURL</code> *     an attempt will be made to use the <code>alternateURL</code> if it *     exists.</li> * * <li>Each user element has a distinguished name that can be formed by *     substituting the presented username into a pattern configured by the *     <code>userPattern</code> property.</li> * * <li>Alternatively, if the <code>userPattern</code> property is not *     specified, a unique element can be located by searching the directory *     context. In this case: *     <ul> *     <li>The <code>userSearch</code> pattern specifies the search filter *         after substitution of the username.</li> *     <li>The <code>userBase</code> property can be set to the element that *         is the base of the subtree containing users.  If not specified, *         the search base is the top-level context.</li> *     <li>The <code>userSubtree</code> property can be set to *         <code>true</code> if you wish to search the entire subtree of the *         directory context.  The default value of <code>false</code> *         requests a search of only the current level.</li> *    </ul> * </li> * * <li>The user may be authenticated by binding to the directory with the *      username and password presented. This method is used when the *      <code>userPassword</code> property is not specified.</li> * * <li>The user may be authenticated by retrieving the value of an attribute *     from the directory and comparing it explicitly with the value presented *     by the user. This method is used when the <code>userPassword</code> *     property is specified, in which case: *     <ul> *     <li>The element for this user must contain an attribute named by the *         <code>userPassword</code> property. *     <li>The value of the user password attribute is either a cleartext *         String, or the result of passing a cleartext String through the *         <code>RealmBase.digest()</code> method (using the standard digest *         support included in <code>RealmBase</code>). *     <li>The user is considered to be authenticated if the presented *         credentials (after being passed through *         <code>RealmBase.digest()</code>) are equal to the retrieved value *         for the user password attribute.</li> *     </ul></li> * * <li>Each group of users that has been assigned a particular role may be *     represented by an individual element in the top level *     <code>DirContext</code> that is accessed via the *     <code>connectionURL</code> property.  This element has the following *     characteristics: *     <ul> *     <li>The set of all possible groups of interest can be selected by a *         search pattern configured by the <code>roleSearch</code> *         property.</li> *     <li>The <code>roleSearch</code> pattern optionally includes pattern *         replacements "{0}" for the distinguished name, and/or "{1}" for *         the username, and/or "{2}" the value of an attribute from the *         user's directory entry (the attribute is specified by the *         <code>userRoleAttribute</code> property), of the authenticated user *         for which roles will be retrieved.</li> *     <li>The <code>roleBase</code> property can be set to the element that *         is the base of the search for matching roles.  If not specified, *         the entire context will be searched.</li> *     <li>The <code>roleSubtree</code> property can be set to *         <code>true</code> if you wish to search the entire subtree of the *         directory context.  The default value of <code>false</code> *         requests a search of only the current level.</li> *     <li>The element includes an attribute (whose name is configured by *         the <code>roleName</code> property) containing the name of the *         role represented by this element.</li> *     </ul></li> * * <li>In addition, roles may be represented by the values of an attribute * in the user's element whose name is configured by the * <code>userRoleName</code> property.</li> * * <li>A default role can be assigned to each user that was successfully * authenticated by setting the <code>commonRole</code> property to the * name of this role. The role doesn't have to exist in the directory.</li> * * <li>If the directory server contains nested roles, you can search for them * by setting <code>roleNested</code> to <code>true</code>. * The default value is <code>false</code>, so role searches will not find * nested roles.</li> * * <li>Note that the standard <code>&lt;security-role-ref&gt;</code> element in *     the web application deployment descriptor allows applications to refer *     to roles programmatically by names other than those used in the *     directory server itself.</li> * </ul> * * <p><strong>TODO</strong> - Support connection pooling (including message * format objects) so that <code>authenticate()</code> does not have to be * synchronized.</p> * * <p><strong>WARNING</strong> - There is a reported bug against the Netscape * provider code (com.netscape.jndi.ldap.LdapContextFactory) with respect to * successfully authenticated a non-existing user. The * report is here: https://bz.apache.org/bugzilla/show_bug.cgi?id=11210 . * With luck, Netscape has updated their provider code and this is not an * issue. </p> * * @author John Holman * @author Craig R. McClanahan  */
//  create registry 
//  Sends local member shutdown. 
//  HTTP request with an upgrade header for WebSocket present 
//  Any buffered data left over from a previous non-blocking write is   written in the Processor so if this point is reached the app is able   to write data. 
//  This may happen if test fails. Output the exception in case it is   useful and let asserts handle the failure 
//  Might not be any further frames after the reset 
//  Create a servlet that always throws an exception for a PUT request 
// NO-OP 
//  We put the resources into the servlet context 
/*  JavaCC - OriginalChecksum=70ac39f1e0e1eed7476e1dae2dfa25fa (do not edit this line)  */
/*  JavaCC - OriginalChecksum=071159eff10c8e15ec612c765ae4480a (do not edit this line)  */
//  Smarter than the typical client. Attempts to read the response   even if the request is not fully written. 
//  Socket write buffer has some data. 
//  window. The stream 3 window should still be negative 
//  Cipher C0AB 
//  ---------------------------------------------------- Context Inner Class 
//  Used for notifications 
//  Test with port in pattern but forgotten "addConnectorPort" 
/*  * In a server it is very important to be able to operate on * the original byte[] without converting everything to chars. * Some protocols are ASCII only, and some allow different * non-UNICODE encodings. The encoding is not known beforehand, * and can even change during the execution of the protocol. * ( for example a multipart message may have parts with different *  encoding ) * * For HTTP it is not very clear how the encoding of RequestURI * and mime values can be determined, but it is a great advantage * to be able to parse the request without converting to string.  */
//  Outer multipart terminated -> No more data 
//  introspection 
//  use our mock driver 
//  The server should identify the acceptable method(s) 
//  $: back reference to rule or map lookup 
//  default configuration - it sucks. Let's override at least the   formatter for the console 
//  Configure a web app with a read/write default servlet 
//  Clearing references should be done before setting started to   false, due to possible side effects 
//  Unable to create sufficient space for this resource   Remove it from the cache 
//  Start child   Don't do this inside sync block - start can be a slow process and 
//  Proxy CONNECT is clear text 
// first connection should be closed 
//  Cipher C00A 
//  Add the other permitted characters 
//  File#getCanonicalPath(). 
//  No more branches can be taken for this if block 
//  Use trailing null as sentinel 
//  NOOP for HTTP 
//  Invalid - Assume no charset and just pass through whatever   the user provided. 
//  Increment the nesting count for the current expression 
/*      * We have "diamond" multiple interface/abstract class inheritance     * here, and that introduces ambiguities. Often we want the     * BlockingDeque javadoc combined with the AbstractQueue     * implementation, so a lot of method specs are duplicated here.      */
//  SNIExtractor only to discover there is no data to process 
//  Return the number of extra bytes which were consumed 
//  Remove a possible default UNDEFINED certificate 
//  Section 5.5 
//  This will trigger the timer & thread creation 
//  to be GC'd and save memory. 
//  Generation of web.xml fragments 
//  Ignore. 
//  Cipher C0AA 
//  Maximum amount of streams which can be concurrently executed over 
//  Block content type sniffing 
//  According to JSP spec, for static values (those determined at 
//  Something failed 
/*      * Get the set of current threads as an array.      */
//  defined in web.xml 
//  strip the base slash since it will be combined with the   uriBase to generate a file 
// It's a modifier code 
//  All users should be able to perform a GET 
//  Avoid NPE 
//  Library not on path 
//  Should never happen   The if ... else ... blocks above should cover all states   permitted by the preceding checkState() call 
//  Draw a line. 
//  still have a requirement for it. 
/*      * Verify serving of brotli compressed resources from context root.      */
//  Arbitrary default 
//  If the top is a spacer then don't pop 
//  targetUri is invalid? 
//  Get the class object 
//  Check if this is a user-defined (custom) tag 
/*      * Store with NamingResource Factory     *     * @see org.apache.catalina.storeconfig.IStoreFactory#store(java.io.PrintWriter,     *      int, java.lang.Object)      */
//  Less than or equal 
//  Only one decode table currently; keep for consistency with Base32 code 
//  on whether the parser is namespace aware 
//  stream 3 
//  ignore error, keep destroying the rest 
//  Valid UTF-8 
//  --------------------------------------------------------------- Lifecycle 
//  Successful accept, reset the error delay 
//  Settings ack and stream 3 body are written from different threads. 
// flag for the existence of the "context" 
//  Validate the proposed mapping 
//  Read the extensions until we run out of data or find the data 
//  Need to try and close some streams.   Try to close streams in this order   1. Completed streams used for a request with no children   2. Completed streams used for a request with children   3. Closed final streams     Steps 1 and 2 will always be completed.   Step 3 will be completed to the minimum extent necessary to bring the   total number of streams under the limit. 
//  Check the parameters match 
//  let's keep the original value in this case 
//  Example 13-6   @ServletSecurity(value = @HttpConstraint(rolesAllowed = "R1"), 
//  %: back reference to condition 
//  Next two bytes (unsigned) are the size of the record. We need all of   it. 
//  Do not flag as error 
//  Need this to fire listener on complete 
/*      * Assigns an identifier (of type integer) to every custom tag, in order     * to help identify, for every custom tag, the scripting variables that it     * needs to declare.      */
//  Ignore. This is expected if using the EL stand-alone 
//  Don't overwrite an existing error 
//  no xml escaping was necessary 
//  Finalize our character set mapper 
//  Read boundary - if succeeded, the stream contains an 
//  Wait was aborted with socket.close() 
//  Redo (table is supposed to be updated) 
//  access the protected resource with the encoded url (with session id) 
//  the setter? 
/*      * Gets the tag library corresponding to the given URI.     *     * @return Tag library corresponding to the given URI      */
//  trim() to remove whitespace like new lines 
//  Create multistatus object 
// These built-in variables are supplied by the mediator ( if not   over-written by   the user ) and always exist 
//  complete and/or the container can flush any remaining data 
//  Basic 
/*      * Returns an attributes list which contains all the attributes     * passed in, with any text of form "${xxx}" in an attribute value     * replaced by the appropriate value from the system property.      */
//  Decoding not required 
/*  Generated By:JJTree: Do not edit this line. AstLessThan.java  */
//  Only index if it will fit 
//  Re-throw 
//  Ignore. Not running on Tomcat. TRACE is always allowed. 
//  Do we need to do valueUnbound() and attributeRemoved() notification? 
//  Unlike other connectors, the thread pool is tied to the server socket 
//  Associate with the processor with the connection 
//  First search "known locations" 
//  Set the protocol in the constructor 
//  Node representing the XML element currently being parsed 
//  add specified folders to the list 
//  Additional configuration properties for abandoned object tracking 
//  a.addBeforeOrderingOthers(); 
//  NO-OP for AJP 
//  Content is not applicable here (e.g. is a directory) 
// data.message = new XByteBuffer(new byte[xsize],false); 
//  Setup session (if required) 
// ------------------------------------------------------------------------------                METHODS TO OVERRIDE  ------------------------------------------------------------------------------ 
//  second try with fresh connection 
//  Force TLS 1.2 if TLS 1.3 is available as JSSE's TLS 1.3   implementation doesn't support Post Handshake Authentication   which is required for this test to pass. 
//  Loop until we run out of allocation or recipients 
//  Server 
//  Ensure no errors were reported on the server 
//  Allow the file to be read 
//  The error occurred during non-blocking I/O. Set the correct   state else the error handling will trigger an ISE. 
//  Check request completed 
/*      * With the caching of NotFound responses this test takes ~20ms. Without the     * caching it takes ~6s.      */
//  Ensures headers are generated and then written for one thread at a time.   Because of the compression used, headers need to be written to the   network in the same order they are generated. 
//  If this point is reached, a new compressed message part 
//  Test cases provided by OP 
//  True if this attribute should be omitted from the output if 
//  This method should never be called   Stack trace will show where this was called from 
//  if the bit is set then add the name to the result 
//  sat between 0.1 and 0.3 
//  Windows does not allow file names to end in ' ' unless specific low   level APIs are used to create the files that bypass various checks.   File names that end in ' ' are known to cause problems when using 
//  if there is a is an active transaction context, assure the transaction context hasn't changed 
// header length  data length indicator  actual data length  footer length 
//  Headers should be visible now 
//  Ignore - activation failure is more important 
//  This effectively checks the next two bytes 
// writeMessage 
/*  apr_filetype_e values for the filetype member of the     * apr_file_info_t structure     * <br><b>Warning :</b>: Not all of the filetypes below can be determined.     * For example, a given platform might not correctly report     * a socket descriptor as APR_SOCK if that type isn't     * well-identified on that platform.  In such cases where     * a filetype exists but cannot be described by the recognized     * flags below, the filetype will be APR_UNKFILE.  If the     * filetype member is not determined, the type will be APR_NOFILE.      */
//  If none of the given ETags match, 412 Precondition failed is   sent back 
// Interfaces 
//  Age of zero will trigger removal 
//  Destroy our defined Connectors 
// 4k 
// am I the leader in my view? 
//  If a stream was configured, it needs to be copied to 
/*  The unquoted result.  */
//  OK - turnover the session and inform other cluster nodes 
//  Loading service Interface 
/*      * Custom error/status codes should not result in a blank response.      */
// get the url string before adding this param 
//  Cipher C006 
/*      * Store nested Element Value Arrays WatchedResource     *     * @see org.apache.catalina.config.IStoreFactory#store(java.io.PrintWriter,     *      int, java.lang.Object)      */
//  Extension Name must match 
//  Do nothing on a 1xx, 2xx and 3xx status   Do nothing if anything has been written already   Do nothing if the response hasn't been explicitly marked as in error 
//  createStatement 
//  Cipher C0A8 
// the next position to allocate to 
//  Do we have enough room in destination to write encrypted data? 
// unique context is more efficient if it is stored as bytes 
//  Upgrade protocols have to be configured first since the endpoint   init (triggered via super.init() below) uses this list to configure   the list of ALPN protocols to advertise 
/*      * Ensures that the given body only contains nodes that are instances of     * TemplateText.     *     * This check is performed only for the body of a scripting (that is:     * declaration, scriptlet, or expression) element, after the end tag of a     * scripting element has been reached.      */
//  UTF-16, little-endian 
// update last replicated time 
//  CPONG should have a message length of 1 
//  Check for a 401 
// read from the network 
//  Need to wait for message 
//  Cipher C007 
//  Can't create an array that big 
// the only member, no need for an election 
//  Triggers clean-up 
//  Do nothing - the spec doesn't have any "throws"   and the user might know what he's doing 
//  Cipher C005 
//  NO-OP   Members are defined by the array of members specified in the call to   sendMessage() 
//  PUT with POST-style parsing 
/*          * Output a DOCTYPE declaration if the doctype-root-element appears. If         * doctype-public appears: <!DOCTYPE name PUBLIC "doctypePublic"         * "doctypeSystem"> else <!DOCTYPE name SYSTEM "doctypeSystem" >          */
//  Restore the original limit 
//  If the connection is closed fast enough, writing the request will   fail and the response won't be read. 
//  Trying to retrieve the servlet output stream 
//  Wait for second request to release first and allow it to complete 
//         System.setProperty("com.mchange.v2.log.FallbackMLog.DEFAULT_CUTOFF_LEVEL", "WARNING");          MLog.getLogger().setLevel(MLevel.WARNING);          MLog.getLogger("com").setLevel(MLevel.WARNING);          //http://www.mchange.com/projects/c3p0/index.html#automaticTestTable          ComboPooledDataSource c3p0 = new ComboPooledDataSource();          c3p0.setAcquireIncrement(1);          c3p0.setAcquireRetryAttempts(2);          c3p0.setAcquireRetryDelay(datasource.getPoolProperties().getMaxWait());          c3p0.setCheckoutTimeout(datasource.getPoolProperties().getMaxWait());          c3p0.setDebugUnreturnedConnectionStackTraces(datasource.getPoolProperties().isLogAbandoned());          c3p0.setIdleConnectionTestPeriod(datasource.getPoolProperties().getTimeBetweenEvictionRunsMillis()/1000);          c3p0.setInitialPoolSize(datasource.getPoolProperties().getInitialSize());          c3p0.setMaxIdleTime(datasource.getPoolProperties().getMinEvictableIdleTimeMillis()/1000);          c3p0.setMaxIdleTimeExcessConnections(datasource.getPoolProperties().getMaxIdle());          c3p0.setMaxPoolSize(datasource.getPoolProperties().getMaxActive());          c3p0.setMinPoolSize(datasource.getPoolProperties().getMinIdle());          c3p0.setPassword(datasource.getPoolProperties().getPassword());          c3p0.setPreferredTestQuery(datasource.getPoolProperties().getValidationQuery());          c3p0.setTestConnectionOnCheckin(datasource.getPoolProperties().isTestOnReturn());          c3p0.setTestConnectionOnCheckout(datasource.getPoolProperties().isTestOnBorrow());          c3p0.setUnreturnedConnectionTimeout(datasource.getPoolProperties().getRemoveAbandonedTimeout());          c3p0.setUser(datasource.getPoolProperties().getUsername());          c3p0.setUsesTraditionalReflectiveProxies(true);          c3p0.setJdbcUrl(datasource.getPoolProperties().getUrl());          c3p0.setDriverClass(datasource.getPoolProperties().getDriverClassName());          this.c3p0Datasource = c3p0; 
//  not defined any welcomes files. 
//  Cipher C0A7 
//  If allow linking changes, invalidate the cache. 
//  This case should be handled by the native method,   but we'll make absolutely sure, here. 
/*      * Maps the given URI to the given tag library.     *     * @param uri The URI to map     * @param info The tag library to be associated with the given URI      */
/*      * private fields for JSP 2.0      */
// default step value is 1. 
//  Do nothing if there is a directory server connection already open 
//  IBM JRE. 
/*  TEMP_GOST_TLS */
/*      * Parses a taglib directive with the following syntax: Directive ::= ( S     * Attribute)*      */
//  Check it 
//  Undecoded path - just %nn encoded 
//  Ensure in case of error that any non-container threads that have been 
//  Configure the authenticator 
// invoke next 
//  In the case where the parameter for the method   is taken from the body text, but there is no   body text included in the source XML file,   skip the method call 
//  still small body frames to read. 
//  accessible 
// try to double start the RX 
//  Assume this is triggered by the user closing their browser and   ignore it. 
//  Cipher C009 
//  This always returns false otherwise the superclass will call   #getArchiveEntry(String) 
//  uri (of the form "urn:jsptagdir:path") references tag file dir 
/*              * And then the CIDR.              */
//  -------------------------------------------- SocketProcessor Inner Class 
//  Caller ensures pool is non-null if reuse is true 
//  Getting the type of the object and wrapping it within a new   NamingEntry 
//  Validate the credentials specified by the user 
//  NO-OP by default. 
//  Allow for the 8k still in the stream window 
//  ---------------------------- Processor methods that are NO-OP for upgrade 
//  Replace the entry targeted at an earlier   version 
//  We are registering the key to start with, reset the fairness counter. 
//  Optimization to coalesce attribute name filters 
//  Build includes path 
// flag for the existence of the var attribute 
//  Cipher C0A9 
//  Set as notes 
/*      * The combined count of the currently active objects for all keys and those     * in the process of being created. Under load, it may exceed     * {@link #maxTotal} but there will never be more than {@link #maxTotal}     * created at any one time.      */
//  If non-blocking writes are being used, don't write here as it   will inject unexpected data into the write output. 
//  The spec says to return null if we can't create an instance   of the reference 
//  '$' is permitted in a path 
//  strIdxStart & strIdxEnd 
//  Valid range 
/*  ==================== Common implementation ====================  */
//  step 2 - notify on read 
//  context is not null 
//  Disable deployment on start up 
//  Check all expected parameters are present 
/*  Quote from the JVM specification:             * "All eight byte constants take up two spots in the constant pool.             * If this is the n'th byte in the constant pool, then the next item             * will be numbered n+2"             *             * Thus we have to increment the index counter.              */
//  For performance - only done for debug 
// always add the trap interceptor to the mix 
//  as equal to a REQUEST 
//  Save the authenticated Principal in our session 
//  Cipher C008 
//  No file system docBase required 
//  Extra write event likely after async, ignore 
//  Cipher C002 
//  Type 
//  Determine what type of value this is, quoted value, 
//  Ensure that we have a directory context available 
//  xmlns attributes that represent tag libraries (only in XML syntax) 
//  Always need to look for static resources 
//  Need to check this now since sending end of stream will change this. 
//  scheme 
//  If base is null, method MUST be static   If base is non-null, method may be static or non-static 
//  Generate package declaration 
//  Virtual host mapping 
/*          * The map is keyed on pooled instances, wrapped to ensure that         * they work properly as keys.          */
//  required 
/*      * Additional test following on from SPR-7350 above to check files that     * contain JNDI reserved characters can be served when caching is disabled.      */
//  Special cases: -1 and 0 
//  Check maximum permitted redirects 
//  If we're unpacking WARs, the docBase will be mutated after 
//  Cipher 0x020080 (SSLv2) 
//  configured to do so 
//  Cipher C0A4 
//  Construct the timestamp we will use, if requested 
//  Binding the naming context to the class loader 
//  Must be a classic tag, load it here.   tag files will be loaded later, in TagFileProcessor 
//  @GuardedBy("this")   @GuardedBy("this") 
//  Cipher C001 
//  Initialize defaults. There are no setter methods for them. 
//                             "displayName=jmx.modelmbean.generic" }); 
//  See also https://bz.apache.org/bugzilla/show_bug.cgi?id=63690   The buffering behaviour of some clients means that small data frames   are much more frequent (roughly 1 in 20) than expected. Some clients   issue a Window update for every DATA frame so a similar pattern may   be observed. Use an average over two frames to avoid false positives. 
//  Session is currently being accessed - skip it 
//  HTTP 1.0 status Code 
// let the cluster know that there is a context that is distributable  and that it has its own manager 
//  Monitoring (primarily JMX) attributes 
//  Class variable declarations 
// SMAPping problem, we simply ignore the flawed SMAP entries. 
//  Create the APR server socket 
//  Set the start position and read the length 
//  change constraints 
//  Cipher C0A3 
//  User has not, yet, exceeded lock thresholds 
//  we don't change the expiry scan interval - just the iteration count 
//  dump 2 bits 
/*  JSSEImplementation:   Concrete implementation class for JSSE   @author EKR */
//  Try the resolved systemId 
//  Modifications guarded by this 
//  readBytes() above will set readChunk unless it returns a value < 0 
//  8KB default 
//  SecureRandom is not thread-safe so need to make sure only one thread   uses it at a time. In theory, the pool could grow to the same size   as the number of request processing threads. In reality it will be   a lot smaller. 
//  JarFile#entries() is NOT multi-release aware 
//  foo#bar.jsp 
//  Destroy file descriptor pool, which should close the file 
//  Map 
//  Remove the specified watched resource 
//  Then base 
//  Loading factory 
//  The SocketChannel is also available via the SelectionKey. If   it hasn't been closed in the block above, close it now. 
//  Add TLD 
//  ParameterMap 
/*      * Adds this Node to the body of the given parent.      */
//  read all the headers. 
//  Cipher C004 
/*  JDBC_4_ANT_KEY_BEGIN  */
/*      * Checks that every cipher suite returned by OpenSSL is mapped to at least     * one cipher suite that is recognised by JSSE or is a cipher suite known     * not to be supported by JSSE.      */
// add this map as a message listener 
//  Initialize the Date formatters 
//  Is the payload size valid for the given FrameType 
/*      * Test case for https://bz.apache.org/bugzilla/show_bug.cgi?id=57626      */
//  ALPHA and DIGIT are always treated as safe characters 
//  Validate the Context of the specified application 
//  Extensions   Should normally only be one header but handle the case of multiple 
//  Name 
//  plus the default conf/web.xml one. 
//  "imaginary" <taglib> element 
//  These tests should be unnecessary... 
//  Cipher C0A6 
//  Delimiters for request-time expressions (JSP and XML syntax) 
//  Empty response, manually trigger   onBeforeWriteResponseBody() 
//              lock.unlock();           }       } 
//  Invoke body 
//  Don't transition to STOPPING_PREP as that would briefly mark the   component as available but do ensure the BEFORE_STOP_EVENT is   fired 
//  Limit exceeded 
//  object name 
//  f.addAfterOrderingOthers(); 
//  Use getResource as it won't trigger an expensive   ClassNotFoundException if the resource is not available from   the Java SE class loader. However (see   https://bz.apache.org/bugzilla/show_bug.cgi?id=58125 for   details) when running under a security manager in rare cases   this call may trigger a ClassCircularityError.   See https://bz.apache.org/bugzilla/show_bug.cgi?id=61424 for   details of how this may trigger a StackOverflowError   Given these reported errors, catch Throwable to ensure any   other edge cases are also caught 
//  resume interest in OP_READ, OP_WRITE 
//  -------------------- Methods -------------------- 
//  top-level page 
//  Should always return null 
//  Bound the number of retries - only needed if bad instances return 
//  Groups 
//  Bugzilla 32130 
//  Only need to read these 
/*      * xmlns attributes that do not represent tag libraries (only in XML syntax)      */
//  Search for additional roles 
//  Cipher C003 
/*  MUST be specified in the element  */
//  Note: Retrieving the full status is much slower   use StatusTransformer to output status 
/*      * For Plugin: StdActionContent ::= Attributes PluginBody     *     * PluginBody ::= EmptyBody | ( '>' S? ( '<jsp:attribute' NamedAttributes )? '<jsp:body' (     * JspBodyPluginTags | <TRANSLATION_ERROR> ) S? ETag ) | ( '>' S? PluginTags     * ETag )     *     * EmptyBody ::= '/>' | ( '>' ETag ) | ( '>' S? '<jsp:attribute'     * NamedAttributes ETag )     *      */
//  timeout for the socket... 
//  If we run into the container request we are done 
//  ------------------------------------------------------------------------------ 
//  Hide default constructor for utility class 
//  This test uses small window updates that will trigger the excessive   overhead protection so disable it. 
//  catch 
/*              * The webapp-specific JspServlet inherits all the mappings             * specified in the global web.xml, and may add additional ones.              */
//  Client sent invalid data   Ignore, TODO: maybe close connection 
//  deny-uncovered-http-methods added in Servlet 3.1 
//  ----------------------------------------------- ContainerServlet Methods 
//  Open the application web.xml file, if it exists 
//  Cipher C0A5 
//  (1) Delegate to parent if requested 
//  RFC6455 4.2.2 explicitly states "" is not valid here 
//  Write the header 
// cache a proxy so that we don't reuse the facade 
//  Is the client trying to use clear text HTTP? 
//  (.5) Permission to access this class when using a SecurityManager 
//  First step, expand to the current payload. That should   cover most cases. 
//  No versioned entry found for this name. Create   one. 
//  "/*" is the same as "/" 
//  since there is no limit, create a prepared statement pool with an eviction thread;   evictor settings are the same as the connection pool settings. 
/*      * Request line host is an exact match for Host header (no port)      */
//  Not having a particular attribute in the response   is the indication of a getter problem 
//  Store nested <Deployer> element 
//  Propagate current positions to the byte chunk and char chunk 
//  First JSP should be unloaded and replaced by third (second left 
/*      * This is the same as testAcceptProtectedBasic (above), except     * to verify the server follows RFC2617 by treating the auth-scheme     * token as case-insensitive.      */
//  No need for overflow protection here.   Increment can't be more than Integer.MAX_VALUE and once windowSize   goes beyond 2^31-1 an error is triggered. 
//  Set configuration source 
//  0 bytes - too small should fail 
//  Cipher C0A0 
//  tidy up 
//  Return "not authenticated" for this request 
//  doPrivileged() returns the correct type 
//  Exclude sub-packages   Exclude non-class resources   Extract class name 
//  load the container level resource map if it has not been built 
/*  APR_MINOR_VERSION  */
//  Record if the tag element and its body contains any scriptlet. 
//  Invalid IPv4 netmasks 
//  security-constraint/display-name was introduced in Servlet 2.3 
/*  empty slot: +9  */
//  When the Service is an embedded Service, there is no Server 
//  If we reach the other " then stop 
/*      * A CORS request arrives with a "null" origin which is allowed by default.      */
//  Remove trailing '/'. Use while just in case a value ends in /// 
//  The longest response time for a request 
//  empty 
/*      * Partially read chunked input is not swallowed when it is read during     * async processing.      */
//  Store nested resources 
/*      * Logon to access a protected resource using DIGEST authentication,     * which will establish an SSO session.     * Immediately try to access a protected resource in the NonLogin     * webapp, but without sending the SSO session cookie.     * This should be rejected with SC_FORBIDDEN 403 status.      */
//  on ci.apache.org so allow a margin and use 20. 
//  override headers 
//  Pause connectors first 
//  First fall-back. See if current directory is a bin directory   in a normal Tomcat install
//  TODO 
//  Is there a saved principal? 
//  Reached end of stream before SNI could be processed. 
/*  * Helper class to investigate native memory leaks. Needs to be used with tools * to monitor native memory usage. * * Note: Moving the Pool, SSLContext, SSL and BIO creation in/out of the loop *       can help identify where the memory is leaking.  */
// the member was not part of our map. 
//  IPv4 in IPv6   e.g. 0:0:0:0:0:FFFF:127.0.0.1 
//  href is a live property which is handled differently 
//  Container is responsible for first call to onWritePossible(). 
/*              * Append "xmlns" attributes that represent tag libraries              */
//  Default error page 
//  More complex, trying to break the algorithm 
//  Prevent possible memory leak. Ensure Transformer and 
//  with a new array but with the same contents. 
//  Cipher C0A2 
//  DIR_COOKIE_NAME since Tomcat is going to assume DIR is expanded WAR 
//  Read constant pool entries 
//  The default implementation is a no-op. 
/*  JavaCCOptions:TOKEN_EXTENDS=,KEEP_LINE_COLUMN=true,SUPPORT_CLASS_VISIBILITY_PUBLIC=true  */
//  Copy remaining bytes read in HTTP phase to input buffer used by   frame processing 
//  The IP/hostname where the tests are running. The proxy will connect   back to this expecting to find the Tomcat instance created by the   unit test. 
//  The application and platform class loaders are not   instances of URLClassLoader. Use the class path in this   case. 
//  FIXME This send call block the deploy thread, when sender waitForAck is enabled 
//  Force initialization of the random number generator 
//  should get login challenge or timeout status 408 
//  Flush char buffer and remove white spaces 
//  Returns the contents of the module 
/*          * Indicates whether an encoding has been explicitly specified in the         * page's dom.          */
//  Set the new Query if there is one 
//  No exact match. Need to look for template matches. 
// create sync button 
//  No listed roles means no access at all 
//  Create a mapper the first time it is requested 
//  Can't create arrays of generic types 
//  XXX function should accept an encoding parameter & throw this   exception.  Otherwise throw something expected. 
//  Fields used by ApplicationMapping to implement javax.servlet.http.HttpServletMapping 
//  -------------------- Pool setup -------------------- 
//  Cipher C0A1 
//  Add a filter with a name that should be escaped if used in a JMX 
//  Constants 
// header 
//  Propfind type 
/*              * javac error line number cannot be mapped to JSP page             * line number. For example, this is the case if a             * scriptlet is missing a closing brace, which causes             * havoc with the try-catch-finally block that the code             * generator places around all generated code: As a result             * of this, the javac error line numbers will be outside             * the range of begin and end java line numbers that were             * generated for the scriptlet, and therefore cannot be             * mapped to the start line number of the scriptlet in the             * JSP page.             * Include just the javac error info in the error detail.              */
//  No action required for modified directory 
//  This test requires manual intervention to create breakpoints etc. 
//  Default suppression time of 1 day. 
// this is a real error, log it. 
//  Get the annotation from the test case 
//  If a close frame has been received, no further data should   have seen 
//  but not long enough for NonLogin session expiry 
//  No digests, compare directly 
/*      * https://bz.apache.org/bugzilla/show_bug.cgi?id=59317      */
//  the first access attempt should be challenged 
//  Write the scalar instance variables (except Manager) 
//  No '/'. Must be a file name rather than a URL 
//  This is of course only meaningful for bytes 
// default end place is the last index 
//  Payload must be zero or 2+ bytes long 
//  filter-mapping 
//  parse header 
//  Special handling required 
//  Remove the specified attribute   Check for read only attribute 
// content length and date change all the time  no need to index them, or they will churn the table 
/*      * Implementation notes:     * Original Request     *   - async     *     - error in original thread / new thread     *     - error before / after startAsync     *     - error before / after complete / dispatch     * Error page     *   - sync     *   - async     *     - complete     *     - dispatch      */
//  Must be followed by '-' 
//  Replace "//" with "/" 
//  Store nested <Parameter> elements 
/*          * Flag indicating if the default page encoding is being used (only         * applicable with standard syntax).         *         * True if the page does not provide a page directive with a         * 'contentType' attribute (or the 'contentType' attribute doesn't have         * a CHARSET value), the page does not provide a page directive with a         * 'pageEncoding' attribute, and there is no JSP configuration element         * page-encoding whose URL pattern matches the page.          */
// ------------------------------------------------------------------ 
//  Using "-1" as the default value,   in the assumption that it won't be used as the value.   Cannot use null here, because null is an important case   that should be present in the tests. 
// secure port 
//  Take copies as if anything goes wrong originals will be   corrupted. This means original values can be logged. 
/*              * JspServlet must always be preloaded, because its instance is             * used during registerJMX (when registering the JSP             * monitoring mbean)              */
//  yes, this may return null (in case of timeout) which normally   does not occur with take()   but the ThreadPoolExecutor implementation allows this 
//  No pending data   Still handshaking / renegotiation / post-handshake auth pending 
//  Render a className attribute if requested 
//  qualified name 
//  Allow webapp to override JspServlet inherited from global web.xml. 
//  Filters were introduced in Servlet 2.3 
/*      * Expected behaviour for deployment of a DIR without an embedded XML file.     * deployXML  copyXML  unpackWARs      XML  WAR  DIR     *    Y/N       Y/N       Y/N           N    N    Y      */
//  NOOP: No body to read 
// generates a unique Id 
//  -------------------------------------------- HttpSession Private Methods 
// return a future that will wait for the object 
//  -------------------- Hash code  -------------------- 
/*          * Sets the encoding specified in the JSP config element whose URL         * pattern matches the page containing this Root.          */
/*  When running on Java 11, TLSv1.3 is enabled by default. The JSSE         * implementation of TLSv1.3 does not support         * certificateVerification="optional", a setting on which these tests         * depend. Therefore, force these tests to use TLSv1.2 so that they pass         * when running on TLSv1.3.          */
//  should fire 
//  install local 
//  if the text contains any encoded tokens, those tokens will be marked with "=?".  If the   source string doesn't contain that sequent, no decoding is required. 
//  dump the extra 4 bits 
/*      * Parse for a template text string until '<' or "${" or "#{" is encountered,     * recognizing escape sequences "<\%", "\$", and "\#".     *     * Note: JSP uses '\$' as an escape for '$' and '\#' for '#' whereas EL uses     *       '\${' for '${' and '\#{' for '#{'. We are processing JSP template     *       test here so the JSP escapes apply.      */
/*          * @return A unique name for a function mapper.          */
// id 
//  Admin shutdown   Crash shutdown   Cannot connect now   SQL92 disconnect error   Sybase disconnect error   Sybase disconnect error 
//  Skip the webapp loader for now as delegation is enabled 
//  STOPPING 
//  NB In EL null coerces to the empty String 
/*  Our format description string, null if CLF  */
//  = EmptyRoleSemantic.PERMIT;   = TransportGuarantee.NONE;   = new String[0]; 
//  log the first exception. 
//  Expose ssl_session (getId) 
//  attribute does not allow RTexpression. 
//  clear the buffer 
//  Chunk size in hex 
//  Disabling blocking timeouts for this test 
//  Nothing to do. stop() was already called 
//  Default to page 
//  payload 
//  Fire the onClose event 
/*          * ... Which means that right shifting by lastByteShift should be 0.          */
// sessionId - String  recordAll - boolean  size - int 
// uniqueId data  byte[] addr = new byte[XByteBuffer.toInt(xbuf.getBytesDirect(),offset)]; 
//  This field should only be used by Poller#run() 
//  unregister mbeans. 
//  loop on remoteIpHeaderValue to find the first trusted remote ip and to build the proxies chain 
//  Ensure jarIs is closed if there is an exception 
//  will do class for name and set init params 
//  Test passes but GC delays can introduce false failures. 
// } 
//  Not valid for HTTP protocol 
/*                  * Creating a MessageDigest during web application startup                 * initializes the Java Cryptography Architecture. Under certain                 * conditions this starts a Token poller thread with TCCL equal                 * to the web application class loader.                 *                 * Instead we initialize JCA right now.                 *                 * Fixed in Java 9 onwards (from early access build 133)                  */
//  ---------------------------------------------------------- Static Fields 
//  Not start of EL anymore 
//  If already committed, the wrapped response will throw ISE 
//  Using RFC6265 parsing rules, check to see if the header starts with a   version marker. An RFC2109 version marker may be read using RFC6265   parsing rules. If version 1, use RFC2109. Else use RFC6265. 
//  Checking If-Range 
//  Ignore. Won't happen. URLs are of the correct form. 
//  chunk 
//  SSL_OP_PKCS1_CHECK_1 and SSL_OP_PKCS1_CHECK_2 flags are unsupported   in the current version of OpenSSL library. See ssl.h changes in commit   7409d7ad517650db332ae528915a570e4e0ab88b (30 Apr 2011) of OpenSSL. 
//  stats 
//  See if a custom SSLContext has been provided 
//  Escaping another character 
//  Payload - left as zero 
//  Check the results   External WAR and DIR should only be deleted if the test is testing 
//  Just above default maxHttpHeaderSize 
//  Returns ModuleReader 
// create a gui, name it with the member name of this JVM 
//  JspIdConsumer (after context has been set) 
//  All known issues have been fixed in Java 8   https://bugs.openjdk.java.net/browse/JDK-8039751 
// acquire the interceptors to invoke on send ping events 
//  Simple dispatch with invalid target 
//  Retrieve or construct the parameter values array 
//  Prepend the IV to the beginning of the encrypted data 
//  In case an XML file is added to the config base later 
//  Check for a role alias defined in a <security-role-ref> element 
//  --------------------------------------------------  LockInfo Inner Class 
//  Checking If headers 
//  SSO entry will never be cleared if we don't associate the session 
/*      * Check https://jira.springsource.org/browse/SPR-7350 isn't really an issue      */
//  The socket is already registered for write and multiple   registrations will cause problems. 
//  JAR / directory has been skipped 
//  Only recycle copies if we used them 
//  Note this is invalid EL 
//  RFC7233#3.1 Servers must ignore range units they don't understand 
//  @GuardedBy("lock") 
//  it is illegal to call complete   if there is a write in progress 
//  Read protocol 
//  Acquire the ModelMBeanOperationInfo information for 
//  Configure the users in the Realm 
//  instance not created through the instance manager 
//  Add server header 
// add before   prev cannot be null here, warning suppressed 
//  Size is now 3 after using the table 
//  Each list entry has one byte for length followed by a string of   that length 
//  Build the response header 
//  Not a whole lot we can do here as connection is closed   and this is a transaction callback so there is no   way to report the error. 
/*  Add everything else  */
// to do 
//  Pre-calculate so we don't do this for every iteration of the 
//  don't use any preset content-length as it will be wrong after gzipping 
//  Verify there are no Catalina or Tomcat MBeans 
//  Do nothing 
// validate 
//  For a TLS client hello the first byte must be 22 - handshake 
// find the response that was passed into the service method 
//  Array of more than i dimension 
//  Check children 
//  maximum number of concurrent streams 
/*          * Implementation notes         *         * The path parameter passed into this method always starts with '/'.         *         * The path parameter passed into this method may or may not end with a         * '/'. JarFile.getEntry() will return a matching directory entry         * whether or not the name ends in a '/'. However, if the entry is         * requested without the '/' subsequent calls to JarEntry.isDirectory()         * will return false.         *         * Paths in JARs never start with '/'. Leading '/' need to be removed         * before any JarFile.getEntry() call.          */
//  Entry located outside the docBase   Throw an exception to stop the deployment 
//  Extract the port information first, if any 
//  Process the response message 
//  Report our failure to process this custom page 
//  Set the Java compiler to use 
//  URI decoding 
//  Cast to long to avoid issue with Integer.MIN_VALUE 
//  TODO : Process this request body 
//  Taglib URIs must be unique within a web(-fragment).xml 
//  This is a quoted-string 
//  Write the body 
//  Note: Tests for zero/multiple HTTP2-Settings fields can be found below         in the tests for section 3.2.1 
//  Container fragments are always included 
//  cannot use side-effects.  It's removed and added back each time 
//  Class body begins here 
// force a so timeout so that we don't block forever 
//  Build HSTS header value 
// if the message is not primary, we need to retrieve the latest value 
//  Don't use getName() here to prevent an InvalidFileNameException. 
//  this test depends on the execution time of the validation query     specifically, it needs to run for longer than 1 second to pass 
//  Treat as a regular expression 
//  Special handling for form-based logins to deal with the case   where the login form (and therefore the "j_security_check" URI 
//  Unsupported protocol 
//  Add the end message 
//  cycle the selector so this key is active again 
//  Non-switch argument... probably the cipher spec 
//  found first char, now look for a match 
/*      * "-" is not a legal base64 character. The RFC says it must be     * ignored by the decoder. This will scramble the decoded string     * and eventually result in an IllegalArgumentException.      */
//  Add the properties for the socket 
//  Check the number of parameters 
//  Create a wrapped response to use for this request 
//  than keep-alive timeout is used 
//  files are ignored for container provided JARs. 
//  If the cache is null, then either caching is disabled, or we're   still training 
//  Request more data immediately 
//  TODO -- clean this one up. 
//  -------------------- Helpers -------------------- 
//  Cache compilation exception 
//  No match - ignore this injection target 
//  now create a statement, make sure the query timeout is set by the interceptor 
/*          * Encoder for query strings         * https://www.w3.org/TR/html5/forms.html#application/x-www-form-urlencoded-encoding-algorithm         * 0x20 ' ' -> '+'         * 0x2A, 0x2D, 0x2E, 0x30 to 0x39, 0x41 to 0x5A, 0x5F, 0x61 to 0x7A as-is         * '*',  '-',  '.',  '0'  to '9',  'A'  to 'Z',  '_',  'a'  to 'z'         * Also '=' and '&' are not encoded         * Everything else %nn encoded          */
//  Special 2.4 role meaning everyone 
//  ==================== Compile and reload ==================== 
// synch 
//  Store nested <Membership> element 
//  Step 9. Apply merged web.xml to Context 
//  send object data as byte[] 
//  "HTTP/" DIGIT "." DIGIT 
//  Without this test may complete before access log has a chance to log 
//  factor 
//  If it has already failed, don't try and start it 
//  ==== methods accessing taglib information ======= 
//  Fill the  elements. 
//  Navigation menu 
//  %nn decoding will be checked at the point of decoding 
//  doing what they are supposed to. 
//  Instantiate a new wrapper at this point and insert it in the chain 
//  TransformationResult.UNDERFLOW   Ran out of input data - get some more 
//  position within current stream 
//  Write the 2nd request body 
//  No resource injection 
//  Skip multi-release entries 
// update all alive times 
//  SCL2 pretends to be in web.xml, and tries to install a 
//  Handle the case where the filter configuration was changed while 
/*      * Timeout with app processing parameters.      */
//  Initialize the char buffer 
//  opCode is ignored as the transformation is the same for all   opCodes   rsv is ignored as it known to be zero at this point 
// construct a complete 
//  Race condition (file has been deleted) - not an error 
//  RewriteRule Pattern Substitution [Flags] 
//  The tag this attribute belongs to 
//  Wrapper is not mapped for incoming requests if context is paused 
//  Only compare valves in pipeline until we find this valve 
//  login-config 
//  --------------------------------------------------------- Writer Methods 
//  ---------------------------------------------- TaskQueue Inner Class 
//  in has to have one byte more. 
//  CHECKSTYLE IGNORE MagicNumber FOR NEXT 1 LINE 
//  Simple dispatch with multiple path parameters on start and dispatch 
//  Store nested <SSLHostConfig> elements 
//  Check for errors that occurred while printing 
/*      * non-trailing "=" should trigger premature termination of the     * decoder, returning a truncated string that will eventually     * result in an authentication Assert.failure.      */
//  Frame is fully received 
//  Step 5. Process JARs for annotations and   @HandlesTypes matches - only need to process those fragments we   are going to use (remember orderedFragments includes any 
//  Remove the specified lifecycle listener 
//  Wait up to 5s for a message 
//  Odd number of hex characters 
//  Removing parameters 
//  Only set security elements if reauthentication is not required 
//  Primarily used for error reporting 
//  Construct a cookie to be returned to the client 
/*          * Appends the given tag, including its body, to the XML view.          */
//  killing the eviction thread. 
/*      * Tests successful conversions      */
//  -------------------- Info  -------------------- 
//  IBM JDK only understands indefinite lifetime 
//  make the session time out and lose authentication 
//  Handle dynamically removing welcome files 
/*      * Test using list directly as variable.      */
//  To keep any external calling code from messing up the   concurrency. 
//  Now use a settings frame to restore the size of the flow control 
//  nothing to process 
//  Close the doTag method 
//  Store nested <UpgradeProtocol> elements 
//  Configure the defaults and then tweak the JSP servlet settings 
//  the Validator uses this to access the EL ExpressionFactory 
//  There will always be a single collection 
//  Frame is fully received   Send the message if either:   - partial messages are supported 
//  Trailers 
// get the raw url 
//  This one collides with HTTP 1.1   "419 Proxy Reauthentication Required" 
//  Set the flag that indicates that the message is compressed 
//  List always displayed - nothing to do here 
//  SQLWarning getWarnings() throws SQLException; 
//  NO-OP   No factory in org.apache.naming.factory   No reference in org.apache.naming 
//  Binding the resources directory context 
//        ServletInputStream.readLine() does not strip new lines 
// Exceptions 
/*      * Gets the key- or truststore with the specified type, path, and password.      */
//  ------------------------------------------ ServletRequestWrapper Methods 
//  if qsa is specified append the query 
//  Second child is a value expression 
//  Update fields that can change 
//  If that is the case, don't accept new connections 
//  Parse and set Catalina and configuration specific   request parameters 
//  do not make application available if dependency check fails 
//  Add extra sleep to avoid completing inline 
//  Only visit the body when bean is instantiated 
//  -------------------------------------------------------- Context Methods 
//  Get content length 
//  Caller will be the third element 
//  This is definitely the same thread that triggered the write so a   dispatch will be required. 
//  method is invoked 
//  - only do this for newly created locks 
//  Set up our CallbackHandler requests 
//  ------------------------------------------------------ Protected Methods 
//  Check that URL decoding is not done twice 
//  Swallow the unread body packet if present 
//  Construct a RequestDispatcher to process this request 
//  loop forever waiting for work to do 
/*      * Simple request won't fill buffer so timeout will occur in Tomcat internal     * code during response completion.      */
//  Choice in Placement of "::" (4.2.3) 
//  Create a template text node 
//  Connection header. 
//  All other attributes are skipped 
//  Serve a precompressed version of the file if present 
//  Set player to null to prevent NPEs when onMessage events   are processed (from other threads) after onClose has been 
// class CGIRunner 
//  above. 
//  Open a connection 
//  Validate settings before starting 
//  A custom search tree may be better 
//  Try classloader 
//  Has the Connector provided a pre-authenticated Principal that now 
/*          * @param c The target class to which to coerce the given string @param         * s The string value @param attrName The name of the attribute whose         * value is being supplied @param propEditorClass The property editor         * for the given attribute @param isNamedAttribute true if the given         * attribute is a named attribute (that is, specified using the         * jsp:attribute standard action), and false otherwise          */
//  Binary decoder - ignore it 
//  Clean-up after test 
//  Internally all names are lower case 
//  Using a name space for the function is not allowed 
// strValName, strEscapeXmlName & strDefName are two variables' name 
//  Read the second response. No need to sleep, read will block until 
//  This filter is security related to configuration issues always   trigger a failure. 
//  ServletContainerInitializer. 
// then get the size 4 bytes 
//  Has to be the innermost delegate else the prepared statement will   be closed when the pooled connection is passivated. 
//  If there is no systemId, can't try anything else 
//  Define attribute getter and setter methods 
//  Start our subordinate components, if any 
//  Add the per method constraints 
//  BZ 57863 
//  Acquire references to objects we will need to evaluate 
//  ==================== protected utility methods ==================== 
//  Handler needs wrapping and optional decoder to convert it to one of   the types expected by the frame handling code 
//  Server or just unknown 
//  Print the file prolog 
//  Regular write 
//  Since this is quoted, it should retain the space at the end 
//  exception should be thrown only if failOnError == true   or error line will be logged twice 
//  Special headers 
//  Attempt to map javac error line number to line in JSP page 
//  JARs are treated as application provided until the common class 
//  Version 2 (RFC2965) attributes that would need to be added to support v2 cookies   CommentURL   Discard - implied by maxAge <0   Port 
//  Initial set from Oracle JDK 8 u192 
/*      * Used to record the first IOException that occurs during non-blocking     * read/writes that can't be usefully propagated up the stack since there is     * no user code or appropriate container code in the stack to handle it.      */
//  Should have a single collection 
//  Draw message 
//  Volatile 'reload' forces in order write of 'theServlet' and new servlet object 
//  IPv4-safe 
//  Two stars next to each other, skip the first one. 
//  else, return null which will trigger a NPE. 
//  Add this LifecycleListener to our associated component 
//  Connection ID will vary so use a pattern 
//  If the buffer is now full, write it to the network and then write 
//  not available and any in progress async requests will timeout 
//  Configure write when read-only behaviour 
//  Connection will be forcibly closed which will prevent   completion happening at the usual point. Need to trigger   call to onComplete() here. 
//  quote 
//  APR connector so OpenSSL is used for TLS. 
//  post-construct and pre-destroy 
/*      * The combined count of the currently created objects and those in the     * process of being created. Under load, it may exceed {@link #_maxActive}     * if multiple threads try and create a new object at the same time but     * {@link #create()} will ensure that there are never more than     * {@link #_maxActive} objects created at any one time.      */
//  Don't care 
//  For this connector, only the overall connection count is relevant 
//  Check for suffix matching 
/*      * private fields for JSP 2.1      */
//  Copy was successful 
//           stage doesn't have to be. 
//  (arrays will be the same length) 
//  Retrieve the root logger of the parent classloader instead 
//  Import 
//  web-fragment.xml 
// serverSocket.bind(new InetSocketAddress(getBind(), getTcpListenPort())); 
//  Give connections plenty of time to time out 
//  Redirect the request to the bound initial context 
//  Entries with lookup-name and ejb-link are an error (EE.5.5.2 / EE.5.5.3) 
//  Set the header value 
//  to confirm it has expired 
//  set the default if we don't have any overrides 
//  signal to app stream is closing) 
//  determine if source dependent files (e.g. includes using include 
//  3DES requires a compile time switch to enable. Treat as removed. 
//    (because JKS will auto-switch to PKCS12) 
/*      * See https://bz.apache.org/bugzilla/show_bug.cgi?id=58751 comment 1      */
//  This will commit the response 
//  ?jsp_precompile 
/*      * Gets the collection of tag libraries that are associated with a URI     *     * @return Collection of tag libraries that are associated with a URI      */
//  Prepare the output buffer 
//  If the date has changed, switch log files 
// wait for the specified timeout 
//  Collect non-fatal errors 
//  50-5f P-Z   60-6f a-o 
//  Disable compression if requested 
/*      * Assumes valid xml      */
//  DefaultServlet processing 
//  Does not rethrow e. 
//  connections 
//  Very, very unlikely but just in case... 
//  for the cgi command. 
//  Note that the host will not get physically removed 
//  Assume this is a configuration descriptor and deploy it 
//  Generated methods, helper classes, etc. 
//  --------------------------------------------------------------   STATIC SUPPORT METHODS   -------------------------------------------------------------- 
//  Add the dependencies on the TLD to the referencing page 
//  Description is ignored   Display name is ignored   Icons are ignored 
//  Process the request in the adapter 
//  Bugzilla 32269 
//  all CHARs except CTLs or separators are allowed without quoting 
//  This one DOES get an extra/empty definition (with trailing whitespace) 
//  Used to enforce requirements of SRV.8.2 / SRV.14.2.5.1 
// end package TRIBES_MBR_END.length 
//  First example from servlet spec 
//  Binding the object to the appropriate name 
// for PHP 
//  That'll do it. 
//  Parsing the request header 
//  try to get a connection with the supplied userName/password 
//  Reason phrase is optional but mod_jk + httpd 2.x fails with a null 
//  We found a context. Is it the one that has   already been mapped? 
//  Send the body of present 
//  ------------------------------------------------------ Contained Methods 
//  Create an object to hold the parse results and put it on the top 
//  Class is not in org.apache.jsp, therefore, have our   parent load it 
/*  request.getRemoteHost() will default to                     * request.getRemoteAddr() unless enableLookups is set.  */
// ignore message, its an alive message 
/*  Ignore  */
//  Private data 
//  Insert the <servlet> and <servlet-mapping> declarations 
/*      * Peeks at the initial network bytes to determine if the SNI extension is     * present and, if it is, what host name has been requested. Based on the     * provided host name, configure the SSLEngine for this connection.     *     * @return 0 if SNI processing is complete, -1 if an error (other than an     *         IOException) occurred, otherwise it returns a SelectionKey     *         interestOps value     *     * @throws IOException If an I/O error occurs during the SNI processing      */
//  Build a LambdaExpression 
/*              * Gets the name of the tag handler pool for the given custom tag             * and adds it to the list of tag handler pool names unless it is             * already contained in it.              */
//  For Streams, client might only release the minimum so check   against current demand 
//  Swap out all sessions idle longer than maxIdleSwap 
//  64k default write buffer 
//  No flags   Stream 0   Empty payload 
//  Asynchronous IO has significantly lower performance with APR:   - no IO vectoring   - mandatory use of direct buffers forces output buffering 
//  During initialisation, getResource() is called before resourceJARs is 
//  ------------------------------------------------------- Pipeline Methods 
//  Should list GET as an method 
//  Start of a new h16 block 
//  reference is held on the certificate. 
/*      * Test case for {@link Request#login(String, String)} and     * {@link Request#logout()}.      */
//  In memory session count 
//  Null value is the same as removeAttribute() 
//  Process resources unordered for speed. Trades cache   efficiency (younger entries may be evicted before older   ones) for speed since this is on the critical path for   request processing 
//  type is fixed to "JspFragment" and a translation error 
//  Prepare the signature required by Java reflection APIs 
//  Host is using default value. Context may override it. 
//  Common elements and attributes 
//  Clear RMI Targets loaded by this class loader 
/*              * (4) Service request              */
// make sure at least one packet gets out there 
//  When running as a service the call to stop will be on a new   thread so make sure the correct class loader is used to   prevent a range of class not found exceptions. 
//  assert out!=null 
//  Ensure the local port field is populated before using it. 
//  Look for the interface of interest 
//  Set error report valve 
//  This implementation assumes that the base for all resources will be a   file. 
//  -------------------- JMX and Registration  -------------------- 
//  Deploy the application in this WAR file 
//  unreached 
/*      * write a specific response header - x-O(xxx)      */
//  Failed to mutate user credentials. Automatic fail.   Root cause should be logged by mutate() 
//  Copy data 
//  The chunk is longer than the number of bytes remaining   in the body; changing the chunk length to the number   of bytes remaining 
//  80 characters 
//  Get required attributes from user entry 
//  Canonical name for klass 
//  Assume this is pointing to a JAR file within a WAR. Java doesn't   support jar:jar:file:... so switch to Tomcat's war:file:... 
//  Create handlers for the root logger of this classloader 
//  On Windows set the reuseaddr flag after the bind/listen 
//  That's fine - we have reasonable defaults. 
//  check that we did not reach the join timeout 
//  special avpairs first 
//  session.lastAccessedTime via session.endAccess(). 
//  First may be a fragment 
//  Tag-handler specific declarations 
//  this is a hex pair we need to convert back to a single byte. 
//  Trigger automatic deployment 
//  Set the contentLanguage for header output 
//  Remove all path parameters; any needed path parameter should be set   using the request object rather than passing it in the URL 
